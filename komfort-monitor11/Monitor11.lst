 AS V1.42 Beta [Bld 249] - Source File Monitor11.asm - Page 1 - 11/1/2023 14:5:13


    1/       0 :                        ; File Name   :	d:\hobby3\ac1-2010\monitor\komfort-monitor11\MonitorV11.0.BIN
    2/       0 :                        ; Base Address:	0000h Range: 0000h - 1000h Loaded length: 1000h
    3/       0 :                        
    4/       0 :                        
    5/       0 :                        ;AC1-MONITOR USB-KomfortMonitorV11.0 Stand 22.02.2015 [c]HR
    6/       0 :                        ;reass. Volker Pohlers, Neustadt i.H., 31.01.2023
    7/       0 :                        ;letzte Änderung 
    8/       0 :                        
    9/       0 :                        
   10/       0 :                        		page	0
   11/       0 :                        		cpu	z80undoc
   12/       0 :                        
   13/       0 :                        
   14/       0 : ="11"                  mon11ver	equ	"11";	 11; 11a; 11b
   15/       0 :                        
   16/       0 :                        ;------------------------------------------------------------------------------
   17/       0 :                        ; Patches
   18/       0 :                        ;------------------------------------------------------------------------------
   19/       0 :                        
   20/       0 : ="V11.0 "              version		eval	"V11.0 "
   21/       0 : =0H                    p_setcol	eval	false
   22/       0 : =0H                    p_colkdo	eval	false
   23/       0 :                        
   24/       0 : =>FALSE                		if mon11ver == "11a"
   25/       0 :                        ;mon11a		
   26/       0 :                        version		eval	"V11.0a"
   27/       0 :                        p_setcol	eval	true	; Version 110a, Patch in Farb-Kommando
   28/       0 :                        
   29/       0 : =>FALSE                		elseif mon11ver == "11b"
   30/       0 :                        ;mon11b		
   31/       0 :                        version		eval	"V11.0b"
   32/       0 :                        p_setcol	eval	true	; Version 110a, Patch in Farb-Kommando
   33/       0 :                        p_colkdo	eval	true
   34/       0 :                        
   35/       0 : [24]                   		endif
   36/       0 :                        
   37/       0 :                        ;------------------------------------------------------------------------------
   38/       0 :                        ; div. indiv. Einstellungen
   39/       0 :                        ;------------------------------------------------------------------------------
   40/       0 :                        
   41/       0 :                        ; Geometriedaten der verwendeten HD
   42/       0 :                        ; 128MB DOM: 500*16*32
   43/       0 :                        ; voreingestellt ist 256MB SSD
   44/       0 : =3D8H                  vHDCyls		equ	3D8h	; 984 ?? = 1000-16
   45/       0 : =10H                   vHDHeads	equ	16
   46/       0 : =20H                   vHDSectors	equ	32
   47/       0 :                        
   48/       0 :                        ; Cursor-Symbol
   49/       0 : =7FH                   vCursorSymb	equ	7Fh
   50/       0 :                        
   51/       0 :                        ; Kommandos nachladen
   52/       0 : ="USB"                 vKdoProc	equ	"USB"	; USB oder HD
   53/       0 :                        
   54/       0 :                        ; GSB Methode
   55/       0 : ="USB"                 vGSBProc	equ	"USB"	; USB oder HD
   56/       0 :                        
   57/       0 :                        ; Standard-Farben
   58/       0 :                        ;vColor		equ	0Fh		; bg: schwarz, fg: weiß
   59/       0 : =0BH                   vColor		equ	0Bh		; bg: schwarz, fg: hellgelb
   60/       0 :                        
   61/       0 :                        ;------------------------------------------------------------------------------
   62/       0 :                        ;
   63/       0 :                        ;------------------------------------------------------------------------------
   64/       0 :                        
   65/       0 :                        ; Makros
   66/       0 :                        hi              function x, (x>>8) & 0ffh	; High-Byte
   67/       0 :                        lo              function x, x & 0ffh		; Low-Byte
   68/       0 :                        ; bws(zeile 0..31, spalte 0..63) analog print_at
   69/       0 :                        bwsat		function z, s, 1800h-z*64-s
   70/       0 :                        
   71/       0 :                        ; Speicheraufteilung
   72/       0 : =0H                    ROM		equ	0000h
   73/       0 : =1000H                 BWS		equ	1000h		; 2K
   74/       0 : =1800H                 RAM		equ	1800h
   75/       0 :                        ; BWS
   76/       0 : =40H                   COLS		equ	64		; muss 2er-Potenz sein!
   77/       0 : =20H                   LINES		equ	32		; muss 2er-Potenz sein!
   78/       0 :                        
   79/       0 : =17FFH                 BWSANF		equ	BWS+LINES*COLS-1	; Adresse Home (links oben)
   80/       0 : =1000H                 BWSEND		equ	BWS			; letzte Adresse (rechts unten)
   81/       0 :                        
   82/       0 :                        ; I/O
   83/       0 : =0H                    CTC0		equ	0
   84/       0 : =1H                    CTC1		equ	1
   85/       0 : =2H                    CTC2		equ	2
   86/       0 : =3H                    CTC3		equ	3
   87/       0 : =4H                    PIODA		equ	4		; Tastatur
   88/       0 : =5H                    PIODB		equ	5		; Grafik/Ton
   89/       0 : =6H                    PIOCA		equ	6
   90/       0 : =7H                    PIOCB		equ	7
   91/       0 :                        
   92/       0 :                        ;Belegung PIOA
   93/       0 :                        ;B0..B6 ASCII-Code Zeichen
   94/       0 :                        ;B7 Taste gedrückt
   95/       0 :                        
   96/       0 :                        ;Belegung PIOB
   97/       0 :                        ;B0 Ton-Ausgang
   98/       0 :                        ;B1 Joystick ges. A
   99/       0 :                        ;B2 Grafiktaste
  100/       0 :                        ;B3 Bildschim-Mode
  101/       0 :                        ;B4 frei
  102/       0 :                        ;B5 Start/Stop-Schaltung
  103/       0 :                        ;B6 TB-Interface-Ausgang
  104/       0 :                        ;B7 TB-Interface-Eingang
  105/       0 :                        
  106/       0 : =8H                    PIO2DA		equ	8		; b0..b3 V24, b4..b7 IEC
  107/       0 : =9H                    PIO2DB		equ	9
  108/       0 : =0AH                   PIO2CA		equ	0ah
  109/       0 : =0BH                   PIO2CB		equ	0bh
  110/       0 :                        
  111/       0 :                        ; PIO 2 / IOSEL2
  112/       0 :                        ; A0 Eingang Daten RxD 			serielle Schnittstelle	
  113/       0 :                        ; A1 Ausgang Daten TxD 			serielle Schnittstelle
  114/       0 :                        ; A2 Eingang empfangsbereit CTS		serielle Schnittstelle
  115/       0 :                        ; A3 Ausgang sendebereit DTR		serielle Schnittstelle
  116/       0 :                        ; A4 SRQ		IEC - Schnittstelle (in CPM + BASIC)
  117/       0 :                        ; A5 ATN		IEC - Schnittstelle (in CPM + BASIC)
  118/       0 :                        ; A6 CLK		IEC - Schnittstelle (in CPM + BASIC)
  119/       0 :                        ; A7 DATA		IEC - Schnittstelle (in CPM + BASIC)
  120/       0 :                        
  121/       0 :                        ;EPROM auf PIO2-Karte
  122/       0 : =0FH                   PIO2EPROM	equ	0Fh
  123/       0 :                        ; 00 RAM
  124/       0 :                        ; 10 Bank 1 auf 2000h einblenden (ROM 0000-07FF)
  125/       0 :                        ; 20 Bank 2 auf 2000h einblenden (ROM 0800-0FFF)
  126/       0 :                        ; 40 Bank 3 auf 2000h einblenden (ROM 1000-17FF)
  127/       0 :                        ; 60 Bank 4 auf 2000h einblenden (ROM 0800-1FFF)
  128/       0 :                        
  129/       0 : =14H                   modul1		equ	14h		; Konfigurationsbyte für SCCH-Modul 1
  130/       0 :                        ; Port 14h, OUT-Port
  131/       0 :                        ; 	00 - Modul nicht aktiv
  132/       0 :                        ; 	01 - 8K-ROM "PaketX" E000-FFFF
  133/       0 :                        ; 	02 - 16K-ROM "Basic" 2000-5FFF
  134/       0 :                        ; 	x8 - 512K ROM1 aktiv, jeweils 32K-Bänke, x = 0..F Bank0..Bank15, 8000-FFFF
  135/       0 :                        ; 	x9 - 512K ROM2 aktiv, jeweils 32K-Bänke, x = 0..F Bank0..Bank15, 8000-FFFF
  136/       0 :                        
  137/       0 : =0F0H                  BWSPORT:	EQU	0F0H		; rücklesbares BWS Steuerregister
  138/       0 :                        ;Bit 0 Taktumschaltung, 0=2Mhz, 1=4Mhz Takt
  139/       0 :                        ;Bit 1 BWS INVERS, 0=Hintergrund	dunkel,	1=Hintergrund hell
  140/       0 :                        ;Bit 2 Umschaltung FarbRAM <> BWS RAM, 0=BWS RAM, 1=FarbRAM
  141/       0 :                        ;Bit 3 ZG Programmierung	0=Normal BWS, 1=ZG lesen/schreiben
  142/       0 :                        ;Bit 4 ZG Programmierung	A0 Zeilennummer	Zeichen
  143/       0 :                        ;Bit 5 ZG Programmierung	A1 Zeilennummer	Zeichen
  144/       0 :                        ;Bit 6 ZG Programmierung	A2 Zeilennummer	Zeichen
  145/       0 :                        ;Bit 7 frei
  146/       0 :                        ; Aufbau FarbRAM
  147/       0 :                        ; untere 4 Bit VordergrundFarbe	Bit 0 =	Rot
  148/       0 :                        ;				Bit 1 =	Grün
  149/       0 :                        ;				Bit 2 =	Blau
  150/       0 :                        ;				Bit 3 =	Intensiv
  151/       0 :                        ; obere 4Bits Hintergrundfarbe	Bit 4 =	Rot
  152/       0 :                        ;				Bit 5 =	Grün
  153/       0 :                        ;				Bit 6 =	Blau
  154/       0 :                        ;				Bit 7 =	Intensiv
  155/       0 :                        
  156/       0 :                        ;PIO3 f. VDIP/USB
  157/       0 :                        ;VDIP1 oder VDIP2 auf der Basisadresse FCh (AC1) bzw. DCh (LLC2).
  158/       0 : =0FCH                  PIO3A	EQU	0FCh	; Daten A (Datenport, bidirektional)
  159/       0 : =0FDH                  PIO3B	EQU	0FDh	; Daten B (Steuersignale, Bitbetrieb)
  160/       0 : =0FEH                  PIO3AS	EQU	0FEh	; Steuer A
  161/       0 : =0FFH                  PIO3BS	EQU	0FFh	; Steuer B
  162/       0 :                        
  163/       0 :                        ;GIDE
  164/       0 : =80H                   GIDE	equ	80h		; base address of GIDE board
  165/       0 : =86H                   IdeDOR	equ	GIDE+6		; Digital Output Register
  166/       0 : =88H                   IdeDat	equ	GIDE+8		; Data Register
  167/       0 : =89H                   IdeErr	equ	GIDE+9		; Error Register
  168/       0 : =89H                   IdeWrPc	equ	IdeErr		; Write Precomp REgister
  169/       0 : =8AH                   IdeSCnt	equ	GIDE+0Ah	; Sector Count
  170/       0 : =8BH                   IdeSNum	equ	GIDE+0Bh	; Sector Number
  171/       0 : =8CH                   IdeCLo	equ	GIDE+0Ch	; Cylinder Low
  172/       0 : =8DH                   IdeCHi	equ	GIDE+0Dh	; Cylinder High
  173/       0 : =8EH                   IdeSDH	equ	GIDE+0Eh	; Drive and Head
  174/       0 : =8FH                   IdeCmd	equ	GIDE+0Fh	; Command
  175/       0 : =8FH                   IdeStat	equ	IdeCmd		; Status
  176/       0 :                        ; Commands for IDE hard disk drives:
  177/       0 : =20H                   CmdRd	equ	20h		; Read Sector
  178/       0 : =30H                   CmdWr	equ	30h		; Write Sector
  179/       0 : =91H                   CmdInit	equ	91h		; Initialize Drive Params
  180/       0 :                        
  181/       0 :                        ;
  182/       0 : =28H                   NAMELEN		equ	40		; max. Länge des Dateinamens bei LOAD/SAVE
  183/       0 :                        ;KDOANF		equ	0400h		; Beginn f. Kdo-Suche
  184/       0 :                        ;RAMEND		equ	0BFFFh		; Ende f. Kdo-Suche, auf RAM beschränkt
  185/       0 : =10H                   KDOANF		equ	00010h		; Beginn f. Kdo-Suche
  186/       0 : =20H                   KDOANFH		equ	00020h		; Beginn f. Kdo-Suche im Help-Kommando
  187/       0 : =0FFFFH                RAMEND		equ	0FFFFh		; Ende f. Kdo-Suche, auf RAM beschränkt
  188/       0 :                        
  189/       0 :                        
  190/       0 :                        ; Zeitkonstanten (bei 2 MHz-Takt)
  191/       0 : =31H                   ZK1    EQU  49        ;Laenge 1.Halbwelle
  192/       0 : =2EH                   ZK2    EQU  46        ;Laenge 2.Halbwelle
  193/       0 : =3FH                   ZKR    EQU  (ZK1+ZK2)*2/3
  194/       0 :                        
  195/       0 :                        ;------------------------------------------------------------------------------
  196/       0 :                        ; Reset
  197/       0 :                        ;------------------------------------------------------------------------------
  198/       0 :                        
  199/       0 :                        		org	ROM
  200/       0 :                        
  201/       0 : F3                     init:		di
  202/       1 : 31 56 18               		ld	sp, SYSSK	; Stack
  203/       4 : ED 5E                  		im	2
  204/       6 : 18 03                  		jr	init1
  205/       8 :                        
  206/       8 :                        		org	8
  207/       8 :                        ; RST 8: Eingabekanal, normal Tastatur
  208/       8 : C3 02 18               inch:		jp	jp_rst08
  209/       B :                        
  210/       B : 11 1C 18               init1:		ld	de, warmcod	; warmstart-Erkennung
  211/       E : 18 0B                  		jr	init2
  212/      10 :                        
  213/      10 :                        		org	10h
  214/      10 :                        ; RST 10: Ausgabekanal,	normal Bildschirm
  215/      10 : C3 05 18               outch:		jp	jp_rst10
  216/      13 :                        
  217/      13 :                        ; Leer-Kommando
  218/      13 : 00 09 20 0D            		db 0,9,' ',0Dh
  219/      17 : C9                     		ret
  220/      18 :                        		org	18h
  221/      18 :                        ; RST 18: PRNST
  222/      18 : C3 08 18               prnst:		jp	jp_rst18
  223/      1B :                        
  224/      1B : 21 D8 0A               init2:		ld	hl, TABIO
  225/      1E : 18 1B                  		jr	init3
  226/      20 :                        
  227/      20 :                        		org	20h
  228/      20 :                        ; RST 20: PUT
  229/      20 : C3 0B 18               PUT:		jp	jp_rst20
  230/      23 :                        
  231/      23 :                        
  232/      23 :                        ; Leer-Kommando
  233/      23 : 00 09 0D 0D            		db 0,9,0Dh,0Dh
  234/      27 : C9                     		ret
  235/      28 :                        
  236/      28 :                        		org	28h
  237/      28 :                        ; RST 28: GET
  238/      28 : C3 0E 18               GET:		jp	jp_rst28
  239/      2B :                        
  240/      2B : E5                     routch:		push	hl
  241/      2C : D5                     		push	de
  242/      2D : C3 00 03               		jp	co0
  243/      30 :                        
  244/      30 :                        
  245/      30 :                        		org	30h
  246/      30 :                        ; RST 30: outhl
  247/      30 : C3 11 18               j_outhl:	jp	jp_rst30
  248/      33 :                        
  249/      33 :                        ; Ausgabe über Bildschirm
  250/      33 : F5                     co:		push	af
  251/      34 : 18 F5                  		jr	routch
  252/      36 :                        
  253/      36 : D7 03                  hd_cylinder:	dw vHDCyls-1		; Geometriedaten der verwendeten HD. Zylinder-1
  254/      38 :                        
  255/      38 :                        		org	38h
  256/      38 :                        ; RST 38:		
  257/      38 : C3 14 18               sub_38:		jp	jp_rst38
  258/      3B :                        
  259/      3B :                        ;------------------------------------------------------------------------------
  260/      3B :                        ; Kaltstart
  261/      3B :                        ; Sprungverteiler initialisieren, RAM löschen
  262/      3B :                        ;------------------------------------------------------------------------------
  263/      3B :                        
  264/      3B : 3E 02                  init3:		ld	a, 2
  265/      3D : ED 47                  		ld	i, a
  266/      3F : 06 11                  		ld	b, 11h
  267/      41 : 4E                     init4:		ld	c, (hl)
  268/      42 : 23                     		inc	hl
  269/      43 : ED A3                  		outi
  270/      45 : 20 FA                  		jr	nz, init4
  271/      47 : CD 7B 0A               		call	tstsch		; Test auf Warmstart
  272/      4A :                        ; Sprungverteiler initialisieren
  273/      4A : 01 20 00               		ld	bc, 20h	; ' '   ; lo(sv_rst)      ; == Laenge sv_rst-Bereich
  274/      4D : 69                     		ld	l, c
  275/      4E : 26 02                  		ld	h, 2		; hl=220 = sv_rst
  276/      50 : 5C                     		ld	e, h		; de=1802
  277/      51 : ED B0                  		ldir
  278/      53 : 28 03                  		jr	z, init5	; wenn Warmstart
  279/      55 : CD 85 0F               		call	erase		; sonst	RAM loeschen
  280/      58 : DF                     init5:		rst	prnst		; Ausgabe String
  281/      59 : 8C                     		db  8Ch			; CLS
  282/      5A : CD C8 0F               		call	setcolor	; Farb-RAM loeschen
  283/      5D : CD CE 07               		call	init_gsb
  284/      60 : 18 0C                  		jr	init8
  285/      62 :                        
  286/      62 : 48 52                  		db "HR"			; ID Hänsel, Ralph
  287/      64 :                        
  288/      64 : 0F                     hd_heads:	db vHDHeads-1		; Geometriedaten der verwendeten HD. Koepfe -1
  289/      65 : 20                     hd_sectors:	db vHDSectors		; Geometriedaten der verwendeten HD. Sektoren
  290/      66 :                        
  291/      66 :                        ;------------------------------------------------------------------------------
  292/      66 :                        ; MNI-Befehl, Programmunterbrechnung, Breakpoint
  293/      66 :                        ;------------------------------------------------------------------------------
  294/      66 :                        
  295/      66 :                        		org	66h
  296/      66 : C3 17 18               		jp	nmi
  297/      69 :                        
  298/      69 :                        ; zu tbsave
  299/      69 : 2E 5A 38 30 22         aZ80:		db ".Z80\""
  300/      6E :                        
  301/      6E :                        		org	006Eh	; fixe Adresse
  302/      6E :                        ; EINSPRUNGPUNKT Rueckkehr aus Programmpaket X
  303/      6E : AF                     init8:		xor	a
  304/      6F : D3 14                  		out	(modul1), a	; Modul1 disablen
  305/      71 :                        
  306/      71 :                        		org	0071h	; fixe Adresse
  307/      71 :                        ; EINSPRUNGPUNKT Rueckkehr aus Grafik-Sound-Basic 3.2
  308/      71 : DF                     		rst	prnst		; Ausgabe String
  309/      72 : 0C 0D 0F 0F 2A 20 41   		db 0Ch,0Dh,0Fh,0Fh,"* AC1 USB-KomfortMonitor ", version, "*"
            79 : 43 31 20 55 53 42 2D
            80 : 4B 6F 6D 66 6F 72 74
            87 : 4D 6F 6E 69 74 6F 72
            8E : 20 56 31 31 2E 30 20
            95 : 2A                  
  310/      96 : 0D 8D                  		db  0Dh, 8Dh
  311/      98 : C3 5B 02               		jp	GETCO1
  312/      9B :                        
  313/      9B :                        ;------------------------------------------------------------------------------
  314/      9B :                        ; Tasten-Piep
  315/      9B :                        ;------------------------------------------------------------------------------
  316/      9B :                        		
  317/      9B : 71                     PIEP:		ld	(hl), c
  318/      9C : 01 34 A0               		ld	bc, 0A034h
  319/      9F : CD 87 02               		call	UPTON
  320/      A2 : C1                     ENDE8:		pop	bc
  321/      A3 : E1                     		pop	hl
  322/      A4 : C9                     		ret
  323/      A5 :                        
  324/      A5 :                        ;------------------------------------------------------------------------------
  325/      A5 :                        ; Einsprungpunkt fuer RST 08H
  326/      A5 :                        ; Eingabekanal auswerten
  327/      A5 :                        ; iobyt
  328/      A5 :                        ; Eingabe: b0 Tastatur, b1 V24 (Rs 232c), b2 Reserve, b3 User
  329/      A5 :                        ;------------------------------------------------------------------------------
  330/      A5 :                        
  331/      A5 : E5                     rinch:		push	hl		; UP "Eingabekanal"
  332/      A6 : C5                     		push	bc
  333/      A7 : 3A 21 18               		ld	a, (IOBYT)	; Ein/Ausgabebyte
  334/      AA : 0F                     		rrca			; b0 gesetzt?
  335/      AB : 30 29                  		jr	nc, NOTAST	; nein, anderes Eingabegeraet (keine Tastatur)
  336/      AD :                        
  337/      AD :                        ; Eingabe von Tastatur
  338/      AD : 21 57 18               		ld	hl, repeat	; Hilfsregister	Repetierfunktion Tastatur
  339/      B0 : 46                     		ld	b, (hl)
  340/      B1 : 36 18                  		ld	(hl), 18h	; Repeat-Zeit erstmalig lange
  341/      B3 : CD 97 02               rinch1:		call	UPTAST
  342/      B6 : 28 05                  		jr	z, rinch2	; Taste losgelassen
  343/      B8 : 05                     		dec	b
  344/      B9 : 20 F8                  		jr	nz, rinch1
  345/      BB : 36 01                  		ld	(hl), 1		; kurze Repeatzeit für Wiederholung
  346/      BD : 2A 00 18               rinch2:		ld	hl, (cupos)	; Zwischenspeicher Kursor
  347/      C0 : 4E                     		ld	c, (hl)		; Zeichen merken
  348/      C1 : 36 7F                  rinch3:		ld	(hl), vCursorSymb	; Cursorsymbol anzeigen
  349/      C3 : CD 97 02               rinch4:		call	UPTAST
  350/      C6 :                        ; Taste gedrückt? dann Piep und ENDE8
  351/      C6 : 20 D3                  		jr	nz, PIEP	; Tasten-Piep
  352/      C8 :                        ; sonst kurz warten		
  353/      C8 : 3E 48                  		ld	a, 48h
  354/      CA : 3D                     rinch5:		dec	a
  355/      CB : 20 FD                  		jr	nz, rinch5
  356/      CD : 10 F4                  		djnz	rinch4
  357/      CF :                        ; und Cursor toggeln
  358/      CF : 79                     		ld	a, c
  359/      D0 : BE                     		cp	(hl)		; ist Zeichen zu sehen?
  360/      D1 : 28 EE                  		jr	z, rinch3	; dann Cursorsymbol anzeigen
  361/      D3 : 71                     		ld	(hl), c		; sonst Zeichen wieder anzeigen
  362/      D4 : 18 ED                  		jr	rinch4
  363/      D6 :                        
  364/      D6 :                        ;------------------------------------------------------------------------------
  365/      D6 :                        ; IOBYT Verteiler Eingabe
  366/      D6 :                        ;------------------------------------------------------------------------------
  367/      D6 :                        
  368/      D6 : 0F                     NOTAST:		rrca			; IOBYT b1 gesetzt?
  369/      D7 : DA 4E 0E               		jp	c, v24in0	; ja, -> v24
  370/      DA : 0F                     		rrca			; IOBYT b2 gesetzt?
  371/      DB : DC FF FF               		call	c, 0FFFFh	; ja -> Reserve
  372/      DE : 0F                     		rrca			; IOBYT b3 gesetzt?	
  373/      DF : DC F0 18               		call	c, unk_18F0	; ja -> USER-Eingabe
  374/      E2 : 18 BE                  		jr	ENDE8
  375/      E4 :                        
  376/      E4 :                        ;------------------------------------------------------------------------------
  377/      E4 :                        ; routch
  378/      E4 :                        ; Ausgabe: Druckersteuerung, IO-Byte Verteiler
  379/      E4 :                        ; Ausgabe: b4 Bildschirm, b5 V24 (RS 232c), b6 Reserve, b7 User
  380/      E4 :                        ;------------------------------------------------------------------------------
  381/      E4 :                        
  382/      E4 : E5                     routch0:	push	hl
  383/      E5 : F5                     		push	af
  384/      E6 : 21 20 18               		ld	hl, kdov24
  385/      E9 : CB 7E                  		bit	7, (hl)		; Ausgabe 8 Datenbit?
  386/      EB : 20 02                  		jr	nz, routch2	; nein
  387/      ED : E6 7F                  		and	7Fh		; dann Bit 7 rücksetzen
  388/      EF : 23                     routch2:	inc	hl		; HL=IOBYT
  389/      F0 :                        		;
  390/      F0 : FE 18                  		cp	18h		; Drucker ein, V 24-Schnittstelle
  391/      F2 : 28 07                  		jr	z, routch3
  392/      F4 : FE 19                  		cp	19h		; Ein-/Ausgabe normal, Drucker aus
  393/      F6 : 20 07                  		jr	nz, routch4
  394/      F8 :                        ; Drucker aus		
  395/      F8 : 36 11                  		ld	(hl), 11h	; setze Std-I/O-Byte
  396/      FA : 21                     		db  21h			; LD HL,xxx; überspringe nachfolgenden Befehl
  397/      FB :                        ; Drucker ein
  398/      FB : CB EE                  routch3:	set	5, (hl)		; setze V 24 - Ausgabe
  399/      FD : 18 14                  		jr	routch5
  400/      FF :                        		
  401/      FF :                        ; IOBYT	Verteiler Ausgabe
  402/      FF : CB 66                  routch4:	bit	4, (hl)
  403/     101 : C4 33 00               		call	nz, co		; IOBYT B4 -> BWS
  404/     104 : CB 6E                  		bit	5, (hl)
  405/     106 : C4 F9 0D               		call	nz, v24out	; IOBYT B5 -> V 24 - Ausgabe
  406/     109 : CB 76                  		bit	6, (hl)
  407/     10B : C4 FF FF               		call	nz, 0FFFFh	; IOBYT B6 -> Reserve
  408/     10E : CB 7E                  		bit	7, (hl)
  409/     110 : C4 F3 18               		call	nz, unk_18F3	; IOBYT B7 -> User-Ausgabe
  410/     113 : F1                     routch5:	pop	af
  411/     114 : E1                     		pop	hl
  412/     115 : C9                     		ret
  413/     116 :                        
  414/     116 :                        ;------------------------------------------------------------------------------
  415/     116 :                        ; Funktion für Sprungverteiler 7E8h
  416/     116 :                        ;------------------------------------------------------------------------------
  417/     116 :                        
  418/     116 : CD 97 02               TASTE:		call	UPTAST
  419/     119 : C8                     		ret	z
  420/     11A : CB FF                  		set	7, a
  421/     11C : C9                     		ret
  422/     11D :                        
  423/     11D :                        ;------------------------------------------------------------------------------
  424/     11D :                        ; ca. 30 ms warten
  425/     11D :                        ;------------------------------------------------------------------------------
  426/     11D :                        
  427/     11D : C5                     MS30:		push	bc
  428/     11E : 01 03 09               		ld	bc, 903h	; Zeitkonstante	fuer 30ms, ; B = 9, C = 3
  429/     121 : 0B                     ms301:		dec	bc
  430/     122 : 78                     		ld	a, b
  431/     123 : B1                     		or	c
  432/     124 : 20 FB                  		jr	nz, ms301
  433/     126 : C1                     		pop	bc
  434/     127 : C9                     		ret
  435/     128 :                        
  436/     128 :                        ;------------------------------------------------------------------------------
  437/     128 :                        ; Zeile	eingeben
  438/     128 :                        ; liest eine Zeile, die mit cr abgeschlossen wird, auf dem Schirm ein und
  439/     128 :                        ; legt den Anfang der Zeile in SOIL ab
  440/     128 :                        ; kein Register wird zerstört
  441/     128 :                        ;------------------------------------------------------------------------------
  442/     128 :                        
  443/     128 : E5                     INLINE:		push	hl
  444/     129 : F5                     		push	af
  445/     12A : DF                     		rst	prnst		; Ausgabe String
  446/     12B : 20 23 A0               aA:		db " #",' '+80h		; Prompt
  447/     12E : 00                     		nop
  448/     12F : CF                     inlin1:		rst	inch		; inch; Zeicheneingabe
  449/     130 : 2A 00 18               		ld	hl, (cupos)	; Zwischenspeicher Kursor
  450/     133 : D7                     		rst	outch		; Zeichenausgabe
  451/     134 : FE 0D                  		cp	0Dh		; Enter?
  452/     136 : 20 F7                  		jr	nz, inlin1	; nein --> weiter eingeben
  453/     138 :                        ; Zeilenanfang ermitteln
  454/     138 : 3E 23                  		ld	a, '#'
  455/     13A : 23                     inlin2:		inc	hl		; ein zeichen zurück
  456/     13B : BE                     		cp	(hl)		; zeilenanfang?
  457/     13C : 20 FC                  		jr	nz, inlin2	; nein
  458/     13E : 2B                     		dec	hl		; das '#'
  459/     13F : 2B                     		dec	hl		; Leerzeichen davor
  460/     140 : 22 1A 18               		ld	(soil),	hl	; erstes Zeichen der Zeile
  461/     143 : F1                     		pop	af
  462/     144 : E1                     		pop	hl
  463/     145 : C9                     		ret
  464/     146 :                        
  465/     146 :                        ;------------------------------------------------------------------------------
  466/     146 :                        ; fuehrende Leerzeichen ueberlesen
  467/     146 :                        ; letzen vier Zeichen als Hexzahl konvertieren
  468/     146 :                        ; und in DATA ablegen
  469/     146 :                        ;------------------------------------------------------------------------------
  470/     146 :                        
  471/     146 : 1A                     konvx:		ld	a, (de)		; UP - Routine zu InHex
  472/     147 : FE 20                  		cp	' '		; Leerzeichen
  473/     149 : 1B                     		dec	de
  474/     14A : 28 FA                  		jr	z, konvx	; überlesen
  475/     14C :                        ;
  476/     14C : 13                     		inc	de		; erstes Zeichen
  477/     14D : AF                     		xor	a
  478/     14E : 21 58 18               		ld	hl, data	; Hilfsregister
  479/     151 : 77                     		ld	(hl), a
  480/     152 : 23                     		inc	hl
  481/     153 : 77                     		ld	(hl), a
  482/     154 : 23                     		inc	hl
  483/     155 : 77                     		ld	(hl), a		; data=0
  484/     156 : 1A                     konvx2:		ld	a, (de)
  485/     157 : 2B                     		dec	hl
  486/     158 : 2B                     		dec	hl
  487/     159 : D6 30                  		sub	30h ; '0'	; Zeichen<"0"?
  488/     15B : F8                     		ret	m
  489/     15C : FE 0A                  		cp	0Ah		; Zeichen<="9"?
  490/     15E : 38 08                  		jr	c, konvx3
  491/     160 : D6 07                  		sub	7
  492/     162 : FE 0A                  		cp	0Ah		; Zeichen<"A"?
  493/     164 : F8                     		ret	m
  494/     165 : FE 10                  		cp	10h		; Zeichen>"F"?
  495/     167 : F0                     		ret	p
  496/     168 : 1B                     konvx3:		dec	de
  497/     169 : 34                     		inc	(hl)
  498/     16A : 23                     		inc	hl
  499/     16B : ED 6F                  		rld			; Hexziffer eintragen
  500/     16D : 23                     		inc	hl
  501/     16E : ED 6F                  		rld			; nächste Ziffer
  502/     170 : 18 E4                  		jr	konvx2
  503/     172 :                        
  504/     172 :                        ;------------------------------------------------------------------------------
  505/     172 :                        ; wandelt eine maximal vierstellige in ASCII-Zeichen angegebene Zahl
  506/     172 :                        ; ab (DE) abwärts in deren hexadezimalen Wert um, der dann in HL steht.
  507/     172 :                        ; DE wird entsprechend dekrementiert, der Akku wird zerstört
  508/     172 :                        ;------------------------------------------------------------------------------
  509/     172 :                        
  510/     172 : C5                     INHEX:		push	bc
  511/     173 : F5                     		push	af
  512/     174 : CD 46 01               		call	konvx		; Konvertierung
  513/     177 : 23                     		inc	hl
  514/     178 : 44                     		ld	b, h		; BC=HL=DATA+1
  515/     179 : 4D                     		ld	c, l
  516/     17A : 6E                     		ld	l, (hl)		; unteres Byte
  517/     17B : 03                     		inc	bc
  518/     17C : 0A                     		ld	a, (bc)
  519/     17D : 67                     		ld	h, a		; oberes Byte
  520/     17E : C1                     		pop	bc
  521/     17F : B5                     		or	l		; Z-Flag setzen
  522/     180 : 78                     		ld	a, b
  523/     181 : C1                     		pop	bc
  524/     182 : C9                     		ret
  525/     183 :                        
  526/     183 :                        ;------------------------------------------------------------------------------
  527/     183 :                        ; Ausgabe (A) hexadezimal
  528/     183 :                        ; gibt den Akku als zweistellige Hexzahl auf dem Schirm aus,
  529/     183 :                        ; kein Register wird zerstört
  530/     183 :                        ;------------------------------------------------------------------------------
  531/     183 :                        
  532/     183 : F5                     OUTHEX:		push	af
  533/     184 : 1F                     		rra
  534/     185 : 1F                     		rra
  535/     186 : 1F                     		rra
  536/     187 : 1F                     		rra
  537/     188 : CD 8C 01               		call	OUTHEX1		; obere Tetrade ausgeben
  538/     18B : F1                     		pop	af		; und die untere
  539/     18C : F5                     OUTHEX1:	push	af
  540/     18D : E6 0F                  		and	0Fh
  541/     18F : C6 30                  		add	a, '0'		; Konvertierung --> ASCII
  542/     191 : FE 3A                  		cp	'9'+1		; Ziffer "A" ... "F"?
  543/     193 : 38 02                  		jr	c, OUTHEX2	; nein
  544/     195 : C6 07                  		add	a, 7		; sonst Korrektur
  545/     197 : D7                     OUTHEX2:	rst	outch		; OUTCH ; und Ausgabe
  546/     198 : F1                     		pop	af
  547/     199 : C9                     		ret
  548/     19A :                        
  549/     19A :                        ;------------------------------------------------------------------------------
  550/     19A :                        ; Ausgabe HL hexadezimal
  551/     19A :                        ; gibt das HL-Register als vierstellige Hexzahl auf dem Schirm aus,
  552/     19A :                        ; kein Register wird zerstört
  553/     19A :                        ;------------------------------------------------------------------------------
  554/     19A :                        
  555/     19A : F5                     OUTHL:		push	af
  556/     19B : 7C                     		ld	a, h
  557/     19C : CD 83 01               		call	OUTHEX		; Ausgabe A hexadezimal
  558/     19F : 7D                     		ld	a, l
  559/     1A0 : CD 83 01               		call	OUTHEX		; Ausgabe A hexadezimal
  560/     1A3 : F1                     		pop	af
  561/     1A4 : C9                     		ret
  562/     1A5 :                        
  563/     1A5 :                        ;------------------------------------------------------------------------------
  564/     1A5 :                        ; Up zu xxx
  565/     1A5 :                        ;------------------------------------------------------------------------------
  566/     1A5 :                        
  567/     1A5 : E5                     sub_1A5:	push	hl
  568/     1A6 : 2A 1A 18               		ld	hl, (soil)
  569/     1A9 : 7D                     		ld	a, l
  570/     1AA : B4                     		or	h
  571/     1AB : E1                     		pop	hl
  572/     1AC : 3A 8A 18               		ld	a, (hs_filetyp)	; Basic-Mode
  573/     1AF : C9                     		ret
  574/     1B0 :                        
  575/     1B0 : FF                     		db 0FFh
  576/     1B1 : FF                     		db 0FFh
  577/     1B2 : FF                     		db 0FFh
  578/     1B3 : FF                     		db 0FFh
  579/     1B4 : FF                     		db 0FFh
  580/     1B5 :                        
  581/     1B5 :                        ;------------------------------------------------------------------------------
  582/     1B5 :                        ; Kommandos nachladen
  583/     1B5 :                        ; Dateiname f. Nachladbare Kommandos
  584/     1B5 :                        ; MO11A_46.Z80
  585/     1B5 :                        ;   | | ^^--------- ASCII-Code des Kommandobuchstabens
  586/     1B5 :                        ;   | +------------ Gerätekenner (A=AC1, L=LLC2)
  587/     1B5 :                        ;   +-------------- Monitorversion
  588/     1B5 :                        ;------------------------------------------------------------------------------
  589/     1B5 :                        
  590/     1B5 : 21 E2 02               kdo5:		ld	hl, aFNERW	; Dateiname f. Nachladbare Kommandos
  591/     1B8 : 11 B4 18               		ld	de, filenambuf	; in hsbuf kopieren
  592/     1BB : 01 0E 00               		ld	bc, 14		; Länge Dateiname (mit "")
  593/     1BE : ED B0                  		ldir
  594/     1C0 : ED 43 5B 18            		ld	(ARG1),	bc	; 0
  595/     1C4 :                        		;
  596/     1C4 : 2A 1A 18               		ld	hl, (soil)
  597/     1C7 : 7E                     		ld	a, (hl)		; Kommandobuchstabe
  598/     1C8 : CD C8 0E               		call	tohex		; als Hex-Ascii
  599/     1CB : 22 B9 18               		ld	(filenambuf+5), hl	; in Dateiname eintragen
  600/     1CE : CD B5 04               		call	outchoff	; outch deaktivieren
  601/     1D1 : 3E 50                  		ld	a, 'P'		; Typ Programm
  602/     1D3 : =>TRUE                 		if vKdoProc == "USB"
  603/     1D3 : CD DB 04               		call	ld_usb		; Datei laden, Nachladen via USB 
  604/     1D6 : =>FALSE                		else
  605/     1D6 :                        		call	ld_hd		; Datei laden, Nachladen via HD (lt. Doku 9C4H, das ist falsch!)
  606/     1D6 : [602]                  		endif
  607/     1D6 : CD B9 04               		call	outchon		; outch aktivieren
  608/     1D9 : 28 06                  		jr	z, kdo1a	; wenn geladen, kdo im RAM suchen und ausführen
  609/     1DB : DF                     		rst	prnst		; Ausgabe String
  610/     1DC : 20 BF                  		db ' ','?'+80h		; Fehler (Kommando-Datei nicht geladen)
  611/     1DE :                        
  612/     1DE :                        ;------------------------------------------------------------------------------
  613/     1DE :                        ; Kommandoschleife
  614/     1DE :                        ;
  615/     1DE :                        ; Suchen des Kommandos
  616/     1DE :                        ; wenn ':' folgt, dann alte Parameter nehmen
  617/     1DE :                        ; sonst 3 Parameter einlesen und in ARG1..ARG3 ablegen
  618/     1DE :                        ; bei Kdo-Start gilt
  619/     1DE :                        ; 	BC = Return-Adr
  620/     1DE :                        ; 	DE zeigt auf ':' oder auf Leezeichen hinter letzem Parameter
  621/     1DE :                        ; 	HL = Kdo-Adr
  622/     1DE :                        ; Kommandorahmen: 00,09,Kdo-Zeichen,0D
  623/     1DE :                        ;------------------------------------------------------------------------------
  624/     1DE :                        ;Eingang Kommandomodus
  625/     1DE :                        
  626/     1DE : CD 28 01               kdo1:		call	INLINE		; Zeile eingeben
  627/     1E1 : 21 10 00               kdo1a:		ld	hl, KDOANF	; erste Adr, aber der Kdo zu suchen sind
  628/     1E4 : 01 F0 FF               		ld	bc, RAMEND-KDOANF+1	; Anzahl (RAM-Ende-Startpos.)	; 0FFF0h
  629/     1E7 : AF                     kdo2:		xor	a		; 00
  630/     1E8 : ED B1                  		cpir			; suche 00
  631/     1EA : E2 B5 01               		jp	po, kdo5	; Kommando nachladen
  632/     1ED : 3E 09                  		ld	a, 9		; 09
  633/     1EF : BE                     		cp	(hl)		; folgt 09?
  634/     1F0 : 20 F5                  		jr	nz, kdo2
  635/     1F2 : 23                     		inc	hl
  636/     1F3 : ED 5B 1A 18            		ld	de, (soil)	; Zwischenspeicher "Inline"
  637/     1F7 : 1A                     		ld	a, (de)		; KDO
  638/     1F8 : BE                     		cp	(hl)		; folgt Kommandbuchstabe?
  639/     1F9 : 20 EC                  		jr	nz, kdo2
  640/     1FB : 23                     		inc	hl
  641/     1FC : 3E 0D                  		ld	a, 0Dh		; 0d
  642/     1FE : BE                     		cp	(hl)		; folgt 0D?
  643/     1FF : 20 E6                  		jr	nz, kdo2	; falsches Kdo
  644/     201 :                        ;
  645/     201 : 01 DE 01               		ld	bc, kdo1	; Returnadr. auf Stack
  646/     204 : C5                     		push	bc
  647/     205 : 23                     		inc	hl
  648/     206 : E5                     		push	hl
  649/     207 :                        ; Parameter
  650/     207 : 1B                     		dec	de
  651/     208 : CD 72 01               		call	INHEX		; 1. Argument
  652/     20B : 1A                     		ld	a, (de)
  653/     20C : FE 3A                  		cp	':'		; die alten Werte nehmen ?
  654/     20E : 28 0F                  		jr	z, kdo4
  655/     210 : 22 5B 18               		ld	(ARG1),	hl	; Argument 1
  656/     213 : CD 72 01               		call	INHEX
  657/     216 : 22 5D 18               		ld	(ARG2),	hl	; Argument 2
  658/     219 : CD 72 01               		call	INHEX
  659/     21C : 22 5F 18               		ld	(ARG3),	hl	; Argument 3
  660/     21F : C9                     kdo4:		ret
  661/     220 :                        
  662/     220 :                        ;------------------------------------------------------------------------------
  663/     220 :                        ; init. Sprungverteiler für RST-Aufrufe, NMI und Init.
  664/     220 :                        ; RST xx springt in den RAM. von dort geht es normalerweise zu den Monitor-
  665/     220 :                        ; Routinen, aber man kann auch eigene Ein-/Ausgaberoutinen nehmen
  666/     220 :                        ;
  667/     220 :                        ; bei Systemstart werden 32 Bytes nach Adresse 1802H kopiert
  668/     220 :                        ; Tabelle RST, NMI, Hilfsregister, V24, I/O (Voreinstellung)
  669/     220 :                        ;------------------------------------------------------------------------------
  670/     220 :                        
  671/     220 :                        ; damit init4 funktioniert, muss das Adresse 220h sein
  672/     220 :                        ; und lo(sv_rst) = Bereichsgröße sv_rstend-sv_rst
  673/     220 :                        	
  674/     220 :                        		org 220h
  675/     220 :                        
  676/     220 : C3 A5 00               sv_rst:		jp	rinch		; rst 08
  677/     223 : C3 E4 00               		jp	routch0		; rst 10
  678/     226 : C3 AA 04               		jp	rprnst		; rst 18
  679/     229 : C3 CF 02               		jp	rPUT		; rst 20
  680/     22C : C3 A3 07               		jp	rGET		; rst 28
  681/     22F : C3 9A 01               		jp	OUTHL		; rst 30
  682/     232 : C3 40 02               		jp	BREAK		; rst 38
  683/     235 : C3 40 02               		jp	BREAK		; NMI: Breakpoint
  684/     238 : =>TRUE                 igsbslm:	if vGSBProc == "USB"
  685/     238 : 00                     		db 0			; Voreinstellung Methode GSB SAVE/Load USB HD 00h 20h
  686/     239 : =>FALSE                		else
  687/     239 :                        		db 20h
  688/     239 : [684]                  		endif
  689/     239 : FD                     hd_buf_hi:	db 0FDh			; Voreinstellung HighByte HD-Puffer FD (AC1) FE	(LLC2)
  690/     23A : 53 43 48               aSch:		db "SCH"		; 181C Autostart-Kennung
  691/     23D : 00                     		db  0			; 181F FARBBWS init
  692/     23E : 42                     		db  42h			; 1820 Kommandocode V 24 (Adresse 1820H)
  693/     23F : 11                     		db  11h			; Ein/Ausgabebyte (Adresse 1821H)
  694/     240 :                        
  695/     240 :                        ;------------------------------------------------------------------------------
  696/     240 :                        ; Einsprung NMI, Register werden in die RSA gerettet, 
  697/     240 :                        ; I/O und PIO werden auf Standard gesetzt
  698/     240 :                        ;------------------------------------------------------------------------------
  699/     240 :                        
  700/     240 :                        ; Breakpoint
  701/     240 : 00                     BREAK:		nop			; ehem CALL REGA
  702/     241 : 00                     		nop
  703/     242 : 00                     		nop
  704/     243 : E1                     break1:		pop	hl		; Returnadr nach Break
  705/     244 : 2B                     		dec	hl		; ein Byte zurück (norm. RST 38)
  706/     245 : 22 75 18               		ld	(REGPC), hl	; merken
  707/     248 : ED 73 77 18            		ld	(REGSP), sp
  708/     24C : 31 56 18               		ld	sp, SYSSK	; Stack
  709/     24F : 3E 11                  		ld	a, 11h		; Standard Console
  710/     251 : 32 21 18               		ld	(IOBYT), a	; Ein/Ausgabebyte
  711/     254 : DF                     		rst	prnst		; Ausgabe String
  712/     255 : 20 42 52 45 41 CB      		db " BREA",'K'+80h
  713/     25B :                        		
  714/     25B :                        ;------------------------------------------------------------------------------
  715/     25B :                        ; Rückkehr in Monitor, nach NMI
  716/     25B :                        ;------------------------------------------------------------------------------
  717/     25B :                        
  718/     25B :                        GETCO1:
  719/     25B : 31 56 18               break2:		ld	sp, SYSSK	; Stack init
  720/     25E : 3E DA                  		ld	a, 0DAh		; Standard setzen für
  721/     260 : D3 05                  		out	(PIODB), a	; Grafik/Ton
  722/     262 : 21 DE 01               		ld	hl, kdo1	; Kommandoschleife
  723/     265 : E5                     		push	hl		; auf Stack
  724/     266 : ED 45                  		retn			; und anspringen
  725/     268 :                        
  726/     268 :                        ;------------------------------------------------------------------------------
  727/     268 :                        ; Ausgabe "Error"
  728/     268 :                        ;------------------------------------------------------------------------------
  729/     268 :                        
  730/     268 : DF                     error:		rst	prnst		; Ausgabe String
  731/     269 : 20 45 52 52 4F 52 20   		db " ERROR "
  732/     270 : 87                     		db  87h			; Beep
  733/     271 : C9                     		ret
  734/     272 :                        
  735/     272 :                        ;------------------------------------------------------------------------------
  736/     272 :                        ; UP "akustisches Signal"
  737/     272 :                        ;------------------------------------------------------------------------------
  738/     272 :                        
  739/     272 : C5                     beep:		push	bc
  740/     273 : 06 02                  		ld	b, 2
  741/     275 : C5                     beep1:		push	bc
  742/     276 : 01 40 00               		ld	bc, 00040h
  743/     279 : CD 87 02               		call	UPTON		; UP "Ton", Reg, B = Tonlaenge, C = Tonhoehe
  744/     27C : 01 32 F0               		ld	bc, 0F032h
  745/     27F : CD 87 02               		call	UPTON		; UP "Ton", Reg, B = Tonlaenge, C = Tonhoehe
  746/     282 : C1                     		pop	bc
  747/     283 : 10 F0                  		djnz	beep1
  748/     285 : C1                     		pop	bc
  749/     286 : C9                     		ret
  750/     287 :                        
  751/     287 :                        ;------------------------------------------------------------------------------
  752/     287 :                        ; UP "Ton", Reg, B = Tonlaenge, C = Tonhoehe
  753/     287 :                        ;------------------------------------------------------------------------------
  754/     287 :                        
  755/     287 : F5                     UPTON:		push	af
  756/     288 : DB 05                  ton1:		in	a, (PIODB)	; Grafik/Ton
  757/     28A : 1F                     		rra
  758/     28B : 3F                     		ccf
  759/     28C : 17                     		rla
  760/     28D : D3 05                  		out	(PIODB), a	; Grafik/Ton
  761/     28F : 79                     		ld	a, c
  762/     290 : 3D                     ton2:		dec	a
  763/     291 : 20 FD                  		jr	nz, ton2
  764/     293 : 10 F3                  		djnz	ton1
  765/     295 : F1                     		pop	af
  766/     296 : C9                     		ret
  767/     297 :                        
  768/     297 :                        ;------------------------------------------------------------------------------
  769/     297 :                        ;UP "Taste", testet Tastaturtatus, kehrt bei gedrückter Taste
  770/     297 :                        ;nach 18 ms mit dem Kode zum Akku zurück, keine Taste-Rückkehr mit
  771/     297 :                        ;gesetztem Z-Flag und A=0, Code steht in $1822
  772/     297 :                        ;------------------------------------------------------------------------------
  773/     297 :                        
  774/     297 : C5                     UPTAST:		push	bc
  775/     298 : CD C3 02               		call	tast6		; Taste gedrückt?
  776/     29B : 28 20                  tast1:		jr	z, tast5	; nein
  777/     29D : 06 0C                  		ld	b, 12		; 12x Kontrollesen, Wartezeit
  778/     29F : 4F                     		ld	c, a		; Tastenwert
  779/     2A0 : CD C3 02               tast2:		call	tast6
  780/     2A3 : B9                     		cp	c		; noch dieselbe Taste?
  781/     2A4 : 20 17                  		jr	nz, tast5
  782/     2A6 : 10 F8                  		djnz	tast2
  783/     2A8 : FE 21                  		cp	21h		; Steuerzeichen ?
  784/     2AA : 38 0F                  		jr	c, tast4	; sprung wenn a < 21h, d.h. Steuerzeichen
  785/     2AC :                        					; daher patch auf 21h, so dass für
  786/     2AC :                        					; ASCII-zeichen der Grafik-Offs. funktioniert
  787/     2AC : DB 05                  		in	a, (PIODB)
  788/     2AE : CB 57                  tast3:		bit	2, a		; Grafiktaste ?
  789/     2B0 : 79                     		ld	a, c
  790/     2B1 : 20 08                  		jr	nz, tast4	; nein
  791/     2B3 : C6 80                  		add	a, 80h		; sonst Grafik-Offset dazu
  792/     2B5 : FE E0                  		cp	0E0h
  793/     2B7 : 38 02                  		jr	c, tast4
  794/     2B9 : D6 60                  		sub	60h
  795/     2BB : 04                     tast4:		inc	b		; ??
  796/     2BC : 06                     		db  06h			; --> ld b,xx; überspringt XOR A
  797/     2BD : AF                     tast5:		xor	a
  798/     2BE : C1                     		pop	bc
  799/     2BF : 32 22 18               		ld	(tacod), a	; Tastencode der zuletzt gedr}ckten Taste
  800/     2C2 : C9                     		ret
  801/     2C3 :                        
  802/     2C3 :                        ; Test Taste gedrückt?
  803/     2C3 : 3E 48                  tast6:		ld	a, 48h		; kurz warten (Entprellen)
  804/     2C5 : 3D                     tast7:		dec	a
  805/     2C6 : 20 FD                  		jr	nz, tast7
  806/     2C8 : DB 04                  		in	a, (PIODA)	; Tastenwert
  807/     2CA : CB 7F                  		bit	7, a		; Taste	gedrückt?
  808/     2CC : CB BF                  		res	7, a
  809/     2CE : C9                     		ret
  810/     2CF :                        
  811/     2CF :                        ;------------------------------------------------------------------------------
  812/     2CF :                        ; rst20 PUT
  813/     2CF :                        ; Ausgabe zu VDIP1 senden:
  814/     2CF :                        ; PE:	A	Datenbyte
  815/     2CF :                        ; VR:	-
  816/     2CF :                        ;------------------------------------------------------------------------------
  817/     2CF :                        
  818/     2CF : D3 FC                  rPUT:		out	(PIO3A), a	; Daten	ausgeben
  819/     2D1 : F5                     		push	af
  820/     2D2 : DB FD                  rput1:		in	a, (PIO3B)	; Status abfragen
  821/     2D4 : 0F                     		rrca
  822/     2D5 : 0F                     		rrca
  823/     2D6 : 38 FA                  		jr	c, rput1	; nicht	bereit,	warten!
  824/     2D8 : 3E CC                  		ld	a, 0CCh		; WR aktiv
  825/     2DA : D3 FD                  		out	(PIO3B), a
  826/     2DC : 3E C4                  		ld	a, 0C4h		; WR inaktiv
  827/     2DE : D3 FD                  		out	(PIO3B), a
  828/     2E0 : F1                     		pop	af
  829/     2E1 : C9                     		ret
  830/     2E2 :                        
  831/     2E2 :                        ;------------------------------------------------------------------------------
  832/     2E2 :                        ; Dateiname f. Nachladbare Kommandos
  833/     2E2 :                        ; MO11A_46.Z80
  834/     2E2 :                        ;   | | ^^--------- ASCII-Code des Kommandobuchstabens
  835/     2E2 :                        ;   | +------------ Gerätekenner (A=AC1, L=LLC2)
  836/     2E2 :                        ;   +-------------- Monitorversion
  837/     2E2 :                        ;------------------------------------------------------------------------------
  838/     2E2 :                        
  839/     2E2 :                        ; zu kdo5
  840/     2E2 : 22 30 38 5A 2E 78 78   aFNERW:		db "\"08Z.xx_A11OM\""	; -> MO11A_xx.Z80
           2E9 : 5F 41 31 31 4F 4D 22
  841/     2F0 :                        
  842/     2F0 :                        ;------------------------------------------------------------------------------
  843/     2F0 :                        ; Zeichensatz umschalten
  844/     2F0 :                        ;------------------------------------------------------------------------------
  845/     2F0 :                        
  846/     2F0 : DB 05                  o_ZS:		in	a, (PIODB); Grafik/Ton
  847/     2F2 : EE 08                  		xor	8
  848/     2F4 : D3 05                  		out	(PIODB), a; Grafik/Ton
  849/     2F6 : 18 36                  		jr	o_00
  850/     2F8 :                        
  851/     2F8 :                        ;------------------------------------------------------------------------------
  852/     2F8 :                        ; Interrupt-Tabelle CTC
  853/     2F8 :                        ;------------------------------------------------------------------------------
  854/     2F8 :                        
  855/     2F8 :                        inttab:		align 2
  856/     2F8 :                        
  857/     2F8 : FF FF                  		dw 0FFFFh		; interrupt-Routine CTC0 
  858/     2FA : FF FF                  		dw 0FFFFh		; interrupt-Routine CTC1
  859/     2FC : FF FF                  		dw 0FFFFh		; interrupt-Routine CTC2
  860/     2FE : FF FF                  		dw 0FFFFh		; interrupt-Routine CTC3
  861/     300 :                        
  862/     300 :                        ;------------------------------------------------------------------------------
  863/     300 :                        ; Bildschirmtreiber
  864/     300 :                        ; im Sprungverteiler wurde die HI-Adresse eingespart, deshalb müssen alle
  865/     300 :                        ; Steuerzeichenroutinen in derselben Page 03xx liegen! ( hi(cotab),lo(co_fkt) )
  866/     300 :                        ;
  867/     300 :                        ; 017FFH Bildschirmanfang (links oben !!)
  868/     300 :                        ; 01000H Bildschirmende (rechts unten !!)
  869/     300 :                        ; 32 Zeilen a 64 Zeichen
  870/     300 :                        ;
  871/     300 :                        ; Der BWS arbeitet aufgrund der Hardware invers
  872/     300 :                        ; d.h. inc geht ein Zeichen / eine Zeile zurück
  873/     300 :                        ;      dec geht ein Zeichen / eine Zeile vor
  874/     300 :                        ;------------------------------------------------------------------------------
  875/     300 :                        ;
  876/     300 :                        ;
  877/     300 :                        ;  bwsat(0,0)                                       bwsat(0,63)
  878/     300 :                        ;  +--------------------------------------------------------+
  879/     300 :                        ;  ¦17FF BSWANF                ...                     17C0 ¦
  880/     300 :                        ;  ¦                                                        ¦
  881/     300 :                        ;  ¦                     32 Zeilen                          ¦
  882/     300 :                        ;  ¦                     64 Spalten                         ¦
  883/     300 :                        ;  ¦                                                        ¦
  884/     300 :                        ;  ¦                    <-- inc cupos                       ¦
  885/     300 :                        ;  ¦                    --> dec cupos                       ¦
  886/     300 :                        ;  ¦                                                    .   ¦
  887/     300 :                        ;  ¦ .                                                  .   ¦
  888/     300 :                        ;  ¦ .                                                  .   ¦
  889/     300 :                        ;  ¦ .                                                      ¦
  890/     300 :                        ;  ¦                                                        ¦
  891/     300 :                        ;  ¦10BF                       ...                     1080 ¦
  892/     300 :                        ;  ¦107F                       ...                     1040 ¦
  893/     300 :                        ;  ¦103F                       ...              BWSEND 1000 ¦
  894/     300 :                        ;  +--------------------------------------------------------+ 
  895/     300 :                        ;  bwsat(31,0)                                      bwsat(31,63)
  896/     300 :                        ;
  897/     300 :                        ;
  898/     300 :                        ;------------------------------------------------------------------------------
  899/     300 :                        
  900/     300 :                        		; org 300h
  901/     300 : C5                     co0:		push	bc
  902/     301 : ED 5B 00 18            		ld	de, (cupos)	; Zwischenspeicher Kursor
  903/     305 : 21 56 18               		ld	hl, poscnt	; Hilfsregister Kursorpositionierung (CTRL+N)
  904/     308 : FE 10                  		cp	10h		; Steuerzeichen?
  905/     30A : 30 0C                  		jr	nc, co1		; Sprung, wenn kein Steuerzeichen
  906/     30C : 36 01                  		ld	(hl), 1		; poscnt auf 1 setzen
  907/     30E : 01 C7 03               		ld	bc, cotab	; Tabelle f. Steuerzeichen
  908/     311 : 81                     		add	a, c
  909/     312 : 4F                     		ld	c, a
  910/     313 : 0A                     		ld	a, (bc)
  911/     314 : 4F                     		ld	c, a		; bc = hi(cotab),lo(co_fkt)
  912/     315 : C5                     		push	bc		; Adresse Steuerzeichenfkt. auf Stack
  913/     316 : EB                     		ex	de, hl		; hl=cupos, de=poscnt
  914/     317 : C9                     		ret			; und anspringen
  915/     318 :                        
  916/     318 :                        ; einfache Zeichenausgabe
  917/     318 : 35                     co1:		dec	(hl)		; hl=poscnt. ist ctrl-n-Mode aktiv? d.h.
  918/     319 :                        					; sind noch Ziffern zu verarbeiten?
  919/     319 : 20 18                  		jr	nz, co5		; poscnt > 1 -> ja, dann dort weiter
  920/     31B : 36 01                  co2:		ld	(hl), 1		; sonst wieder poscnt auf 1 setzen
  921/     31D :                        		;
  922/     31D : EB                     		ex	de, hl		; hl=cupos
  923/     31E : FE 1A                  		cp	1Ah		; steuerzeichen 1Ah (Zeichensatz umschalten)
  924/     320 : 28 CE                  		jr	z, o_ZS
  925/     322 : FE 7F                  		cp	7Fh		; steuerzeichen 7Fh (del)
  926/     324 : 28 37                  		jr	z, co8
  927/     326 : 77                     		ld	(hl), a		; sonst Zeichen in BWS schreiben
  928/     327 :                        
  929/     327 :                        ; Kursor nach rechts
  930/     327 : 2B                     o_cur:		dec	hl		; inc. cupos
  931/     328 : CD DC 03               co3:		call	scroll
  932/     32B : 22 00 18               co4:		ld	(cupos), hl	; Zwischenspeicher Kursor
  933/     32E :                        ; co Ende
  934/     32E : C1                     o_00:		pop	bc
  935/     32F : D1                     		pop	de
  936/     330 : E1                     		pop	hl
  937/     331 : F1                     		pop	af
  938/     332 : C9                     		ret
  939/     333 :                        
  940/     333 :                        ; direkte Cursorpositionierung
  941/     333 :                        ; in hl=poscnt Hilfsregister Kursorpositionierung (CTRL+N)
  942/     333 :                        ; de = bwsanf
  943/     333 :                        ; es folgen 4 Ziffern dezimal Zeile 00.31, Spalte 00..63
  944/     333 : FE 30                  co5:		cp	'0'		; wenn keine Ziffer
  945/     335 : 38 E4                  		jr	c, co2		; dann Abbruch 
  946/     337 : 28 F5                  		jr	z, o_00		; '0' übergehen
  947/     339 : FE 3A                  		cp	'9'+1		; wenn keine Ziffer
  948/     33B : 30 DE                  		jr	nc, co2		; dann Abbruch 
  949/     33D : D6 30                  		sub	'0'
  950/     33F : 46                     		ld	b, (hl)		; hl=poscnt
  951/     340 :                        		; offs. berechnen
  952/     340 :                        		; summand ermitteln
  953/     340 : EB                     		ex	de, hl		; hl = bwsanf
  954/     341 : 11 FF FF               		ld	de, -1
  955/     344 : 05                     		dec	b
  956/     345 : 28 0D                  		jr	z, co6		; wenn Einerstelle Spalte
  957/     347 : 1E F6                  		ld	e, -10
  958/     349 : 05                     		dec	b
  959/     34A : 28 08                  		jr	z, co6		; wenn Zehnerstelle Spalte
  960/     34C : 1E C0                  		ld	e, -COLS
  961/     34E : 05                     		dec	b
  962/     34F : 28 03                  		jr	z, co6		; wenn Einerstelle Zeile
  963/     351 : 11 80 FD               		ld	de, -COLS*10	; sonst wenn Zehner Zeile
  964/     354 : 47                     co6:		ld	b, a		; a (=ziffer) mal
  965/     355 : 19                     co7:		add	hl, de		; aufaddieren
  966/     356 : CD DC 03               		call	scroll
  967/     359 : 10 FA                  		djnz	co7
  968/     35B : 18 CE                  		jr	co4		; ende
  969/     35D :                        
  970/     35D :                        ; del 7Fh, 5Fh
  971/     35D : 23                     co8:		inc	hl		; ein Zeichen zurück
  972/     35E : CD DC 03               		call	scroll
  973/     361 : 36 20                  		ld	(hl), ' '	; Zeichen löschen
  974/     363 : 18 C6                  		jr	co4
  975/     365 :                        
  976/     365 :                        ; Bildschirm löschen
  977/     365 : 21 FF 17               o_cls:		ld	hl, BWSANF
  978/     368 : 22 00 18               		ld	(cupos), hl	; Zwischenspeicher Kursor
  979/     36B :                        
  980/     36B :                        ; Bildschirm ab Kursorposition löschen
  981/     36B : 36 20                  o_clsc:		ld	(hl), ' '	; mil Leerzeichen füllen
  982/     36D : 2B                     		dec	hl		; nächstes Zeichen
  983/     36E : 7C                     		ld	a, h
  984/     36F : FE 0F                  		cp	hi(BWS-1)	; BWS überschritten ?
  985/     371 : 20 F8                  		jr	nz, o_clsc	; weiter bis BWS-Ende
  986/     373 : 18 B9                  		jr	o_00
  987/     375 :                        
  988/     375 :                        ; Zeile ab Kursorposition löschen
  989/     375 : 36 20                  o_clln:		ld	(hl), ' '	; aktuelles Zeichen löschen
  990/     377 : 2B                     co9:		dec	hl		; inc cupos
  991/     378 : 36 20                  		ld	(hl), ' '	; nächstes  Zeichen löschen
  992/     37A : 3E 3F                  		ld	a, COLS-1
  993/     37C : A5                     		and	l		; Zeilenende erreicht?
  994/     37D : 20 F8                  		jr	nz, co9		; nein -> weiter
  995/     37F : 18 AD                  co10:		jr	o_00
  996/     381 :                        
  997/     381 :                        ; Kursor an den Anfang der Zeile
  998/     381 : 7D                     o_sol:		ld	a, l
  999/     382 : F6 3F                  		or	COLS-1		 ; setze auf Zeilenanfang
 1000/     384 : 6F                     		ld	l, a
 1001/     385 : 18 A4                  		jr	co4
 1002/     387 :                        
 1003/     387 :                        ; BEL, akustisches Signal
 1004/     387 : CD 72 02               o_bell:		call	beep
 1005/     38A : 18 A2                  		jr	o_00
 1006/     38C :                        
 1007/     38C :                        ; Kursor nach links
 1008/     38C : 23                     o_cul:		inc	hl		; dec cupos
 1009/     38D : 18 99                  		jr	co3
 1010/     38F :                        
 1011/     38F :                        ; Kursor nach unten
 1012/     38F : 11 C0 FF               o_cud:		ld	de, -COLS
 1013/     392 : 19                     co11:		add	hl, de
 1014/     393 : 18 93                  		jr	co3
 1015/     395 :                        
 1016/     395 :                        ; Kursor nach oben
 1017/     395 : 11 40 00               o_cuu:		ld	de, COLS
 1018/     398 : 18 F8                  		jr	co11
 1019/     39A :                        
 1020/     39A :                        ; CR, Kursor an Anfang nächster Zeile; Enter
 1021/     39A : 7D                     o_cr:		ld	a, l
 1022/     39B : E6 C0                  		and	0C0h		; Pos=Zeilenende
 1023/     39D : 6F                     		ld	l, a
 1024/     39E : 18 87                  		jr	o_cur
 1025/     3A0 :                        
 1026/     3A0 :                        ; Kursor direkt positionieren
 1027/     3A0 : 3E 05                  o_setc:		ld	a, 5
 1028/     3A2 : 12                     		ld	(de), a		; de=poscnt Hilfsregister Kursorpositionierung (CTRL+N)
 1029/     3A3 :                        		; jetzt Cursor auf BWSANF setzen (f. Berechnung in co5)
 1030/     3A3 :                        
 1031/     3A3 :                        ; Home, Kursor oben links
 1032/     3A3 : 21 FF 17               o_home:		ld	hl, BWSANF
 1033/     3A6 : 18 83                  		jr	co4
 1034/     3A8 :                        
 1035/     3A8 :                        ; Delete;	Zeichen	löschen, Zeile rückt nach links
 1036/     3A8 : 54                     o_del:		ld	d, h
 1037/     3A9 : 5D                     		ld	e, l
 1038/     3AA : 2B                     		dec	hl
 1039/     3AB : 7D                     co12:		ld	a, l
 1040/     3AC : ED A8                  		ldd
 1041/     3AE : E6 3F                  		and	COLS-1
 1042/     3B0 : 20 F9                  		jr	nz, co12
 1043/     3B2 : 13                     		inc	de
 1044/     3B3 : 3E 20                  co13:		ld	a, ' '
 1045/     3B5 : 12                     		ld	(de), a
 1046/     3B6 : 18 C7                  		jr	co10
 1047/     3B8 :                        
 1048/     3B8 :                        ; Insert;	Space einfügen,	Zeile rückt nach rechts
 1049/     3B8 : 7D                     o_ins:		ld	a, l
 1050/     3B9 : E6 C0                  		and	0C0h		; Pos=Zeilenende
 1051/     3BB : 5F                     		ld	e, a
 1052/     3BC : 7D                     		ld	a, l
 1053/     3BD : 6B                     		ld	l, e
 1054/     3BE : 54                     		ld	d, h
 1055/     3BF : 23                     		inc	hl
 1056/     3C0 : BB                     co14:		cp	e
 1057/     3C1 : 28 F0                  		jr	z, co13
 1058/     3C3 : ED A0                  		ldi
 1059/     3C5 : 18 F9                  		jr	co14
 1060/     3C7 :                        
 1061/     3C7 :                        ; Tabelle Steuercodes, lo-teil, hi-teil ist hi(cotab) also, 03xx !
 1062/     3C7 : 2E                     cotab:		db lo(o_00)	; 00 keine Funktion
 1063/     3C8 : A3                     		db lo(o_home)	; 01 Home, Kursor oben links
 1064/     3C9 : 6B                     		db lo(o_clsc)	; 02 Bildschirm ab Kursorposition löschen
 1065/     3CA : 75                     		db lo(o_clln)	; 03 Zeile ab Kursorposition löschen
 1066/     3CB : A8                     		db lo(o_del)	; 04 Delete; Zeichen löschen, Zeile rückt nach links
 1067/     3CC : B8                     		db lo(o_ins)	; 05 Insert; Space einfügen, Zeile rückt nach rechts
 1068/     3CD : 81                     		db lo(o_sol)	; 06 Kursor an den Anfang der Zeile
 1069/     3CE : 87                     		db lo(o_bell)	; 07 BEL, akustisches Signal
 1070/     3CF : 8C                     		db lo(o_cul)	; 08 Kursor nach links
 1071/     3D0 : 27                     		db lo(o_cur)	; 09 Kursor nach rechts
 1072/     3D1 : 8F                     		db lo(o_cud)	; 0A Kursor nach unten
 1073/     3D2 : 95                     		db lo(o_cuu)	; 0B Kursor nach oben
 1074/     3D3 : 65                     		db lo(o_cls)	; 0C Bildschirm löschen
 1075/     3D4 : 9A                     		db lo(o_cr)	; 0D CR, Kursor an Anfang nächster Zeile; Enter
 1076/     3D5 : A0                     		db lo(o_setc)	; 0E Kursor direkt positionieren
 1077/     3D6 : D7                     		db lo(o_tab)	; 0F Tabulator 8 Spalten
 1078/     3D7 :                        
 1079/     3D7 :                        ; Tabulator 8 Spalten
 1080/     3D7 : 11 F8 FF               o_tab:		ld	de, -8
 1081/     3DA : 18 B6                  		jr	co11
 1082/     3DC :                        
 1083/     3DC :                        ; eine Zeile hochscrollen
 1084/     3DC : 7C                     scroll:	ld	a, h
 1085/     3DD : FE 18                  		cp	hi(BWSANF)+1	; BWS-Ende?
 1086/     3DF : 38 02                  		jr	c, scroll1
 1087/     3E1 : 26 10                  		ld	h, Hi(BWSEND)
 1088/     3E3 : FE 10                  scroll1:	cp	Hi(BWSEND)
 1089/     3E5 : D0                     		ret	nc
 1090/     3E6 : 7D                     		ld	a, l
 1091/     3E7 : D5                     		push	de
 1092/     3E8 : C5                     		push	bc
 1093/     3E9 : 21 BF 17               		ld	hl, BWSANF-COLS
 1094/     3EC : 11 FF 17               		ld	de, BWSANF
 1095/     3EF : 01 C0 07               		ld	bc, COLS*(LINES-1)
 1096/     3F2 : ED B8                  		lddr			; scrollen
 1097/     3F4 : EB                     		ex	de, hl
 1098/     3F5 : 23                     		inc	hl
 1099/     3F6 : 2D                     scroll2:	dec	l
 1100/     3F7 : 36 20                  		ld	(hl), ' '
 1101/     3F9 : 20 FB                  		jr	nz, scroll2
 1102/     3FB : E6 3F                  		and	COLS-1
 1103/     3FD : 6F                     		ld	l, a
 1104/     3FE : C1                     		pop	bc
 1105/     3FF : D1                     		pop	de
 1106/     400 : C9                     		ret
 1107/     401 :                        
 1108/     401 :                        ;------------------------------------------------------------------------------
 1109/     401 :                        ; N aaaa bbbb CRC - Prüfsumme
 1110/     401 :                        ; schnelle 16-Bit-SDLC-Routine
 1111/     401 :                        ;------------------------------------------------------------------------------
 1112/     401 :                        
 1113/     401 : 00 09 4E 0D            		db 0,9,'N',0Dh
 1114/     405 :                        
 1115/     405 : CD CA 04               crc:		call	para
 1116/     408 : EB                     		ex	de, hl
 1117/     409 : 23                     		inc	hl
 1118/     40A : AF                     		xor	a
 1119/     40B : ED 52                  		sbc	hl, de
 1120/     40D : 01 FF FF               		ld	bc, 0FFFFh
 1121/     410 : 1A                     crc1:		ld	a, (de)
 1122/     411 : A8                     		xor	b
 1123/     412 : 47                     		ld	b, a
 1124/     413 : 0F                     		rrca
 1125/     414 : 0F                     		rrca
 1126/     415 : 0F                     		rrca
 1127/     416 : 0F                     		rrca
 1128/     417 : E6 0F                  		and	0Fh
 1129/     419 : A8                     		xor	b
 1130/     41A : 47                     		ld	b, a
 1131/     41B : 0F                     		rrca
 1132/     41C : 0F                     		rrca
 1133/     41D : 0F                     		rrca
 1134/     41E : F5                     		push	af
 1135/     41F : E6 1F                  		and	1Fh
 1136/     421 : A9                     		xor	c
 1137/     422 : 4F                     		ld	c, a
 1138/     423 : F1                     		pop	af
 1139/     424 : F5                     		push	af
 1140/     425 : 0F                     		rrca
 1141/     426 : E6 F0                  		and	0F0h
 1142/     428 : A9                     		xor	c
 1143/     429 : 4F                     		ld	c, a
 1144/     42A : F1                     		pop	af
 1145/     42B : E6 E0                  		and	0E0h
 1146/     42D : A8                     		xor	b
 1147/     42E : 41                     		ld	b, c
 1148/     42F : 4F                     		ld	c, a
 1149/     430 : 13                     		inc	de
 1150/     431 : 2B                     		dec	hl
 1151/     432 : 7C                     		ld	a, h
 1152/     433 : B5                     		or	l
 1153/     434 : 20 DA                  		jr	nz, crc1
 1154/     436 : C5                     		push	bc
 1155/     437 : DF                     		rst	prnst		; Ausgabe String
 1156/     438 : 20 43 52 43 A0         		db " CRC",0A0h
 1157/     43D : E1                     		pop	hl
 1158/     43E : F7                     		rst	30h		; outhl
 1159/     43F : C9                     		ret
 1160/     440 :                        
 1161/     440 :                        ;------------------------------------------------------------------------------
 1162/     440 :                        ; UP zu	Dump
 1163/     440 :                        ; Ausgabe einer Zeile
 1164/     440 :                        ; "            2008>  FF FF FF FF FF FF FF FF  * ........ *"
 1165/     440 :                        ;------------------------------------------------------------------------------
 1166/     440 :                        
 1167/     440 : 41                     dmp_zeile:	ld	b, c		; c = Nr. aktives Byte
 1168/     441 : 23                     		inc	hl
 1169/     442 : 2B                     dmp_zeile1:	dec	hl
 1170/     443 : 10 FD                  		djnz	dmp_zeile1
 1171/     445 : 22 5D 18               		ld	(ARG2),	hl
 1172/     448 : DF                     		rst	prnst		; Ausgabe String
 1173/     449 : 06                     		db    6
 1174/     44A : 83                     		db  83h			; Zeilenanfang,zeile loeschen
 1175/     44B :                        		;12x Kursor nach rechts
 1176/     44B : 06 0C                  		ld	b, 12
 1177/     44D : DF                     dmp_zeile2:	rst	prnst		; Ausgabe String
 1178/     44E : 89                     		db  89h			; Kursor nach rechts
 1179/     44F : 10 FC                  		djnz	dmp_zeile2
 1180/     451 :                        		;Adresse
 1181/     451 : F7                     		rst	30h		; outhl
 1182/     452 : ED 5B 00 18            		ld	de, (cupos)
 1183/     456 :                        		;>
 1184/     456 : DF                     		rst	prnst		; Ausgabe String
 1185/     457 : 3E A0                  		db '>',' '+80h
 1186/     459 :                        		;8 Bytes headezimal
 1187/     459 : 06 08                  		ld	b, 8
 1188/     45B : 7E                     dmp_zeile3:	ld	a, (hl)
 1189/     45C : 23                     		inc	hl
 1190/     45D : DF                     		rst	prnst		; Ausgabe String
 1191/     45E : A0                     		db ' '+80h
 1192/     45F : CD EE 07               		call	j_OUTHEX
 1193/     462 : 10 F7                  		djnz	dmp_zeile3
 1194/     464 :                        		;Ascii start "  * "
 1195/     464 : DF                     		rst	prnst		; Ausgabe String
 1196/     465 : 20 20 2A A0            		db "  *",' '+80h
 1197/     469 : 2A 5D 18               		ld	hl, (ARG2)
 1198/     46C :                        		;8 Bytes ASCII
 1199/     46C : 06 08                  		ld	b, 8
 1200/     46E : 7E                     dmp_zeile4:	ld	a, (hl)
 1201/     46F : 23                     		inc	hl
 1202/     470 : CD 84 04               		call	tstzei
 1203/     473 : 30 02                  		jr	nc, dmp_zeile5	; wenn kein Zeichen
 1204/     475 : 3E 2E                  		ld	a, '.'		; dann "."
 1205/     477 : D7                     dmp_zeile5:	rst	outch		; Zeichenausgabe
 1206/     478 : 10 F4                  		djnz	dmp_zeile4
 1207/     47A :                        		;
 1208/     47A : 22 5B 18               		ld	(ARG1),	hl	; aktuelle Adresse merken (HL+8)
 1209/     47D :                        		;Ascii Ende
 1210/     47D : DF                     		rst	prnst		; Ausgabe String
 1211/     47E : 20 2A 06 20 88         		db " *",6,' ',88h	; 6-Kursor an den Anfang der Zeile
 1212/     483 :                        					; 8-Kursor nach links
 1213/     483 : C9                     		ret
 1214/     484 :                        
 1215/     484 :                        ;------------------------------------------------------------------------------
 1216/     484 :                        ; Test auf normales ASCII-Zeichen
 1217/     484 :                        ;------------------------------------------------------------------------------
 1218/     484 :                        
 1219/     484 : FE 7F                  tstzei:		cp	7Fh
 1220/     486 : 28 09                  tstzei1:	jr	z, tstzei3
 1221/     488 : FE 20                  		cp	' '
 1222/     48A : D8                     		ret	c		; wenn Steuerzeichen
 1223/     48B : FE 7F                  		cp	7Fh
 1224/     48D : 30 02                  		jr	nc, tstzei3	; wenn kein ACSII
 1225/     48F : A7                     tstzei2:	and	a
 1226/     490 : C9                     		ret
 1227/     491 : 37                     tstzei3:	scf
 1228/     492 : C9                     		ret
 1229/     493 :                        
 1230/     493 :                        ;------------------------------------------------------------------------------
 1231/     493 :                        ; Test auf Hexziffer
 1232/     493 :                        ;------------------------------------------------------------------------------
 1233/     493 :                        
 1234/     493 : FE 47                  tsthex:		cp	'F'+1
 1235/     495 : 30 FA                  		jr	nc, tstzei3
 1236/     497 : FE 30                  		cp	'0'
 1237/     499 : D8                     		ret	c
 1238/     49A : FE 3A                  		cp	'9'+1
 1239/     49C : 38 F1                  		jr	c, tstzei2
 1240/     49E : FE 41                  		cp	'A'
 1241/     4A0 : C9                     		ret
 1242/     4A1 :                        
 1243/     4A1 :                        ;------------------------------------------------------------------------------
 1244/     4A1 :                        ; Ausgabe 12 Leerzeichen an Zeilenanfang
 1245/     4A1 :                        ;------------------------------------------------------------------------------
 1246/     4A1 :                        
 1247/     4A1 : DF                     loc_4A1:	rst	prnst		; Ausgabe String
 1248/     4A2 : 86                     		db 6h +80h		; Kursor an den Anfang der Zeile
 1249/     4A3 : 06 0C                  		ld	b, 12
 1250/     4A5 : DF                     loc_4A5:	rst	prnst		; Ausgabe String
 1251/     4A6 : A0                     		db ' ' +80h
 1252/     4A7 : 10 FC                  		djnz	loc_4A5
 1253/     4A9 : C9                     		ret
 1254/     4AA :                        
 1255/     4AA :                        ;------------------------------------------------------------------------------
 1256/     4AA :                        ; Standard-Routine Ausgabe Zeichenkette, RST 18
 1257/     4AA :                        ;------------------------------------------------------------------------------
 1258/     4AA :                        
 1259/     4AA : E3                     rprnst:		ex	(sp), hl
 1260/     4AB : F5                     		push	af
 1261/     4AC : 7E                     rprnst1:	ld	a, (hl)		; Zeichen holen
 1262/     4AD : 23                     		inc	hl		; nächste Adr.
 1263/     4AE : D7                     		rst	OUTCH
 1264/     4AF : 07                     		rlca			; Ende (Bit7 gesetzt)?
 1265/     4B0 : 30 FA                  		jr	nc, rprnst1	; nein -> nächstes Zeichen
 1266/     4B2 : F1                     		pop	af
 1267/     4B3 : E3                     		ex	(sp), hl	; neue Return-Adr.
 1268/     4B4 : C9                     		ret
 1269/     4B5 :                        
 1270/     4B5 :                        ;------------------------------------------------------------------------------
 1271/     4B5 :                        ; outch deaktivieren/aktivieren
 1272/     4B5 :                        ;------------------------------------------------------------------------------
 1273/     4B5 :                        
 1274/     4B5 :                        ; up's zu kdo5
 1275/     4B5 : 3E C9                  outchoff:	ld	a, 0C9h		; RET
 1276/     4B7 : 18 02                  		jr	outchon1
 1277/     4B9 : 3E C3                  outchon:	ld	a, 0C3h		; JP
 1278/     4BB : 32 05 18               outchon1:	ld	(jp_rst10), a	; outch
 1279/     4BE : C9                     		ret
 1280/     4BF :                        
 1281/     4BF :                        ;------------------------------------------------------------------------------
 1282/     4BF :                        ; X Prog X Sprung in Programmpaket X via Modul 1
 1283/     4BF :                        ;------------------------------------------------------------------------------
 1284/     4BF :                        
 1285/     4BF : 00 09 58 0D            		db 0,9,'X',0Dh
 1286/     4C3 :                        
 1287/     4C3 : 3E 01                  		ld	a, 1
 1288/     4C5 : D3 14                  		out	(modul1), a	; Modul1 ROM "PaketX" aktivieren
 1289/     4C7 : C3 00 E0               		jp	0E000h		; und starten
 1290/     4CA :                        
 1291/     4CA :                        ;------------------------------------------------------------------------------
 1292/     4CA :                        ; Register mit Argumenten laden, aaaa=HL, bbbb=DE, cccc=BC
 1293/     4CA :                        ;------------------------------------------------------------------------------
 1294/     4CA :                        
 1295/     4CA : 2A 5B 18               para:		ld	hl, (ARG1)	; Argument 1
 1296/     4CD : ED 5B 5D 18            		ld	de, (ARG2)	; Argument 2
 1297/     4D1 : ED 4B 5F 18            		ld	bc, (ARG3)
 1298/     4D5 : C9                     		ret
 1299/     4D6 :                        
 1300/     4D6 :                        ;------------------------------------------------------------------------------
 1301/     4D6 :                        ; U USB Load Laedt Files vom USB
 1302/     4D6 :                        ; U aaaa "FILENAME.Z80"                      	USB File laden
 1303/     4D6 :                        ;------------------------------------------------------------------------------
 1304/     4D6 :                        
 1305/     4D6 : 00 09 55 0D            		db 0,9,'U',0Dh
 1306/     4DA :                        
 1307/     4DA : AF                     		xor	a
 1308/     4DB : 32 B0 18               ld_usb:		ld	(filetyp), a	; erwarteter Filetyp
 1309/     4DE : AF                     		xor	a		; load
 1310/     4DF : 18 0A                  		jr	ldsv_usb
 1311/     4E1 :                        
 1312/     4E1 :                        ;------------------------------------------------------------------------------
 1313/     4E1 :                        ; u USB SAVE Speichert/Loescht Files auf USB
 1314/     4E1 :                        ; u AADR EADR SADR "FILENAME.Z80" P Fileinfo   USB File speichern 
 1315/     4E1 :                        ; u-"FILENAME.Z80"	USB File löschen
 1316/     4E1 :                        ; u			Directory auflisten
 1317/     4E1 :                        ;------------------------------------------------------------------------------
 1318/     4E1 :                        
 1319/     4E1 : 00 09 75 0D            		db 0,9,'u',0Dh
 1320/     4E5 :                        
 1321/     4E5 : FE 2D                  		cp	'-'		; Datei loeschen?
 1322/     4E7 : 28 36                  		jr	z, del_usb
 1323/     4E9 :                        
 1324/     4E9 : 3E 01                  		ld	a, 1		; save
 1325/     4EB :                        
 1326/     4EB :                        ; Datei laden/speichern	
 1327/     4EB :                        ; in DE=Adr. Filename etc. 
 1328/     4EB :                        ; bei Aufruf via Monitor DE=Adr in BWS (Leerzeichen von Filename), 
 1329/     4EB :                        ; Filename steht in umgekehrter Reihenfolge im Speicher
 1330/     4EB :                        ; D=0Fh, Direktmodus
 1331/     4EB :                        
 1332/     4EB : DD 6F                  ldsv_usb:	ld	ixl, a		;Modus (0=load, 1=save)
 1333/     4ED : CD D6 06               		call	USBInit
 1334/     4F0 : C0                     		ret	nz
 1335/     4F1 : CD 0F 08               		call	sub_80F		; Teste Filename
 1336/     4F4 : 20 34                  		jr	nz, ldsv_usb1	; Filename ab DE
 1337/     4F6 :                        		
 1338/     4F6 :                        		; kein Filename oder ungültige Syntax:
 1339/     4F6 :                        ; 'u' List Directory
 1340/     4F6 : DF                     dir_usb:	rst	prnst		; Ausgabe String
 1341/     4F7 : 49 4E 48 41 4C 54 BA   		db "INHALT",':'+80h
 1342/     4FE : 3E 01                  		ld	a, 1		; Vinculum-Kdo List files
 1343/     500 : E7                     		rst	PUT
 1344/     501 : 3E 0D                  		ld	a, 0Dh		; ohne Parameter
 1345/     503 : E7                     		rst	PUT
 1346/     504 :                        		; Anzeigen bis CR
 1347/     504 : EF                     dir_usb1:	rst	GET
 1348/     505 : FE 0D                  		cp	0Dh		; CR
 1349/     507 : 20 0A                  		jr	nz, dir_usb2
 1350/     509 :                        		; Ende:
 1351/     509 : 3A 00 18               		ld	a, (cupos)	; cursor auf Zeilenende
 1352/     50C : E6 F0                  		and	0F0h
 1353/     50E : 32 00 18               		ld	(cupos), a
 1354/     511 : 3E 20                  		ld	a, ' '		; Leerzeichen ausgeben
 1355/     513 : D7                     dir_usb2:	rst	outch		; Zeichenausgabe
 1356/     514 : FE 3E                  		cp	'>'		; Prompt erkannt?
 1357/     516 : 20 EC                  		jr	nz, dir_usb1	; nein
 1358/     518 : EF                     		rst	GET		; noch CR einlesen
 1359/     519 : FE 0D                  		cp	0Dh
 1360/     51B : C2 47 07               		jp	nz, error1	; kein CR -> Fehler
 1361/     51E : C9                     		ret
 1362/     51F :                        
 1363/     51F :                        ; Datei loeschen
 1364/     51F : CD 0F 08               del_usb:	call	sub_80F		; Teste Filename
 1365/     522 : CD 5B 09               		call	sub_95B		; Headersave-Kopf befüllen
 1366/     525 : 3E 07                  		ld	a, 7		; Vinculum-Kdo  Delete File
 1367/     527 : C3 86 0E               		jp	sub_E86		; Kommando mit Filename senden
 1368/     52A :                        
 1369/     52A :                        ; Datei laden/speichern
 1370/     52A : CD 5B 09               ldsv_usb1:	call	sub_95B		; Headersave-Kopf befüllen
 1371/     52D :                        		; gibt es die Datei schon?
 1372/     52D : 3E 01                  		ld	a, 1		; Vinculum-Kdo  List files
 1373/     52F : CD BB 06               		call	sub_6BB		; Kommando mit Filename senden
 1374/     532 : 3E 0D                  		ld	a, 0Dh		; CR, Kommando ausführen
 1375/     534 : E7                     		rst	PUT
 1376/     535 : EF                     		rst	GET		; Kdo erfolgreich ausgeführt?
 1377/     536 : FE 0D                  		cp	0Dh
 1378/     538 : 20 21                  		jr	nz, ldsv_usb5	; nein -> Fehler
 1379/     53A : EF                     ldsv_usb2:	rst	GET		; folgt CR?
 1380/     53B : FE 0D                  		cp	0Dh
 1381/     53D : CA 2A 06               		jp	z, ldsv_usb17	; ja - Keine Datei gefunden
 1382/     540 : FE 20                  		cp	' '
 1383/     542 : 20 F6                  		jr	nz, ldsv_usb2
 1384/     544 : 06 04                  		ld	b, 4
 1385/     546 : 21 6A 18               		ld	hl, hs_gesamt
 1386/     549 : EF                     ldsv_usb3:	rst	GET
 1387/     54A : 77                     		ld	(hl), a
 1388/     54B : 23                     		inc	hl
 1389/     54C : 10 FB                  		djnz	ldsv_usb3
 1390/     54E : EF                     ldsv_usb4:	rst	GET
 1391/     54F : FE 0D                  		cp	0Dh
 1392/     551 : 20 FB                  		jr	nz, ldsv_usb4
 1393/     553 : EF                     		rst	GET
 1394/     554 : FE 3E                  		cp	'>'		; Prompt ?
 1395/     556 : 20 03                  		jr	nz, ldsv_usb5
 1396/     558 : EF                     		rst	GET
 1397/     559 : FE 0D                  		cp	0Dh
 1398/     55B : 20 6C                  ldsv_usb5:	jr	nz, ldsv_usb11	; nz-> Fehler
 1399/     55D : DD A5                  		and	ixl		;Modus (0=load, 1=save)
 1400/     55F : C2 4D 07               		jp	nz, loc_74D	;bei Save
 1401/     562 :                        ; load		
 1402/     562 : 3E 0E                  		ld	a, 0Eh		; Vinculum-Kdo  Open/read
 1403/     564 : CD 86 0E               		call	sub_E86		; Kommando mit Filename senden
 1404/     567 : ED 4B 6A 18            		ld	bc, (hs_gesamt)
 1405/     56B : AF                     		xor	a
 1406/     56C : 67                     		ld	h, a
 1407/     56D : 6F                     		ld	l, a		; hl=0
 1408/     56E : 22 68 18               		ld	(hs_rest), hl
 1409/     571 : 2E 20                  		ld	l, 20h ;
 1410/     573 : ED 42                  		sbc	hl, bc
 1411/     575 : 2A 5B 18               		ld	hl, (ARG1)
 1412/     578 : 3E 0B                  		ld	a, 0Bh		; Vinculum-Kdo Read from File
 1413/     57A : 38 06                  		jr	c, ldsv_usb6	
 1414/     57C : CD 1E 08               		call	put_length	; BC senden (Laenge)
 1415/     57F : C3 0E 06               		jp	ldsv_usb15
 1416/     582 :                        
 1417/     582 :                        ;
 1418/     582 : 01 20 00               ldsv_usb6:	ld	bc, 20h		; Erste 32 Bytes vom File
 1419/     585 : CD 1E 08               		call	put_length	; BC senden (Laenge)
 1420/     588 : 21 7E 18               		ld	hl, hs_aadr
 1421/     58B : 11 20 00               		ld	de, 20h	
 1422/     58E : CD 87 07               		call	sub_787		; ixl=0 max(bc,de) Bytes ab hl anzeigen
 1423/     591 :                        					; ixl<>0 max(bc,de) Bytes nach hl holen
 1424/     591 : CD 38 07               		call	PROMPTTEST	; Prompt, CR testen
 1425/     594 : 21 8E 18               		ld	hl, hs_fileinfo
 1426/     597 : 2B                     ldsv_usb7:	dec	hl
 1427/     598 : 3E D3                  		ld	a, 0D3h		; Kennung HeaderSaveKopf
 1428/     59A : BE                     		cp	(hl)
 1429/     59B : 20 74                  		jr	nz, ldsv_usb16	; kein HS-Kopf
 1430/     59D : 1C                     		inc	e
 1431/     59E : 7B                     		ld	a, e
 1432/     59F : FE 03                  		cp	3
 1433/     5A1 : 20 F4                  		jr	nz, ldsv_usb7	; 3xD3 erwartet
 1434/     5A3 : 2B                     		dec	hl
 1435/     5A4 : 4E                     		ld	c, (hl)		; Dateityp
 1436/     5A5 :                        		;
 1437/     5A5 : 21 8E 18               		ld	hl, hs_fileinfo
 1438/     5A8 : 7E                     ldsv_usb8:	ld	a, (hl)
 1439/     5A9 : D7                     		rst	outch		; Zeichenausgabe
 1440/     5AA : 23                     		inc	hl
 1441/     5AB : 1C                     		inc	e
 1442/     5AC : 7B                     		ld	a, e
 1443/     5AD : FE 13                  		cp	13h
 1444/     5AF : 20 F7                  		jr	nz, ldsv_usb8
 1445/     5B1 : DF                     		rst	prnst		; Ausgabe String
 1446/     5B2 : BA                     		db 0BAh
 1447/     5B3 : 79                     		ld	a, c
 1448/     5B4 : D7                     		rst	outch		; Zeichenausgabe
 1449/     5B5 : DF                     		rst	prnst		; Ausgabe String
 1450/     5B6 : A0                     		db 0A0h
 1451/     5B7 : CD B7 0A               		call	sub_AB7
 1452/     5BA : 28 21                  		jr	z, ldsv_usb14
 1453/     5BC : CD 84 0E               		call	sub_E84		; Close File
 1454/     5BF : DF                     ldsv_usb9:	rst	prnst		; Ausgabe String
 1455/     5C0 : 54 59 50 A0            		db "TYP",0A0h
 1456/     5C4 : DF                     ldsv_usb10:	rst	prnst		; Ausgabe String
 1457/     5C5 : 46 49 4C C5            		db "FIL",0C5h
 1458/     5C9 : C3 47 07               ldsv_usb11:	jp	error1
 1459/     5CC :                        ;
 1460/     5CC : DF                     ldsv_usb12:	rst	prnst		; Ausgabe String
 1461/     5CD : 45 58 49 53 54 A0      		db "EXIST",0A0h
 1462/     5D3 : 18 EF                  		jr	ldsv_usb10
 1463/     5D5 :                        
 1464/     5D5 :                        ;
 1465/     5D5 : DF                     ldsv_usb13:	rst	prnst		; Ausgabe String
 1466/     5D6 : 4E 41 4D 45 A0         		db "NAME",0A0h
 1467/     5DB : 18 E7                  		jr	ldsv_usb10
 1468/     5DD :                        ;		
 1469/     5DD : 2A 80 18               ldsv_usb14:	ld	hl, (hs_eadr)
 1470/     5E0 : ED 4B 7E 18            		ld	bc, (hs_aadr)
 1471/     5E4 : ED 42                  		sbc	hl, bc
 1472/     5E6 : 23                     		inc	hl
 1473/     5E7 : 22 66 18               		ld	(hs_laenge), hl	; Laenge
 1474/     5EA : E5                     		push	hl
 1475/     5EB : E5                     		push	hl
 1476/     5EC : 2A 6A 18               		ld	hl, (hs_gesamt)
 1477/     5EF : 1E 20                  		ld	e, 20h ; ' '
 1478/     5F1 : ED 52                  		sbc	hl, de
 1479/     5F3 : 44                     		ld	b, h
 1480/     5F4 : 4D                     		ld	c, l
 1481/     5F5 : 3E 0B                  		ld	a, 0Bh		; Vinculum-Kdo Read from File
 1482/     5F7 : CD 1E 08               		call	put_length	; BC senden (Laenge)
 1483/     5FA : D1                     		pop	de
 1484/     5FB : ED 52                  		sbc	hl, de
 1485/     5FD : 22 68 18               		ld	(hs_rest), hl	; Restlänge
 1486/     600 : C1                     		pop	bc
 1487/     601 : CD A0 06               		call	sub_6A0
 1488/     604 : 2A 5B 18               		ld	hl, (ARG1)
 1489/     607 : 7D                     		ld	a, l
 1490/     608 : B4                     		or	h
 1491/     609 : 20 03                  		jr	nz, ldsv_usb15
 1492/     60B : 2A 7E 18               		ld	hl, (hs_aadr)
 1493/     60E : F7                     ldsv_usb15:	rst	30h		; outhl
 1494/     60F : 18 61                  		jr	ldsv_usb20
 1495/     611 :                        
 1496/     611 :                        ;
 1497/     611 : CD 84 0E               ldsv_usb16:	call	sub_E84		; close file
 1498/     614 : 3E 0E                  		ld	a, 0Eh		; Vinculum-Kdo  Open/read
 1499/     616 : CD 86 0E               		call	sub_E86		; Kommando mit Filename senden
 1500/     619 : ED 4B 6A 18            		ld	bc, (hs_gesamt)
 1501/     61D : 3E 0B                  		ld	a, 0Bh		; Vinculum-Kdo Read from File
 1502/     61F : CD 1E 08               		call	put_length	; BC senden (Laenge)
 1503/     622 : 2A 5B 18               		ld	hl, (ARG1)
 1504/     625 : 22 82 18               		ld	(hs_sadr), hl
 1505/     628 : 18 E4                  		jr	ldsv_usb15
 1506/     62A :                        
 1507/     62A :                        ;
 1508/     62A : DD A5                  ldsv_usb17:	and	ixl
 1509/     62C : 28 A7                  		jr	z, ldsv_usb13
 1510/     62E :                        ;		
 1511/     62E : CD CA 04               ldsv_usb18:	call	para
 1512/     631 : EB                     		ex	de, hl
 1513/     632 : ED 52                  		sbc	hl, de
 1514/     634 : 38 93                  		jr	c, ldsv_usb11
 1515/     636 : 3E 09                  		ld	a, 9		; Vinculum-Kdo  Open/write
 1516/     638 : CD 86 0E               		call	sub_E86		; Kommando mit Filename senden
 1517/     63B : 20 98                  		jr	nz, ldsv_usb13
 1518/     63D : ED 4B 6A 18            		ld	bc, (hs_gesamt)
 1519/     641 : CD A5 01               		call	sub_1A5
 1520/     644 : 21 00 00               		ld	hl, 0
 1521/     647 : 20 0E                  		jr	nz, ldsv_usb19
 1522/     649 :                        	; basic		
 1523/     649 : FE 46                  		cp	'F'
 1524/     64B : 20 0A                  		jr	nz, ldsv_usb19
 1525/     64D : 2A AB 60               		ld	hl, (60ABh)	; LSTRAM  Last available RAM
 1526/     650 : ED 5B BF 60            		ld	de, (60BFh)	; STRBOT  Bottom of string space
 1527/     654 : ED 52                  		sbc	hl, de
 1528/     656 : 23                     		inc	hl
 1529/     657 : 22 68 18               ldsv_usb19:	ld	(hs_rest), hl
 1530/     65A : 09                     		add	hl, bc
 1531/     65B : 44                     		ld	b, h
 1532/     65C : 4D                     		ld	c, l
 1533/     65D : 3E 08                  		ld	a, 8		; Vinculum-Kdo Write to File
 1534/     65F : CD 1E 08               		call	put_length	; BC senden (Laenge)
 1535/     662 :                        		; Lese Kopfblock
 1536/     662 : 21 7E 18               		ld	hl, hs_buf
 1537/     665 : 06 20                  		ld	b, 20h 		; Anzahl
 1538/     667 : CD FA 0A               		call	loc_AFA		; Lese b Bytes nach (HL)
 1539/     66A : ED 4B 66 18            		ld	bc, (hs_laenge)	; Laenge
 1540/     66E : 2A 5B 18               		ld	hl, (ARG1)	; aadr ausgeben
 1541/     671 : F7                     		rst	30h		; outhl
 1542/     672 : DF                     ldsv_usb20:	rst	prnst		; Ausgabe String
 1543/     673 : A0                     		db ' ' + 80h
 1544/     674 :                        		; Lese Dateiinhalt
 1545/     674 : CD 84 07               		call	sub_784		; bc Bytes nach hl holen
 1546/     677 : CD A5 01               		call	sub_1A5
 1547/     67A : 20 0E                  		jr	nz, ldsv_usb22
 1548/     67C :                        	; Basic
 1549/     67C : FE 42                  		cp	'B'
 1550/     67E : 20 03                  		jr	nz, ldsv_usb21
 1551/     680 : 22 D2 60               		ld	(60D2h), hl	; PROGND  End of program
 1552/     683 : FE 46                  ldsv_usb21:	cp	'F'
 1553/     685 : 20 0A                  		jr	nz, ldsv_usb23
 1554/     687 : 2A BF 60               		ld	hl, (60BFh)	; STRBOT  Bottom of string space
 1555/     68A :                        ;		
 1556/     68A : ED 4B 68 18            ldsv_usb22:	ld	bc, (hs_rest)
 1557/     68E : CD 84 07               		call	sub_784		; bc Bytes nach hl holen
 1558/     691 : CD 38 07               ldsv_usb23:	call	PROMPTTEST	; Prompt, CR testen
 1559/     694 : CD 84 0E               		call	sub_E84		; close file
 1560/     697 : 2B                     		dec	hl		; HL=eadr ausgeben
 1561/     698 : F7                     		rst	30h		; outhl
 1562/     699 : 2A 82 18               		ld	hl, (hs_sadr)
 1563/     69C : DF                     		rst	prnst		; Ausgabe String
 1564/     69D : A0                     		db 0A0h
 1565/     69E : F7                     		rst	30h		; outhl startadr
 1566/     69F : C9                     		ret
 1567/     6A0 :                        
 1568/     6A0 :                        ;		
 1569/     6A0 : CD A5 01               sub_6A0:	call	sub_1A5
 1570/     6A3 : C0                     		ret	nz
 1571/     6A4 : FE 50                  		cp	'P'		; Programm?
 1572/     6A6 : C8                     		ret	z
 1573/     6A7 : E1                     		pop	hl
 1574/     6A8 : 2A 5B 18               		ld	hl, (ARG1)
 1575/     6AB : F7                     		rst	30h		; outhl
 1576/     6AC : FE 46                  		cp	'F'
 1577/     6AE : 1E AB                  		ld	e, 0ABh		; ??
 1578/     6B0 : 28 02                  		jr	z, loc_6B4
 1579/     6B2 : 1E F7                  		ld	e, 0F7h		; ??
 1580/     6B4 :                        
 1581/     6B4 : EF                     loc_6B4:	rst	GET
 1582/     6B5 : 0B                     		dec	bc
 1583/     6B6 : 1D                     		dec	e
 1584/     6B7 : 20 FB                  		jr	nz, loc_6B4
 1585/     6B9 : 18 B7                  		jr	ldsv_usb20
 1586/     6BB :                        
 1587/     6BB :                        ; Kommando mit Filename senden
 1588/     6BB : FD E5                  sub_6BB:	push	iy
 1589/     6BD : E7                     		rst	PUT		; Kommando
 1590/     6BE : 3E 20                  		ld	a, ' '
 1591/     6C0 : E7                     		rst	PUT
 1592/     6C1 : 06 0C                  		ld	b, 12
 1593/     6C3 : FD 7E 00               loc_6C3:	ld	a, (iy+0)
 1594/     6C6 : FD 23                  		inc	iy
 1595/     6C8 : FE 22                  		cp	'"'
 1596/     6CA : 28 07                  		jr	z, loc_6D3
 1597/     6CC : FE 21                  		cp	21h ; '!'
 1598/     6CE : D4 CF 02               		call	nc, rPUT	; rst20
 1599/     6D1 : 10 F0                  		djnz	loc_6C3
 1600/     6D3 : FD E1                  loc_6D3:	pop	iy
 1601/     6D5 : C9                     		ret
 1602/     6D6 :                        
 1603/     6D6 :                        ;------------------------------------------------------------------------------
 1604/     6D6 :                        ; Synchronisieren mit Vinculum:
 1605/     6D6 :                        ;------------------------------------------------------------------------------
 1606/     6D6 :                        
 1607/     6D6 :                        ; PIO Port B initialisieren
 1608/     6D6 : 3E CF                  USBInit:	ld	a, 0CFh		; Bitbetrieb
 1609/     6D8 : D3 FF                  		out	(PIO3BS), a
 1610/     6DA : 3E 33                  		ld	a, 00110011b	; I/O festlegen
 1611/     6DC : D3 FF                  		out	(PIO3BS), a
 1612/     6DE : 3E 07                  		ld	a, 7		; kein INT
 1613/     6E0 : D3 FF                  		out	(PIO3BS), a
 1614/     6E2 :                        ;VDIP Reset
 1615/     6E2 : 3E 84                  		ld	a, 84h
 1616/     6E4 : D3 FD                  		out	(PIO3B), a
 1617/     6E6 :                        ; PIO Port A initialisieren
 1618/     6E6 : 3E 8F                  		ld	a, 8Fh		; bidirektional
 1619/     6E8 : D3 FE                  		out	(PIO3AS), a
 1620/     6EA : 3E 07                  		ld	a, 7		; kein INT
 1621/     6EC : D3 FE                  		out	(PIO3AS), a
 1622/     6EE : DB FC                  		in	a, (PIO3A)	; Dummy-Eingabe
 1623/     6F0 : 3E C4                  		ld	a, 0C4h		; #PROG=1, #RESET=0, RD&WR inaktiv
 1624/     6F2 : D3 FD                  		out	(PIO3B), a
 1625/     6F4 :                        ; mehrstufiges Synchronisieren
 1626/     6F4 : 21 00 04               sync:		ld	hl, 400h
 1627/     6F7 : DB FD                  syn1:		in	a, (PIO3B)	; Status abfragen
 1628/     6F9 : 0F                     		rrca
 1629/     6FA : 38 03                  		jr	c, syn2		; keine	Daten vorhanden
 1630/     6FC : EF                     		rst	GET		; vorhandene Daten abholen
 1631/     6FD : 18 F5                  		jr	sync
 1632/     6FF : 0F                     syn2:		rrca
 1633/     700 : 38 F2                  		jr	c, sync		; noch nicht bereit, Daten zu schreiben
 1634/     702 : 10 FE                  syn2a:		djnz	syn2a		; kurze	Zeit warten
 1635/     704 : 2B                     		dec	hl
 1636/     705 : 7C                     		ld	a, h		; Zaehler abwarten
 1637/     706 : B5                     		or	l
 1638/     707 : 20 EE                  		jr	nz, syn1	; nochmals nachschauen...
 1639/     709 : DB FD                  		in	a, (PIO3B)	; Status abfragen
 1640/     70B : E6 03                  		and	3		; nur Bit 0 und	1 auswerten
 1641/     70D : FE 01                  		cp	1		; alle Daten abgeholt und bereit zum schreiben?
 1642/     70F : 20 E3                  		jr	nz, sync	; nein !
 1643/     711 : 3E 0D                  		ld	a, 0Dh
 1644/     713 : E7                     		rst	PUT
 1645/     714 : EF                     syn3:		rst	GET
 1646/     715 : FE 0D                  		cp	0Dh		; <cr> muss irgendwie <cr> zurueckgeben
 1647/     717 : 20 FB                  		jr	nz, syn3	; warten bis CR	geliefert wird
 1648/     719 : 3E 45                  		ld	a, 'E'		; E <cr> muss E <cr> zurueckgeben
 1649/     71B : E7                     		rst	PUT
 1650/     71C : 3E 0D                  		ld	a, 0Dh
 1651/     71E : E7                     		rst	PUT
 1652/     71F : EF                     syn4:		rst	GET
 1653/     720 : FE 45                  		cp	'E'
 1654/     722 : 20 FB                  		jr	nz, syn4	; warten bis E geliefert wird
 1655/     724 : EF                     		rst	GET
 1656/     725 : FE 0D                  		cp	0Dh		; auf CR warten
 1657/     727 : 20 F6                  		jr	nz, syn4
 1658/     729 :                        ; Test,	ob USB-Stick angeschlossen ist:
 1659/     729 : 3E 10                  		ld	a, 10h		; SCS		    ; Short CMD-Modus
 1660/     72B : E7                     		rst	PUT
 1661/     72C : CD 35 07               		call	EXEC		; Kommando ausfuehren
 1662/     72F : 3E 91                  		ld	a, 91h		; IPH               ; HEX- bzw. BIN-Modus
 1663/     731 : E7                     		rst	PUT
 1664/     732 : CD 35 07               		call	EXEC		; Kommando ausfuehren
 1665/     735 :                        ; und gleich nochmal als Test, ob Stick eingesteckt ?
 1666/     735 :                        
 1667/     735 :                        ; UP EXEC VDIP Kommando ausfuehren, Rueckkehr mit Z wenn OK
 1668/     735 : 3E 0D                  EXEC:		ld	a, 0Dh		; CR		    ; Kommando ausfuehren
 1669/     737 : E7                     		rst	PUT
 1670/     738 :                        ; Prompttest, Rueckkehr bei Fehler	mit C
 1671/     738 :                        ; Prompt, CR testen
 1672/     738 : EF                     PROMPTTEST:	rst	GET
 1673/     739 : FE 3E                  		cp	'>'
 1674/     73B : 20 04                  		jr	nz, ERR
 1675/     73D : EF                     		rst	GET
 1676/     73E : FE 0D                  		cp	0Dh		; CR		      ;	OK, fertig?
 1677/     740 : C8                     		ret	z
 1678/     741 :                        ;
 1679/     741 : D7                     ERR:		rst	outch		; Zeichenausgabe
 1680/     742 : EF                     		rst	GET
 1681/     743 : FE 0D                  		cp	0Dh		; CR		      ;	Ende?
 1682/     745 : 20 FA                  		jr	nz, ERR		; nein,	weiter bis CR folgt (Ende)
 1683/     747 :                        ;
 1684/     747 : CD 68 02               error1:		call	error
 1685/     74A : AF                     		xor	a
 1686/     74B : 3D                     		dec	a		; A = FF, Cy=1
 1687/     74C : C9                     		ret
 1688/     74D :                        
 1689/     74D :                        ; USB Save
 1690/     74D : 2A 00 18               loc_74D:	ld	hl, (cupos)
 1691/     750 : DF                     		rst	prnst		; Ausgabe String
 1692/     751 : 07 4F 76 65 72 57 72   		db 7,"OverWrite?(J)",8,88h
           758 : 69 74 65 3F 28 4A 29
           75F : 08 88               
 1693/     761 : CF                     		rst	inch		; inch; Zeicheneingabe
 1694/     762 : FE 0D                  		cp	0Dh
 1695/     764 : 28 0B                  		jr	z, loc_771
 1696/     766 : CB AF                  		res	5, a		; Umwandlung in Großbuchstabe
 1697/     768 : D7                     		rst	outch		; Zeichenausgabe
 1698/     769 : DF                     		rst	prnst		; Ausgabe String
 1699/     76A : 29 83                  		db ')',83h
 1700/     76C : FE 4A                  		cp	'J'
 1701/     76E : C2 CC 05               		jp	nz, ldsv_usb12
 1702/     771 :                        		
 1703/     771 : 22 00 18               loc_771:	ld	(cupos), hl
 1704/     774 : FD 7C                  		ld	a, iyu
 1705/     776 : FE 30                  		cp	CmdWr		; Write Sector
 1706/     778 : C8                     		ret	z
 1707/     779 : 3E 07                  		ld	a, 7		; Vinculum-Kdo  Delete File
 1708/     77B : CD 86 0E               		call	sub_E86		; Kommando mit Filename senden
 1709/     77E : CD A4 09               		call	sub_9A4
 1710/     781 : C3 2E 06               		jp	ldsv_usb18
 1711/     784 :                        
 1712/     784 :                        ;
 1713/     784 : 11 FF FF               sub_784:	ld	de, 0FFFFh
 1714/     787 :                        ; ixl		;Modus (0=load, 1=save)
 1715/     787 :                        ; ixl=0 max(bc,de) Bytes ab hl anzeigen
 1716/     787 :                        ; ixl<>0 max(bc,de) Bytes nach hl holen
 1717/     787 : 7B                     sub_787:	ld	a, e
 1718/     788 : B2                     		or	d
 1719/     789 : C8                     		ret	z		; de=0?
 1720/     78A : 79                     		ld	a, c
 1721/     78B : B0                     		or	b
 1722/     78C : C8                     		ret	z		; bc=0?
 1723/     78D : AF                     		xor	a
 1724/     78E : DD BD                  		cp	ixl		; ixl <> 0 PUT
 1725/     790 : 20 04                  		jr	nz, loc_796
 1726/     792 : EF                     		rst	GET		; ixl = 0 GET
 1727/     793 : 77                     		ld	(hl), a
 1728/     794 : 18 02                  		jr	loc_798
 1729/     796 : 7E                     loc_796:	ld	a, (hl)
 1730/     797 : E7                     		rst	PUT
 1731/     798 : E5                     loc_798:	push	hl
 1732/     799 : 2A 00 18               		ld	hl, (cupos)
 1733/     79C : 77                     		ld	(hl), a
 1734/     79D : E1                     		pop	hl
 1735/     79E : 23                     		inc	hl
 1736/     79F : 0B                     		dec	bc
 1737/     7A0 : 1B                     		dec	de
 1738/     7A1 : 18 E4                  		jr	sub_787		; ixl=0 max(bc,de) Bytes ab hl anzeigen
 1739/     7A3 :                        
 1740/     7A3 :                        ;------------------------------------------------------------------------------
 1741/     7A3 :                        ; rst28 GET
 1742/     7A3 :                        ; Eingabe von VDIP1 abholen (mit Break und TimeOut):
 1743/     7A3 :                        ; PA:	A	Datenbyte
 1744/     7A3 :                        ;	CY=1	TimeOut oder Break
 1745/     7A3 :                        ; VR:	AF
 1746/     7A3 :                        ;------------------------------------------------------------------------------
 1747/     7A3 :                        
 1748/     7A3 : DB 04                  rGET:		in	a, (PIODA); Tastatur
 1749/     7A5 : FE 83                  		cp	83h		; <STOP>-Taste gedrueckt?
 1750/     7A7 : CA 43 02               		jp	z, break1
 1751/     7AA : DB FD                  		in	a, (PIO3B)	; Status abfragen
 1752/     7AC : 0F                     		rrca
 1753/     7AD : 38 F4                  		jr	c, rGET
 1754/     7AF : 3E C0                  		ld	a, 0C0h		; RD# aktiv
 1755/     7B1 : D3 FD                  		out	(PIO3B),	a
 1756/     7B3 : DB FC                  		in	a, (PIO3A)	; Daten	holen
 1757/     7B5 : F5                     		push	af
 1758/     7B6 : 3E C4                  		ld	a, 0C4h		; RD# inaktiv
 1759/     7B8 : D3 FD                  		out	(PIO3B), a
 1760/     7BA : F1                     		pop	af
 1761/     7BB : C9                     		ret
 1762/     7BC :                        
 1763/     7BC :                        ;------------------------------------------------------------------------------
 1764/     7BC :                        ; Tausch Buffer-Adr Normal <-> Basic
 1765/     7BC :                        ;------------------------------------------------------------------------------
 1766/     7BC :                        
 1767/     7BC : D9                     sub_7BC:	exx
 1768/     7BD : 2A 62 18               		ld	hl, (hd_buffer)	; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 1769/     7C0 : ED 5B 64 18            		ld	de, (hd_bufbas)	; HD-Puffer GS-Basic 00	3E
 1770/     7C4 : EB                     		ex	de, hl
 1771/     7C5 : 22 62 18               		ld	(hd_buffer), hl	; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 1772/     7C8 : ED 53 64 18            		ld	(hd_bufbas), de	; HD-Puffer GS-Basic 00	3E
 1773/     7CC : D9                     		exx
 1774/     7CD : C9                     		ret
 1775/     7CE :                        
 1776/     7CE :                        ;------------------------------------------------------------------------------
 1777/     7CE :                        ;
 1778/     7CE :                        ;------------------------------------------------------------------------------
 1779/     7CE :                        
 1780/     7CE : 2A 38 02               init_gsb:	ld	hl, (igsbslm)	; Voreinstellung Methode GSB SAVE/Load USB HD 00h 20h
 1781/     7D1 : 22 61 18               		ld	(gsbslm), hl	; Methode GSB SAVE/Load	USB HD 00h 20h
 1782/     7D4 : 2E 00                  		ld	l, 0
 1783/     7D6 : 22 62 18               		ld	(hd_buffer), hl	; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 1784/     7D9 : 26 3E                  		ld	h, 3Eh 
 1785/     7DB : 22 64 18               		ld	(hd_bufbas), hl	; HD-Puffer GS-Basic 00	3E
 1786/     7DE :                        
 1787/     7DE :                        ; patcheinschub
 1788/     7DE :                        ; zu colkdo
 1789/     7DE : =>FALSE                	if p_colkdo
 1790/     7DE :                        		ret
 1791/     7DE :                        ;zu colkdo	
 1792/     7DE :                        colkdo1		ld	l, c
 1793/     7DE :                        		rst	prnst
 1794/     7DE :                        		db 0A0h
 1795/     7DE :                        		call	j_OUTHL		; BC = ARG3
 1796/     7DE :                        		rst	prnst
 1797/     7DE :                        		db 8Dh
 1798/     7DE :                        		ret
 1799/     7DE : =>TRUE                 	else
 1800/     7DE : 00                     		nop
 1801/     7DF : 00                     		nop
 1802/     7E0 : 00                     		nop
 1803/     7E1 : C9                     		ret
 1804/     7E2 :                        
 1805/     7E2 : FF                     		db 0FFh
 1806/     7E3 : FF                     		db 0FFh
 1807/     7E4 : FF                     		db 0FFh
 1808/     7E5 : FF                     		db 0FFh
 1809/     7E6 : FF                     		db 0FFh
 1810/     7E7 : FF                     		db 0FFh
 1811/     7E8 : [1789]                 	endif
 1812/     7E8 :                        	
 1813/     7E8 :                        ; Einschub
 1814/     7E8 :                        ;------------------------------------------------------------------------------
 1815/     7E8 :                        ; Sprungverteiler
 1816/     7E8 :                        ; an dieser festen Adr. zur Kompatibilität mit Ur-AC1
 1817/     7E8 :                        ; (Ende 2K-EPROM)
 1818/     7E8 :                        ;------------------------------------------------------------------------------
 1819/     7E8 :                        
 1820/     7E8 :                        		org	07E8h	; fixe Adresse
 1821/     7E8 :                        
 1822/     7E8 : C3 F9 0D               		jp	v24out
 1823/     7EB : C3 1D 01               		jp	MS30
 1824/     7EE : C3 83 01               j_OUTHEX:	jp	OUTHEX
 1825/     7F1 : C3 9A 01               		jp	OUTHL
 1826/     7F4 : C3 28 01               		jp	INLINE
 1827/     7F7 : C3 72 01               		jp	INHEX
 1828/     7FA : C3 16 01               j_TASTE:	jp	TASTE
 1829/     7FD : C3 5B 02               		jp	GETCO1
 1830/     800 :                        
 1831/     800 :                        ;------------------------------------------------------------------------------
 1832/     800 :                        ; Kennung Monitor + Sprungverteiler externes SAVE/LOAD
 1833/     800 :                        ;------------------------------------------------------------------------------
 1834/     800 :                        
 1835/     800 :                        		org 800h	; fixe Adresse
 1836/     800 : 4D 4F 31 31 2E 30      monver:		db "MO11.0"		; Monitorkennung
 1837/     806 :                        		
 1838/     806 : C3 8D 0A               		jp	EX_SA_LO	; XX_SAVE/LOAD
 1839/     809 : C3 D6 06               		jp	USBInit
 1840/     80C : C3 8F 0B               		jp	HDInit
 1841/     80F :                        
 1842/     80F :                        
 1843/     80F :                        ;------------------------------------------------------------------------------
 1844/     80F :                        ; Teste Filename
 1845/     80F :                        ;
 1846/     80F :                        ; in DE=Adr. in BWS auf Leerzeichen vor Filename
 1847/     80F :                        ; in D=0Fh, wenn KEIN " am Filenamensanfang
 1848/     80F :                        ; sonst DE=18D4h
 1849/     80F :                        ; ret z=1 -> kein Filename
 1850/     80F :                        ; ret z=0 -> a=..
 1851/     80F :                        ;         -> gültiger Filename, de=Anfang Filename, a=23h
 1852/     80F :                        ;------------------------------------------------------------------------------
 1853/     80F :                        
 1854/     80F : 3E 0F                  sub_80F:	ld	a, 0Fh		; Direktmodus?
 1855/     811 : BA                     		cp	d		; 
 1856/     812 : C8                     		ret	z		; ja, Ende
 1857/     813 :                        		
 1858/     813 :                        		; wenn BWS, dann muss hier " folgen
 1859/     813 : 1B                     		dec	de		; ein Zeichen vor
 1860/     814 : 1A                     		ld	a, (de)
 1861/     815 : FE 20                  		cp	' '		; Leerzeicheh?	
 1862/     817 : C8                     		ret	z		; ja, Ende, da kein Filename angegeben
 1863/     818 :                        
 1864/     818 : FE 22                  		cp	'"'		; steht " am Filenamensanfang?
 1865/     81A : C0                     		ret	nz		; nein, Ende
 1866/     81B :                        		
 1867/     81B : 1B                     		dec	de		; ein zeichen vor
 1868/     81C :                        					; DE zeigt auf Filename
 1869/     81C : 3C                     		inc	a		; A=23h
 1870/     81D : C9                     		ret
 1871/     81E :                        
 1872/     81E :                        ;------------------------------------------------------------------------------
 1873/     81E :                        ; BC senden (Laenge)
 1874/     81E :                        ;------------------------------------------------------------------------------
 1875/     81E :                        
 1876/     81E : E7                     put_length:	rst	PUT		; Kdo senden
 1877/     81F : 3E 20                  		ld	a, ' '          ; Trennzeichen
 1878/     821 : E7                     		rst	PUT
 1879/     822 : AF                     		xor	a		; 00
 1880/     823 : E7                     		rst	PUT
 1881/     824 : E7                     		rst	PUT
 1882/     825 : 78                     		ld	a, b		; niedrigste Stelle (00xxH)
 1883/     826 : E7                     		rst	PUT
 1884/     827 : 79                     		ld	a, c		; niedrigste Stelle (00xxH)
 1885/     828 : E7                     		rst	PUT
 1886/     829 : 3E 0D                  		ld	a, 0Dh		; CR
 1887/     82B : E7                     		rst	PUT
 1888/     82C : C9                     		ret
 1889/     82D :                        
 1890/     82D :                        ;------------------------------------------------------------------------------
 1891/     82D :                        ; D Dump Hexdump und ASCII-Darstellung, sowie Modifikation
 1892/     82D :                        ; D aaaa Dump normal
 1893/     82D :                        ; D aaaa eeee Dump drucken
 1894/     82D :                        ;------------------------------------------------------------------------------
 1895/     82D :                        
 1896/     82D : 00 09 44 0D            		db 0,9,'D',0Dh
 1897/     831 :                        
 1898/     831 : DD 2A 5D 18            		ld	ix, (ARG2)	; eeee
 1899/     835 : AF                     		xor	a
 1900/     836 : 32 5F 18               d_ko1:		ld	(ARG3),	a	;arg3 = Modus (0-Hex, FF-Ascii-Dump)
 1901/     839 : 21 5D 18               		ld	hl, ARG2
 1902/     83C : 3A 5E 18               		ld	a, (ARG2+1)
 1903/     83F : B6                     		or	(hl)
 1904/     840 : 32 60 18               		ld	(ARG3+1), a	; Arg3+1 <> 0 -> eeee angegeben
 1905/     843 :                        		;
 1906/     843 : DF                     		rst	prnst		; Ausgabe String
 1907/     844 : 2A 8D                  		db '*',8Dh
 1908/     846 : 0E 01                  d_ko2:		ld	c, 1
 1909/     848 : 2A 5B 18               		ld	hl, (ARG1)
 1910/     84B : 7D                     		ld	a, l
 1911/     84C : E6 F8                  		and	0F8h 		; aaaa abrunden auf Vielfaches von 8
 1912/     84E : 6F                     		ld	l, a
 1913/     84F : CD 40 04               		call	dmp_zeile	; Ausgabe Zeile
 1914/     852 : 3A 60 18               		ld	a, (ARG3+1)
 1915/     855 : A7                     		and	a
 1916/     856 : 28 0F                  		jr	z, d_ko4	; keine Endadresse angegeben
 1917/     858 :                        		
 1918/     858 :                        		; Ausgbe fortlaufend, z.B. für Druck
 1919/     858 :                        		; gleich weiter mit nächster Zeile
 1920/     858 : DF                     		rst	prnst		; Ausgabe String
 1921/     859 : 8D                     		db 8Dh			; neue Zeile
 1922/     85A : ED 5B 5B 18            d_ko3:		ld	de, (ARG1)
 1923/     85E : DD E5                  		push	ix
 1924/     860 : E1                     		pop	hl
 1925/     861 : A7                     		and	a
 1926/     862 : ED 52                  		sbc	hl, de		; eeee erreicht?
 1927/     864 : D8                     		ret	c		; ja
 1928/     865 : 18 DF                  		jr	d_ko2		; sonst weiter ausgeben
 1929/     867 :                        
 1930/     867 :                        		; Einzelausgabe/Editieren
 1931/     867 : CD FA 07               d_ko4:		call	j_TASTE		; Tastaturabfrage
 1932/     86A : 28 07                  		jr	z, d_ko6	; keine Taste gedrückt
 1933/     86C :                        		;
 1934/     86C : DF                     		rst	prnst		; Ausgabe String
 1935/     86D : 8D                     		db 8Dh			; neue Zeile
 1936/     86E : 18 D6                  		jr	d_ko2
 1937/     870 :                        ;		
 1938/     870 : CD 40 04               d_ko5:		call	dmp_zeile	; Ausgabe Zeile
 1939/     873 : 2A 5D 18               d_ko6:		ld	hl, (ARG2)	; eeee
 1940/     876 :                        		; + aktuelles Byte
 1941/     876 : 09                     		add	hl, bc
 1942/     877 : 2B                     		dec	hl
 1943/     878 :                        		; Anzeige aktuelle Adresse
 1944/     878 : DF                     		rst	prnst		; Ausgabe String
 1945/     879 : 20 BC                  		db ' ','<'+80h
 1946/     87B : CD 9A 01               		call	OUTHL
 1947/     87E : DF                     		rst	prnst		; Ausgabe String
 1948/     87F : BE                     		db '>'+80h
 1949/     880 :                        		; 
 1950/     880 : 3A 5F 18               		ld	a, (ARG3)	; Hext-Dump?
 1951/     883 : A7                     		and	a
 1952/     884 : 20 08                  		jr	nz, d_ko7	; nein
 1953/     886 :                        		; Hex-Dump
 1954/     886 : DF                     		rst	prnst		; Ausgabe String
 1955/     887 : 20 28 48 29 A0         		db " (H)",0A0h
 1956/     88C : 18 06                  		jr	d_ko8
 1957/     88E :                        d_ko7:		; ASCII-Dump
 1958/     88E : DF                     		rst	prnst		; Ausgabe String
 1959/     88F : 20 28 41 29 A0         		db " (A)",0A0h
 1960/     894 :                        ;		
 1961/     894 : ED 53 00 18            d_ko8:		ld	(cupos), de
 1962/     898 : 41                     		ld	b, c
 1963/     899 : DF                     d_ko9:		rst	prnst		; Ausgabe String
 1964/     89A : 09 09 89               		db 9,9,89h		; je Byte 3x rechts
 1965/     89D : 10 FA                  		djnz	d_ko9
 1966/     89F :                        		;
 1967/     89F : CD FA 07               		call	j_TASTE		; Tastaturabfrage
 1968/     8A2 : FE 8B                  		cp	8Bh 		; Kursor nach oben, Taste gedrückt
 1969/     8A4 : 28 5D                  		jr	z, d_ko19
 1970/     8A6 :                        ;		
 1971/     8A6 : CF                     d_ko10:		rst	inch		; inch; Zeicheneingabe
 1972/     8A7 : FE 08                  		cp	8		; Kursor nach links
 1973/     8A9 : CA 32 09               		jp	z, d_ko26
 1974/     8AC : FE 03                  		cp	3		; Strg-C, Ende
 1975/     8AE : 28 43                  		jr	z, d_ko17	
 1976/     8B0 : FE 0D                  d_ko11:		cp	0Dh		; CR, Kursor an Anfang nächster Zeile; Enter
 1977/     8B2 : 28 37                  		jr	z, d_ko16
 1978/     8B4 : FE 01                  		cp	1		; Home, Toggle Modus
 1979/     8B6 : 28 41                  		jr	z, d_ko18
 1980/     8B8 : FE 09                  d_ko12:		cp	9		; Kursor nach rechts
 1981/     8BA : 28 5F                  		jr	z, d_ko22
 1982/     8BC : FE 0A                  		cp	0Ah		; Kursor nach unten
 1983/     8BE : 28 6C                  		jr	z, d_ko25
 1984/     8C0 : FE 0B                  		cp	0Bh		; Kursor nach oben
 1985/     8C2 : 28 3F                  		jr	z, d_ko19
 1986/     8C4 : FE 20                  		cp	20h ; ' '
 1987/     8C6 : 38 DE                  		jr	c, d_ko10	; sonstige Steuerzeichen werden nicht verarbeitet
 1988/     8C8 :                        		; Zeicheneingabe
 1989/     8C8 : 08                     		ex	af, af'
 1990/     8C9 : 3A 5F 18               		ld	a, (ARG3)
 1991/     8CC : A7                     		and	a
 1992/     8CD : 20 3C                  		jr	nz, d_ko20	; wenn Ascii-Modus
 1993/     8CF :                        ; Zeicheneingabe Hex-Modus
 1994/     8CF :                        ; Eingabe 2 Hex-Zeichen
 1995/     8CF : 08                     		ex	af, af'
 1996/     8D0 : CD 93 04               		call	tsthex		; 1. Zeichen Hex ?
 1997/     8D3 : 38 D1                  		jr	c, d_ko10	; nein, Neueingabe
 1998/     8D5 : 06 02                  		ld	b, 2
 1999/     8D7 : D7                     d_ko13:		rst	outch		; Zeichenausgabe
 2000/     8D8 : FE 3A                  		cp	'9'+1
 2001/     8DA : 38 02                  		jr	c, d_ko14
 2002/     8DC : D6 37                  		sub	37h ; '7'
 2003/     8DE : ED 6F                  d_ko14:		rld
 2004/     8E0 : 05                     		dec	b
 2005/     8E1 : 28 2F                  		jr	z, d_ko21
 2006/     8E3 : CF                     d_ko15:		rst	inch		; inch; Zeicheneingabe
 2007/     8E4 : CD 93 04               		call	tsthex		; 2. Zeichen Hex ?
 2008/     8E7 : 38 FA                  		jr	c, d_ko15	; nein, Neueingabe
 2009/     8E9 : 18 EC                  		jr	d_ko13
 2010/     8EB :                        ; Enter
 2011/     8EB : CD A1 04               d_ko16:		call	loc_4A1		; Ausgabe 12 Leerzeichen an Zeilenanfang
 2012/     8EE : DF                     		rst	prnst		; Ausgabe String
 2013/     8EF : 8D                     		db 8Dh
 2014/     8F0 : C3 46 08               		jp	d_ko2
 2015/     8F3 :                        ; 03 Ende
 2016/     8F3 : DF                     d_ko17:		rst	prnst		; Ausgabe String
 2017/     8F4 : 8D                     		db 8Dh
 2018/     8F5 : 22 5B 18               		ld	(ARG1),	hl
 2019/     8F8 : C9                     		ret
 2020/     8F9 :                        ; Home, toggle Modus
 2021/     8F9 : 3A 5F 18               d_ko18:		ld	a, (ARG3)	; Modus
 2022/     8FC : 2F                     		cpl
 2023/     8FD : 32 5F 18               		ld	(ARG3),	a
 2024/     900 : C3 70 08               		jp	d_ko5
 2025/     903 :                        
 2026/     903 :                        ; Kursor nach oben	
 2027/     903 : 11 08 00               d_ko19:		ld	de, 8
 2028/     906 : A7                     		and	a
 2029/     907 : ED 52                  		sbc	hl, de
 2030/     909 : 18 2D                  		jr	d_ko27
 2031/     90B :                        
 2032/     90B :                        ; Zeicheneingabe Ascii-Modus
 2033/     90B :                        ; c = Nr. aktives Byte
 2034/     90B : 08                     d_ko20:		ex	af, af'	; '
 2035/     90C : CD 84 04               		call	tstzei		; Zeichen?
 2036/     90F : 38 95                  		jr	c, d_ko10	; nein, Neueingabe
 2037/     911 : 77                     		ld	(hl), a		; Zeichen in Speicher
 2038/     912 : 3E 08                  d_ko21:		ld	a, 8		; max 8 Zeichen
 2039/     914 : B9                     		cp	c		; erreicht?
 2040/     915 : 20 04                  		jr	nz, d_ko22	; nein
 2041/     917 : CD 40 04               		call	dmp_zeile	; ja: Ausgabe Zeile
 2042/     91A : 2B                     		dec	hl
 2043/     91B : 0C                     d_ko22:		inc	c		; nächstes Byte
 2044/     91C : 23                     		inc	hl
 2045/     91D : 3E 09                  		ld	a, 9
 2046/     91F : B9                     		cp	c		; max 8 Byte
 2047/     920 : 20 07                  		jr	nz, d_ko24
 2048/     922 : 0E 01                  		ld	c, 1		; erstes Byte
 2049/     924 : CD A1 04               d_ko23:		call	loc_4A1		; Ausgabe 12 Leerzeichen an Zeilenanfang
 2050/     927 : DF                     		rst	prnst		; Ausgabe String
 2051/     928 : 8A                     		db 8Ah
 2052/     929 : C3 70 08               d_ko24:		jp	d_ko5
 2053/     92C :                        
 2054/     92C :                        ; Kursor nach unten
 2055/     92C : 11 08 00               d_ko25:		ld	de, 8	
 2056/     92F : 19                     		add	hl, de
 2057/     930 : 18 F2                  		jr	d_ko23
 2058/     932 :                        
 2059/     932 :                        ; Kursor nach links
 2060/     932 : 2B                     d_ko26:		dec	hl
 2061/     933 : 0D                     		dec	c
 2062/     934 : 20 F3                  		jr	nz, d_ko24
 2063/     936 : 0E 08                  		ld	c, 8
 2064/     938 : CD A1 04               d_ko27:		call	loc_4A1		; Ausgabe 12 Leerzeichen an Zeilenanfang
 2065/     93B : ED 5B 00 18            		ld	de, (cupos)
 2066/     93F : E5                     		push	hl
 2067/     940 : 21 BF 17               		ld	hl, bwsat(1,1)	; 17BFh	
 2068/     943 : ED 52                  		sbc	hl, de
 2069/     945 : E1                     		pop	hl
 2070/     946 : 30 0F                  		jr	nc, d_ko28
 2071/     948 : D9                     		exx
 2072/     949 :                        		; scroll
 2073/     949 : 21 40 10               		ld	hl, BWSEND+COLS
 2074/     94C : 11 00 10               		ld	de, BWSEND
 2075/     94F : 01 BF 07               		ld	bc, COLS*(LINES-1)-1
 2076/     952 : ED B0                  		ldir
 2077/     954 : D9                     		exx
 2078/     955 : 18 D2                  		jr	d_ko24
 2079/     957 : DF                     d_ko28:		rst	prnst		; Ausgabe String
 2080/     958 : 8B                     		db 8Bh
 2081/     959 : 18 CE                  		jr	d_ko24
 2082/     95B :                        
 2083/     95B :                        ;------------------------------------------------------------------------------
 2084/     95B :                        ; UP zu USB
 2085/     95B :                        ; Headersave-Kopf befüllen
 2086/     95B :                        ; in DE=Adr. Filename (im BWS)  ABCD.." (ohne führendes ")
 2087/     95B :                        ;------------------------------------------------------------------------------
 2088/     95B :                        
 2089/     95B : 06 10                  sub_95B:	ld	b, 16		; Länge Filename
 2090/     95D : 21 6E 18               		ld	hl, unk_186E	; Adr.Puffer
 2091/     960 : E5                     		push	hl
 2092/     961 : FD E1                  		pop	iy
 2093/     963 : 7A                     loc_963:	ld	a, d
 2094/     964 : FE 0F                  		cp	hi(BWSEND)-1	; BWS-Ende ?
 2095/     966 : 28 05                  		jr	z, loc_96D	; ja
 2096/     968 : 1A                     		ld	a, (de)		; erstes Zeichen
 2097/     969 : FE 22                  		cp	'"'		; Namensende erreicht?
 2098/     96B : 20 03                  		jr	nz, loc_970	; nein -> Zeichen übertragen
 2099/     96D : 3E 20                  loc_96D:	ld	a, ' '		; sonst mit Leerzeichen auffüllen
 2100/     96F : 13                     		inc	de		; BWS-Pointer zurück (bleibt auf ")
 2101/     970 : 77                     loc_970:	ld	(hl), a		; filename kopieren
 2102/     971 : 23                     		inc	hl		; nächste Adr. Buffer
 2103/     972 : 1B                     		dec	de		; nächste Adr. BWS
 2104/     973 : 10 EE                  		djnz	loc_963		; weiter bis 16 Zeichen fertig
 2105/     975 :                        		;
 2106/     975 : 7A                     		ld	a, d
 2107/     976 : FE 0F                  		cp	hi(BWSEND)-1	; BWS-Ende ?
 2108/     978 : C8                     		ret	z		; ja, Ende
 2109/     979 :                        		; wenn Eingabe von BWS
 2110/     979 : 1B                     		dec	de		; 2 Zeichen weiter	
 2111/     97A : 1B                     		dec	de
 2112/     97B : 1A                     		ld	a, (de)		; Dateityp
 2113/     97C : 1B                     		dec	de		; 2 Zeichen weiter
 2114/     97D : 1B                     		dec	de
 2115/     97E : D5                     		push	de		; Beginn Kommentar
 2116/     97F :                        		; aaadr, eadr, sadr eintragen
 2117/     97F : 21 5B 18               		ld	hl, ARG1
 2118/     982 : 11 7E 18               		ld	de, hs_aadr
 2119/     985 : 01 06 00               		ld	bc, 6
 2120/     988 : ED B0                  		ldir
 2121/     98A :                        		; hs_cod mit Monitor-Kennung füllen
 2122/     98A : 21 00 08               		ld	hl, monver	; "MO11.0"
 2123/     98D : 0E 06                  		ld	c, 6
 2124/     98F : ED B0                  		ldir
 2125/     991 :                        		; hs_filetyp Dateityp eintragen
 2126/     991 : 12                     		ld	(de), a
 2127/     992 : 13                     		inc	de
 2128/     993 :                        		; hs_kennung 3 x D3 Kennung Headersave-Kopf 
 2129/     993 : 3E D3                  		ld	a, 0D3h	
 2130/     995 : 12                     		ld	(de), a
 2131/     996 : 13                     		inc	de
 2132/     997 : 12                     		ld	(de), a
 2133/     998 : 13                     		inc	de
 2134/     999 : 12                     		ld	(de), a
 2135/     99A : 13                     		inc	de
 2136/     99B :                        		; hs_fileinfo Kommentar eintragen
 2137/     99B : E1                     		pop	hl
 2138/     99C : 06 10                  		ld	b, 16		; Länge
 2139/     99E : 7E                     loc_99E:	ld	a, (hl)
 2140/     99F : 12                     		ld	(de), a
 2141/     9A0 : 2B                     		dec	hl
 2142/     9A1 : 13                     		inc	de
 2143/     9A2 : 10 FA                  		djnz	loc_99E
 2144/     9A4 :                        
 2145/     9A4 :                        ; Berechne Dateilänge
 2146/     9A4 : CD CA 04               sub_9A4:	call	para		; aadr, eadr
 2147/     9A7 : AF                     		xor	a
 2148/     9A8 : EB                     		ex	de, hl	
 2149/     9A9 : ED 52                  		sbc	hl, de		; eadr-aadr
 2150/     9AB : 23                     		inc	hl		; Länge=eadr-aadr+1
 2151/     9AC : 22 66 18               		ld	(hs_laenge), hl	; Laenge
 2152/     9AF : 11 20 00               		ld	de, 20h		; Länge HS-Block
 2153/     9B2 : 19                     		add	hl, de
 2154/     9B3 : 22 6A 18               		ld	(hs_gesamt), hl	; Länge incl. Header
 2155/     9B6 : C9                     		ret
 2156/     9B7 :                        
 2157/     9B7 :                        ;------------------------------------------------------------------------------
 2158/     9B7 :                        ; s HD Save Speichert ein File in DVHD
 2159/     9B7 :                        ;------------------------------------------------------------------------------
 2160/     9B7 : 00 09 73 0D            		db 0,9,'s',0Dh
 2161/     9BB :                        
 2162/     9BB : FE 2D                  		cp	'-'
 2163/     9BD : C8                     		ret	z
 2164/     9BE :                        
 2165/     9BE : 3E 30                  save0_hd:	ld	a, CmdWr	; Write Sector
 2166/     9C0 : 18 0C                  		jr	loc_9CE
 2167/     9C2 :                        
 2168/     9C2 :                        ;------------------------------------------------------------------------------
 2169/     9C2 :                        ; HD Load	Laedt ein in DVHD gespeichertes File von HD
 2170/     9C2 :                        ;------------------------------------------------------------------------------
 2171/     9C2 :                        
 2172/     9C2 : 00 09 6C 0D            		db 0,9,'l',0Dh
 2173/     9C6 :                        
 2174/     9C6 : AF                     		xor	a
 2175/     9C7 : 32 B0 18               ld_hd:		ld	(filetyp), a
 2176/     9CA : AF                     load0_hd:	xor	a
 2177/     9CB : 08                     		ex	af, af'		; '
 2178/     9CC : 3E 20                  		ld	a, CmdRd	; Read Sector
 2179/     9CE :                        
 2180/     9CE :                        ;
 2181/     9CE : FD 67                  loc_9CE:	ld	iyu, a
 2182/     9D0 : FD 2E 20               		ld	iyl, CmdRd	; Read Sector
 2183/     9D3 : CD 8F 0B               		call	HDInit
 2184/     9D6 : C2 47 07               		jp	nz, error1
 2185/     9D9 : D5                     		push	de
 2186/     9DA : CD 41 0A               		call	sub_A41
 2187/     9DD : CD 59 0A               		call	sub_A59
 2188/     9E0 : D1                     		pop	de
 2189/     9E1 : CD 0F 08               		call	sub_80F		; Teste Filename
 2190/     9E4 : ED 53 B1 18            		ld	(unk_18B1), de	; Adr. Filename
 2191/     9E8 : CA A2 0C               		jp	z, loc_CA2
 2192/     9EB : C3 A9 0C               		jp	loc_CA9
 2193/     9EE :                        
 2194/     9EE : DD E5                  sub_9EE:	push	ix
 2195/     9F0 : DF                     		rst	prnst		; Ausgabe String
 2196/     9F1 : 91                     		db 91h
 2197/     9F2 : 06 10                  		ld	b, 10h
 2198/     9F4 : DD 7E 00               loc_9F4:	ld	a, (ix+0)
 2199/     9F7 : D7                     		rst	outch		; Zeichenausgabe
 2200/     9F8 : DD 23                  		inc	ix
 2201/     9FA : 10 F8                  		djnz	loc_9F4
 2202/     9FC : DF                     		rst	prnst		; Ausgabe String
 2203/     9FD : 20 90                  		db ' ',90h
 2204/     9FF : DD 7E 09               		ld	a, (ix+9)
 2205/     A02 : D7                     		rst	outch		; Zeichenausgabe
 2206/     A03 : DF                     		rst	prnst		; Ausgabe String
 2207/     A04 : BA                     		db 0BAh
 2208/     A05 : AF                     		xor	a
 2209/     A06 : B3                     		or	e
 2210/     A07 : 28 11                  		jr	z, loc_A1A
 2211/     A09 : 06 02                  		ld	b, 2
 2212/     A0B : DD 23                  loc_A0B:	inc	ix
 2213/     A0D : DD 6E 00               		ld	l, (ix+0)
 2214/     A10 : DD 23                  		inc	ix
 2215/     A12 : DD 66 00               		ld	h, (ix+0)
 2216/     A15 : F7                     		rst	30h		; outhl
 2217/     A16 : DF                     		rst	prnst		; Ausgabe String
 2218/     A17 : A0                     		db 0A0h
 2219/     A18 : 10 F1                  		djnz	loc_A0B
 2220/     A1A : DD E1                  loc_A1A:	pop	ix
 2221/     A1C : C9                     		ret
 2222/     A1D :                        
 2223/     A1D : =>FALSE                	if p_colkdo
 2224/     A1D :                        ;------------------------------------------------------------------------------
 2225/     A1D :                        ; :: Arg. Argument Anzeige
 2226/     A1D :                        ;------------------------------------------------------------------------------
 2227/     A1D :                        		
 2228/     A1D :                        		db 0,9,':',0Dh
 2229/     A1D :                        
 2230/     A1D :                        		call	para
 2231/     A1D :                        		call	j_OUTHL		; HL = ARG1
 2232/     A1D :                        		rst	prnst
 2233/     A1D :                        		db 0A0h
 2234/     A1D :                        		ex	de, hl
 2235/     A1D :                        		call	j_OUTHL		; DE = ARG2
 2236/     A1D :                        		ld	h, b
 2237/     A1D :                        		jp	colkdo1		; an anderer Stelle geht weiter
 2238/     A1D : =>TRUE                 	else
 2239/     A1D : FF                     		db 0FFh
 2240/     A1E : FF                     		db 0FFh
 2241/     A1F : FF                     		db 0FFh
 2242/     A20 : FF                     		db 0FFh
 2243/     A21 : FF                     		db 0FFh
 2244/     A22 : FF                     		db 0FFh
 2245/     A23 : FF                     		db 0FFh
 2246/     A24 : FF                     		db 0FFh
 2247/     A25 : FF                     		db 0FFh
 2248/     A26 : FF                     		db 0FFh
 2249/     A27 : FF                     		db 0FFh
 2250/     A28 : FF                     		db 0FFh
 2251/     A29 : FF                     		db 0FFh
 2252/     A2A : FF                     		db 0FFh
 2253/     A2B : FF                     		db 0FFh
 2254/     A2C : FF                     		db 0FFh
 2255/     A2D : FF                     		db 0FFh
 2256/     A2E : FF                     		db 0FFh
 2257/     A2F : FF                     		db 0FFh
 2258/     A30 : FF                     		db 0FFh
 2259/     A31 : [2223]                 	endif
 2260/     A31 :                        
 2261/     A31 :                        ;------------------------------------------------------------------------------
 2262/     A31 :                        ; Start/Stop-Schaltung stopp
 2263/     A31 :                        ; UP TB aus (Ton und Interrupt wieder ein)
 2264/     A31 :                        ;------------------------------------------------------------------------------
 2265/     A31 :                        
 2266/     A31 :                        		org 0A31h	; fixe Adresse
 2267/     A31 :                        tb_aus:
 2268/     A31 : DB 05                  q_ko20:		in	a, (PIODB)	; Grafik/Ton
 2269/     A33 : CB AF                  		res	5, a
 2270/     A35 : 18 05                  		jr	loc_A3C
 2271/     A37 :                        
 2272/     A37 :                        ;------------------------------------------------------------------------------
 2273/     A37 :                        ;Start/Stop-Schaltung start
 2274/     A37 :                        ; UP TB ein (Ton und Interrupt sperren)
 2275/     A37 :                        ;------------------------------------------------------------------------------
 2276/     A37 :                        
 2277/     A37 :                        		org 0A37h	; fixe Adresse
 2278/     A37 :                        tb_ein:
 2279/     A37 : DB 05                  q_ko21:		in	a, (PIODB)	; Grafik/Ton
 2280/     A39 : CB EF                  		set	5, a
 2281/     A3B : F3                     		di
 2282/     A3C : DF                     loc_A3C:	rst	prnst		; Ausgabe String
 2283/     A3D : 87                     		db 87h
 2284/     A3E : D3 05                  		out	(PIODB), a; Grafik/Ton
 2285/     A40 : C9                     		ret
 2286/     A41 :                        
 2287/     A41 :                        ;------------------------------------------------------------------------------
 2288/     A41 :                        ; 
 2289/     A41 :                        ;------------------------------------------------------------------------------
 2290/     A41 :                        
 2291/     A41 :                        ; UP zu HD
 2292/     A41 : 3E 08                  sub_A41:	ld	a, 8
 2293/     A43 : D5                     sub_A43:	push	de
 2294/     A44 : D9                     		exx
 2295/     A45 : 2A 85 18               		ld	hl, (unk_1885)
 2296/     A48 : ED 5B 87 18            		ld	de, (unk_1887)
 2297/     A4C : 67                     		ld	h, a
 2298/     A4D : D9                     		exx
 2299/     A4E : 2A 62 18               		ld	hl, (hd_buffer)	; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 2300/     A51 : 11 00 02               		ld	de, 200h
 2301/     A54 : CD 7F 0D               		call	sub_D7F		; IDE Read/Write
 2302/     A57 : D1                     		pop	de
 2303/     A58 : C9                     		ret
 2304/     A59 :                        
 2305/     A59 :                        ;------------------------------------------------------------------------------
 2306/     A59 :                        ; 
 2307/     A59 :                        ;------------------------------------------------------------------------------
 2308/     A59 :                        
 2309/     A59 : 2A 62 18               sub_A59:	ld	hl, (hd_buffer)	; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 2310/     A5C : 11 1F 00               		ld	de, 1Fh
 2311/     A5F : 19                     		add	hl, de
 2312/     A60 : 5E                     		ld	e, (hl)
 2313/     A61 : 23                     		inc	hl
 2314/     A62 : 56                     		ld	d, (hl)
 2315/     A63 : ED 53 89 18            		ld	(unk_1889), de
 2316/     A67 : 11 2E 00               		ld	de, 2Eh	; '.'
 2317/     A6A : 19                     		add	hl, de
 2318/     A6B : 5E                     		ld	e, (hl)
 2319/     A6C : 23                     		inc	hl
 2320/     A6D : 56                     		ld	d, (hl)
 2321/     A6E : ED 53 8B 18            		ld	(unk_188B), de
 2322/     A72 : C9                     		ret
 2323/     A73 :                        
 2324/     A73 :                        ;------------------------------------------------------------------------------
 2325/     A73 :                        ; J Jump Sprung in Programm ab Adresse
 2326/     A73 :                        ;------------------------------------------------------------------------------
 2327/     A73 :                        
 2328/     A73 : 00 09 4A 0D            		db 0,9,'J',0Dh
 2329/     A77 :                        
 2330/     A77 : CD CA 04               		call	para
 2331/     A7A : E9                     		jp	(hl)
 2332/     A7B :                        
 2333/     A7B :                        ;------------------------------------------------------------------------------
 2334/     A7B :                        ; Test auf Autostart
 2335/     A7B :                        ;------------------------------------------------------------------------------
 2336/     A7B :                        
 2337/     A7B : 21 3A 02               tstsch:		ld	hl, aSch	; "SCH"
 2338/     A7E : 06 03                  		ld	b, 3
 2339/     A80 : 1A                     tstsch1:	ld	a, (de)
 2340/     A81 : BE                     		cp	(hl)
 2341/     A82 : C0                     		ret	nz		; nicht gefunden
 2342/     A83 : 23                     		inc	hl
 2343/     A84 : 13                     		inc	de
 2344/     A85 : 10 F9                  		djnz	tstsch1
 2345/     A87 :                        		; Adresse hinter "SCH" in HL
 2346/     A87 : 1A                     		ld	a, (de)
 2347/     A88 : 6F                     		ld	l, a
 2348/     A89 : 13                     		inc	de
 2349/     A8A : 1A                     		ld	a, (de)
 2350/     A8B : 67                     		ld	h, a		; HL=Autostartadr.
 2351/     A8C : C9                     		ret
 2352/     A8D :                        
 2353/     A8D :                        ;------------------------------------------------------------------------------
 2354/     A8D :                        ; Einsprungschnittstelle, damit kann aus jeder Anwendung
 2355/     A8D :                        ;    via USB und HD (V24 nachladbar) auf LOAD & SAVE Routinen zugegriffen werden.
 2356/     A8D :                        ; XX_SAVE/LOAD
 2357/     A8D :                        ;------------------------------------------------------------------------------
 2358/     A8D :                        
 2359/     A8D : CD 9F 0F               EX_SA_LO:	call	sub_F9F		; Filename in ungekehrter Reihenfolge ab unk_18D4
 2360/     A90 : 1A                     		ld	a, (de)		; de=unk_18D4
 2361/     A91 : FE 22                  		cp	'"'		; " am Filenamensanfang?
 2362/     A93 : 28 02                  		jr	z, EX_SA_LO1	; ja
 2363/     A95 : 16 0F                  		ld	d, 0Fh		; nein, Direktmode;  hi(BWS)-1
 2364/     A97 :                        					; Adr 0Fxxh ist BWS-Überlauf
 2365/     A97 : 3A B3 18               EX_SA_LO1:	ld	a, (SA_LO_BYT)	; Methode
 2366/     A9A : B7                     		or	a
 2367/     A9B : CA EB 04               EX_SA_LO2:	jp	z, ldsv_usb	; -> ldsv_usb mit A=0 (USB Load)
 2368/     A9E : FE 01                  		cp	1
 2369/     AA0 : 28 F9                  		jr	z, EX_SA_LO2	; -> ldsv_usb mit A=1 (Usb Save)
 2370/     AA2 : FE 10                  		cp	10h
 2371/     AA4 : CA B6 0A               		jp	z, EX_SA_LO3	; -> reserve
 2372/     AA7 : FE 11                  		cp	11h
 2373/     AA9 : CA B6 0A               		jp	z, EX_SA_LO3	; -> reserve
 2374/     AAC : FE 21                  		cp	21h
 2375/     AAE : CA BE 09               		jp	z, save0_hd	; -> HD Save
 2376/     AB1 : FE 20                  		cp	20h
 2377/     AB3 : CA CA 09               		jp	z, load0_hd	; -> HD Load
 2378/     AB6 : C9                     EX_SA_LO3:	ret
 2379/     AB7 :                        
 2380/     AB7 :                        ;------------------------------------------------------------------------------
 2381/     AB7 :                        ; UP Suche Autostartsequenz in DE !! AADR (DE)
 2382/     AB7 :                        ;------------------------------------------------------------------------------
 2383/     AB7 :                        
 2384/     AB7 : 3A B0 18               sub_AB7:	ld	a, (filetyp)
 2385/     ABA : B7                     		or	a
 2386/     ABB : C8                     		ret	z
 2387/     ABC : B9                     		cp	c
 2388/     ABD : C8                     		ret	z
 2389/     ABE : FE 42                  		cp	'B'		; Basicprogramm
 2390/     AC0 : C0                     		ret	nz
 2391/     AC1 : 79                     		ld	a, c
 2392/     AC2 : FE 50                  		cp	'P'		; lauffähiges Maschinenprogramm
 2393/     AC4 : C0                     		ret	nz
 2394/     AC5 : 21 00 00               		ld	hl, 0
 2395/     AC8 : 22 5B 18               		ld	(ARG1),	hl
 2396/     ACB : C9                     		ret
 2397/     ACC :                        
 2398/     ACC :                        ;------------------------------------------------------------------------------
 2399/     ACC :                        ; W IO-Port beschreiben Byte an IO-Port ausgeben
 2400/     ACC :                        ;------------------------------------------------------------------------------
 2401/     ACC :                        
 2402/     ACC : 00 09 57 0D            		db 0,9,'W',0Dh
 2403/     AD0 :                        
 2404/     AD0 : CD CA 04               		call	para
 2405/     AD3 : 44                     		ld	b, h
 2406/     AD4 : 4D                     		ld	c, l
 2407/     AD5 : ED 59                  		out	(c), e
 2408/     AD7 : C9                     		ret
 2409/     AD8 :                        
 2410/     AD8 :                        ;------------------------------------------------------------------------------
 2411/     AD8 :                        ; Tabelle Peripherie Initialisierung
 2412/     AD8 :                        ;------------------------------------------------------------------------------
 2413/     AD8 :                        
 2414/     AD8 :                        ; jeweils port, wert, s. init3
 2415/     AD8 : 00                     TABIO:		db CTC0
 2416/     AD9 : F8                     		db lo(inttab)		; Interrupt-Vektor CTC
 2417/     ADA : 01                     		db CTC1
 2418/     ADB : 37                     		db  37h			; DI,Zeitgeber,Vorteiler 256,ZK folgt
 2419/     ADC : 01                     		db CTC1
 2420/     ADD : 4E                     		db  4Eh			; Zeitkonstante
 2421/     ADE : 02                     		db CTC2
 2422/     ADF : 47                     		db  47h			; DI,Zähler,Vorteiler 16,ZK folgt
 2423/     AE0 : 02                     		db CTC2
 2424/     AE1 : 32                     		db  32h			; Zeitkonstante
 2425/     AE2 :                        ;
 2426/     AE2 : 0B                     		db PIO2CB
 2427/     AE3 : CF                     		db 0CFh			; Mode 3 (Bit E/A)
 2428/     AE4 : 0B                     		db PIO2CB
 2429/     AE5 : 00                     		db    0			; alle Bits Ausgabe
 2430/     AE6 : 0A                     		db PIO2CA
 2431/     AE7 : CF                     		db 0CFh			; Mode 3 (Bit E/A)
 2432/     AE8 : 0A                     		db PIO2CA
 2433/     AE9 : C5                     		db  0C5h		; b7,b6,b3 und b0 Eingabe
 2434/     AEA : 08                     		db PIO2DA
 2435/     AEB : 0A                     		db  0Ah			; Bits setzen
 2436/     AEC :                        ;
 2437/     AEC : 06                     		db PIOCA		; PIOCA Tastatur
 2438/     AED : CF                     		db 0CFh			; Mode 3 (Bit E/A)
 2439/     AEE : 06                     		db PIOCA		; PIOCA Tastatur
 2440/     AEF : FF                     		db 0FFh			; alle Bits Eingabe
 2441/     AF0 : 06                     		db PIOCA		; PIOCA Tastatur
 2442/     AF1 : 07                     		db    7			; DI
 2443/     AF2 : 07                     		db PIOCB
 2444/     AF3 : CF                     		db 0CFh			; Mode 3 (Bit E/A)
 2445/     AF4 : 07                     		db PIOCB
 2446/     AF5 : 84                     		db  84h			; b7 und b2 Eingabe
 2447/     AF6 : 07                     		db PIOCB
 2448/     AF7 : 07                     		db    7			; DI
 2449/     AF8 :                        ;
 2450/     AF8 : 14                     		db modul1
 2451/     AF9 : 00                     		db    0			; alles deaktiviert
 2452/     AFA :                        
 2453/     AFA :                        ;------------------------------------------------------------------------------
 2454/     AFA :                        ; UP zu USB ldsv_usb19
 2455/     AFA :                        ; Lese b Bytes nach (HL)
 2456/     AFA :                        ;------------------------------------------------------------------------------
 2457/     AFA :                        
 2458/     AFA : 7E                     loc_AFA:	ld	a, (hl)
 2459/     AFB : E7                     		rst	PUT
 2460/     AFC : 23                     		inc	hl
 2461/     AFD : 10 FB                  		djnz	loc_AFA
 2462/     AFF : C9                     		ret
 2463/     B00 :                        
 2464/     B00 :                        ;------------------------------------------------------------------------------
 2465/     B00 :                        ; Tabelle mit Baudraten-Timings, muss an 00-Adresse liegen
 2466/     B00 :                        ;------------------------------------------------------------------------------
 2467/     B00 :                        		
 2468/     B00 :                        		org 0B00h	; fixe Adresse
 2469/     B00 : 03                     bdtab:		db    3			; 14400
 2470/     B01 : 02                     		db    2			; 19200
 2471/     B02 : 05                     		db    5			; 9600
 2472/     B03 : 0B                     		db  0Bh			; 4800
 2473/     B04 : 17                     		db  17h			; 2400
 2474/     B05 : 30                     		db  30h			; 1200
 2475/     B06 : 61                     		db  61h			; 600
 2476/     B07 : C2                     		db 0C2h			; 300
 2477/     B08 :                        
 2478/     B08 :                        ;------------------------------------------------------------------------------
 2479/     B08 :                        ; UP zu tbload
 2480/     B08 :                        ;------------------------------------------------------------------------------
 2481/     B08 :                        
 2482/     B08 : 7A                     loc_B08:	ld	a, d
 2483/     B09 : 32 8D 18               		ld	(unk_188D), a
 2484/     B0C : DD E5                  		push	ix
 2485/     B0E : D1                     		pop	de
 2486/     B0F : 06 10                  		ld	b, 10h
 2487/     B11 : 2A B1 18               		ld	hl, (unk_18B1)
 2488/     B14 : 7E                     loc_B14:	ld	a, (hl)
 2489/     B15 : FE 22                  		cp	'"'
 2490/     B17 : 20 03                  		jr	nz, loc_B1C
 2491/     B19 : 3E 20                  		ld	a, ' '
 2492/     B1B : 23                     		inc	hl
 2493/     B1C : 12                     loc_B1C:	ld	(de), a
 2494/     B1D : 2B                     		dec	hl
 2495/     B1E : 13                     		inc	de
 2496/     B1F : 10 F3                  		djnz	loc_B14
 2497/     B21 : 2B                     		dec	hl
 2498/     B22 : 2B                     		dec	hl
 2499/     B23 : 7E                     		ld	a, (hl)
 2500/     B24 : 13                     		inc	de
 2501/     B25 : 21 5B 18               		ld	hl, ARG1
 2502/     B28 : 01 06 00               		ld	bc, 6
 2503/     B2B : ED B0                  		ldir
 2504/     B2D : 13                     		inc	de
 2505/     B2E : 13                     		inc	de
 2506/     B2F : 12                     		ld	(de), a
 2507/     B30 : DD 36 10 FF            		ld	(ix+10h), 0FFh
 2508/     B34 : D9                     		exx
 2509/     B35 : 2A 89 18               		ld	hl, (unk_1889)
 2510/     B38 : DD 75 1B               		ld	(ix+1Bh), l
 2511/     B3B : DD 74 1C               		ld	(ix+1Ch), h
 2512/     B3E : ED 5B 8B 18            		ld	de, (unk_188B)
 2513/     B42 : DD 72 1D               		ld	(ix+1Dh), d
 2514/     B45 : DD 73 1E               		ld	(ix+1Eh), e
 2515/     B48 : D9                     		exx
 2516/     B49 : CD CA 04               		call	para
 2517/     B4C : FD 2E 30               		ld	iyl, CmdWr 	; Write Sector
 2518/     B4F : CD 7F 0D               loc_B4F:	call	sub_D7F		; IDE Read/Write
 2519/     B52 : DD 34 1A               		inc	(ix+1Ah)
 2520/     B55 : E5                     		push	hl
 2521/     B56 : AF                     		xor	a
 2522/     B57 : ED 52                  		sbc	hl, de
 2523/     B59 : E1                     		pop	hl
 2524/     B5A : 38 F3                  		jr	c, loc_B4F
 2525/     B5C : CD 05 04               		call	crc
 2526/     B5F : DD 75 17               		ld	(ix+17h), l
 2527/     B62 : DD 74 18               		ld	(ix+18h), h
 2528/     B65 : D9                     		exx
 2529/     B66 : D5                     		push	de
 2530/     B67 : E5                     		push	hl
 2531/     B68 : D9                     		exx
 2532/     B69 : 3A 8D 18               		ld	a, (unk_188D)
 2533/     B6C : CD 43 0A               		call	sub_A43
 2534/     B6F : FD 2E 20               		ld	iyl, CmdRd 	; Read Sector
 2535/     B72 : CD 41 0A               		call	sub_A41
 2536/     B75 : 2A 62 18               		ld	hl, (hd_buffer)	; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 2537/     B78 : 11 1F 00               		ld	de, 1Fh
 2538/     B7B : 19                     		add	hl, de
 2539/     B7C : D1                     		pop	de
 2540/     B7D : 73                     		ld	(hl), e
 2541/     B7E : 23                     		inc	hl
 2542/     B7F : 72                     		ld	(hl), d
 2543/     B80 : 11 2E 00               		ld	de, 2Eh
 2544/     B83 : 19                     		add	hl, de
 2545/     B84 : D1                     		pop	de
 2546/     B85 : 73                     		ld	(hl), e
 2547/     B86 : 23                     		inc	hl
 2548/     B87 : 72                     		ld	(hl), d
 2549/     B88 : FD 2E 30               		ld	iyl, CmdWr	; Write Sector
 2550/     B8B : CD 41 0A               		call	sub_A41
 2551/     B8E : C9                     		ret
 2552/     B8F :                        
 2553/     B8F :                        ;------------------------------------------------------------------------------
 2554/     B8F :                        ; 
 2555/     B8F :                        ;------------------------------------------------------------------------------
 2556/     B8F :                        
 2557/     B8F : 21 02 00               HDInit:		ld	hl, 2		; Startspur fuer HD (Standard=2)	02 00
 2558/     B92 : 7C                     		ld	a, h
 2559/     B93 : 26 01                  		ld	h, 1
 2560/     B95 : 22 85 18               		ld	(unk_1885), hl
 2561/     B98 : 67                     		ld	h, a
 2562/     B99 : 2E 00                  		ld	l, 0
 2563/     B9B : 22 87 18               		ld	(unk_1887), hl
 2564/     B9E : CD B9 0B               		call	sub_BB9
 2565/     BA1 : 2A 64 00               		ld	hl, (hd_heads)
 2566/     BA4 : 7C                     		ld	a, h
 2567/     BA5 : D3 8A                  		out	(IdeSCnt), a
 2568/     BA7 : 7D                     		ld	a, l
 2569/     BA8 : F6 A0                  		or	0A0h ; ' '
 2570/     BAA : D3 8E                  		out	(IdeSDH), a
 2571/     BAC : 2A 36 00               		ld	hl, (hd_cylinder)
 2572/     BAF : 7D                     		ld	a, l
 2573/     BB0 : D3 8C                  		out	(IdeCLo), a
 2574/     BB2 : 7C                     		ld	a, h
 2575/     BB3 : D3 8D                  		out	(IdeCHi), a
 2576/     BB5 : 3E 91                  		ld	a, CmdInit 	; Initialize Drive Params
 2577/     BB7 : D3 8F                  		out	(IdeCmd), a
 2578/     BB9 :                        		;
 2579/     BB9 : E5                     sub_BB9:	push	hl
 2580/     BBA : 21 00 08               		ld	hl, 800h
 2581/     BBD : 10 FE                  loc_BBD:	djnz	loc_BBD
 2582/     BBF : 2B                     		dec	hl
 2583/     BC0 : 7D                     		ld	a, l
 2584/     BC1 : B4                     		or	h
 2585/     BC2 : 28 07                  		jr	z, loc_BCB
 2586/     BC4 :                        		;
 2587/     BC4 : DB 8F                  		in	a, (IdeCmd)
 2588/     BC6 : 17                     		rla
 2589/     BC7 : 3E 01                  		ld	a, 1
 2590/     BC9 : 38 F2                  		jr	c, loc_BBD
 2591/     BCB : 3D                     loc_BCB:	dec	a
 2592/     BCC : E1                     		pop	hl
 2593/     BCD : C9                     		ret
 2594/     BCE :                        		
 2595/     BCE : FF                     		db 0FFh
 2596/     BCF : FF                     		db 0FFh
 2597/     BD0 : FF                     		db 0FFh
 2598/     BD1 : FF                     		db 0FFh
 2599/     BD2 : FF                     		db 0FFh
 2600/     BD3 : FF                     		db 0FFh
 2601/     BD4 :                        
 2602/     BD4 :                        		org 0BD4h	; fixe Adresse
 2603/     BD4 :                        ; Direktaufruf aus Basic
 2604/     BD4 : 2E B0                  tbh6:		ld	l, 0B0h
 2605/     BD6 : 71                     		ld	(hl), c
 2606/     BD7 : C9                     		ret
 2607/     BD8 :                        
 2608/     BD8 :                        ; UP zu xx
 2609/     BD8 : CD EE 09               loc_BD8:	call	sub_9EE
 2610/     BDB : CD 4D 07               		call	loc_74D
 2611/     BDE : DF                     		rst	prnst		; Ausgabe String
 2612/     BDF : 8D                     		adc	a, l
 2613/     BE0 : C0                     		ret	nz
 2614/     BE1 : DD 36 10 00            		ld	(ix+10h), 0
 2615/     BE5 : 7A                     		ld	a, d
 2616/     BE6 : FD 2E 30               		ld	iyl, CmdWr	; Write Sector
 2617/     BE9 : CD 43 0A               		call	sub_A43
 2618/     BEC : FD 2E 20               		ld	iyl, CmdRd	; Read Sector
 2619/     BEF : C3 C9 0C               		jp	loc_CC9
 2620/     BF2 :                        
 2621/     BF2 : FF                     		db 0FFh
 2622/     BF3 : FF                     		db 0FFh
 2623/     BF4 : FF                     		db 0FFh
 2624/     BF5 : FF                     		db 0FFh
 2625/     BF6 : FF                     		db 0FFh
 2626/     BF7 :                        
 2627/     BF7 :                        ;------------------------------------------------------------------------------
 2628/     BF7 :                        ; Erweiterung der Funktionalitäten von GS-BASIC 3.2
 2629/     BF7 :                        ;------------------------------------------------------------------------------
 2630/     BF7 :                        
 2631/     BF7 :                        ; BASIC-Direktaufrufe in den Monitor
 2632/     BF7 :                        ; 0008h			; inch
 2633/     BF7 :                        ; 0071h			; (BYE) sprung in Monitor
 2634/     BF7 :                        ; 			; Ausgabe Startmeldung. Besser wäre Adr 006E
 2635/     BF7 :                        ; 0183h			; OUTHEX
 2636/     BF7 :                        ; 0272h			; beep, UP "akustisches Signal"
 2637/     BF7 :                        ; 0287h			; UPTON, UP "Ton", Reg, B = Tonlaenge, C = Tonhoehe
 2638/     BF7 :                        ; 0297h			; UPTAST, UP "Taste", testet Tastaturtatus
 2639/     BF7 :                        ; 0A31h			; q_ko20, Start/Stop-Schaltung stop
 2640/     BF7 :                        ; 0A37h			; q_ko21, Start/Stop-Schaltung start
 2641/     BF7 :                        ; 0BD4h			; tbh6
 2642/     BF7 :                        ; 0BF7h			; tbsave
 2643/     BF7 :                        ; 0C81h			; tbload
 2644/     BF7 :                        	
 2645/     BF7 :                        		org	0BF7h	; fixe Adresse
 2646/     BF7 :                        ; Kassette Save
 2647/     BF7 :                        ; in C: Dateityp
 2648/     BF7 : E1                     tbsave:		pop	hl
 2649/     BF8 : E1                     		pop	hl
 2650/     BF9 : 79                     		ld	a, c
 2651/     BFA : FE 46                  		cp	'F'		; Datenfeld (Basic) ?
 2652/     BFC : 28 09                  		jr	z, loc_C07
 2653/     BFE :                        		; Programm speichern
 2654/     BFE : 2A 5A 60               		ld	hl, (605Ah)	; BASTXT Pointer to start of program
 2655/     C01 : ED 5B D2 60            		ld	de, (60D2h)	; PROGND End of program
 2656/     C05 : 18 07                  		jr	loc_C0E
 2657/     C07 :                        		; Felder speichern		
 2658/     C07 : 21 AB 60               loc_C07:	ld	hl, 60ABh	; LSTRAM Last available RAM
 2659/     C0A : ED 5B D6 60            		ld	de, (60D6h)	; ARREND End of arrays
 2660/     C0E :                        		;
 2661/     C0E : 22 5F 18               loc_C0E:	ld	(ARG3),	hl
 2662/     C11 : 21 00 60               		ld	hl, 6000h	; WRKSPC BASIC Work space
 2663/     C14 : 22 5B 18               		ld	(ARG1),	hl
 2664/     C17 : 1B                     		dec	de
 2665/     C18 : ED 53 5D 18            		ld	(ARG2),	de
 2666/     C1C : 0E 01                  		ld	c, 1
 2667/     C1E : 3A 61 18               loc_C1E:	ld	a, (gsbslm)	; Methode GSB SAVE/Load	USB HD 00h 20h
 2668/     C21 : 81                     		add	a, c
 2669/     C22 : 21 B3 18               		ld	hl, SA_LO_BYT
 2670/     C25 : 77                     		ld	(hl), a
 2671/     C26 : 23                     		inc	hl		; hl=filenambuf
 2672/     C27 :                        ;headersave-kopf leeren
 2673/     C27 : E5                     		push	hl
 2674/     C28 : 36 20                  		ld	(hl), ' '
 2675/     C2A : 11 B5 18               		ld	de, filenambuf+1
 2676/     C2D : 01 20 00               		ld	bc, 20h
 2677/     C30 : ED B0                  		ldir
 2678/     C32 : E1                     		pop	hl
 2679/     C33 : 36 22                  		ld	(hl), '"'
 2680/     C35 : 23                     		inc	hl
 2681/     C36 : 11 9E 18               		ld	de, unk_189E
 2682/     C39 : D5                     		push	de
 2683/     C3A : CD 8C 0E               		call	loc_E8C
 2684/     C3D : 0E 09                  		ld	c, 9
 2685/     C3F : 1A                     loc_C3F:	ld	a, (de)
 2686/     C40 : 77                     		ld	(hl), a
 2687/     C41 : 0D                     		dec	c
 2688/     C42 : 28 0C                  		jr	z, loc_C50
 2689/     C44 : FE 20                  		cp	' '
 2690/     C46 : 28 08                  		jr	z, loc_C50
 2691/     C48 : FE 2E                  		cp	'.'
 2692/     C4A : 28 04                  		jr	z, loc_C50
 2693/     C4C : 23                     		inc	hl
 2694/     C4D : 13                     		inc	de
 2695/     C4E : 18 EF                  		jr	loc_C3F
 2696/     C50 : 3E 08                  loc_C50:	ld	a, 8
 2697/     C52 : B9                     		cp	c
 2698/     C53 : 28 0F                  		jr	z, loc_C64
 2699/     C55 : 11 69 00               		ld	de, aZ80	; Endung ".Z80"
 2700/     C58 : EB                     		ex	de, hl
 2701/     C59 : 0E 05                  		ld	c, 5
 2702/     C5B : ED B0                  		ldir
 2703/     C5D : EB                     		ex	de, hl
 2704/     C5E :                        ;
 2705/     C5E : 23                     loc_C5E:	inc	hl
 2706/     C5F : 3A B0 18               		ld	a, (filetyp)	; Filetyp eintragen
 2707/     C62 : 77                     		ld	(hl), a
 2708/     C63 : 23                     		inc	hl
 2709/     C64 : 23                     loc_C64:	inc	hl		
 2710/     C65 : D1                     		pop	de
 2711/     C66 : EB                     		ex	de, hl
 2712/     C67 : 01 10 00               		ld	bc, 16		; Länge Kommentar
 2713/     C6A : ED B0                  		ldir
 2714/     C6C : ED 43 1A 18            		ld	(soil),	bc
 2715/     C70 : CD 8D 0A               		call	EX_SA_LO	; XX_SAVE/LOAD
 2716/     C73 : CD BC 07               		call	sub_7BC		; Tausch Buffer-Adr Normal <-> Basic
 2717/     C76 : DF                     		rst	prnst		; Ausgabe String
 2718/     C77 : 8D                     		db 8Dh
 2719/     C78 : CA EB 5D               		jp	z, 5DEBh	; CSAVE1
 2720/     C7B : 1E 24                  		ld	e, 24h 		; error 24h
 2721/     C7D : C3 84 43               		jp	4384h		; ERROR
 2722/     C80 :                        		
 2723/     C80 : FF                     		db 0FFh
 2724/     C81 :                        
 2725/     C81 :                        
 2726/     C81 :                        		org	0C81h	; fixe Adresse
 2727/     C81 :                        ; Kassette Load
 2728/     C81 :                        ; in C: Dateityp
 2729/     C81 : 3A 80 18               tbload:		ld	a, (hs_eadr)
 2730/     C84 : FE B6                  		cp	0B6h		; ??
 2731/     C86 : C8                     		ret	z
 2732/     C87 : D1                     		pop	de
 2733/     C88 : D1                     		pop	de
 2734/     C89 : D1                     		pop	de
 2735/     C8A : 79                     		ld	a, c
 2736/     C8B : 32 B0 18               		ld	(filetyp), a
 2737/     C8E : 21 AB 60               		ld	hl, 60ABh	; LSTRAM Last available RAM
 2738/     C91 : FE 46                  		cp	'F'		; Datenfeld (Basic) ?
 2739/     C93 : 28 05                  		jr	z, loc_C9A
 2740/     C95 : 2A D2 60               		ld	hl, (60D2h)	; PROGND End of program
 2741/     C98 : 2B                     		dec	hl
 2742/     C99 : 2B                     		dec	hl
 2743/     C9A : 22 5B 18               loc_C9A:	ld	(ARG1),	hl
 2744/     C9D : 0E 00                  		ld	c, 0
 2745/     C9F : C3 1E 0C               		jp	loc_C1E
 2746/     CA2 : AF                     loc_CA2:	xor	a
 2747/     CA3 : FD 67                  		ld	iyu, a
 2748/     CA5 : DF                     		rst	prnst		; Ausgabe String
 2749/     CA6 : 8D                     		db 8Dh
 2750/     CA7 : 0E 02                  		ld	c, 2
 2751/     CA9 : 11 01 01               loc_CA9:	ld	de, 101h
 2752/     CAC : DD 2A 62 18            loc_CAC:	ld	ix, (hd_buffer)	; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 2753/     CB0 : 7A                     		ld	a, d
 2754/     CB1 : CD 43 0A               		call	sub_A43
 2755/     CB4 : DD 7E 10               loc_CB4:	ld	a, (ix+10h)
 2756/     CB7 : A7                     		and	a
 2757/     CB8 : 28 0F                  		jr	z, loc_CC9
 2758/     CBA : AF                     		xor	a
 2759/     CBB : FD BC                  		cp	iyu
 2760/     CBD : 20 33                  		jr	nz, loc_CF2
 2761/     CBF : CD EE 09               		call	sub_9EE
 2762/     CC2 : DF                     		rst	prnst		; Ausgabe String
 2763/     CC3 : A0                     		db 0A0h
 2764/     CC4 : 0D                     		dec	c
 2765/     CC5 : 20 02                  		jr	nz, loc_CC9
 2766/     CC7 : 0E 02                  		ld	c, 2
 2767/     CC9 : FD 7C                  loc_CC9:	ld	a, iyu
 2768/     CCB : FE 30                  		cp	CmdWr 		; Write Sector
 2769/     CCD : 20 07                  		jr	nz, loc_CD6
 2770/     CCF : DD 7E 00               		ld	a, (ix+0)
 2771/     CD2 : A7                     		and	a
 2772/     CD3 : CA 08 0B               		jp	z, loc_B08
 2773/     CD6 : 06 20                  loc_CD6:	ld	b, 20h ; ' '
 2774/     CD8 : DD 23                  loc_CD8:	inc	ix
 2775/     CDA : 10 FC                  		djnz	loc_CD8
 2776/     CDC : 3A 63 18               		ld	a, (hd_buffer+1) ; HD-Puffer normal 00 FD (AC1)	00 FE (LLC2)
 2777/     CDF : 3C                     		inc	a
 2778/     CE0 : 3C                     		inc	a
 2779/     CE1 : DD BC                  		cp	ixu
 2780/     CE3 : 20 CF                  		jr	nz, loc_CB4
 2781/     CE5 : 14                     		inc	d
 2782/     CE6 : 3E 08                  		ld	a, 8
 2783/     CE8 : BA                     		cp	d
 2784/     CE9 : 20 C1                  		jr	nz, loc_CAC
 2785/     CEB : AF                     		xor	a
 2786/     CEC : FD BC                  		cp	iyu
 2787/     CEE : C8                     		ret	z
 2788/     CEF : C3 D5 05               		jp	ldsv_usb13
 2789/     CF2 :                        
 2790/     CF2 : 2A B1 18               loc_CF2:	ld	hl, (unk_18B1)
 2791/     CF5 : 06 10                  		ld	b, 10h
 2792/     CF7 : DD E5                  		push	ix
 2793/     CF9 : 7E                     loc_CF9:	ld	a, (hl)
 2794/     CFA : FE 22                  		cp	'"'
 2795/     CFC : 28 0B                  		jr	z, loc_D09
 2796/     CFE : DD BE 00               		cp	(ix+0)
 2797/     D01 : 20 06                  		jr	nz, loc_D09
 2798/     D03 : DD 23                  		inc	ix
 2799/     D05 : 2B                     		dec	hl
 2800/     D06 : 10 F1                  		djnz	loc_CF9
 2801/     D08 : AF                     		xor	a
 2802/     D09 : DD E1                  loc_D09:	pop	ix
 2803/     D0B : 20 BC                  		jr	nz, loc_CC9
 2804/     D0D : FD 7C                  		ld	a, iyu
 2805/     D0F : FE 30                  		cp	CmdWr		; Write Sector
 2806/     D11 : CA D8 0B               		jp	z, loc_BD8
 2807/     D14 : 1E 00                  		ld	e, 0
 2808/     D16 : CD EE 09               		call	sub_9EE
 2809/     D19 : DD 4E 19               		ld	c, (ix+19h)
 2810/     D1C : CD B7 0A               		call	sub_AB7
 2811/     D1F : C2 BF 05               		jp	nz, ldsv_usb9
 2812/     D22 : CD A5 01               		call	sub_1A5
 2813/     D25 : 20 12                  		jr	nz, loc_D39
 2814/     D27 : 08                     		ex	af, af'
 2815/     D28 : 79                     		ld	a, c
 2816/     D29 : 06 F7                  		ld	b, 0F7h		; ??
 2817/     D2B : FE 42                  		cp	'B'		; Basicprogramm
 2818/     D2D : 28 08                  		jr	z, loc_D37
 2819/     D2F : FE 46                  		cp	'F'		; Datenfeld (Basic)
 2820/     D31 : 06 AB                  		ld	b, 0ABh		; ??
 2821/     D33 : 28 02                  		jr	z, loc_D37
 2822/     D35 : 06 00                  		ld	b, 0
 2823/     D37 : 78                     loc_D37:	ld	a, b
 2824/     D38 : 08                     		ex	af, af'
 2825/     D39 : D9                     loc_D39:	exx
 2826/     D3A : DD 6E 1B               		ld	l, (ix+1Bh)
 2827/     D3D : DD 66 1C               		ld	h, (ix+1Ch)
 2828/     D40 : DD 5E 1E               		ld	e, (ix+1Eh)
 2829/     D43 : DD 56 1D               		ld	d, (ix+1Dh)
 2830/     D46 : D9                     		exx
 2831/     D47 : DD 6E 13               		ld	l, (ix+13h)
 2832/     D4A : DD 66 14               		ld	h, (ix+14h)
 2833/     D4D : DD 5E 11               		ld	e, (ix+11h)
 2834/     D50 : DD 56 12               		ld	d, (ix+12h)
 2835/     D53 : ED 52                  		sbc	hl, de
 2836/     D55 : 23                     		inc	hl
 2837/     D56 : E5                     		push	hl
 2838/     D57 : 2A 5B 18               		ld	hl, (ARG1)
 2839/     D5A : 7D                     		ld	a, l
 2840/     D5B : B4                     		or	h
 2841/     D5C : 20 01                  		jr	nz, loc_D5F
 2842/     D5E : EB                     		ex	de, hl
 2843/     D5F : D1                     loc_D5F:	pop	de
 2844/     D60 : F7                     		rst	30h		; outhl
 2845/     D61 : DF                     		rst	prnst		; Ausgabe String
 2846/     D62 : A0                     		db 0A0h
 2847/     D63 : DD 7E 1A               		ld	a, (ix+1Ah)
 2848/     D66 : F5                     loc_D66:	push	af
 2849/     D67 : CD 7F 0D               		call	sub_D7F		; IDE Read/Write
 2850/     D6A : F1                     		pop	af
 2851/     D6B : 3D                     		dec	a
 2852/     D6C : 20 F8                  		jr	nz, loc_D66
 2853/     D6E : CD A5 01               		call	sub_1A5
 2854/     D71 : 20 08                  		jr	nz, loc_D7B
 2855/     D73 : 79                     		ld	a, c
 2856/     D74 : FE 42                  		cp	'B'		; Basicprogramm
 2857/     D76 : 20 03                  		jr	nz, loc_D7B
 2858/     D78 : 22 D2 60               		ld	(60D2h), hl	; PROGND End of program
 2859/     D7B : 2B                     loc_D7B:	dec	hl
 2860/     D7C : F7                     		rst	30h		; outhl
 2861/     D7D : AF                     		xor	a
 2862/     D7E : C9                     		ret
 2863/     D7F :                        
 2864/     D7F :                        ; IDE Read/Write
 2865/     D7F :                        ; in iyl Kommando, e disk, dl cylinder, h sector
 2866/     D7F : C5                     sub_D7F:	push	bc
 2867/     D80 : 3E 01                  		ld	a, 1		;1-sector transfer
 2868/     D82 : D3 8A                  		out	(IdeSCnt), a	;tell IDE drive
 2869/     D84 : D9                     		exx
 2870/     D85 : 7D                     		ld	a, l		;get low order byte
 2871/     D86 : D3 8C                  		out	(IdeCLo), a	;send to Task File
 2872/     D88 : 7A                     		ld	a, d		;get high-order byte
 2873/     D89 : D3 8D                  		out	(IdeCHi), a	;send to task file
 2874/     D8B : 7B                     		ld	a, e		;get disk number
 2875/     D8C : F6 A0                  		or	0A0h
 2876/     D8E : D3 8E                  		out	(IdeSDH), a	;send to drive!
 2877/     D90 : 7C                     		ld	a, h		;get sector number
 2878/     D91 : D3 8B                  		out	(IdeSNum), a	;send to Task File
 2879/     D93 : D9                     		exx
 2880/     D94 : 01 88 00               		ld	bc, IdeDat	; BC has port
 2881/     D97 : FD 7D                  		ld	a, iyl
 2882/     D99 : D3 8F                  		out	(IdeCmd), a
 2883/     D9B : DB 8F                  loc_D9B:	in	a, (IdeCmd)	;Wait until data available or ready for data
 2884/     D9D : CB 5F                  		bit	3, a
 2885/     D9F : 28 FA                  		jr	z, loc_D9B
 2886/     DA1 :                        		;
 2887/     DA1 : FD 7D                  		ld	a, iyl
 2888/     DA3 : FE 30                  		cp	CmdWr 		; Write Sector
 2889/     DA5 : 28 3E                  		jr	z, loc_DE5
 2890/     DA7 : 0E 02                  		ld	c, 2
 2891/     DA9 : 7B                     loc_DA9:	ld	a, e
 2892/     DAA : B2                     		or	d
 2893/     DAB : DB 88                  		in	a, (IdeDat)
 2894/     DAD : 28 0C                  		jr	z, loc_DBB
 2895/     DAF : 08                     		ex	af, af'
 2896/     DB0 : B7                     		or	a
 2897/     DB1 : 28 04                  		jr	z, loc_DB7
 2898/     DB3 : 3D                     		dec	a
 2899/     DB4 : 08                     		ex	af, af'
 2900/     DB5 : 18 03                  		jr	loc_DBA
 2901/     DB7 : 08                     loc_DB7:	ex	af, af'		; '
 2902/     DB8 : 77                     		ld	(hl), a
 2903/     DB9 : 23                     		inc	hl
 2904/     DBA : 1B                     loc_DBA:	dec	de
 2905/     DBB : 10 EC                  loc_DBB:	djnz	loc_DA9
 2906/     DBD : 0D                     		dec	c
 2907/     DBE : 20 E9                  		jr	nz, loc_DA9
 2908/     DC0 : D9                     loc_DC0:	exx
 2909/     DC1 : CD B9 0B               		call	sub_BB9
 2910/     DC4 : ED 4B 64 00            		ld	bc, (hd_heads)
 2911/     DC8 : 78                     		ld	a, b
 2912/     DC9 : BC                     		cp	h
 2913/     DCA : 28 03                  		jr	z, loc_DCF
 2914/     DCC : 24                     		inc	h
 2915/     DCD : 18 0F                  		jr	loc_DDE
 2916/     DCF : 26 01                  loc_DCF:	ld	h, 1
 2917/     DD1 : 79                     		ld	a, c
 2918/     DD2 : BB                     		cp	e
 2919/     DD3 : 28 03                  		jr	z, loc_DD8
 2920/     DD5 : 1C                     		inc	e
 2921/     DD6 : 18 06                  		jr	loc_DDE
 2922/     DD8 : 1E 00                  loc_DD8:	ld	e, 0
 2923/     DDA : 2C                     		inc	l
 2924/     DDB : 20 01                  		jr	nz, loc_DDE
 2925/     DDD : 14                     		inc	d
 2926/     DDE : D9                     loc_DDE:	exx
 2927/     DDF : C1                     		pop	bc
 2928/     DE0 : DB 8F                  		in	a, (IdeCmd)
 2929/     DE2 : E6 89                  		and	89h
 2930/     DE4 : C9                     		ret
 2931/     DE5 :                        ;
 2932/     DE5 : ED B3                  loc_DE5:	otir
 2933/     DE7 : ED B3                  		otir
 2934/     DE9 : 18 D5                  		jr	loc_DC0
 2935/     DEB :                        
 2936/     DEB :                        
 2937/     DEB :                        ;------------------------------------------------------------------------------
 2938/     DEB :                        ; w IO-Port lesen	liest den Portwert an IO-Port ein und gibt sie aus
 2939/     DEB :                        ;------------------------------------------------------------------------------
 2940/     DEB :                        
 2941/     DEB : 00 09 77 0D            		db 0,9,'w',0Dh
 2942/     DEF :                        
 2943/     DEF : ED 4B 5B 18            		ld	bc, (ARG1)
 2944/     DF3 : ED 78                  		in	a, (c)
 2945/     DF5 : C3 83 01               		jp	OUTHEX
 2946/     DF8 :                        
 2947/     DF8 : FF                     		db 0FFh
 2948/     DF9 :                        
 2949/     DF9 :                        ;------------------------------------------------------------------------------
 2950/     DF9 :                        ; Ausgabe auf V24 (RS232)
 2951/     DF9 :                        ; PIO2 A1 Ausgang Daten TxD 
 2952/     DF9 :                        ;      A2 Eingang empfangsbereit CTS 
 2953/     DF9 :                        ;------------------------------------------------------------------------------
 2954/     DF9 :                        
 2955/     DF9 : E5                     v24out:		push	hl
 2956/     DFA : C5                     		push	bc
 2957/     DFB : D5                     		push	de
 2958/     DFC : F5                     		push	af
 2959/     DFD : 57                     		ld	d, a
 2960/     DFE : 3A 20 18               		ld	a, (kdov24)	; kdov24
 2961/     E01 : E6 07                  		and	7		; Baudrate
 2962/     E03 : 26 0B                  		ld	h, hi(bdtab) 	; Baudratentabelle, liegt auf xx00-Adr.
 2963/     E05 : 6F                     		ld	l, a
 2964/     E06 : 5E                     		ld	e, (hl)
 2965/     E07 : 7A                     		ld	a, d
 2966/     E08 : 21 20 18               		ld	hl, kdov24
 2967/     E0B : 01 FF 7F               		ld	bc, 7FFFh	; Datenmaske 7F= 7 Bit, FF= 8 Bit
 2968/     E0E : CB 66                  		bit	4, (hl)		; 1=7 Datenbit, + P.ungerade
 2969/     E10 : 20 05                  		jr	nz, v24out2	; ja
 2970/     E12 : CB 6E                  		bit	5, (hl)		; 1=7 Datenbit, + P.gerade
 2971/     E14 : 28 07                  		jr	z, v24out3	; nein -> 8 Datenbit
 2972/     E16 : 48                     		ld	c, b		; ja: c=7F, sonst c=FF
 2973/     E17 :                        v24out2:	; parity bestimmen
 2974/     E17 : A0                     		and	b		; ggf. 7. Bit löschen
 2975/     E18 : EA 1D 0E               		jp	pe, v24out3
 2976/     E1B : CB FF                  		set	7, a		; Parity setzen
 2977/     E1D : A9                     v24out3:	xor	c		; Maske anwenden, bits negieren
 2978/     E1E : 4F                     		ld	c, a		; c=auszugebendes Zeichen
 2979/     E1F :                        		;
 2980/     E1F : CB 76                  		bit	6, (hl)		; 1=3-Draht-Handshake
 2981/     E21 : 20 06                  		jr	nz, v24out6	; dann nicht auf CTS warten
 2982/     E23 : DB 08                  v24out5:	in	a, (PIO2DA)	; sonst X-Draht
 2983/     E25 : CB 57                  		bit	2, a		; empfangsbereit CTS ?
 2984/     E27 : 20 FA                  		jr	nz, v24out5	; warten auf Freigabe
 2985/     E29 :                        		;
 2986/     E29 : 06 0A                  v24out6:	ld	b, 10		; 10 Bits senden (Start - 8Bit/7Bit+P - Stop)
 2987/     E2B : CB 5E                  		bit	3, (hl)		; Stop-bit
 2988/     E2D : 28 01                  		jr	z, v24out7	; 0=1 Stop-bit	
 2989/     E2F : 04                     		inc	b		; sonst ein Stop-Bit mehr
 2990/     E30 : 37                     v24out7:	scf			; Start mit 1-Bits
 2991/     E31 :                        		;
 2992/     E31 : 2A 00 18               		ld	hl, (cupos)
 2993/     E34 : F3                     		di
 2994/     E35 : 53                     v24out8:	ld	d, e		; Baudratenzähler		4   Takte
 2995/     E36 : CB CF                  		set	1, a		; b1=1				8
 2996/     E38 : 30 02                  		jr	nc, v24out9	;				12/7
 2997/     E3A : CB 8F                  		res	1, a		; b1=0				8 
 2998/     E3C : D3 08                  v24out9:	out	(PIO2DA), a	; A1 Ausgang Daten TxD		(11
 2999/     E3E : 70                     		ld	(hl), b		; Zeitverzögerung
 3000/     E3F : 15                     		dec	d		;				4
 3001/     E40 : 20 FA                  		jr	nz, v24out9	;				12) * E - 5
 3002/     E42 : CB 39                  		srl	c		; c=auszugebendes Zeichen	8
 3003/     E44 :                        					; nächstes Bit nach Cy
 3004/     E44 : 10 EF                  		djnz	v24out8		;				13
 3005/     E46 :                        					; insg. xx Takte
 3006/     E46 : 36 20                  		ld	(hl), ' '	; cupos
 3007/     E48 : F1                     		pop	af
 3008/     E49 : 18 33                  		jr	v24in6
 3009/     E4B :                        		
 3010/     E4B : FF                     		db 0FFh
 3011/     E4C :                        		
 3012/     E4C :                        ;------------------------------------------------------------------------------
 3013/     E4C :                        ; Eingabe von V24 (RS232)
 3014/     E4C :                        ;------------------------------------------------------------------------------
 3015/     E4C :                        
 3016/     E4C : E5                     v24in:		push	hl
 3017/     E4D : C5                     		push	bc
 3018/     E4E : D5                     v24in0:		push	de
 3019/     E4F : F3                     		di
 3020/     E50 : 3A 20 18               		ld	a, (kdov24)	; Kommandocode V 24
 3021/     E53 : E6 07                  		and	7		; Baudrate
 3022/     E55 : 26 0B                  		ld	h, hi(bdtab)	; Baudratentabelle, liegt auf xx00-Adr.
 3023/     E57 : 6F                     		ld	l, a
 3024/     E58 : 5E                     		ld	e, (hl)
 3025/     E59 : 2A 00 18               		ld	hl, (cupos)
 3026/     E5C : AF                     		xor	a		; alles 0
 3027/     E5D : D3 08                  		out	(PIO2DA), a	; DTR=0,CTS=0,TxD=0,RxD=0
 3028/     E5F : DB 08                  v24in2:		in	a, (PIO2DA)	; Pegel am Datenport abfragen
 3029/     E61 : E6 01                  		and	1		; nur RxD zulassen (Bits 7-1 ausblenden)
 3030/     E63 : 20 FA                  		jr	nz, v24in2	; Dateneingang war L warten auf H-Pegel
 3031/     E65 : 43                     		ld	b, e		; Zeitkonstante nach B
 3032/     E66 : 70                     v24in3:		ld	(hl), b
 3033/     E67 : 10 FD                  		djnz	v24in3		; warten
 3034/     E69 : 06 09                  		ld	b, 9		; 9 Bits empfangen (Start - 8Bit)
 3035/     E6B : 53                     v24in4:		ld	d, e
 3036/     E6C : CB 19                  		rr	c		; gelesenes CarryBit ins Bit 7 schieben
 3037/     E6E : 70                     v24in5:		ld	(hl), b
 3038/     E6F : 15                     		dec	d
 3039/     E70 : DB 08                  		in	a, (PIO2DA)	; Pegelabfrage
 3040/     E72 : 20 FA                  		jr	nz, v24in5
 3041/     E74 : 1F                     		rra			; Bit0=RxD ins Carry schieben
 3042/     E75 : 10 F4                  		djnz	v24in4		; weiter bis alle Bits durch
 3043/     E77 : 36 20                  		ld	(hl), ' ' 	; cupos
 3044/     E79 : 3E 0A                  		ld	a, 0Ah		; DTR=1,CTS=0,TxD=1,RxD=0
 3045/     E7B : D3 08                  		out	(PIO2DA), a	; Bereitschaftsbits setzen
 3046/     E7D : 79                     		ld	a, c		; gelesenes Byte in A umladen
 3047/     E7E : D1                     v24in6:		pop	de
 3048/     E7F : C1                     		pop	bc
 3049/     E80 : E1                     		pop	hl
 3050/     E81 : FB                     		ei
 3051/     E82 : C9                     		ret
 3052/     E83 :                        
 3053/     E83 : FF                     		db 0FFh
 3054/     E84 :                        
 3055/     E84 :                        ;------------------------------------------------------------------------------
 3056/     E84 :                        ; usb close file
 3057/     E84 :                        ;------------------------------------------------------------------------------
 3058/     E84 :                        
 3059/     E84 : 3E 0A                  sub_E84:	ld	a, 0Ah		; Vinculum-Kdo Close
 3060/     E86 :                        ;
 3061/     E86 : CD BB 06               sub_E86:	call	sub_6BB		; Kommando mit Filename senden
 3062/     E89 : C3 35 07               		jp	EXEC		; Kommando ausfuehren
 3063/     E8C :                        
 3064/     E8C :                        ;------------------------------------------------------------------------------
 3065/     E8C :                        ; 
 3066/     E8C :                        ;------------------------------------------------------------------------------
 3067/     E8C :                        
 3068/     E8C : CD BC 07               loc_E8C:	call	sub_7BC		; Tausch Buffer-Adr Normal <-> Basic
 3069/     E8F : CB 87                  		res	0, a
 3070/     E91 : FE 20                  		cp	' '
 3071/     E93 : C0                     		ret	nz
 3072/     E94 : F1                     		pop	af
 3073/     E95 :                        		; 16 Zeichen von DE nach HL kopieren
 3074/     E95 : 06 10                  		ld	b, 16
 3075/     E97 : 1A                     loc_E97:	ld	a, (de)
 3076/     E98 : 77                     		ld	(hl), a
 3077/     E99 : 23                     		inc	hl
 3078/     E9A : 13                     		inc	de
 3079/     E9B : 10 FA                  		djnz	loc_E97
 3080/     E9D :                        		;
 3081/     E9D : 3E 10                  		ld	a, 16
 3082/     E9F : B8                     		cp	b		; b==0
 3083/     EA0 : 20 01                  		jr	nz, loc_EA3	; daher immer jr ??
 3084/     EA2 : 23                     		inc	hl
 3085/     EA3 : 36 22                  loc_EA3:	ld	(hl), '"'	; mit " abschließen
 3086/     EA5 : 23                     		inc	hl
 3087/     EA6 : C3 5E 0C               		jp	loc_C5E
 3088/     EA9 :                        
 3089/     EA9 :                        ;------------------------------------------------------------------------------
 3090/     EA9 :                        ; r Basic Warmstart Warmstart Grafik-Sound-Basic via Modul 1
 3091/     EA9 :                        ;------------------------------------------------------------------------------
 3092/     EA9 :                        
 3093/     EA9 : 00 09 72 0D            		db 0,9,'r',0Dh
 3094/     EAD :                        
 3095/     EAD : DD 21 D5 5F            		ld	ix, 5FD5h	; Warmstart
 3096/     EB1 : 18 33                  		jr	bko1		; ROM "Basic" aktivieren, Fkt-Tasten laden
 3097/     EB3 :                        
 3098/     EB3 : FF                     		db 0FFh
 3099/     EB4 :                        
 3100/     EB4 :                        ;------------------------------------------------------------------------------
 3101/     EB4 :                        ;UP "Joy".Abfrage Joystick 1,keine Taste Z - Flag
 3102/     EB4 :                        ;	    gesetzt und	A = 0,oben bit 0, unten	bit 1,links
 3103/     EB4 :                        ;	    bit	2, rechts bit 3, Feuerknopf bit	4 vom Akku
 3104/     EB4 :                        ;	    gesetzt.
 3105/     EB4 :                        ;------------------------------------------------------------------------------
 3106/     EB4 :                        
 3107/     EB4 :                        		org 0EB4h	; fixe Adresse
 3108/     EB4 : C5                     joy:		push	bc
 3109/     EB5 : DB 05                  		in	a, (PIODB)	; Grafik/Ton
 3110/     EB7 : 4F                     		ld	c, a
 3111/     EB8 : CB 8F                  		res	1, a
 3112/     EBA : D3 05                  		out	(PIODB), a	; Grafik/Ton
 3113/     EBC : DB 04                  		in	a, (PIODA)	; Tastatur
 3114/     EBE : 47                     		ld	b, a
 3115/     EBF : 79                     		ld	a, c
 3116/     EC0 : D3 05                  		out	(PIODB), a	; Grafik/Ton
 3117/     EC2 : 78                     		ld	a, b
 3118/     EC3 : 00                     		nop
 3119/     EC4 : E6 1F                  		and	1Fh
 3120/     EC6 : C1                     		pop	bc
 3121/     EC7 : C9                     		ret
 3122/     EC8 :                        
 3123/     EC8 :                        ;------------------------------------------------------------------------------
 3124/     EC8 :                        ; a to hex hl
 3125/     EC8 :                        ;------------------------------------------------------------------------------
 3126/     EC8 :                        
 3127/     EC8 :                        ; zu kdo5
 3128/     EC8 : F5                     tohex:		push	af
 3129/     EC9 : 1F                     		rra
 3130/     ECA : 1F                     		rra
 3131/     ECB : 1F                     		rra
 3132/     ECC : 1F                     		rra
 3133/     ECD : CD D2 0E               		call	tohex1		; obere Tetrade
 3134/     ED0 : 65                     		ld	h, l		; übergeben in H
 3135/     ED1 : F1                     		pop	af		; untere Tetrade
 3136/     ED2 : E6 0F                  tohex1:		and	0Fh
 3137/     ED4 : C6 30                  		add	a, '0'
 3138/     ED6 : FE 3A                  		cp	'9'+1		; Ziffer "A" ... "F"?
 3139/     ED8 : 38 02                  		jr	c, tohex2	; nein
 3140/     EDA : C6 07                  		add	a, 7		; sonst Korrektur
 3141/     EDC : 6F                     tohex2:		ld	l, a		; übergeben in L
 3142/     EDD : C9                     		ret
 3143/     EDE :                        
 3144/     EDE :                        ;------------------------------------------------------------------------------
 3145/     EDE :                        ; b Basic Start GraficSoundBasic via Modul 1
 3146/     EDE :                        ;------------------------------------------------------------------------------
 3147/     EDE :                        
 3148/     EDE : 00 09 62 0D            		db 0,9,'b',0Dh
 3149/     EE2 :                        
 3150/     EE2 : DD 21 CC 5F            		ld	ix, 5FCCh	; COLD
 3151/     EE6 : 3E 02                  bko1:		ld	a, 2		; BASIC
 3152/     EE8 : D3 14                  		out	(modul1), a	; Modul1 ROM "Basic" aktivieren
 3153/     EEA : 21 E0 5F               		ld	hl, 5FE0h	; Funktionstasten
 3154/     EED : 11 80 1F               		ld	de, 1F80h	; umladen
 3155/     EF0 : 01 20 00               		ld	bc, 20h
 3156/     EF3 : ED B0                  		ldir
 3157/     EF5 : DD E9                  		jp	(ix)		; und starten
 3158/     EF7 :                        
 3159/     EF7 :                        ;------------------------------------------------------------------------------
 3160/     EF7 :                        ; T Transfer Kopiert Speicherbereich in anderen Speicherbereich
 3161/     EF7 :                        ;------------------------------------------------------------------------------
 3162/     EF7 :                        
 3163/     EF7 : 00 09 54 0D            		db 0,9,'T',0Dh
 3164/     EFB : CD CA 04               		call	para		; Argumente uebergeben
 3165/     EFE : AF                     		xor	a
 3166/     EFF : E5                     		push	hl
 3167/     F00 : ED 52                  		sbc	hl, de
 3168/     F02 : E1                     		pop	hl
 3169/     F03 :                        		; kopieren mit ldir ?
 3170/     F03 : 30 1A                  		jr	nc, pko1	; ldir + ret
 3171/     F05 :                        		; sonst kopieren mit lddr		
 3172/     F05 : 09                     		add	hl, bc
 3173/     F06 : EB                     		ex	de, hl
 3174/     F07 : 09                     		add	hl, bc
 3175/     F08 : EB                     		ex	de, hl
 3176/     F09 : 2B                     		dec	hl
 3177/     F0A : 1B                     		dec	de
 3178/     F0B : ED B8                  		lddr
 3179/     F0D : C9                     		ret
 3180/     F0E :                        
 3181/     F0E :                        ;------------------------------------------------------------------------------
 3182/     F0E :                        ; P Pattern Fuellt Speicherbereich mit Datenbyte
 3183/     F0E :                        ;------------------------------------------------------------------------------
 3184/     F0E :                        
 3185/     F0E : 00 09 50 0D            		db 0,9,'P',0Dh
 3186/     F12 :                        
 3187/     F12 : CD CA 04               		call	para		; Argumente uebergeben
 3188/     F15 : 71                     		ld	(hl), c		; Pattern cc
 3189/     F16 : E5                     		push	hl
 3190/     F17 : AF                     		xor	a
 3191/     F18 : EB                     		ex	de, hl
 3192/     F19 : ED 52                  		sbc	hl, de
 3193/     F1B : 44                     		ld	b, h
 3194/     F1C : 4D                     		ld	c, l
 3195/     F1D : E1                     		pop	hl
 3196/     F1E : 13                     		inc	de
 3197/     F1F : ED B0                  pko1:		ldir
 3198/     F21 : C9                     		ret
 3199/     F22 :                        
 3200/     F22 :                        ;------------------------------------------------------------------------------
 3201/     F22 :                        ; ? Help Liste der verfuegbaren Kommandos
 3202/     F22 :                        ;------------------------------------------------------------------------------
 3203/     F22 :                        
 3204/     F22 : 00 09 3F 0D            		db 0,9,'?',0Dh
 3205/     F26 :                        
 3206/     F26 : DF                     help:		rst	prnst		; Ausgabe String
 3207/     F27 : 20 48 65 6C 70 BA      		db " Help",0BAh
 3208/     F2D : 21 20 00               		ld	hl, KDOANFH	; erste Adr, aber der Kdo zu suchen sind
 3209/     F30 : 01 E0 FF               		ld	bc, RAMEND-KDOANFH+1	; Anzahl (RAM-Ende-Startpos.)
 3210/     F33 : AF                     help1:		xor	a
 3211/     F34 : ED B1                  		cpir
 3212/     F36 : E0                     		ret	po
 3213/     F37 : 3E 09                  		ld	a, 9		; folgt 09?
 3214/     F39 : BE                     		cp	(hl)
 3215/     F3A : 20 F7                  		jr	nz, help1
 3216/     F3C : 23                     		inc	hl
 3217/     F3D : 56                     		ld	d, (hl)		; kdo merken
 3218/     F3E : 23                     		inc	hl
 3219/     F3F : 3E 0D                  		ld	a, 0Dh		; folgt 0D?
 3220/     F41 : BE                     		cp	(hl)
 3221/     F42 : 20 EF                  		jr	nz, help1	; wenn Rahmen nicht gefunden
 3222/     F44 : 7A                     		ld	a, d		; sonst kdo anzeigen
 3223/     F45 : D7                     		rst	outch		; Zeichenausgabe
 3224/     F46 : DF                     		rst	prnst		; Ausgabe String
 3225/     F47 : A0                     		db 0A0h
 3226/     F48 : 18 E9                  		jr	help1
 3227/     F4A :                        
 3228/     F4A :                        ;------------------------------------------------------------------------------
 3229/     F4A :                        ; C Compare Vergleich von 2 Speicherbereichen
 3230/     F4A :                        ; C aaaa bbbb cccc Compare
 3231/     F4A :                        ;------------------------------------------------------------------------------
 3232/     F4A :                        
 3233/     F4A : 00 09 43 0D            		db 0,9,'C',0Dh
 3234/     F4E :                        
 3235/     F4E : CD CA 04               		call	para		; Argumente uebergeben
 3236/     F51 : 1A                     cko1:		ld	a, (de)		; bbbb
 3237/     F52 : BE                     		cp	(hl)		; vergleich mit aaaa
 3238/     F53 : 28 21                  		jr	z, cko2		; weiter wenn gleich
 3239/     F55 :                        		; Differenz anzeigen
 3240/     F55 :                        		; "a-Adr. Wert b-Adr. Wert"
 3241/     F55 : DF                     		rst	prnst		; Ausgabe String
 3242/     F56 : 20 A0                  		db ' ',0A0h
 3243/     F58 : F7                     		rst	30h		; outhl
 3244/     F59 : DF                     		rst	prnst		; Ausgabe String
 3245/     F5A : 20 20 20               		db "   "
 3246/     F5D : A0                     		db 0A0h	;  
 3247/     F5E : 7E                     		ld	a, (hl)
 3248/     F5F : CD 83 01               		call	OUTHEX		; Ausgabe A hexadezimal Wert
 3249/     F62 : DF                     		rst	prnst		; Ausgabe String
 3250/     F63 : 8F                     		db 8Fh
 3251/     F64 : EB                     		ex	de, hl
 3252/     F65 : F7                     		rst	30h		; outhl
 3253/     F66 : DF                     		rst	prnst		; Ausgabe String
 3254/     F67 : 20 20 20               		db "   "
 3255/     F6A : A0                     		db 0A0h	;  
 3256/     F6B : EB                     		ex	de, hl
 3257/     F6C : 1A                     		ld	a, (de)
 3258/     F6D : CD 83 01               		call	OUTHEX
 3259/     F70 : DF                     		rst	prnst		; Ausgabe String
 3260/     F71 : 8D                     		db 8Dh
 3261/     F72 : CF                     		rst	inch		; inch; Zeicheneingabe
 3262/     F73 : FE 0D                  		cp	0Dh
 3263/     F75 : C0                     		ret	nz
 3264/     F76 : 0B                     cko2:		dec	bc		; Anzahl cccc
 3265/     F77 : 23                     		inc	hl		; Adressen erhöhen
 3266/     F78 : 13                     		inc	de
 3267/     F79 : 78                     		ld	a, b		; Anzahl cccc abgearbeitet?
 3268/     F7A : B1                     		or	c
 3269/     F7B : C8                     		ret	z		; dann Ende
 3270/     F7C : 18 D3                  		jr	cko1		; sonst weiter vergleichen
 3271/     F7E :                        
 3272/     F7E : FF                     		db 0FFh
 3273/     F7F : FF                     		db 0FFh
 3274/     F80 : FF                     		db 0FFh
 3275/     F81 :                        
 3276/     F81 :                        ;------------------------------------------------------------------------------
 3277/     F81 :                        ; p Clear RAM Loescht RAM bis FF00H mit FFH
 3278/     F81 :                        ;------------------------------------------------------------------------------
 3279/     F81 :                        
 3280/     F81 : 00 09 70 0D            		db 0,9,'p',0Dh
 3281/     F85 :                        
 3282/     F85 :                        ; RAM loeschen
 3283/     F85 : 21 66 18               erase:		ld	hl, erasebeg	; Beginn Löschbereich
 3284/     F88 : 36 FF                  		ld	(hl), 0FFh
 3285/     F8A : 11 67 18               		ld	de, erasebeg+1
 3286/     F8D : 01 99 E6               		ld	bc, 0FF00h-erasebeg-1
 3287/     F90 : ED B0                  		ldir
 3288/     F92 : DF                     		rst	prnst		; Ausgabe String
 3289/     F93 : 20 43 6C 65 61 72 20   		db " Clear RAM",8Dh
           F9A : 52 41 4D 8D         
 3290/     F9E : C9                     		ret
 3291/     F9F :                        
 3292/     F9F :                        ;------------------------------------------------------------------------------
 3293/     F9F :                        ; Filename in ungekehrter Reihenfolge ab unk_18D4 ablegen/tauschen
 3294/     F9F :                        ;------------------------------------------------------------------------------
 3295/     F9F :                        
 3296/     F9F :                        ; UP zu EX_SA_LO
 3297/     F9F : 06 10                  sub_F9F:	ld	b, 16		; Länge
 3298/     FA1 : 21 B4 18               		ld	hl, filenambuf
 3299/     FA4 : 11 D4 18               		ld	de, unk_18D4
 3300/     FA7 : D5                     		push	de
 3301/     FA8 : 4E                     loc_FA8:	ld	c, (hl)
 3302/     FA9 : 1A                     		ld	a, (de)
 3303/     FAA : 77                     		ld	(hl), a
 3304/     FAB : 79                     		ld	a, c
 3305/     FAC : 12                     		ld	(de), a
 3306/     FAD : 23                     		inc	hl
 3307/     FAE : 1B                     		dec	de
 3308/     FAF : 10 F7                  		djnz	loc_FA8
 3309/     FB1 : D1                     		pop	de
 3310/     FB2 : C9                     		ret
 3311/     FB3 :                        
 3312/     FB3 :                        ;------------------------------------------------------------------------------
 3313/     FB3 :                        ; 4 2/4Mhz schaltet AC1 zwischen 2/4Mhz Takt um (BWS-Port noetig)
 3314/     FB3 :                        ;------------------------------------------------------------------------------
 3315/     FB3 :                        
 3316/     FB3 : 00 09 34 0D            		db 0,9,'4',0Dh
 3317/     FB7 :                        
 3318/     FB7 : DB F0                  		in	a, (BWSPORT)
 3319/     FB9 : EE 01                  		xor	1
 3320/     FBB : D3 F0                  		out	(BWSPORT), a
 3321/     FBD : C9                     		ret
 3322/     FBE :                        
 3323/     FBE :                        ;------------------------------------------------------------------------------
 3324/     FBE :                        ; ! BWS Farbe BWS Farbe setzen (COLOR-BWS noetig)
 3325/     FBE :                        ; ! cc Farbbyte setzen
 3326/     FBE :                        ; s.a. Monitorpatch 08.11.2011.LISTING
 3327/     FBE :                        ;------------------------------------------------------------------------------
 3328/     FBE :                        
 3329/     FBE : 00 09 21 0D            		db 0,9,'!',0Dh
 3330/     FC2 :                        
 3331/     FC2 : 3A 5B 18               		ld	a, (ARG1)	; mögliches FarbByte laden
 3332/     FC5 : B7                     		or	a		; wenn 00H (keine Angabe) dann FarbByte
 3333/     FC6 : 20 02                  		jr	nz, setcolor1
 3334/     FC8 :                        
 3335/     FC8 :                        ; Farb-RAM loeschen
 3336/     FC8 : 3E 0B                  setcolor:	ld	a, vColor	; 0E = bg: schwarz, fg: hellgelb
 3337/     FCA : F5                     setcolor1:	push	af		; FarbByte sichern
 3338/     FCB : AF                     		xor	a		; noFarbRAM A=00
 3339/     FCC : 32 1F 18               		ld	(FARBBWS), a	; noFarbRAM einstellen
 3340/     FCF : F1                     		pop	af		; FarbByte nach A zurück
 3341/     FD0 : 0E F0                  		ld	c, BWSPORT
 3342/     FD2 : ED 40                  		in	b, (c)		; akt. Portwert einlesen
 3343/     FD4 : 04                     		inc	b		; FFH wenn kein rücklesbares Register
 3344/     FD5 : C8                     		ret	z		; Rückkehr weil kein BWSPort gefunden
 3345/     FD6 :                        					; wenn hier dann wurde KEIN FFH gelesen, altes B zurück
 3346/     FD6 : 05                     		dec	b		; altes B zurück
 3347/     FD7 : 50                     		ld	d, b		; in B BWS Steuercode für Text RAM
 3348/     FD8 : CB D2                  		set	2, d		; in D BWS Steuercode für FarbRAM
 3349/     FDA : 21 00 10               		ld	hl, BWSEND
 3350/     FDD : 5E                     		ld	e, (hl)		; altes TextByte in E merken
 3351/     FDE :                        
 3352/     FDE : =>FALSE                		if p_setcol
 3353/     FDE :                        ;Es wird vor dem Einstellen der Vorder- und Hintergrundfarbe
 3354/     FDE :                        ;geprüft, ob es sich um einen Color-BWS handelt. Das passiert auf der RAM-Zelle
 3355/     FDE :                        ;1000h. Wenn diese den gleichen Hex-Wert, wie das bei "!" übergebene Argument hat
 3356/     FDE :                        ;(also z.B. 20h), passiert bisher nix. Das ist hiermit korrigiert worden.
 3357/     FDE :                        		cpl
 3358/     FDE :                        		ld 	(hl), a
 3359/     FDE :                        		out 	(c), d		; FarbRAM an
 3360/     FDE :                        		cpl
 3361/     FDE :                        		ld 	(hl), a		; Farbbyte schreiben
 3362/     FDE :                        		cp 	(hl)		; und vergleichslesen
 3363/     FDE :                        		out 	(c), b		; Text RAM wieder ein (wegen RET)
 3364/     FDE :                        		jr 	nz, setcolor2	; kein phys.RAM (Text- oder FarbRAM!)
 3365/     FDE :                        		cpl
 3366/     FDE :                        		cp 	(hl)
 3367/     FDE :                        setcolor2	ld 	(hl),e		; altes Zeichen Text-RAM zurück
 3368/     FDE :                        		ret 	nz
 3369/     FDE :                        		out	(c), d		; FarbRAM an
 3370/     FDE : =>TRUE                 		else
 3371/     FDE : ED 51                  		out	(c), d		; FarbRAM an
 3372/     FE0 : 77                     		ld	(hl), a		; Farbbyte schreiben
 3373/     FE1 : BE                     		cp	(hl)		; und vergleichslesen
 3374/     FE2 : ED 41                  		out	(c), b		; Text RAM wieder ein (wegen RET)
 3375/     FE4 : 73                     		ld	(hl), e		; altes Zeichen Text-RAM zurück
 3376/     FE5 : C0                     		ret	nz		; kein phys.RAM (Text- oder FarbRAM!)
 3377/     FE6 :                        		; wenn hier dann unterschiedliche RAM's! damit gilt der FarbRAM
 3378/     FE6 :                        		; als erkannt, das 1.Byte ist bereits in Farbe
 3379/     FE6 : ED 51                  		out	(c), d		; FarbRAM an
 3380/     FE8 :                        		;
 3381/     FE8 : 7E                     		ld	a, (hl)
 3382/     FE9 : BB                     		cp	e
 3383/     FEA : ED 41                  		out	(c), b		; Text RAM an
 3384/     FEC : C8                     		ret	z
 3385/     FED : ED 51                  		out	(c), d		; FarbRAM an
 3386/     FEF : [3352]                 		endif
 3387/     FEF :                        		;
 3388/     FEF : C5                     		push	bc		; BWSPort und TextRAM ein sichern
 3389/     FF0 : 11 01 10               		ld	de, BWSEND+1	; 2.Byte FarbRAM
 3390/     FF3 : 01 FF 07               		ld	bc, LINES*COLS-1	; restliche Bytezahl
 3391/     FF6 : ED B0                  		ldir			; nun FarbRAM schreiben
 3392/     FF8 : 7E                     		ld	a, (hl)		; FarbByte zurücklesen (von 17FFH)
 3393/     FF9 : C1                     		pop	bc		; BWSPort und TextRAM ein
 3394/     FFA : ED 41                  		out	(c), b		; Text RAM ein
 3395/     FFC : 32 1F 18               		ld	(FARBBWS), a	; FarbByte eintragen
 3396/     FFF : C9                     		ret
 3397/    1000 :                        
 3398/    1000 :                        ; end of "ROM"
 3399/    1000 :                        
 3400/    1000 :                        
 3401/    1000 :                        ;------------------------------------------------------------------------------
 3402/    1000 :                        ; Arbeitszellen Monitor
 3403/    1000 :                        ;------------------------------------------------------------------------------
 3404/    1000 :                        ; segment "RAM"
 3405/    1000 :                        
 3406/    1800 :                        		org RAM
 3407/    1800 :                        		
 3408/    1800 :                        cupos:		ds 2			; Cursorposition
 3409/    1802 :                        ; Sprungverteiler f. RST-Aufrufe und NMI
 3410/    1802 :                        ; wird initialisiert mit Werten von sv_rst
 3411/    1802 :                        jp_rst08:	ds 3			; jp	rinch
 3412/    1805 :                        jp_rst10:	ds 3			; jp	routch
 3413/    1808 :                        jp_rst18:	ds 3			; jp	rprnst
 3414/    180B :                        jp_rst20:	ds 3			; jp	
 3415/    180E :                        jp_rst28:	ds 3			; jp	
 3416/    1811 :                        jp_rst30:	ds 3			; jp	
 3417/    1814 :                        jp_rst38:	ds 3			; jp	rst38	Einsprung bei Einzelschritt
 3418/    1817 :                        nmi:		ds 3			; jp	BREAK	NMI: Breakpoint
 3419/    181A :                        ;Hilfsregister, V24, I/O
 3420/    181A :                        soil:		ds 2			; Beginn Eingabezeile	, 0FFFFh
 3421/    181C :                        warmcod:	ds 3			; Warmstartcode		, "SCH"
 3422/    181F :                        FARBBWS:	ds 1			; Farbcode		, 0
 3423/    1820 :                        kdov24:		ds 1			; V24-Kontrollregister	, 42h
 3424/    1821 :                        IOBYT:		ds 1			; Ein/Ausgabebyte	; 11h
 3425/    1822 :                        			; Eingabe: b0 Tastatur, b1 V24 (Rs 232c), b2 Reserve, b3 User
 3426/    1822 :                        			; Ausgabe: b4 Bildschirm, b5 V24 (RS 232c), b6 Reserve, b7 User
 3427/    1822 :                        ;
 3428/    1822 :                        tacod:		ds 1			; Tastencode der zuletzt gedrückten Taste
 3429/    1823 :                        ;Stack
 3430/    1823 :                        		ds 33h			; Stackbereich
 3431/    1856 : =1856H                 SYSSK:		equ $			; Stack
 3432/    1856 :                        ;
 3433/    1856 :                        poscnt:		ds 1			; Hilfsregister Kursorpositionierung (CTRL+N)
 3434/    1857 :                        					; std. 1, nach ctrln 5 (dh 5-1 Ziffern werden erwartet)
 3435/    1857 :                        repeat:		ds 1			; Hilfsregister	Repetierfunktion Tastatur
 3436/    1858 :                        data:		ds 2			; Hilfsregister	UP "INLINE"
 3437/    185A :                        		ds 1
 3438/    185B :                        ;Kdo-Argumente
 3439/    185B :                        ARG1:		ds 2			; Argument 1
 3440/    185D :                        ARG2:		ds 2			; Argument 2
 3441/    185F :                        ARG3:		ds 2			; Argument 3
 3442/    1861 :                        
 3443/    1861 :                        		; org 1861h
 3444/    1861 :                        ;orig hier Registerrettebereich (register save area)
 3445/    1861 :                        gsbslm:		ds 1			; Methode GSB SAVE/Load	USB HD 00h 20h
 3446/    1862 :                        hd_buffer:	ds 2			; HD-Puffer normal 00 FD (AC1) 00 FE (LLC2)
 3447/    1864 :                        hd_bufbas:	ds 2			; HD-Puffer GS-Basic 00	3E
 3448/    1866 :                        ; ab hier wird in erase: geöscht
 3449/    1866 : =1866H                 erasebeg:	equ	$
 3450/    1866 :                        ;
 3451/    1866 :                        hs_laenge:	ds 2			; Laenge
 3452/    1868 :                        hs_rest:	ds 2			; Restlänge
 3453/    186A :                        hs_gesamt:	ds 2			; Gesamtlänge incl. Header
 3454/    186C :                        ;
 3455/    186C :                        		ds 2
 3456/    186E :                        
 3457/    186E :                        ; Headersave-Buffer für sub_95B, 186E-187Dh
 3458/    186E :                        unk_186E:	ds 16			; 16 Byte Buffer Filename 
 3459/    187E :                        
 3460/    187E :                        ; noch orig. Adressen in RSA / überlagert unk_186E		
 3461/    1875 :                        		org unk_186E+7
 3462/    1875 :                        REGPC:		ds 2			; s. BREAK, write only
 3463/    1877 :                        REGSP:		ds 2			; s. BREAK, write only
 3464/    1879 :                        ; in V11 ungenutzt
 3465/    1879 :                        BPADR:		ds 2			; RSA: BP
 3466/    187B :                        BPOPC:		ds 3			; RSA: Breakpointsequenz
 3467/    187E :                        
 3468/    187E :                        		; org 187Eh
 3469/    187E :                        ;hsbuf Speicher Save/Load Turbo-Tape/V24 USB
 3470/    187E :                        hs_buf:		ds 32 			; Headersave-Kopf-Buffer
 3471/    189E : =187EH                 hs_aadr:	equ hs_buf+0		; aadr
 3472/    189E : =1880H                 hs_eadr:	equ hs_buf+2		; eadr
 3473/    189E : =1882H                 hs_sadr:	equ hs_buf+4		; sadr
 3474/    189E : =1884H                 hs_cod:		equ hs_buf+6		; ds 6 "MO11.0" / frei belegbar
 3475/    189E : =188AH                 hs_filetyp:	equ hs_buf+12		; Dateityp / Basic-Modus
 3476/    189E : =188BH                 hs_kennung:	equ hs_buf+13		; 3 x D3 Kennung Headersave-Kopf 
 3477/    189E : =188EH                 hs_fileinfo:	equ hs_buf+16		; Kommentar
 3478/    189E :                        		
 3479/    189E :                        ; HD-Speicher, überlagert hsbuf
 3480/    189E : =1885H                 unk_1885:	equ hs_buf+7
 3481/    189E : =1887H                 unk_1887:	equ unk_1885+2
 3482/    189E : =1889H                 unk_1889:	equ unk_1885+4
 3483/    189E : =188BH                 unk_188B:	equ unk_1885+6
 3484/    189E : =188DH                 unk_188D:	equ unk_1885+8
 3485/    189E :                        
 3486/    189E :                        ; 
 3487/    189E :                        unk_189E:	ds 16			; Buffer Filename BASIC
 3488/    18AE :                        		ds 2
 3489/    18B0 :                        ;
 3490/    18B0 :                        filetyp:	ds 1			; Dateityp (00, P, B)
 3491/    18B1 :                        unk_18B1:	ds 2
 3492/    18B3 :                        ;
 3493/    18B3 :                        SA_LO_BYT:	ds 1			; Methode fuer XX_SAVE/LOAD
 3494/    18B4 :                        					;	  00h =	USB laden
 3495/    18B4 :                        					;	  01h =	USB sichern
 3496/    18B4 :                        					;	  20h =	HD laden
 3497/    18B4 :                        					;	  21h =	HD sichern
 3498/    18B4 :                        ; 32 Byte HeaderSave Puffer Filename+Typ+Info
 3499/    18B4 :                        filenambuf:	ds 32			; Puffer fuer SAVE/LOAD-Arbeit
 3500/    18D4 :                        					;	  1 Byte Hochkomma
 3501/    18D4 :                        					;  	 12 Byte Filename (8 . 3)
 3502/    18D4 :                        					;	  1 Byte Hochkomma
 3503/    18D4 :                        					;	  1 Byte Leerzeichen
 3504/    18D4 :                        					;	  1 Byte Dateityp (P)
 3505/    18D4 :                        					;	  1 Byte Leerzeichen
 3506/    18D4 :                        					;	 16 Bytes Header-Info
 3507/    18D4 :                        unk_18D4:	ds 2
 3508/    18D6 :                        
 3509/    18D6 :                        ; ab 18D6 freier RAM
 3510/    18D6 :                        
 3511/    18F0 :                        		org	18F0h
 3512/    18F0 :                        unk_18F0:	ds 3			; User Eingaberoutine
 3513/    18F3 :                        unk_18F3:	ds 3			; User Ausgaberoutine
 3514/    18F6 :                        
 3515/    18F6 :                        ; end of "RAM"
 3516/    18F6 :                        		end
 AS V1.42 Beta [Bld 249] - Source File Monitor11.asm - Page 2 - 11/1/2023 14:5:13


  Symbol Table (* = unused):
  --------------------------

*AA :                           12B C |  AFNERW :                       2E2 C |
*ARCHITECTURE :                                        "i386-unknown-win32" - |
 ARG1 :                        185B C |  ARG2 :                        185D C |
 ARG3 :                        185F C |  ASCH :                         23A C |
 AZ80 :                          69 C |  BDTAB :                       0B00 C |
 BEEP :                         272 C |  BEEP1 :                        275 C |
 BKO1 :                        0EE6 C | *BPADR :                       1879 C |
*BPOPC :                       187B C |  BREAK :                        240 C |
 BREAK1 :                       243 C | *BREAK2 :                       25B C |
 BWS :                         1000 - |  BWSANF :                      17FF - |
 BWSEND :                      1000 - |  BWSPORT :                      0F0 - |
*CASESENSITIVE :                  0 - |  CKO1 :                        0F51 C |
 CKO2 :                        0F76 C |  CMDINIT :                       91 - |
 CMDRD :                         20 - |  CMDWR :                         30 - |
 CO :                            33 C |  CO0 :                          300 C |
 CO1 :                          318 C |  CO10 :                         37F C |
 CO11 :                         392 C |  CO12 :                         3AB C |
 CO13 :                         3B3 C |  CO14 :                         3C0 C |
 CO2 :                          31B C |  CO3 :                          328 C |
 CO4 :                          32B C |  CO5 :                          333 C |
 CO6 :                          354 C |  CO7 :                          355 C |
 CO8 :                          35D C |  CO9 :                          377 C |
 COLS :                          40 - | *CONSTPI :        3.141592653589793 - |
 COTAB :                        3C7 C |  CRC :                          405 C |
 CRC1 :                         410 C |  CTC0 :                           0 - |
 CTC1 :                           1 - |  CTC2 :                           2 - |
*CTC3 :                           3 - |  CUPOS :                       1800 C |
 DATA :                        1858 C | *DATE :                 "11/1/2023" - |
 DEL_USB :                      51F C | *DIR_USB :                      4F6 C |
 DIR_USB1 :                     504 C |  DIR_USB2 :                     513 C |
 DMP_ZEILE :                    440 C |  DMP_ZEILE1 :                   442 C |
 DMP_ZEILE2 :                   44D C |  DMP_ZEILE3 :                   45B C |
 DMP_ZEILE4 :                   46E C |  DMP_ZEILE5 :                   477 C |
*D_KO1 :                        836 C |  D_KO10 :                       8A6 C |
*D_KO11 :                       8B0 C | *D_KO12 :                       8B8 C |
 D_KO13 :                       8D7 C |  D_KO14 :                       8DE C |
 D_KO15 :                       8E3 C |  D_KO16 :                       8EB C |
 D_KO17 :                       8F3 C |  D_KO18 :                       8F9 C |
 D_KO19 :                       903 C |  D_KO2 :                        846 C |
 D_KO20 :                       90B C |  D_KO21 :                       912 C |
 D_KO22 :                       91B C |  D_KO23 :                       924 C |
 D_KO24 :                       929 C |  D_KO25 :                       92C C |
 D_KO26 :                       932 C |  D_KO27 :                       938 C |
 D_KO28 :                       957 C | *D_KO3 :                        85A C |
 D_KO4 :                        867 C |  D_KO5 :                        870 C |
 D_KO6 :                        873 C |  D_KO7 :                        88E C |
 D_KO8 :                        894 C |  D_KO9 :                        899 C |
 ENDE8 :                        0A2 C |  ERASE :                       0F85 C |
 ERASEBEG :                    1866 - |  ERR :                          741 C |
 ERROR :                        268 C |  ERROR1 :                       747 C |
 EXEC :                         735 C |  EX_SA_LO :                    0A8D C |
 EX_SA_LO1 :                   0A97 C |  EX_SA_LO2 :                   0A9B C |
 EX_SA_LO3 :                   0AB6 C |  FALSE :                          0 - |
 FARBBWS :                     181F C |  FILENAMBUF :                  18B4 C |
 FILETYP :                     18B0 C | *FULLPMMU :                       1 - |
 GET :                           28 C |  GETCO1 :                       25B C |
 GIDE :                          80 - |  GSBSLM :                      1861 C |
*HAS64 :                          0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - |  HDINIT :                      0B8F C |
 HD_BUFBAS :                   1864 C |  HD_BUFFER :                   1862 C |
*HD_BUF_HI :                    239 C |  HD_CYLINDER :                   36 C |
 HD_HEADS :                      64 C | *HD_SECTORS :                    65 C |
*HELP :                        0F26 C |  HELP1 :                       0F33 C |
 HS_AADR :                     187E - |  HS_BUF :                      187E C |
*HS_COD :                      1884 - |  HS_EADR :                     1880 - |
 HS_FILEINFO :                 188E - |  HS_FILETYP :                  188A - |
 HS_GESAMT :                   186A C | *HS_KENNUNG :                  188B - |
 HS_LAENGE :                   1866 C |  HS_REST :                     1868 C |
 HS_SADR :                     1882 - |  IDECHI :                        8D - |
 IDECLO :                        8C - |  IDECMD :                        8F - |
 IDEDAT :                        88 - | *IDEDOR :                        86 - |
 IDEERR :                        89 - |  IDESCNT :                       8A - |
 IDESDH :                        8E - |  IDESNUM :                       8B - |
*IDESTAT :                       8F - | *IDEWRPC :                       89 - |
 IGSBSLM :                      238 C |  INCH :                           8 C |
 INHEX :                        172 C | *INIT :                           0 C |
 INIT1 :                         0B C |  INIT2 :                         1B C |
 INIT3 :                         3B C |  INIT4 :                         41 C |
 INIT5 :                         58 C |  INIT8 :                         6E C |
 INIT_GSB :                     7CE C |  INLIN1 :                       12F C |
 INLIN2 :                       13A C |  INLINE :                       128 C |
*INSUPMODE :                      0 - |  INTTAB :                       2F8 C |
 IOBYT :                       1821 C | *JOY :                         0EB4 C |
 JP_RST08 :                    1802 C |  JP_RST10 :                    1805 C |
 JP_RST18 :                    1808 C |  JP_RST20 :                    180B C |
 JP_RST28 :                    180E C |  JP_RST30 :                    1811 C |
 JP_RST38 :                    1814 C |  J_OUTHEX :                     7EE C |
*J_OUTHL :                       30 C |  J_TASTE :                      7FA C |
 KDO1 :                         1DE C |  KDO1A :                        1E1 C |
 KDO2 :                         1E7 C |  KDO4 :                         21F C |
 KDO5 :                         1B5 C |  KDOANF :                        10 - |
 KDOANFH :                       20 - |  KDOV24 :                      1820 C |
 KONVX :                        146 C |  KONVX2 :                       156 C |
 KONVX3 :                       168 C |  LDSV_USB :                     4EB C |
 LDSV_USB1 :                    52A C |  LDSV_USB10 :                   5C4 C |
 LDSV_USB11 :                   5C9 C |  LDSV_USB12 :                   5CC C |
 LDSV_USB13 :                   5D5 C |  LDSV_USB14 :                   5DD C |
 LDSV_USB15 :                   60E C |  LDSV_USB16 :                   611 C |
 LDSV_USB17 :                   62A C |  LDSV_USB18 :                   62E C |
 LDSV_USB19 :                   657 C |  LDSV_USB2 :                    53A C |
 LDSV_USB20 :                   672 C |  LDSV_USB21 :                   683 C |
 LDSV_USB22 :                   68A C |  LDSV_USB23 :                   691 C |
 LDSV_USB3 :                    549 C |  LDSV_USB4 :                    54E C |
 LDSV_USB5 :                    55B C |  LDSV_USB6 :                    582 C |
 LDSV_USB7 :                    597 C |  LDSV_USB8 :                    5A8 C |
 LDSV_USB9 :                    5BF C | *LD_HD :                        9C7 C |
 LD_USB :                       4DB C |  LINES :                         20 - |
*LISTON :                         1 - |  LOAD0_HD :                     9CA C |
 LOC_4A1 :                      4A1 C |  LOC_4A5 :                      4A5 C |
 LOC_6B4 :                      6B4 C |  LOC_6C3 :                      6C3 C |
 LOC_6D3 :                      6D3 C |  LOC_74D :                      74D C |
 LOC_771 :                      771 C |  LOC_796 :                      796 C |
 LOC_798 :                      798 C |  LOC_963 :                      963 C |
 LOC_96D :                      96D C |  LOC_970 :                      970 C |
 LOC_99E :                      99E C |  LOC_9CE :                      9CE C |
 LOC_9F4 :                      9F4 C |  LOC_A0B :                     0A0B C |
 LOC_A1A :                     0A1A C |  LOC_A3C :                     0A3C C |
 LOC_AFA :                     0AFA C |  LOC_B08 :                     0B08 C |
 LOC_B14 :                     0B14 C |  LOC_B1C :                     0B1C C |
 LOC_B4F :                     0B4F C |  LOC_BBD :                     0BBD C |
 LOC_BCB :                     0BCB C |  LOC_BD8 :                     0BD8 C |
 LOC_C07 :                     0C07 C |  LOC_C0E :                     0C0E C |
 LOC_C1E :                     0C1E C |  LOC_C3F :                     0C3F C |
 LOC_C50 :                     0C50 C |  LOC_C5E :                     0C5E C |
 LOC_C64 :                     0C64 C |  LOC_C9A :                     0C9A C |
 LOC_CA2 :                     0CA2 C |  LOC_CA9 :                     0CA9 C |
 LOC_CAC :                     0CAC C |  LOC_CB4 :                     0CB4 C |
 LOC_CC9 :                     0CC9 C |  LOC_CD6 :                     0CD6 C |
 LOC_CD8 :                     0CD8 C |  LOC_CF2 :                     0CF2 C |
 LOC_CF9 :                     0CF9 C |  LOC_D09 :                     0D09 C |
 LOC_D37 :                     0D37 C |  LOC_D39 :                     0D39 C |
 LOC_D5F :                     0D5F C |  LOC_D66 :                     0D66 C |
 LOC_D7B :                     0D7B C |  LOC_D9B :                     0D9B C |
 LOC_DA9 :                     0DA9 C |  LOC_DB7 :                     0DB7 C |
 LOC_DBA :                     0DBA C |  LOC_DBB :                     0DBB C |
 LOC_DC0 :                     0DC0 C |  LOC_DCF :                     0DCF C |
 LOC_DD8 :                     0DD8 C |  LOC_DDE :                     0DDE C |
 LOC_DE5 :                     0DE5 C |  LOC_E8C :                     0E8C C |
 LOC_E97 :                     0E97 C |  LOC_EA3 :                     0EA3 C |
 LOC_FA8 :                     0FA8 C | *MACEXP :                         7 - |
 MODUL1 :                        14 - | *MOMCPU :                      80DC - |
*MOMCPUNAME :            "Z80UNDOC" - |  MON11VER :                    "11" - |
 MONVER :                       800 C |  MS30 :                         11D C |
 MS301 :                        121 C | *NAMELEN :                       28 - |
*NESTMAX :                      100 - |  NMI :                         1817 C |
 NOTAST :                       0D6 C |  OUTCH :                         10 C |
 OUTCHOFF :                     4B5 C |  OUTCHON :                      4B9 C |
 OUTCHON1 :                     4BB C |  OUTHEX :                       183 C |
 OUTHEX1 :                      18C C |  OUTHEX2 :                      197 C |
 OUTHL :                        19A C |  O_00 :                         32E C |
 O_BELL :                       387 C |  O_CLLN :                       375 C |
 O_CLS :                        365 C |  O_CLSC :                       36B C |
 O_CR :                         39A C |  O_CUD :                        38F C |
 O_CUL :                        38C C |  O_CUR :                        327 C |
 O_CUU :                        395 C |  O_DEL :                        3A8 C |
 O_HOME :                       3A3 C |  O_INS :                        3B8 C |
 O_SETC :                       3A0 C |  O_SOL :                        381 C |
 O_TAB :                        3D7 C |  O_ZS :                         2F0 C |
*PADDING :                        1 - |  PARA :                         4CA C |
 PIEP :                          9B C |  PIO2CA :                        0A - |
 PIO2CB :                        0B - |  PIO2DA :                         8 - |
*PIO2DB :                         9 - | *PIO2EPROM :                     0F - |
 PIO3A :                        0FC - |  PIO3AS :                       0FE - |
 PIO3B :                        0FD - |  PIO3BS :                       0FF - |
 PIOCA :                          6 - |  PIOCB :                          7 - |
 PIODA :                          4 - |  PIODB :                          5 - |
 PKO1 :                        0F1F C |  POSCNT :                      1856 C |
 PRNST :                         18 C |  PROMPTTEST :                   738 C |
 PUT :                           20 C |  PUT_LENGTH :                   81E C |
 P_COLKDO :                       0 - |  P_SETCOL :                       0 - |
*Q_KO20 :                      0A31 C | *Q_KO21 :                      0A37 C |
 RAM :                         1800 - |  RAMEND :                     0FFFF - |
 REGPC :                       1875 C |  REGSP :                       1877 C |
*RELAXED :                        0 - |  REPEAT :                      1857 C |
 RGET :                         7A3 C |  RINCH :                        0A5 C |
 RINCH1 :                       0B3 C |  RINCH2 :                       0BD C |
 RINCH3 :                       0C1 C |  RINCH4 :                       0C3 C |
 RINCH5 :                       0CA C |  ROM :                            0 - |
 ROUTCH :                        2B C |  ROUTCH0 :                      0E4 C |
 ROUTCH2 :                      0EF C |  ROUTCH3 :                      0FB C |
 ROUTCH4 :                      0FF C |  ROUTCH5 :                      113 C |
 RPRNST :                       4AA C |  RPRNST1 :                      4AC C |
 RPUT :                         2CF C |  RPUT1 :                        2D2 C |
 SAVE0_HD :                     9BE C |  SA_LO_BYT :                   18B3 C |
 SCROLL :                       3DC C |  SCROLL1 :                      3E3 C |
 SCROLL2 :                      3F6 C |  SETCOLOR :                    0FC8 C |
 SETCOLOR1 :                   0FCA C |  SOIL :                        181A C |
 SUB_1A5 :                      1A5 C | *SUB_38 :                        38 C |
 SUB_6A0 :                      6A0 C |  SUB_6BB :                      6BB C |
 SUB_784 :                      784 C |  SUB_787 :                      787 C |
 SUB_7BC :                      7BC C |  SUB_80F :                      80F C |
 SUB_95B :                      95B C |  SUB_9A4 :                      9A4 C |
 SUB_9EE :                      9EE C |  SUB_A41 :                     0A41 C |
 SUB_A43 :                     0A43 C |  SUB_A59 :                     0A59 C |
 SUB_AB7 :                     0AB7 C |  SUB_BB9 :                     0BB9 C |
 SUB_D7F :                     0D7F C |  SUB_E84 :                     0E84 C |
 SUB_E86 :                     0E86 C |  SUB_F9F :                     0F9F C |
*SV_RST :                       220 C |  SYN1 :                         6F7 C |
 SYN2 :                         6FF C |  SYN2A :                        702 C |
 SYN3 :                         714 C |  SYN4 :                         71F C |
 SYNC :                         6F4 C |  SYSSK :                       1856 - |
 TABIO :                       0AD8 C |  TACOD :                       1822 C |
*TAST1 :                        29B C |  TAST2 :                        2A0 C |
*TAST3 :                        2AE C |  TAST4 :                        2BB C |
 TAST5 :                        2BD C |  TAST6 :                        2C3 C |
 TAST7 :                        2C5 C |  TASTE :                        116 C |
*TBH6 :                        0BD4 C | *TBLOAD :                      0C81 C |
*TBSAVE :                      0BF7 C | *TB_AUS :                      0A31 C |
*TB_EIN :                      0A37 C | *TIME :                   "14:5:13" - |
 TOHEX :                       0EC8 C |  TOHEX1 :                      0ED2 C |
 TOHEX2 :                      0EDC C |  TON1 :                         288 C |
 TON2 :                         290 C | *TRUE :                           1 - |
 TSTHEX :                       493 C |  TSTSCH :                      0A7B C |
 TSTSCH1 :                     0A80 C |  TSTZEI :                       484 C |
*TSTZEI1 :                      486 C |  TSTZEI2 :                      48F C |
 TSTZEI3 :                      491 C |  UNK_186E :                    186E C |
 UNK_1885 :                    1885 - |  UNK_1887 :                    1887 - |
 UNK_1889 :                    1889 - |  UNK_188B :                    188B - |
 UNK_188D :                    188D - |  UNK_189E :                    189E C |
 UNK_18B1 :                    18B1 C |  UNK_18D4 :                    18D4 C |
 UNK_18F0 :                    18F0 C |  UNK_18F3 :                    18F3 C |
 UPTAST :                       297 C |  UPTON :                        287 C |
 USBINIT :                      6D6 C | *V24IN :                       0E4C C |
 V24IN0 :                      0E4E C |  V24IN2 :                      0E5F C |
 V24IN3 :                      0E66 C |  V24IN4 :                      0E6B C |
 V24IN5 :                      0E6E C |  V24IN6 :                      0E7E C |
 V24OUT :                      0DF9 C |  V24OUT2 :                     0E17 C |
 V24OUT3 :                     0E1D C |  V24OUT5 :                     0E23 C |
 V24OUT6 :                     0E29 C |  V24OUT7 :                     0E30 C |
 V24OUT8 :                     0E35 C |  V24OUT9 :                     0E3C C |
 VCOLOR :                        0B - |  VCURSORSYMB :                   7F - |
 VERSION :                 "V11.0 " - |  VGSBPROC :                   "USB" - |
 VHDCYLS :                      3D8 - |  VHDHEADS :                      10 - |
 VHDSECTORS :                    20 - |  VKDOPROC :                   "USB" - |
 WARMCOD :                     181C C |  ZK1 :                           31 - |
 ZK2 :                           2E - | *ZKR :                           3F - |

    471 symbols
     57 unused symbols

 AS V1.42 Beta [Bld 249] - Source File Monitor11.asm - Page 3 - 11/1/2023 14:5:13


  Defined Functions:
  ------------------

BWSAT                                 | LO                                   
HI                                    |

 AS V1.42 Beta [Bld 249] - Source File Monitor11.asm - Page 4 - 11/1/2023 14:5:13


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.05 seconds assembly time

   3521 lines source file
      2 passes
      0 errors
      0 warnings
