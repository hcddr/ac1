 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 1 - 11/7/2018 12:33:42


       1/       0 :                     ; B A S I C  -  AC 1   V 1.1  (C) Y21SO 1986
       2/       0 :                     
       3/       0 :                     ; File Name   :	D:\hobby3\ac1\basic\BASIC+EDITV1.1_4000_5FFF_4000.bin
       4/       0 :                     ; reassembled: V.Pohlers, 11/2018
       5/       0 :                     ; last change: 07.11.2018 12:23:15
       6/       0 :                     ; based on nascom basic (microsoft basic 4.7)
       7/       0 :                     
       8/       0 :                     ; NASCOM ROM BASIC Ver 4.7, (C) 1978 Microsoft
       9/       0 :                     ; Scanned from source published in 80-BUS NEWS from Vol 2, Issue 3
      10/       0 :                     ; (May-June 1983) to Vol 3, Issue 3 (May-June 1984)
      11/       0 :                     ; adapted to arnold assembler vpohlers
      12/       0 :                     
      13/       0 :                     		cpu	z80
      14/       0 :                     
      15/       0 :                     ; GENERAL EQUATES
      16/       0 :                     
      17/       0 : =3H                 CTRLC   EQU    03H             ; Control "C"
      18/       0 : =7H                 CTRLG   EQU    07H             ; Control "G"
      19/       0 : =8H                 BKSP    EQU    08H             ; Back space
      20/       0 : =AH                 LF      EQU    0AH             ; Line feed
      21/       0 : =CH                 CS      EQU    0CH             ; Clear screen
      22/       0 : =DH                 CR      EQU    0DH             ; Carriage return
      23/       0 : =FH                 CTRLO   EQU    0FH             ; Control "O"
      24/       0 : =11H                CTRLQ	EQU	11H             ; Control "Q"
      25/       0 : =12H                CTRLR   EQU    12H             ; Control "R"
      26/       0 : =13H                CTRLS   EQU    13H             ; Control "S"
      27/       0 : =15H                CTRLU   EQU    15H             ; Control "U"
      28/       0 : =1BH                ESC     EQU    1BH             ; Escape
      29/       0 : =7FH                DEL     EQU    7FH             ; Delete
      30/       0 :                     
      31/       0 :                     ; BASIC WORK SPACE LOCATIONS
      32/       0 :                     
      33/       0 : =6000H              WRKSPC  EQU    6000H           ; <<<< BASIC Work space ** Rx buffer & Tx buffer located from 2100H **
      34/       0 : =6003H              USR     EQU    WRKSPC+3H       ; "USR (x)" jump
      35/       0 : =6006H              OTPORT  EQU    WRKSPC+6H       ; Port (p)
      36/       0 : =600AH              TRFLAG	EQU    WRKSPC+0AH
      37/       0 : =600BH              DIVSUP  EQU    WRKSPC+0BH       ; Division support routine
      38/       0 : =600CH              DIV1    EQU    WRKSPC+0CH      ; <- Values
      39/       0 : =6010H              DIV2    EQU    WRKSPC+10H      ; <-   to
      40/       0 : =6014H              DIV3    EQU    WRKSPC+14H      ; <-   be
      41/       0 : =6017H              DIV4    EQU    WRKSPC+17H      ; <-inserted
      42/       0 : =6019H              SEED    EQU    WRKSPC+19H      ; Random number seed
      43/       0 : =603CH              LSTRND  EQU    WRKSPC+3CH      ; Last random number
      44/       0 : =6040H              NULLS   EQU    WRKSPC+40H      ; Number of nulls
      45/       0 : =6041H              LWIDTH  EQU    WRKSPC+41H      ; Terminal width
      46/       0 : =6042H              COMMAN  EQU    WRKSPC+42H      ; Width for commas
      47/       0 : =6043H              CTLOFG  EQU    WRKSPC+43H      ; Control "O" flag
      48/       0 : =6044H              LINESC  EQU    WRKSPC+44H      ; Lines counter
      49/       0 : =6046H              LINESN  EQU    WRKSPC+46H      ; Lines number
      50/       0 : =604AH              RINPUT  EQU    WRKSPC+4AH      ; Input reflection
      51/       0 : =604DH              unk_604D	equ WRKSPC+4DH
      52/       0 : =604EH              unk_604E	equ WRKSPC+4EH
      53/       0 : =6050H              unk_6050	equ WRKSPC+50H
      54/       0 : =6052H              unk_6052	equ WRKSPC+52H
      55/       0 : =6054H              unk_6054	equ WRKSPC+54H
      56/       0 : =6056H              STRSPC  EQU    WRKSPC+56H      ; Bottom of string space
      57/       0 : =6058H              LINEAT  EQU    WRKSPC+58H      ; Current line number
      58/       0 : =605AH              BASTXT  EQU    WRKSPC+5AH      ; Pointer to start of program
      59/       0 : =605DH              BUFFER  EQU    WRKSPC+5DH      ; Input buffer
      60/       0 : =6062H              STACK   EQU    WRKSPC+62H      ; Initial stack
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 2 - 11/7/2018 12:33:42


      61/       0 : =60A6H              unk_60A6	equ WRKSPC+0A6H
      62/       0 : =60A7H              CURPOS  EQU    WRKSPC+0A7H     ; <<<< Character position on line ** Top of TEMPSTACK **
      63/       0 : =60A8H              LCRFLG  EQU    WRKSPC+0A8H     ; Locate/Create flag
      64/       0 : =60A9H              TYPE    EQU    WRKSPC+0A9H     ; Data type flag
      65/       0 : =60AAH              DATFLG  EQU    WRKSPC+0AAH     ; Literal statement flag
      66/       0 : =60ABH              LSTRAM  EQU    WRKSPC+0ABH     ; Last available RAM
      67/       0 : =60ADH              TMSTPT  EQU    WRKSPC+0ADH     ; Temporary string pointer
      68/       0 : =60AFH              TMSTPL  EQU    WRKSPC+0AFH     ; Temporary string pool
      69/       0 : =60BBH              TMPSTR  EQU    WRKSPC+0BBH     ; Temporary string
      70/       0 : =60BFH              STRBOT  EQU    WRKSPC+0BFH     ; Bottom of string space
      71/       0 : =60C1H              CUROPR  EQU    WRKSPC+0C1H     ; Current operator in EVAL
      72/       0 : =60C3H              LOOPST  EQU    WRKSPC+0C3H     ; First statement of loop
      73/       0 : =60C5H              DATLIN  EQU    WRKSPC+0C5H     ; Line of current DATA item
      74/       0 : =60C7H              FORFLG  EQU    WRKSPC+0C7H     ; "FOR" loop flag
      75/       0 : =60C8H              LSTBIN  EQU    WRKSPC+0C8H     ; Last byte entered
      76/       0 : =60C9H              READFG  EQU    WRKSPC+0C9H     ; Read/Input flag
      77/       0 : =60CAH              BRKLIN  EQU    WRKSPC+0CAH     ; Line of break
      78/       0 : =60CCH              NXTOPR  EQU    WRKSPC+0CCH     ; Next operator in EVAL
      79/       0 : =60CEH              ERRLIN  EQU    WRKSPC+0CEH     ; Line of error
      80/       0 : =60D0H              CONTAD  EQU    WRKSPC+0D0H     ; Where to CONTinue
      81/       0 : =60D2H              PROGND  EQU    WRKSPC+0D2H     ; End of program
      82/       0 : =60D4H              VAREND  EQU    WRKSPC+0D4H     ; End of variables
      83/       0 : =60D6H              ARREND  EQU    WRKSPC+0D6H     ; End of arrays
      84/       0 : =60D8H              NXTDAT  EQU    WRKSPC+0D8H     ; Next data item
      85/       0 : =60DAH              FNRGNM  EQU    WRKSPC+0DAH     ; Name of FN argument
      86/       0 : =60DCH              FNARG   EQU    WRKSPC+0DCH     ; FN argument value
      87/       0 : =60DEH              unk_60DE	equ WRKSPC+0DEH
      88/       0 : =60E0H              FPREG   EQU    WRKSPC+0E0H     ; Floating point register
      89/       0 : =60E3H              FPEXP   EQU    FPREG+3         ; Floating point exponent
      90/       0 : =60E4H              SGNRES  EQU    WRKSPC+0E4H     ; Sign of result
      91/       0 : =60E5H              PBUFF   EQU    WRKSPC+0E5H     ; Number print buffer
      92/       0 : =60F2H              MULVAL  EQU    WRKSPC+0F2H     ; Multiplier
      93/       0 : =60F6H              PROGST  EQU    WRKSPC+0F6H     ; Start of program text area
      94/       0 : =615BH              STLOOK  EQU    WRKSPC+15BH     ; Start of memory test
      95/       0 :                     
      96/       0 :                     ; BASIC ERROR CODE VALUES
      97/       0 :                     
      98/       0 : =0H                 NF      EQU    00H             ; NEXT without FOR
      99/       0 : =2H                 SN      EQU    02H             ; Syntax error
     100/       0 : =4H                 RG      EQU    04H             ; RETURN without GOSUB
     101/       0 : =6H                 OD      EQU    06H             ; Out of DATA
     102/       0 : =8H                 FC      EQU    08H             ; Function call error
     103/       0 : =AH                 OV      EQU    0AH             ; Overflow
     104/       0 : =CH                 OM      EQU    0CH             ; Out of memory
     105/       0 : =EH                 UL      EQU    0EH             ; Undefined line number
     106/       0 : =10H                BS      EQU    10H             ; Bad subscript
     107/       0 : =12H                DD      EQU    12H             ; Re-DIMensioned array
     108/       0 : =14H                DZ      EQU    14H             ; Division by zero (/0)
     109/       0 : =16H                ID      EQU    16H             ; Illegal direct
     110/       0 : =18H                TM      EQU    18H             ; Type miss-match
     111/       0 : =1AH                OS      EQU    1AH             ; Out of string space
     112/       0 : =1CH                LS      EQU    1CH             ; String too long
     113/       0 : =1EH                ST      EQU    1EH             ; String formula too complex
     114/       0 : =20H                CN      EQU    20H             ; Can't CONTinue
     115/       0 : =22H                UF      EQU    22H             ; UnDEFined FN function
     116/       0 : =24H                MO      EQU    24H             ; Missing operand
     117/       0 :                     
     118/    4000 :                     		org 4000h
     119/    4000 :                     
     120/    4000 : C3 05 40            COLD:   JP      STARTB          ; Jump in for cold start
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 3 - 11/7/2018 12:33:42


     121/    4003 : 18 6F               WARM:   jr	BRKRET          ; Jump in for warm start
     122/    4005 :                     STARTB:
     123/    4005 : 31 A6 60            	ld	sp, unk_60A6	;?
     124/    4008 : 21 D2 40            	ld	hl, INITAB
     125/    400B : 11 00 60            	ld	de, WRKSPC
     126/    400E : 01 5F 00            	ld	bc, 5Fh
     127/    4011 : ED B0               	ldir
     128/    4013 : EB                  	ex	de, hl
     129/    4014 : F9                  	ld	sp, hl
     130/    4015 : CD 58 46            	call	CLREG
     131/    4018 : 32 A6 60            	ld	(unk_60A6), a	;?
     132/    401B : 32 F6 60            	ld	(PROGST), a
     133/    401E : CD 24 5E            	call	CLS
     134/    4021 : 21 7A 40            MSIZE:  LD      HL,MEMMSG       ; Point to message
     135/    4024 : CD 25 51                    CALL    PRS             ; Output "Memory size"
     136/    4027 : CD C5 46                    CALL    PROMPT          ; Get input with '?'
     137/    402A : CD 5C 48                    CALL    GETCHR          ; Get next character
     138/    402D : B7                          OR      A               ; Set flags
     139/    402E : 11 FF FF            	ld	de, 0FFFFh
     140/    4031 : 28 07               	jr	z, msiz1
     141/    4033 : CD F6 48            	call	ATOH
     142/    4036 : B7                  	or	a
     143/    4037 : C2 70 43            	jp	nz, SNERR
     144/    403A : 21 FF 5F            msiz1:	ld	hl, 5FFFh	; default memory end
     145/    403D : 23                  MLOOP:  INC     HL              ; Next byte
     146/    403E : CD 75 46            	call	CPDEHL
     147/    4041 : 28 09                       Jr      Z,SETTOP        ; Yes - 64K RAM
     148/    4043 : 7E                          LD      A,(HL)          ; Get contents
     149/    4044 : 47                          LD      B,A             ; Save it
     150/    4045 : 2F                          CPL                     ; Flip all bits
     151/    4046 : 77                          LD      (HL),A          ; Put it back
     152/    4047 : BE                          CP      (HL)            ; RAM there if same
     153/    4048 : 70                          LD      (HL),B          ; Restore old contents
     154/    4049 : 28 F2                       Jr      Z,MLOOP         ; If RAM - test next byte
     155/    404B : 2B                  	DEC     HL              ; Back one byte
     156/    404C :                     
     157/    404C : 11 5A 61            SETTOP: LD      DE,STLOOK-1     ; See if enough RAM
     158/    404F : CD 75 46                    CALL    CPDEHL          ; Compare DE with HL
     159/    4052 : 38 CD                       Jr      C,MSIZE         ; Ask again if not enough RAM
     160/    4054 : 11 CE FF                    LD      DE,0-50         ; 50 Bytes string space
     161/    4057 : 22 AB 60                    LD      (LSTRAM),HL     ; Save last available RAM
     162/    405A : 19                          ADD     HL,DE           ; Allocate string space
     163/    405B : 22 56 60                    LD      (STRSPC),HL     ; Save string space
     164/    405E : CD 33 46                    CALL    CLRPTR          ; Clear program area
     165/    4061 : 2A 56 60                    LD      HL,(STRSPC)     ; Get end of memory
     166/    4064 : 11 F9 9E                    LD      DE,-PROGST-17         ; Offset for free bytes
     167/    4067 : 19                          ADD     HL,DE           ; Adjust HL
     168/    4068 : CD 9B 57                    CALL    PRNTHL          ; Output amount of free memory
     169/    406B : 21 C3 40                    LD      HL,BFREE        ; " Bytes free" message
     170/    406E : CD 25 51                    CALL    PRS             ; Output string
     171/    4071 :                     
     172/    4071 : 31 62 60            WARMST: LD      SP,STACK        ; Temporary stack
     173/    4074 : CD 58 46            BRKRET: CALL    CLREG           ; Clear registers and stack
     174/    4077 : C3 BB 43                    JP      PRNTOK          ; Go to get command line
     175/    407A :                     
     176/    407A : 0D 0D 20 2A 20 2A   MEMMSG:		db 0Dh,0Dh," * * *  B A S I C  -  AC 1   V 1.1  (C) Y21SO 1986  "
                    20 2A 20 20 42 20 
                    41 20 53 20 49 20 
                    43 20 20 2D 20 20 
                    41 43 20 31 20 20 
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 4 - 11/7/2018 12:33:42


                    20 56 20 31 2E 31 
                    20 20 28 43 29 20 
                    59 32 31 53 4F 20 
                    31 39 38 36 20 20 
     177/    40B0 : 2A 20 2A 20 2A 0D   		db "* * *",0Dh,0Dh
                    0D 
     178/    40B7 : 4D 65 6D 6F 72 79   		db "Memory end ",0
                    20 65 6E 64 20 00 
     179/    40C3 :                     
     180/    40C3 : 20 42 79 74 65 73   BFREE:		db " Bytes free ",0Dh,0Dh,0
                    20 66 72 65 65 20 
                    0D 0D 00 
     181/    40D2 :                     
     182/    40D2 :                     ; INITIALISATION TABLE -------------------------------------------------------
     183/    40D2 :                     
     184/    40D2 : C3 71 40            INITAB: JP      WARMST          ; Warm start jump
     185/    40D5 : C3 F1 48                    JP      FCERR           ; "USR (X)" jump (Set to Error)
     186/    40D8 : 00                         		db    0
     187/    40D9 : 00                  		db    0
     188/    40DA : 00                  		db    0
     189/    40DB : 00                  		db    0
     190/    40DC : 00                  		db    0
     191/    40DD : D6 00                       SUB     0               ; Division support routine
     192/    40DF : 6F                          LD      L,A
     193/    40E0 : 7C                          LD      A,H
     194/    40E1 : DE 00                       SBC     A,0
     195/    40E3 : 67                          LD      H,A
     196/    40E4 : 78                          LD      A,B
     197/    40E5 : DE 00                       SBC     A,0
     198/    40E7 : 47                          LD      B,A
     199/    40E8 : 3E 00                       LD      A,0
     200/    40EA : C9                          RET
     201/    40EB : 00 00 00                    DB   0,0,0                   ; Random number seed table used by RND
     202/    40EE : 35 4A CA 99                 DB   035H,04AH,0CAH,099H     ;-2.65145E+07
     203/    40F2 : 39 1C 76 98                 DB   039H,01CH,076H,098H     ; 1.61291E+07
     204/    40F6 : 22 95 B3 98                 DB   022H,095H,0B3H,098H     ;-1.17691E+07
     205/    40FA : 0A DD 47 98                 DB   00AH,0DDH,047H,098H     ; 1.30983E+07
     206/    40FE : 53 D1 99 99                 DB   053H,0D1H,099H,099H     ;-2-01612E+07
     207/    4102 : 0A 1A 9F 98                 DB   00AH,01AH,09FH,098H     ;-1.04269E+07
     208/    4106 : 65 BC CD 98                 DB   065H,0BCH,0CDH,098H     ;-1.34831E+07
     209/    410A : D6 77 3E 98                 DB   0D6H,077H,03EH,098H     ; 1.24825E+07
     210/    410E : 52 C7 4F 80                 DB   052H,0C7H,04FH,080H     ; Last random number
     211/    4112 :                     ;--
     212/    4112 : 01                          DB   1               ; POS (x) number (1)
     213/    4113 : 3F                          DB   3Fh             ; Terminal width (255 = no auto CRLF)
     214/    4114 : 2A                          DB   42              ; Width for commas (3 columns)
     215/    4115 : 00                  	db    0
     216/    4116 : 0C 00                       DW   12              ; Initial lines counter
     217/    4118 : 0C 00                       DW   12              ; Initial lines number
     218/    411A : 00                  	db    0
     219/    411B : 00                  	db    0
     220/    411C : C3 8D 45                    JP      TTYLIN          ; Input reflection (set to TTY)
     221/    411F : 00                  	db    0
     222/    4120 : 00                  	db    0
     223/    4121 : 00                  	db    0
     224/    4122 : 00                  	db    0
     225/    4123 : 00                  	db    0
     226/    4124 : 00                  	db    0
     227/    4125 : 00                  	db    0
     228/    4126 : 00                  	db    0
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 5 - 11/7/2018 12:33:42


     229/    4127 : 00                  	db    0
     230/    4128 : 5B 61                       DW   STLOOK          ; Temp string space
     231/    412A : FE FF                       DW   -2              ; Current line number (cold)
     232/    412C : F7 60                       DW   PROGST+1        ; Start of program text
     233/    412E :                     INITBE:
     234/    412E :                     
     235/    412E :                     ; END OF INITIALISATION TABLE ---------------------------------------------------
     236/    412E :                     
     237/    412E :                     ; RESERVED WORD LIST
     238/    412E :                     
     239/    412E : C5 4E 44            WORDS:  DB   'E'+80H,"ND"
     240/    4131 : C6 4F 52                    DB   'F'+80H,"OR"
     241/    4134 : CE 45 58 54                 DB   'N'+80H,"EXT"
     242/    4138 : C4 41 54 41                 DB   'D'+80H,"ATA"
     243/    413C : C9 4E 50 55 54              DB   'I'+80H,"NPUT"
     244/    4141 : C4 49 4D                    DB   'D'+80H,"IM"
     245/    4144 : D2 45 41 44                 DB   'R'+80H,"EAD"
     246/    4148 : CC 45 54                    DB   'L'+80H,"ET"
     247/    414B : C7 4F 54 4F                 DB   'G'+80H,"OTO"
     248/    414F : D2 55 4E                    DB   'R'+80H,"UN"
     249/    4152 : C9 46                       DB   'I'+80H,"F"
     250/    4154 : D2 45 53 54 4F 52           DB   'R'+80H,"ESTORE"
                    45 
     251/    415B : C7 4F 53 55 42              DB   'G'+80H,"OSUB"
     252/    4160 : D2 45 54 55 52 4E           DB   'R'+80H,"ETURN"
     253/    4166 : D2 45 4D                    DB   'R'+80H,"EM"
     254/    4169 : D3 54 4F 50                 DB   'S'+80H,"TOP"
     255/    416D : CF 55 54                    DB   'O'+80H,"UT"
     256/    4170 : CF 4E                       DB   'O'+80H,"N"
     257/    4172 : CE 55 4C 4C                 DB   'N'+80H,"ULL"
     258/    4176 : D7 41 49 54                 DB   'W'+80H,"AIT"
     259/    417A : C4 45 46                    DB   'D'+80H,"EF"
     260/    417D : D0 4F 4B 45                 DB   'P'+80H,"OKE"
     261/    4181 : C4 4F 4B 45                 DB   'D'+80H,"OKE"
     262/    4185 : C1 55 54 4F         	db   'A'+80H,"UTO"
     263/    4189 : CC 49 4E 45 53              DB   'L'+80H,"INES"
     264/    418E : C3 4C 53                    DB   'C'+80H,"LS"
     265/    4191 : D7 49 44 54 48              DB   'W'+80H,"IDTH"
     266/    4196 : C2 59 45            	db   'B'+80H,"YE"
     267/    4199 : D2 45 4E 55 4D 42   	db   'R'+80H,"ENUMBER"
                    45 52 
     268/    41A1 : C3 41 4C 4C         	db   'C'+80H,"ALL"
     269/    41A5 : D0 52 49 4E 54              DB   'P'+80H,"RINT"
     270/    41AA : C3 4F 4E 54                 DB   'C'+80H,"ONT"
     271/    41AE : CC 49 53 54                 DB   'L'+80H,"IST"
     272/    41B2 : C3 4C 45 41 52              DB   'C'+80H,"LEAR"
     273/    41B7 : C3 4C 4F 41 44              DB   'C'+80H,"LOAD"
     274/    41BC : C3 53 41 56 45              DB   'C'+80H,"SAVE"
     275/    41C1 : CE 45 57                    DB   'N'+80H,"EW"
     276/    41C4 :                     
     277/    41C4 : D4 41 42 28                 DB   'T'+80H,"AB("
     278/    41C8 : D4 4F                       DB   'T'+80H,"O"
     279/    41CA : C6 4E                       DB   'F'+80H,"N"
     280/    41CC : D3 50 43 28                 DB   'S'+80H,"PC("
     281/    41D0 : D4 48 45 4E                 DB   'T'+80H,"HEN"
     282/    41D4 : CE 4F 54                    DB   'N'+80H,"OT"
     283/    41D7 : D3 54 45 50                 DB   'S'+80H,"TEP"
     284/    41DB :                     
     285/    41DB : AB                          DB   '+'+80H
     286/    41DC : AD                          DB   '-'+80H
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 6 - 11/7/2018 12:33:42


     287/    41DD : AA                          DB   '*'+80H
     288/    41DE : AF                          DB   '/'+80H
     289/    41DF : DE                          DB   '^'+80H
     290/    41E0 : C1 4E 44                    DB   'A'+80H,"ND"
     291/    41E3 : CF 52                       DB   'O'+80H,"R"
     292/    41E5 : BE                          DB   '>'+80H
     293/    41E6 : BD                          DB   '='+80H
     294/    41E7 : BC                          DB   '<'+80H
     295/    41E8 :                     
     296/    41E8 : D3 47 4E                    DB   'S'+80H,"GN"
     297/    41EB : C9 4E 54                    DB   'I'+80H,"NT"
     298/    41EE : C1 42 53                    DB   'A'+80H,"BS"
     299/    41F1 : D5 53 52                    DB   'U'+80H,"SR"
     300/    41F4 : C6 52 45                    DB   'F'+80H,"RE"
     301/    41F7 : C9 4E 50                    DB   'I'+80H,"NP"
     302/    41FA : D0 4F 53                    DB   'P'+80H,"OS"
     303/    41FD : D3 51 52                    DB   'S'+80H,"QR"
     304/    4200 : D2 4E 44                    DB   'R'+80H,"ND"
     305/    4203 : CC 4E                       db   'L'+80H,'N'
     306/    4205 : C5 58 50                    DB   'E'+80H,"XP"
     307/    4208 : C3 4F 53                    DB   'C'+80H,"OS"
     308/    420B : D3 49 4E                    DB   'S'+80H,"IN"
     309/    420E : D4 41 4E                    DB   'T'+80H,"AN"
     310/    4211 : C1 54 4E                    DB   'A'+80H,"TN"
     311/    4214 : D0 45 45 4B                 DB   'P'+80H,"EEK"
     312/    4218 : C4 45 45 4B                 DB   'D'+80H,"EEK"
     313/    421C : D0 4F 49 4E 54              DB   'P'+80H,"OINT"
     314/    4221 : CC 45 4E                    DB   'L'+80H,"EN"
     315/    4224 : D3 54 52 24                 DB   'S'+80H,"TR$"
     316/    4228 : D6 41 4C                    DB   'V'+80H,"AL"
     317/    422B : C1 53 43                    DB   'A'+80H,"SC"
     318/    422E : C3 48 52 24                 DB   'C'+80H,"HR$"
     319/    4232 :                     
     320/    4232 : CC 45 46 54 24              DB   'L'+80H,"EFT$"
     321/    4237 : D2 49 47 48 54 24           DB   'R'+80H,"IGHT$"
     322/    423D : CD 49 44 24                 DB   'M'+80H,"ID$"
     323/    4241 :                     
     324/    4241 : D3 45 54            	db   'S'+80H,"ET"
     325/    4244 : D2 45 53 45 54      	db   'R'+80H,"ESET"
     326/    4249 : D7 49 4E 44 4F 57   	db   'W'+80H,"INDOW"
     327/    424F : D3 43 52 45 45 4E   	db   'S'+80H,"CREEN"
     328/    4255 : C5 44 49 54         	db   'E'+80H,"DIT"
     329/    4259 : C1 53 41 56 45      	db   'A'+80H,"SAVE"
     330/    425E : C1 4C 4F 41 44      	db   'A'+80H,"LOAD"
     331/    4263 : D4 52 4F 4E         	db   'T'+80H,"RON"
     332/    4267 : D4 52 4F 46 46      	db   'T'+80H,"ROFF"
     333/    426C : 80                          DB   80H             ; End of list marker
     334/    426D :                     
     335/    426D :                     ; KEYWORD ADDRESS TABLE
     336/    426D :                     
     337/    426D : 92 48               WORDTB:	dw PEND
     338/    426F : 87 47               	dw FOR
     339/    4271 : 34 4C               	dw NEXT
     340/    4273 : BD 49               	dw DATA
     341/    4275 : 48 4B               	dw INPUT
     342/    4277 : 59 4E               	dw DIM
     343/    4279 : 75 4B               	dw READ
     344/    427B : D2 49               	dw LET
     345/    427D : 7B 49               	dw GOTO
     346/    427F : 5F 49               	dw RUN
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 7 - 11/7/2018 12:33:42


     347/    4281 : 44 4A               	dw IF
     348/    4283 : 6B 48               	dw RESTOR
     349/    4285 : 6A 49               	dw GOSUB
     350/    4287 : 99 49               	dw RETURN
     351/    4289 : BF 49               	dw REM
     352/    428B : 90 48               	dw STOP
     353/    428D : 4F 53               	dw POUT
     354/    428F : 28 4A               	dw ON
     355/    4291 : 1C 4B               	dw NULL
     356/    4293 : 5A 53               	dw WAIT
     357/    4295 : 1E 50               	dw DEF
     358/    4297 : A0 53               	dw POKE
     359/    4299 : BC 53               	dw DOKE
     360/    429B : 00 46               	dw AUTO
     361/    429D : D2 46               	dw LINES
     362/    429F : 24 5E               	dw CLS
     363/    42A1 : 14 4B               	dw WIDTH
     364/    42A3 : 32 5E               	dw BYE
     365/    42A5 : F0 5A               	dw RENUM
     366/    42A7 : AA 5A               	dw PCALL
     367/    42A9 : 69 4A               	dw PRINT
     368/    42AB : BD 48               	dw CONT
     369/    42AD : E1 46               	dw LIST
     370/    42AF : 1A 49               	dw CLEAR
     371/    42B1 : 10 5D               	dw CLOAD
     372/    42B3 : CF 5C               	dw CSAVE
     373/    42B5 : 32 46               	dw NEW
     374/    42B7 :                     ;---
     375/    42B7 : 72 5D               	dw PSET
     376/    42B9 : 75 5D               	dw PRESET
     377/    42BB : F1 48               	dw FCERR	; WINDOW
     378/    42BD : EF 5D               	dw SCREEN
     379/    42BF : E4 5E               	dw EDIT
     380/    42C1 : F1 48               	dw FCERR	; ASAVE
     381/    42C3 : F1 48               	dw FCERR	; ALOAD
     382/    42C5 : 60 47               	dw TRON
     383/    42C7 : 61 47               	dw TROFF
     384/    42C9 :                     
     385/    42C9 : 1F 56               FNCTAB:	dw SGN
     386/    42CB : E1 56               	dw INT
     387/    42CD : 35 56               	dw ABS
     388/    42CF : 03 60               	dw USR
     389/    42D1 : E9 4F               	dw FRE
     390/    42D3 : 46 53               	dw INP
     391/    42D5 : 16 50               	dw POS
     392/    42D7 : 91 58               	dw SQR
     393/    42D9 : 6F 59               	dw RND
     394/    42DB : D1 54               	dw LOG
     395/    42DD : DF 58               	dw EXP
     396/    42DF : E2 59               	dw COS
     397/    42E1 : E8 59               	dw SIN
     398/    42E3 : 49 5A               	dw TAN
     399/    42E5 : 5E 5A               	dw ATN
     400/    42E7 : 99 53               	dw PEEK
     401/    42E9 : B1 53               	dw DEEK
     402/    42EB : 70 5D               	dw POINT
     403/    42ED : 8A 52               	dw LEN
     404/    42EF : B2 50               	dw STR
     405/    42F1 : 21 53               	dw VAL
     406/    42F3 : 99 52               	dw ASC
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 8 - 11/7/2018 12:33:42


     407/    42F5 : AA 52               	dw CHR
     408/    42F7 : BA 52               	dw LEFT
     409/    42F9 : E9 52               	dw RIGHT
     410/    42FB : F2 52               	dw MID
     411/    42FD :                     
     412/    42FD :                     ; RESERVED WORD TOKEN VALUES
     413/    42FD :                     
     414/    42FD : =80H                ZEND    EQU    080H            ; END
     415/    42FD : =81H                ZFOR    EQU    081H            ; FOR
     416/    42FD : =83H                ZDATA   EQU    083H            ; DATA
     417/    42FD : =88H                ZGOTO   EQU    088H            ; GOTO
     418/    42FD : =8CH                ZGOSUB  EQU    08CH            ; GOSUB
     419/    42FD : =8EH                ZREM    EQU    08EH            ; REM
     420/    42FD : =9EH                ZPRINT  EQU    09EH            ; PRINT
     421/    42FD : =A4H                ZNEW    EQU    0A4H            ; NEW
     422/    42FD :                     
     423/    42FD : =A5H                ZTAB    EQU    0A5H            ; TAB
     424/    42FD : =A6H                ZTO     EQU    0A6H            ; TO
     425/    42FD : =A7H                ZFN     EQU    0A7H            ; FN
     426/    42FD : =A8H                ZSPC    EQU    0A8H            ; SPC
     427/    42FD : =A9H                ZTHEN   EQU    0A9H            ; THEN
     428/    42FD : =AAH                ZNOT    EQU    0AAH            ; NOT
     429/    42FD : =ABH                ZSTEP   EQU    0ABH            ; STEP
     430/    42FD :                     
     431/    42FD : =ACH                ZPLUS   EQU    0ACH            ; +
     432/    42FD : =ADH                ZMINUS  EQU    0ADH            ; -
     433/    42FD : =AEH                ZTIMES  EQU    0AEH            ; *
     434/    42FD : =AFH                ZDIV    EQU    0AFH            ; /
     435/    42FD : =B2H                ZOR     EQU    0B2H            ; OR
     436/    42FD : =B3H                ZGTR    EQU    0B3H            ; >
     437/    42FD : =B4H                ZEQUAL  EQU    0B4H            ; M
     438/    42FD : =B5H                ZLTH    EQU    0B5H            ; <
     439/    42FD : =B6H                ZSGN    EQU    0B6H            ; SGN
     440/    42FD : =C7H                ZPOINT  EQU    0C7H            ; POINT
     441/    42FD : =CFH                ZLEFT   EQU    0CDH +2         ; LEFT$
     442/    42FD :                     
     443/    42FD :                     ; ARITHMETIC PRECEDENCE TABLE
     444/    42FD :                     
     445/    42FD : 79                  PRITAB: DB   79H             ; Precedence value
     446/    42FE : 83 57                       DW   PADD            ; FPREG = <last> + FPREG
     447/    4300 :                     
     448/    4300 : 79                          DB   79H             ; Precedence value
     449/    4301 : DF 53                       DW   PSUB            ; FPREG = <last> - FPREG
     450/    4303 :                     
     451/    4303 : 7C                          DB   7CH             ; Precedence value
     452/    4304 : 10 55                       DW   MULT            ; PPREG = <last> * FPREG
     453/    4306 :                     
     454/    4306 : 7C                          DB   7CH             ; Precedence value
     455/    4307 : 6B 55                       DW   DIV             ; FPREG = <last> / FPREG
     456/    4309 :                     
     457/    4309 : 7F                          DB   7FH             ; Precedence value
     458/    430A : 9A 58                       DW   POWER           ; FPREG = <last> ^ FPREG
     459/    430C :                     
     460/    430C : 50                          DB   50H             ; Precedence value
     461/    430D : B4 4D                       DW   PAND            ; FPREG = <last> AND FPREG
     462/    430F :                     
     463/    430F : 46                          DB   46H             ; Precedence value
     464/    4310 : B3 4D                       DW   POR             ; FPREG = <last> OR FPREG
     465/    4312 :                     
     466/    4312 :                     ; BASIC ERROR CODE LIST
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 9 - 11/7/2018 12:33:42


     467/    4312 :                     
     468/    4312 : 4E 46               ERRORS: DB   "NF"            ; NEXT without FOR
     469/    4314 : 53 4E                       DB   "SN"            ; Syntax error
     470/    4316 : 52 47                       DB   "RG"            ; RETURN without GOSUB
     471/    4318 : 4F 44                       DB   "OD"            ; Out of DATA
     472/    431A : 46 43                       DB   "FC"            ; Illegal function call
     473/    431C : 4F 56                       DB   "OV"            ; Overflow error
     474/    431E : 4F 4D                       DB   "OM"            ; Out of memory
     475/    4320 : 55 4C                       DB   "UL"            ; Undefined line
     476/    4322 : 42 53                       DB   "BS"            ; Bad subscript
     477/    4324 : 44 44                       DB   "DD"            ; Re-DIMensioned array
     478/    4326 : 2F 30                       DB   "/0"            ; Division by zero
     479/    4328 : 49 44                       DB   "ID"            ; Illegal direct
     480/    432A : 54 4D                       DB   "TM"            ; Type mis-match
     481/    432C : 4F 53                       DB   "OS"            ; Out of string space
     482/    432E : 4C 53                       DB   "LS"            ; String too long
     483/    4330 : 53 54                       DB   "ST"            ; String formula too complex
     484/    4332 : 43 4E                       DB   "CN"            ; Can't CONTinue
     485/    4334 : 55 46                       DB   "UF"            ; Undefined FN function
     486/    4336 : 4D 4F                       DB   "MO"            ; Missing operand
     487/    4338 :                     
     488/    4338 : 20 45 72 72 6F 72   ERRMSG: DB   " Error",0
                    00 
     489/    433F : 20 69 6E 20 00      INMSG:  DB   " in ",0
     490/    4344 : =4343H              ZERBYT  EQU    $-1             ; A zero byte
     491/    4344 : 6F 6B 0D 0A 00      OKMSG:  DB   "ok",CR,LF,0
     492/    4349 : 42 72 65 61 6B 00   BRKMSG: DB   "Break",0
     493/    434F :                     
     494/    434F : E5                  CHKSTK: PUSH    HL              ; Save code string address
     495/    4350 : 2A D6 60                    LD      HL,(ARREND)     ; Lowest free memory
     496/    4353 : 06 00                       LD      B,0             ; BC = Number of levels to test
     497/    4355 : 09                          ADD     HL,BC           ; 2 Bytes for each level
     498/    4356 : 09                          ADD     HL,BC
     499/    4357 : 3E                          DB   3EH             ; Skip "PUSH HL"
     500/    4358 :                     
     501/    4358 : E5                  ENFMEM: PUSH    HL              ; Save code string address
     502/    4359 : 3E D0                       LD      A,0D0H ;LOW -48 ; 48 Bytes minimum RAM
     503/    435B : 95                          SUB     L
     504/    435C : 6F                          LD      L,A
     505/    435D : 3E FF                       LD      A,0FFH; HIGH (-48) ; 48 Bytes minimum RAM
     506/    435F : 9C                          SBC     A,H
     507/    4360 : 38 04                       Jr      C,OMERR         ; Not enough - ?OM Error
     508/    4362 : 67                          LD      H,A
     509/    4363 : 39                          ADD     HL,SP           ; Test if stack is overflowed
     510/    4364 : E1                          POP     HL              ; Restore code string address
     511/    4365 : D8                          RET     C               ; Return if enough mmory
     512/    4366 : 1E 0C               OMERR:  LD      E,OM            ; ?OM Error
     513/    4368 : 18 1A                       Jr      ERROR
     514/    436A :                     
     515/    436A : 2A C5 60            DATSNR: LD      HL,(DATLIN)     ; Get line of current DATA item
     516/    436D : 22 58 60                    LD      (LINEAT),HL     ; Save as current line
     517/    4370 : 1E 02               SNERR:  LD      E,SN            ; ?SN Error
     518/    4372 : 01                          DB   01H             ; Skip "LD E,DZ"
     519/    4373 : 1E 14               DZERR:  LD      E,DZ            ; ?/0 Error
     520/    4375 : 01                          DB   01H             ; Skip "LD E,NF"
     521/    4376 : 1E 00               NFERR:  LD      E,NF            ; ?NF Error
     522/    4378 : 01                          DB   01H             ; Skip "LD E,DD"
     523/    4379 : 1E 12               DDERR:  LD      E,DD            ; ?DD Error
     524/    437B : 01                          DB   01H             ; Skip "LD E,UF"
     525/    437C : 1E 22               UFERR:  LD      E,UF            ; ?UF Error
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 10 - 11/7/2018 12:33:42


     526/    437E : 01                          DB   01H             ; Skip "LD E,OV
     527/    437F : 1E 0A               OVERR:  LD      E,OV            ; ?OV Error
     528/    4381 : 01                          DB   01H             ; Skip "LD E,TM"
     529/    4382 : 1E 18               TMERR:  LD      E,TM            ; ?TM Error
     530/    4384 :                     
     531/    4384 : CD 58 46            ERROR:  CALL    CLREG           ; Clear registers and stack
     532/    4387 : 32 43 60                    LD      (CTLOFG),A      ; Enable output (A is 0)
     533/    438A : CD B3 4A                    CALL    STTLIN          ; Start new line
     534/    438D : 21 12 43                    LD      HL,ERRORS       ; Point to error codes
     535/    4390 : 57                          LD      D,A             ; D = 0 (A is 0)
     536/    4391 : 3E 3F                       LD      A,'?'
     537/    4393 : CD 8E 46                    CALL    OUTC            ; Output '?'
     538/    4396 : 19                          ADD     HL,DE           ; Offset to correct error code
     539/    4397 : 7E                          LD      A,(HL)          ; First character
     540/    4398 : CD 8E 46                    CALL    OUTC            ; Output it
     541/    439B : CD 5C 48                    CALL    GETCHR          ; Get next character
     542/    439E : CD 8E 46                    CALL    OUTC            ; Output it
     543/    43A1 : 21 38 43                    LD      HL,ERRMSG       ; "Error" message
     544/    43A4 : CD 25 51            ERRIN:  CALL    PRS             ; Output message
     545/    43A7 : 2A 58 60                    LD      HL,(LINEAT)     ; Get line of error
     546/    43AA : 11 FE FF                    LD      DE,-2           ; Cold start error if -2
     547/    43AD : CD 75 46                    CALL    CPDEHL          ; See if cold start error
     548/    43B0 : CA 05 40                    JP      Z,STARTB        ; Cold start error - Restart
     549/    43B3 : 7C                          LD      A,H             ; Was it a direct error?
     550/    43B4 : A5                          AND     L               ; Line = -1 if direct error
     551/    43B5 : 3C                          INC     A
     552/    43B6 : C4 93 57                    CALL    NZ,LINEIN       ; No - output line of error
     553/    43B9 : 3E                          DB   3EH             ; Skip "POP BC"
     554/    43BA : C1                  POPNOK: POP     BC              ; Drop address in input buffer
     555/    43BB :                     
     556/    43BB : AF                  PRNTOK: XOR     A               ; Output "Ok" and get command
     557/    43BC : 32 43 60                    LD      (CTLOFG),A      ; Enable output
     558/    43BF : CD B3 4A                    CALL    STTLIN          ; Start new line
     559/    43C2 : 21 44 43                    LD      HL,OKMSG        ; "Ok" message
     560/    43C5 : CD 25 51                    CALL    PRS             ; Output "Ok"
     561/    43C8 : 37                  	scf
     562/    43C9 : 21 FF FF            GETCMD: LD      HL,-1           ; Flag direct mode
     563/    43CC : 22 58 60                    LD      (LINEAT),HL     ; Save as current line
     564/    43CF :                     ;---
     565/    43CF : 3A 4D 60            	ld	a, (unk_604D)
     566/    43D2 : B7                  	or	a
     567/    43D3 : 28 3A               	jr	z, getcmd4
     568/    43D5 : 2A 4E 60            	ld	hl, (unk_604E)
     569/    43D8 : E5                  	push	hl
     570/    43D9 : CD 9B 57            	call	PRNTHL
     571/    43DC : D1                  	pop	de
     572/    43DD : D5                  	push	de
     573/    43DE : CD B0 44            	call	SRCHLN
     574/    43E1 : 3E 2A               	ld	a, '*'
     575/    43E3 : 38 02               	jr	c, getcmd1
     576/    43E5 : 3E 20               	ld	a, ' '
     577/    43E7 :                     getcmd1:
     578/    43E7 : CD 8E 46            	call	OUTC
     579/    43EA : CD 8D 45            	call	TTYLIN
     580/    43ED : D1                  	pop	de
     581/    43EE : 30 06               	jr	nc, getcmd3
     582/    43F0 :                     getcmd2:
     583/    43F0 : AF                  	xor	a
     584/    43F1 : 32 4D 60            	ld	(unk_604D), a
     585/    43F4 : 18 C5               	jr	PRNTOK
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 11 - 11/7/2018 12:33:42


     586/    43F6 :                     getcmd3:
     587/    43F6 : 2A 50 60            	ld	hl, (unk_6050)
     588/    43F9 : 19                  	add	hl, de
     589/    43FA : 38 F4               	jr	c, getcmd2
     590/    43FC : D5                  	push	de
     591/    43FD : 11 F9 FF            	ld	de, 0FFF9h
     592/    4400 : CD 75 46            	call	CPDEHL
     593/    4403 : D1                  	pop	de
     594/    4404 : 30 EA               	jr	nc, getcmd2
     595/    4406 : 22 4E 60            	ld	(unk_604E), hl
     596/    4409 : 21 5D 60            	ld	hl, BUFFER
     597/    440C : F5                  	push	af
     598/    440D : 18 15               	jr	getcmd5
     599/    440F :                     getcmd4:
     600/    440F : 3E 3E               	ld	a, '>'
     601/    4411 : CD 8E 46            	call	OUTC
     602/    4414 : CD 8D 45            	call	TTYLIN
     603/    4417 :                     ;---
     604/    4417 : 38 B0                       Jr      C,GETCMD        ; Get line again if break
     605/    4419 : CD 5C 48                    CALL    GETCHR          ; Get first character
     606/    441C : 3C                          INC     A               ; Test if end of line
     607/    441D : 3D                          DEC     A               ; Without affecting Carry
     608/    441E : 28 A9                       Jr      Z,GETCMD        ; Nothing entered - Get another
     609/    4420 : F5                          PUSH    AF              ; Save Carry status
     610/    4421 : CD F6 48                    CALL    ATOH            ; Get line number into DE
     611/    4424 :                     getcmd5:
     612/    4424 : D5                          PUSH    DE              ; Save line number
     613/    4425 : CD CF 44                    CALL    CRUNCH          ; Tokenise rest of line
     614/    4428 : 47                          LD      B,A             ; Length of tokenised line
     615/    4429 : D1                          POP     DE              ; Restore line number
     616/    442A : F1                          POP     AF              ; Restore Carry
     617/    442B : D2 31 48                    JP      NC,EXCUTE       ; No line number - Direct mode
     618/    442E : D5                          PUSH    DE              ; Save line number
     619/    442F : C5                          PUSH    BC              ; Save length of tokenised line
     620/    4430 : AF                          XOR     A
     621/    4431 : 32 C8 60                    LD      (LSTBIN),A      ; Clear last byte input
     622/    4434 : CD 5C 48                    CALL    GETCHR          ; Get next character
     623/    4437 : B7                          OR      A               ; Set flags
     624/    4438 : F5                          PUSH    AF              ; And save them
     625/    4439 : CD B0 44                    CALL    SRCHLN          ; Search for line number in DE
     626/    443C : 38 06                       Jr      C,LINFND        ; Jump if line found
     627/    443E : F1                          POP     AF              ; Get status
     628/    443F : F5                          PUSH    AF              ; And re-save
     629/    4440 : CA 94 49                    JP      Z,ULERR         ; Nothing after number - Error
     630/    4443 : B7                          OR      A               ; Clear Carry
     631/    4444 : C5                  LINFND: PUSH    BC              ; Save address of line in prog
     632/    4445 : 30 12                       Jr      NC,INEWLN       ; Line not found - Insert new
     633/    4447 : EB                          EX      DE,HL           ; Next line address in DE
     634/    4448 : 2A D2 60                    LD      HL,(PROGND)     ; End of program
     635/    444B : 1A                  SFTPRG: LD      A,(DE)          ; Shift rest of program down
     636/    444C : 02                          LD      (BC),A
     637/    444D : 03                          INC     BC              ; Next destination
     638/    444E : 13                          INC     DE              ; Next source
     639/    444F : CD 75 46                    CALL    CPDEHL          ; All done?
     640/    4452 : 20 F7                       Jr      NZ,SFTPRG       ; More to do
     641/    4454 : 60                          LD      H,B             ; HL - New end of program
     642/    4455 : 69                          LD      L,C
     643/    4456 : 22 D2 60                    LD      (PROGND),HL     ; Update end of program
     644/    4459 :                     
     645/    4459 : D1                  INEWLN: POP     DE              ; Get address of line,
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 12 - 11/7/2018 12:33:42


     646/    445A : F1                          POP     AF              ; Get status
     647/    445B : 28 22                       Jr      Z,SETPTR        ; No text - Set up pointers
     648/    445D : 2A D2 60                    LD      HL,(PROGND)     ; Get end of program
     649/    4460 : E3                          EX      (SP),HL         ; Get length of input line
     650/    4461 : C1                          POP     BC              ; End of program to BC
     651/    4462 : 09                          ADD     HL,BC           ; Find new end
     652/    4463 : E5                          PUSH    HL              ; Save new end
     653/    4464 : CD A0 44                    CALL    MOVUP           ; Make space for line
     654/    4467 : E1                          POP     HL              ; Restore new end
     655/    4468 : 22 D2 60                    LD      (PROGND),HL     ; Update end of program pointer
     656/    446B : EB                          EX      DE,HL           ; Get line to move up in HL
     657/    446C : 36 FF                       LD      (HL), 0ffh          ; Save MSB
     658/    446E : D1                          POP     DE              ; Get new line number
     659/    446F : 23                          INC     HL              ; Skip pointer
     660/    4470 : 23                          INC     HL
     661/    4471 : 73                          LD      (HL),E          ; Save LSB of line number
     662/    4472 : 23                          INC     HL
     663/    4473 : 72                          LD      (HL),D          ; Save MSB of line number
     664/    4474 : 23                          INC     HL              ; To first byte in line
     665/    4475 : 11 5D 60                    LD      DE,BUFFER       ; Copy buffer to program
     666/    4478 : 1A                  MOVBUF: LD      A,(DE)          ; Get source
     667/    4479 : 77                          LD      (HL),A          ; Save destinations
     668/    447A : 23                          INC     HL              ; Next source
     669/    447B : 13                          INC     DE              ; Next destination
     670/    447C : B7                          OR      A               ; Done?
     671/    447D : 20 F9                       Jr      NZ,MOVBUF       ; No - Repeat
     672/    447F : CD 3E 46            SETPTR: CALL    RUNFST          ; Set line pointers
     673/    4482 : 23                          INC     HL              ; To LSB of pointer
     674/    4483 : EB                          EX      DE,HL           ; Address to DE
     675/    4484 : 21 C9 43            	ld	hl, GETCMD
     676/    4487 : E5                  	push	hl
     677/    4488 : 62                  PTRLP:  LD      H,D             ; Address to HL
     678/    4489 : 6B                          LD      L,E
     679/    448A : 7E                          LD      A,(HL)          ; Get LSB of pointer
     680/    448B : 23                          INC     HL              ; To MSB of pointer
     681/    448C : B6                          OR      (HL)            ; Compare with MSB pointer
     682/    448D : C8                  	ret	z       ; Get command line if end
     683/    448E : 23                          INC     HL              ; To LSB of line number
     684/    448F : 7E                  	ld	a, (hl)
     685/    4490 : 23                          INC     HL              ; Skip line number
     686/    4491 : A6                  	and	(hl)
     687/    4492 : 3C                  	inc	a
     688/    4493 : C8                  	ret	z       ; Get command line if end
     689/    4494 : 23                          INC     HL              ; Point to first byte in line
     690/    4495 : AF                          XOR     A               ; Looking for 00 byte
     691/    4496 : BE                  FNDEND: CP      (HL)            ; Found end of line?
     692/    4497 : 23                          INC     HL              ; Move to next byte
     693/    4498 : 20 FC                       Jr      NZ,FNDEND       ; No - Keep looking
     694/    449A : EB                          EX      DE,HL           ; Next line address to HL
     695/    449B : 73                          LD      (HL),E          ; Save LSB of pointer
     696/    449C : 23                          INC     HL
     697/    449D : 72                          LD      (HL),D          ; Save MSB of pointer
     698/    449E : 18 E8                       Jr      PTRLP           ; Do next line
     699/    44A0 :                     
     700/    44A0 : CD 58 43            MOVUP:  CALL    ENFMEM          ; See if enough memory
     701/    44A3 : C5                  MOVSTR: PUSH    BC              ; Save end of source
     702/    44A4 : E3                          EX      (SP),HL         ; Swap source and dest" end
     703/    44A5 : C1                          POP     BC              ; Get end of destination
     704/    44A6 : CD 75 46            MOVLP:  CALL    CPDEHL          ; See if list moved
     705/    44A9 : 7E                          LD      A,(HL)          ; Get byte
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 13 - 11/7/2018 12:33:42


     706/    44AA : 02                          LD      (BC),A          ; Move it
     707/    44AB : C8                          RET     Z               ; Exit if all done
     708/    44AC : 0B                          DEC     BC              ; Next byte to move to
     709/    44AD : 2B                          DEC     HL              ; Next byte to move
     710/    44AE : 18 F6                       Jr      MOVLP           ; Loop until all bytes moved
     711/    44B0 :                     
     712/    44B0 : 2A 5A 60            SRCHLN: LD      HL,(BASTXT)     ; Start of program text
     713/    44B3 : 44                  SRCHLP: LD      B,H             ; BC = Address to look at
     714/    44B4 : 4D                          LD      C,L
     715/    44B5 : 7E                          LD      A,(HL)          ; Get address of next line
     716/    44B6 : 23                          INC     HL
     717/    44B7 : B6                          OR      (HL)            ; End of program found?
     718/    44B8 : 2B                          DEC     HL
     719/    44B9 : C8                          RET     Z               ; Yes - Line not found
     720/    44BA : 23                          INC     HL
     721/    44BB : 23                          INC     HL
     722/    44BC : 7E                          LD      A,(HL)          ; Get LSB of line number
     723/    44BD : 23                          INC     HL
     724/    44BE : 66                          LD      H,(HL)          ; Get MSB of line number
     725/    44BF : 6F                          LD      L,A
     726/    44C0 : CD 75 46                    CALL    CPDEHL          ; Compare with line in DE
     727/    44C3 : 60                          LD      H,B             ; HL = Start of this line
     728/    44C4 : 69                          LD      L,C
     729/    44C5 : 7E                          LD      A,(HL)          ; Get LSB of next line address
     730/    44C6 : 23                          INC     HL
     731/    44C7 : 66                          LD      H,(HL)          ; Get MSB of next line address
     732/    44C8 : 6F                          LD      L,A             ; Next line to HL
     733/    44C9 : 3F                          CCF
     734/    44CA : C8                          RET     Z               ; Lines found - Exit
     735/    44CB : 3F                          CCF
     736/    44CC : D0                          RET     NC              ; Line not found,at line after
     737/    44CD : 18 E4                       Jr      SRCHLP          ; Keep looking
     738/    44CF :                     
     739/    44CF : AF                  CRUNCH: XOR     A               ; Tokenise line @ HL to BUFFER
     740/    44D0 : 32 AA 60                    LD      (DATFLG),A      ; Reset literal flag
     741/    44D3 : 0E 05                       LD      C,2+3           ; 2 byte number and 3 nulls
     742/    44D5 : 11 5D 60                    LD      DE,BUFFER       ; Start of input buffer
     743/    44D8 : 7E                  CRNCLP: LD      A,(HL)          ; Get byte
     744/    44D9 : FE 20                       CP      ' '             ; Is it a space?
     745/    44DB : 28 6E                       Jr      Z,MOVDIR        ; Yes - Copy direct
     746/    44DD : 47                          LD      B,A             ; Save character
     747/    44DE : FE 22                       CP      '"'             ; Is it a quote?
     748/    44E0 : CA 67 45                    JP      Z,CPYLIT        ; Yes - Copy literal string
     749/    44E3 : B7                          OR      A               ; Is it end of buffer?
     750/    44E4 : CA 6D 45                    JP      Z,ENDBUF        ; Yes - End buffer
     751/    44E7 : 3A AA 60                    LD      A,(DATFLG)      ; Get data type
     752/    44EA : B7                          OR      A               ; Literal?
     753/    44EB : 7E                          LD      A,(HL)          ; Get byte to copy
     754/    44EC : 20 5D                       Jr      NZ,MOVDIR       ; Literal - Copy direct
     755/    44EE : FE 3F                       CP      '?'             ; Is it '?' short for PRINT
     756/    44F0 : 3E 9E                       LD      A,ZPRINT        ; "PRINT" token
     757/    44F2 : 28 57                       Jr      Z,MOVDIR        ; Yes - replace it
     758/    44F4 : 7E                          LD      A,(HL)          ; Get byte again
     759/    44F5 : FE 30                       CP      '0'             ; Is it less than '0'
     760/    44F7 : 38 04                       Jr      C,FNDWRD        ; Yes - Look for reserved words
     761/    44F9 : FE 3C                       CP      60; ";"+1           ; Is it "0123456789:;" ?
     762/    44FB : 38 4E                       Jr      C,MOVDIR        ; Yes - copy it direct
     763/    44FD : D5                  FNDWRD: PUSH    DE              ; Look for reserved words
     764/    44FE : 11 2D 41                    LD      DE,WORDS-1      ; Point to table
     765/    4501 : C5                          PUSH    BC              ; Save count
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 14 - 11/7/2018 12:33:42


     766/    4502 : 01 47 45                    LD      BC,RETNAD       ; Where to return to
     767/    4505 : C5                          PUSH    BC              ; Save return address
     768/    4506 : 06 7F                       LD      B,ZEND-1        ; First token value -1
     769/    4508 : 7E                          LD      A,(HL)          ; Get byte
     770/    4509 : FE 61                       CP      'a'             ; Less than 'a' ?
     771/    450B : 38 07                       Jr      C,SEARCH        ; Yes - search for words
     772/    450D : FE 7B                       CP      'z'+1           ; Greater than 'z' ?
     773/    450F : 30 03                       Jr      NC,SEARCH       ; Yes - search for words
     774/    4511 : E6 5F                       AND     01011111B       ; Force upper case
     775/    4513 : 77                          LD      (HL),A          ; Replace byte
     776/    4514 : 4E                  SEARCH: LD      C,(HL)          ; Search for a word
     777/    4515 : EB                          EX      DE,HL
     778/    4516 : 23                  GETNXT: INC     HL              ; Get next reserved word
     779/    4517 : B6                          OR      (HL)            ; Start of word?
     780/    4518 : F2 16 45                    JP      P,GETNXT        ; No - move on
     781/    451B : 04                          INC     B               ; Increment token value
     782/    451C : 7E                          LD      A, (HL)         ; Get byte from table
     783/    451D : E6 7F                       AND     01111111B       ; Strip bit 7
     784/    451F : C8                          RET     Z               ; Return if end of list
     785/    4520 : B9                          CP      C               ; Same character as in buffer?
     786/    4521 : 20 F3                       Jr      NZ,GETNXT       ; No - get next word
     787/    4523 : EB                          EX      DE,HL
     788/    4524 : E5                          PUSH    HL              ; Save start of word
     789/    4525 :                     
     790/    4525 : 13                  NXTBYT: INC     DE              ; Look through rest of word
     791/    4526 : 1A                          LD      A,(DE)          ; Get byte from table
     792/    4527 : B7                          OR      A               ; End of word ?
     793/    4528 : FA 43 45                    JP      M,MATCH         ; Yes - Match found
     794/    452B : 4F                          LD      C,A             ; Save it
     795/    452C : 78                          LD      A,B             ; Get token value
     796/    452D : FE 88                       CP      ZGOTO           ; Is it "GOTO" token ?
     797/    452F : 20 04                       Jr      NZ,NOSPC        ; No - Don't allow spaces
     798/    4531 : CD 5C 48                    CALL    GETCHR          ; Get next character
     799/    4534 : 2B                          DEC     HL              ; Cancel increment from GETCHR
     800/    4535 : 23                  NOSPC:  INC     HL              ; Next byte
     801/    4536 : 7E                          LD      A,(HL)          ; Get byte
     802/    4537 : FE 61                       CP      'a'             ; Less than 'a' ?
     803/    4539 : 38 02                       Jr      C,NOCHNG        ; Yes - don't change
     804/    453B : E6 5F                       AND     01011111B       ; Make upper case
     805/    453D : B9                  NOCHNG: CP      C               ; Same as in buffer ?
     806/    453E : 28 E5                       Jr      Z,NXTBYT        ; Yes - keep testing
     807/    4540 : E1                          POP     HL              ; Get back start of word
     808/    4541 : 18 D1                       Jr      SEARCH          ; Look at next word
     809/    4543 :                     
     810/    4543 : 48                  MATCH:  LD      C,B             ; Word found - Save token value
     811/    4544 : F1                          POP     AF              ; Throw away return
     812/    4545 : EB                          EX      DE,HL
     813/    4546 : C9                          RET                     ; Return to "RETNAD"
     814/    4547 : EB                  RETNAD: EX      DE,HL           ; Get address in string
     815/    4548 : 79                          LD      A,C             ; Get token value
     816/    4549 : C1                          POP     BC              ; Restore buffer length
     817/    454A : D1                          POP     DE              ; Get destination address
     818/    454B : 23                  MOVDIR: INC     HL              ; Next source in buffer
     819/    454C : 12                          LD      (DE),A          ; Put byte in buffer
     820/    454D : 13                          INC     DE              ; Move up buffer
     821/    454E : 0C                          INC     C               ; Increment length of buffer
     822/    454F : D6 3A                       SUB     ':'             ; End of statement?
     823/    4551 : 28 04                       Jr      Z,SETLIT        ; Jump if multi-statement line
     824/    4553 : FE 49                       CP      ZDATA-3AH       ; Is it DATA statement ?
     825/    4555 : 20 03                       Jr      NZ,TSTREM       ; No - see if REM
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 15 - 11/7/2018 12:33:42


     826/    4557 : 32 AA 60            SETLIT: LD      (DATFLG),A      ; Set literal flag
     827/    455A : D6 54               TSTREM: SUB     ZREM-3AH        ; Is it REM?
     828/    455C : C2 D8 44                    JP      NZ,CRNCLP       ; No - Leave flag
     829/    455F : 47                          LD      B,A             ; Copy rest of buffer
     830/    4560 : 7E                  NXTCHR: LD      A,(HL)          ; Get byte
     831/    4561 : B7                          OR      A               ; End of line ?
     832/    4562 : 28 09                       Jr      Z,ENDBUF        ; Yes - Terminate buffer
     833/    4564 : B8                          CP      B               ; End of statement ?
     834/    4565 : 28 E4                       Jr      Z,MOVDIR        ; Yes - Get next one
     835/    4567 : 23                  CPYLIT: INC     HL              ; Move up source string
     836/    4568 : 12                          LD      (DE),A          ; Save in destination
     837/    4569 : 0C                          INC     C               ; Increment length
     838/    456A : 13                          INC     DE              ; Move up destination
     839/    456B : 18 F3                       Jr      NXTCHR          ; Repeat
     840/    456D :                     
     841/    456D : 21 5C 60            ENDBUF: LD      HL,BUFFER-1     ; Point to start of buffer
     842/    4570 : 12                          LD      (DE),A          ; Mark end of buffer (A = 00)
     843/    4571 : 13                          INC     DE
     844/    4572 : 12                          LD      (DE),A          ; A = 00
     845/    4573 : 13                          INC     DE
     846/    4574 : 12                          LD      (DE),A          ; A = 00
     847/    4575 : C9                          RET
     848/    4576 :                     ;---
     849/    4576 :                     ;vvv unused
     850/    4576 : 02                  		db    2
     851/    4577 : 08                  		db    8
     852/    4578 : 2E                  		db  2Eh	; .
     853/    4579 : 00                  		db    0
     854/    457A : 08                  		db    8
     855/    457B : 2E                  		db  2Eh	; .
     856/    457C : 01                  		db    1
     857/    457D : 09                  		db    9
     858/    457E : 05                  		db    5
     859/    457F : 05                  		db    5
     860/    4580 : 05                  		db    5
     861/    4581 : 2B                  		db  2Bh	; +
     862/    4582 : CD                  		db 0CDh	; 
     863/    4583 : 8E                  		db  8Eh	; 
     864/    4584 :                     ;^^^---
     865/    4584 :                     
     866/    4584 : 2B                  loc_4584:	dec	hl
     867/    4585 : 05                  		dec	b
     868/    4586 : C4 26 5E            		call	nz, MONOUT
     869/    4589 : 20 0A               		jr	nz, MORINP
     870/    458B : 18 03               		jr	loc_4590
     871/    458D :                     
     872/    458D : CD 3E 5F            TTYLIN:		call	sub_5F3E
     873/    4590 : 06 01               loc_4590:	ld	b, 1
     874/    4592 : 21 5D 60            		ld	hl, BUFFER
     875/    4595 : CD B6 46            MORINP:		call	CLOTST
     876/    4598 : 4F                  		ld	c, a
     877/    4599 : FE 03               		cp	3
     878/    459B : CC BF 4A            		call	z, PRNTCRLF
     879/    459E : 37                  		scf
     880/    459F : C8                  		ret	z
     881/    45A0 : FE 0D               		cp	0Dh
     882/    45A2 : CA C6 45            		jp	z, loc_45C6
     883/    45A5 : FE 08               		cp	8
     884/    45A7 : 28 DB               		jr	z, loc_4584
     885/    45A9 : FE 09               		cp	9
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 16 - 11/7/2018 12:33:42


     886/    45AB : 28 04               		jr	z, loc_45B1
     887/    45AD : FE 20               		cp	20h ; ' '
     888/    45AF : 38 E4               		jr	c, MORINP
     889/    45B1 : 78                  loc_45B1:	ld	a, b
     890/    45B2 : FE 49               		cp	49h ; 'I'
     891/    45B4 : 30 DF               		jr	nc, MORINP
     892/    45B6 : 79                  		ld	a, c
     893/    45B7 : FE 09               		cp	9
     894/    45B9 : 28 04               		jr	z, loc_45BF
     895/    45BB : 77                  		ld	(hl), a
     896/    45BC : 32 C8 60            		ld	(LSTBIN), a
     897/    45BF : 23                  loc_45BF:	inc	hl
     898/    45C0 : 04                  		inc	b
     899/    45C1 : CD 26 5E            		call	MONOUT
     900/    45C4 : 18 CF               		jr	MORINP
     901/    45C6 : 21 A6 60            loc_45C6:	ld	hl, unk_60A6
     902/    45C9 : 2B                  loc_45C9:	dec	hl
     903/    45CA : 7D                  		ld	a, l
     904/    45CB : FE 5D               		cp	5Dh ; ']'
     905/    45CD : 28 05               		jr	z, loc_45D4
     906/    45CF : 3E 20               		ld	a, 20h ; ' '
     907/    45D1 : BE                  		cp	(hl)
     908/    45D2 : 28 F5               		jr	z, loc_45C9
     909/    45D4 : 23                  loc_45D4:	inc	hl
     910/    45D5 : C3 BA 4A            		jp	ENDINP
     911/    45D8 :                     ;--
     912/    45D8 :                     ;vvv unused
     913/    45D8 : E5                  		push	hl
     914/    45D9 : D5                  		push	de
     915/    45DA : 18 51               		jr	loc_462D
     916/    45DC :                     
     917/    45DC : C3 08 18            		jp	1808h
     918/    45DF :                     
     919/    45DF : E3                  		ex	(sp), hl
     920/    45E0 : 7E                  		ld	a, (hl)
     921/    45E1 : 23                  		inc	hl
     922/    45E2 : 18 32               		jr	auto1
     923/    45E4 :                     
     924/    45E4 : C3 0B 18            		jp	180Bh
     925/    45E7 :                     
     926/    45E7 : 31 56 18            		ld	sp, 1856h
     927/    45EA : 18 03               		jr	loc_45EF
     928/    45EC :                     
     929/    45EC : C3 0E 18            		jp	180Eh
     930/    45EF :                     
     931/    45EF : CD A5 01            loc_45EF:	call	1A5h
     932/    45F2 : 18 03               		jr	loc_45F7
     933/    45F4 :                     
     934/    45F4 : C3 11 18            		jp	1811h
     935/    45F7 :                     
     936/    45F7 : C3 4C 02            loc_45F7:	jp	24Ch
     937/    45FA :                     
     938/    45FA : FF                  		db 0FFh
     939/    45FB : FF                  		db 0FFh
     940/    45FC :                     
     941/    45FC : C3 14 18            		jp	1814h
     942/    45FF : 00                  		db    0
     943/    4600 :                     ;^^^---
     944/    4600 :                     
     945/    4600 : 11 0A 00            AUTO:		ld	de, 10
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 17 - 11/7/2018 12:33:42


     946/    4603 : D5                  		push	de
     947/    4604 : 28 18               		jr	z, auto2
     948/    4606 : CD F6 48            		call	ATOH
     949/    4609 : EB                  		ex	de, hl
     950/    460A : E3                  		ex	(sp), hl
     951/    460B : 28 12               		jr	z, auto3
     952/    460D : EB                  		ex	de, hl
     953/    460E : CD 7B 46            		call	CHKSYN
     954/    4611 : 2C                  		db	','
     955/    4612 : ED 5B 50 60         		ld	de, (unk_6050)
     956/    4616 : 28 06               auto1:		jr	z, auto2
     957/    4618 : CD F6 48            		call	ATOH
     958/    461B : C2 70 43            		jp	nz, SNERR
     959/    461E : EB                  auto2:		ex	de, hl
     960/    461F : 7D                  auto3:		ld	a, l
     961/    4620 : B4                  		or	h
     962/    4621 : CA F1 48            		jp	z, FCERR
     963/    4624 : 22 50 60            		ld	(unk_6050), hl
     964/    4627 : 32 4D 60            		ld	(unk_604D), a
     965/    462A : E1                  		pop	hl
     966/    462B : 22                  		db  22h	; "
     967/    462C : 4E                  		db  4Eh	; N
     968/    462D : 60                  loc_462D:	ld	h, b
     969/    462E : C1                  		pop	bc
     970/    462F : C3 C9 43            		jp	GETCMD
     971/    4632 :                     ;---
     972/    4632 :                     
     973/    4632 : C0                  NEW:    RET     NZ              ; Return if any more on line
     974/    4633 : 2A 5A 60            CLRPTR: LD      HL,(BASTXT)     ; Point to start of program
     975/    4636 : AF                          XOR     A               ; Set program area to empty
     976/    4637 : 77                          LD      (HL),A          ; Save LSB = 00
     977/    4638 : 23                          INC     HL
     978/    4639 : 77                          LD      (HL),A          ; Save MSB = 00
     979/    463A : 23                          INC     HL
     980/    463B : 22 D2 60                    LD      (PROGND),HL     ; Set program end
     981/    463E :                     
     982/    463E : 2A 5A 60            RUNFST: LD      HL,(BASTXT)     ; Clear all variables
     983/    4641 : 2B                          DEC     HL
     984/    4642 :                     
     985/    4642 : 22 CA 60            INTVAR: LD      (BRKLIN),HL     ; Initialise RUN variables
     986/    4645 : 2A AB 60                    LD      HL,(LSTRAM)     ; Get end of RAM
     987/    4648 : 22 BF 60                    LD      (STRBOT),HL     ; Clear string space
     988/    464B : AF                          XOR     A
     989/    464C : CD 6B 48                    CALL    RESTOR          ; Reset DATA pointers
     990/    464F : 2A D2 60                    LD      HL,(PROGND)     ; Get end of program
     991/    4652 : 22 D4 60                    LD      (VAREND),HL     ; Clear variables
     992/    4655 : 22 D6 60                    LD      (ARREND),HL     ; Clear arrays
     993/    4658 :                     
     994/    4658 : C1                  CLREG:  POP     BC              ; Save return address
     995/    4659 : 2A 56 60                    LD      HL,(STRSPC)     ; Get end of working RAN
     996/    465C : F9                          LD      SP,HL           ; Set stack
     997/    465D : 21 AF 60                    LD      HL,TMSTPL       ; Temporary string pool
     998/    4660 : 22 AD 60                    LD      (TMSTPT),HL     ; Reset temporary string ptr
     999/    4663 : AF                          XOR     A               ; A = 00
    1000/    4664 : 6F                          LD      L,A             ; HL = 0000
    1001/    4665 : 67                          LD      H,A
    1002/    4666 : 22 D0 60                    LD      (CONTAD),HL     ; No CONTinue
    1003/    4669 : 32 C7 60                    LD      (FORFLG),A      ; Clear FOR flag
    1004/    466C : 22 DA 60                    LD      (FNRGNM),HL     ; Clear FN argument
    1005/    466F : E5                          PUSH    HL              ; HL = 0000
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 18 - 11/7/2018 12:33:42


    1006/    4670 : C5                          PUSH    BC              ; Put back return
    1007/    4671 : 2A CA 60            DOAGN:  LD      HL,(BRKLIN)     ; Get address of code to RUN
    1008/    4674 : C9                          RET                     ; Return to execution driver
    1009/    4675 :                     
    1010/    4675 : 7C                  CPDEHL: LD      A,H             ; Get H
    1011/    4676 : 92                          SUB     D               ; Compare with D
    1012/    4677 : C0                          RET     NZ              ; Different - Exit
    1013/    4678 : 7D                          LD      A,L             ; Get L
    1014/    4679 : 93                          SUB     E               ; Compare with E
    1015/    467A : C9                          RET                     ; Return status
    1016/    467B :                     
    1017/    467B : 7E                  CHKSYN: LD      A,(HL)          ; Check syntax of character
    1018/    467C : E3                          EX      (SP),HL         ; Address of test byte
    1019/    467D : BE                          CP      (HL)            ; Same as in code string?
    1020/    467E : 23                          INC     HL              ; Return address
    1021/    467F : E3                          EX      (SP),HL         ; Put it back
    1022/    4680 : CA 5C 48                    JP      Z,GETCHR        ; Yes - Get next character
    1023/    4683 : C3 70 43                    JP      SNERR           ; Different - ?SN Error
    1024/    4686 :                     
    1025/    4686 : 7E                  CHKLTR: LD      A,(HL)          ; Get byte
    1026/    4687 : FE 41                       CP      'A'             ; < 'a' ?
    1027/    4689 : D8                          RET     C               ; Carry set if not letter
    1028/    468A : FE 5B                       CP      'Z'+1           ; > 'z' ?
    1029/    468C : 3F                          CCF
    1030/    468D : C9                          RET                     ; Carry set if not letter
    1031/    468E :                     
    1032/    468E : F5                  OUTC:   PUSH    AF              ; Save character
    1033/    468F : C5                  	push	bc
    1034/    4690 : 4F                  	ld	c, a
    1035/    4691 : 3A 43 60                    LD      A,(CTLOFG)      ; Get control "O" flag
    1036/    4694 : B7                          OR      A               ; Is it set?
    1037/    4695 : 20 1C                       Jr      NZ,POPAF        ; Yes - don't output
    1038/    4697 : 79                  	ld	a, c
    1039/    4698 : FE 20                       CP      ' '             ; Is it a control code?
    1040/    469A : 38 13                       Jr      C,DINPOS        ; Yes - Don't INC POS(X)
    1041/    469C : 3A 41 60                    LD      A,(LWIDTH)      ; Get line width
    1042/    469F : 47                          LD      B,A             ; To B
    1043/    46A0 : 3A A7 60                    LD      A,(CURPOS)      ; Get cursor position
    1044/    46A3 : 04                          INC     B               ; Width 255?
    1045/    46A4 : 28 05                       Jr      Z,INCLEN        ; Yes - No width limit
    1046/    46A6 : 05                          DEC     B               ; Restore width
    1047/    46A7 : B8                          CP      B               ; At end of line?
    1048/    46A8 : CC BF 4A                    CALL    Z,PRNTCRLF      ; Yes - output CRLF
    1049/    46AB : 3C                  INCLEN: INC     A               ; Move on one character
    1050/    46AC : 32 A7 60                    LD      (CURPOS),A      ; Save new position
    1051/    46AF : 79                  DINPOS: ld	a, c            ; Restore character
    1052/    46B0 : CD 26 5E                    CALL    MONOUT          ; Send it
    1053/    46B3 : C1                  POPAF:  pop	bc
    1054/    46B4 : F1                  	POP     AF              ; Throw away status push
    1055/    46B5 : C9                          RET
    1056/    46B6 :                     
    1057/    46B6 : CD 2C 5E            CLOTST: CALL    GETINP          ; Get input character
    1058/    46B9 : FE 0F                       CP      CTRLO           ; Is it control "O"?
    1059/    46BB : C0                          RET     NZ              ; No don't flip flag
    1060/    46BC : 3A 43 60                    LD      A,(CTLOFG)      ; Get flag
    1061/    46BF : 2F                          CPL                     ; Flip it
    1062/    46C0 : 32 43 60                    LD      (CTLOFG),A      ; Put it back
    1063/    46C3 : AF                          XOR     A               ; Null character
    1064/    46C4 : C9                          RET
    1065/    46C5 :                     
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 19 - 11/7/2018 12:33:42


    1066/    46C5 : 3E 3F               PROMPT: LD      A,'?'           ; '?'
    1067/    46C7 : CD 8E 46                    CALL    OUTC            ; Output character
    1068/    46CA : 3E 20                       LD      A,' '           ; Space
    1069/    46CC : CD 8E 46                    CALL    OUTC            ; Output character
    1070/    46CF : C3 4A 60                    JP      RINPUT          ; Get input line
    1071/    46D2 :                     
    1072/    46D2 : CD 7E 4C            LINES:  CALL    GETNUM          ; Get a number
    1073/    46D5 : CD DC 48                    CALL    DEINT           ; Get integer -32768 to 32767
    1074/    46D8 : ED 53 44 60                 LD      (LINESC),DE     ; Set lines counter
    1075/    46DC : ED 53 46 60                 LD      (LINESN),DE     ; Set lines number
    1076/    46E0 : C9                          RET
    1077/    46E1 :                     
    1078/    46E1 : CD F6 48            LIST:   CALL    ATOH            ; ASCII number to DE
    1079/    46E4 : C0                          RET     NZ              ; Return if anything extra
    1080/    46E5 : C1                          POP     BC              ; Rubbish - Not needed
    1081/    46E6 : CD B0 44                    CALL    SRCHLN          ; Search for line number in DE
    1082/    46E9 : C5                          PUSH    BC              ; Save address of line
    1083/    46EA : CD 41 47                    CALL    SETLIN          ; Set up lines counter
    1084/    46ED : E1                  LISTLP: POP     HL              ; Restore address of line
    1085/    46EE : 4E                          LD      C,(HL)          ; Get LSB of next line
    1086/    46EF : 23                          INC     HL
    1087/    46F0 : 46                          LD      B,(HL)          ; Get MSB of next line
    1088/    46F1 : 23                          INC     HL
    1089/    46F2 : 78                          LD      A,B             ; BC = 0 (End of program)?
    1090/    46F3 : B1                          OR      C
    1091/    46F4 : 28 54                       Jr      Z,loc_474A        ; Yes - Go to command mode
    1092/    46F6 : CD 21 5F                    CALL    COUNT           ; Count lines
    1093/    46F9 : CD 85 48                    CALL    TSTBRK          ; Test for break key
    1094/    46FC : C5                          PUSH    BC              ; Save address of next line
    1095/    46FD : CD BF 4A                    CALL    PRNTCRLF        ; Output CRLF
    1096/    4700 : 5E                          LD      E,(HL)          ; Get LSB of line number
    1097/    4701 : 23                          INC     HL
    1098/    4702 : 56                          LD      D,(HL)          ; Get MSB of line number
    1099/    4703 : 23                          INC     HL
    1100/    4704 : E5                          PUSH    HL              ; Save address of line start
    1101/    4705 : EB                          EX      DE,HL           ; Line number to HL
    1102/    4706 : CD 9B 57                    CALL    PRNTHL          ; Output line number in decimal
    1103/    4709 : E1                          pop	hl
    1104/    470A : 3E 20                       LD      A,' '           ; Space after line number
    1105/    470C : CD 8E 46            	call	OUTC
    1106/    470F : CD 14 47            	call	sub_4714
    1107/    4712 : 18 D9               	jr	LISTLP
    1108/    4714 :                     
    1109/    4714 :                     sub_4714:
    1110/    4714 : CD 3E 5F            	call	sub_5F3E
    1111/    4717 : 06 49               	ld	b, 49h ; 'I'
    1112/    4719 : 18 03               	jr	loc_471E
    1113/    471B :                     loc_471B:
    1114/    471B : CD 4E 5F            	call	sub_5F4E
    1115/    471E :                     loc_471E:
    1116/    471E : 7E                  	ld	a, (hl)
    1117/    471F : B7                  	or	a
    1118/    4720 : 23                  	inc	hl
    1119/    4721 : C8                  	ret	z
    1120/    4722 : F2 1B 47            	jp	p, loc_471B
    1121/    4725 : D6 7F               	sub	7Fh
    1122/    4727 : 4F                  	ld	c, a
    1123/    4728 : 11 2E 41            	ld	de, WORDS
    1124/    472B :                     loc_472B:
    1125/    472B : 1A                  	ld	a, (de)
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 20 - 11/7/2018 12:33:42


    1126/    472C : 13                  	inc	de
    1127/    472D : B7                  	or	a
    1128/    472E : F2 2B 47            	jp	p, loc_472B
    1129/    4731 : 0D                  	dec	c
    1130/    4732 :                     loc_4732:
    1131/    4732 : 20 F7               	jr	nz, loc_472B
    1132/    4734 :                     loc_4734:
    1133/    4734 : E6 7F               	and	7Fh
    1134/    4736 : CD 4E 5F            	call	sub_5F4E
    1135/    4739 : 1A                  	ld	a, (de)
    1136/    473A : 13                  	inc	de
    1137/    473B : B7                  	or	a
    1138/    473C :                     loc_473C:
    1139/    473C : F2 34 47            	jp	p, loc_4734
    1140/    473F : 18 DD               	jr	loc_471E
    1141/    4741 :                     
    1142/    4741 : E5                  SETLIN: PUSH    HL              ; Set up LINES counter
    1143/    4742 :                     loc_4742:
    1144/    4742 : 2A 46 60                    LD      HL,(LINESN)     ; Get LINES number
    1145/    4745 : 22 44 60                    LD      (LINESC),HL     ; Save in LINES counter
    1146/    4748 : E1                          POP     HL
    1147/    4749 : C9                          RET
    1148/    474A :                     
    1149/    474A :                     loc_474A:
    1150/    474A : C3 74 40            	jp	BRKRET
    1151/    474D :                     
    1152/    474D :                     ;vvv unused
    1153/    474D : 5A                  	ld	e, d
    1154/    474E : 22 44 60            	ld	(LINESC), hl
    1155/    4751 : D1                  	pop	de
    1156/    4752 : E1                  	pop	hl
    1157/    4753 : F0                  	ret	p
    1158/    4754 : CD 33 47            	call	loc_4732+1
    1159/    4757 : CD 2C 5E            	call	GETINP
    1160/    475A : FE 03               	cp	3
    1161/    475C : 28 DE               	jr	z, loc_473C
    1162/    475E : 18 E4               	jr	loc_4742+2
    1163/    4760 :                     ;^^^---
    1164/    4760 :                     
    1165/    4760 : 3E                  TRON:	db  3Eh	; ld a,..
    1166/    4761 : AF                  TROFF:	xor	a
    1167/    4762 : 32 0A 60            	ld	(TRFLAG), a
    1168/    4765 : C9                  	ret
    1169/    4766 :                     
    1170/    4766 : 21 04 00            BAKSTK: LD      HL,4            ; Look for "FOR" block with
    1171/    4769 : 39                          ADD     HL,SP           ; same index as specified
    1172/    476A : 7E                  LOKFOR: LD      A,(HL)          ; Get block ID
    1173/    476B : 23                          INC     HL              ; Point to index address
    1174/    476C : FE 81                       CP      ZFOR            ; Is it a "FOR" token
    1175/    476E : C0                          RET     NZ              ; No - exit
    1176/    476F : 4E                          LD      C,(HL)          ; BC = Address of "FOR" index
    1177/    4770 : 23                          INC     HL
    1178/    4771 : 46                          LD      B,(HL)
    1179/    4772 : 23                          INC     HL              ; Point to sign of STEP
    1180/    4773 : E5                          PUSH    HL              ; Save pointer to sign
    1181/    4774 : 69                          LD      L,C             ; HL = address of "FOR" index
    1182/    4775 : 60                          LD      H,B
    1183/    4776 : 7A                          LD      A,D             ; See if an index was specified
    1184/    4777 : B3                          OR      E               ; DE = 0 if no index specified
    1185/    4778 : EB                          EX      DE,HL           ; Specified index into HL
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 21 - 11/7/2018 12:33:42


    1186/    4779 : 28 04                       Jr      Z,INDFND        ; Skip if no index given
    1187/    477B : EB                          EX      DE,HL           ; Index back into DE
    1188/    477C : CD 75 46                    CALL    CPDEHL          ; Compare index with one given
    1189/    477F : 01 0D 00            INDFND: LD      BC,16-3         ; Offset to next block
    1190/    4782 : E1                          POP     HL              ; Restore pointer to sign
    1191/    4783 : C8                          RET     Z               ; Return if block found
    1192/    4784 : 09                          ADD     HL,BC           ; Point to next block
    1193/    4785 : 18 E3                       Jr      LOKFOR          ; Keep on looking
    1194/    4787 :                     
    1195/    4787 : 3E 64               FOR:    LD      A,64H           ; Flag "FOR" assignment
    1196/    4789 : 32 C7 60                    LD      (FORFLG),A      ; Save "FOR" flag
    1197/    478C : CD D2 49                    CALL    LET             ; Set up initial index
    1198/    478F : C1                          POP     BC              ; Drop RETurn address
    1199/    4790 : E5                          PUSH    HL              ; Save code string address
    1200/    4791 : CD BD 49                    CALL    DATA            ; Get next statement address
    1201/    4794 : 22 C3 60                    LD      (LOOPST),HL     ; Save it for start of loop
    1202/    4797 : 21 02 00                    LD      HL,2            ; Offset for "FOR" block
    1203/    479A : 39                          ADD     HL,SP           ; Point to it
    1204/    479B : CD 6A 47            FORSLP: CALL    LOKFOR          ; Look for existing "FOR" block
    1205/    479E : D1                          POP     DE              ; Get code string address
    1206/    479F : 20 14                       Jr      NZ,FORFND       ; No nesting found
    1207/    47A1 : 09                          ADD     HL,BC           ; Move into "FOR" block
    1208/    47A2 : D5                          PUSH    DE              ; Save code string address
    1209/    47A3 : 2B                          DEC     HL
    1210/    47A4 : 56                          LD      D,(HL)          ; Get MSB of loop statement
    1211/    47A5 : 2B                          DEC     HL
    1212/    47A6 : 5E                          LD      E,(HL)          ; Get LSB of loop statement
    1213/    47A7 : 23                          INC     HL
    1214/    47A8 : 23                          INC     HL
    1215/    47A9 : E5                          PUSH    HL              ; Save block address
    1216/    47AA : 2A C3 60                    LD      HL,(LOOPST)     ; Get address of loop statement
    1217/    47AD : CD 75 46                    CALL    CPDEHL          ; Compare the FOR loops
    1218/    47B0 : E1                          POP     HL              ; Restore block address
    1219/    47B1 : 20 E8                       Jr      NZ,FORSLP       ; Different FORs - Find another
    1220/    47B3 : D1                          POP     DE              ; Restore code string address
    1221/    47B4 : F9                          LD      SP,HL           ; Remove all nested loops
    1222/    47B5 :                     
    1223/    47B5 : EB                  FORFND: EX      DE,HL           ; Code string address to HL
    1224/    47B6 : 0E 08                       LD      C,8
    1225/    47B8 : CD 4F 43                    CALL    CHKSTK          ; Check for 8 levels of stack
    1226/    47BB : E5                          PUSH    HL              ; Save code string address
    1227/    47BC : 2A C3 60                    LD      HL,(LOOPST)     ; Get first statement of loop
    1228/    47BF : E3                          EX      (SP),HL         ; Save and restore code string
    1229/    47C0 : E5                          PUSH    HL              ; Re-save code string address
    1230/    47C1 : 2A 58 60                    LD      HL,(LINEAT)     ; Get current line number
    1231/    47C4 : E3                          EX      (SP),HL         ; Save and restore code string
    1232/    47C5 : CD 81 4C                    CALL    TSTNUM          ; Make sure it's a number
    1233/    47C8 : CD 7B 46                    CALL    CHKSYN          ; Make sure "TO" is next
    1234/    47CB : A6                          DB   ZTO          ; "TO" token
    1235/    47CC : CD 7E 4C                    CALL    GETNUM          ; Get "TO" expression value
    1236/    47CF : E5                          PUSH    HL              ; Save code string address
    1237/    47D0 : CD 5C 56                    CALL    BCDEFP          ; Move "TO" value to BCDE
    1238/    47D3 : E1                          POP     HL              ; Restore code string address
    1239/    47D4 : C5                          PUSH    BC              ; Save "TO" value in block
    1240/    47D5 : D5                          PUSH    DE
    1241/    47D6 : 01 00 81                    LD      BC,8100H        ; BCDE - 1 (default STEP)
    1242/    47D9 : 51                          LD      D,C             ; C=0
    1243/    47DA : 5A                          LD      E,D             ; D=0
    1244/    47DB : 7E                          LD      A,(HL)          ; Get next byte in code string
    1245/    47DC : FE AB                       CP      ZSTEP           ; See if "STEP" is stated
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 22 - 11/7/2018 12:33:42


    1246/    47DE : 3E 01                       LD      A,1             ; Sign of step = 1
    1247/    47E0 : 20 0E                       Jr      NZ,SAVSTP       ; No STEP given - Default to 1
    1248/    47E2 : CD 5C 48                    CALL    GETCHR          ; Jump over "STEP" token
    1249/    47E5 : CD 7E 4C                    CALL    GETNUM          ; Get step value
    1250/    47E8 : E5                          PUSH    HL              ; Save code string address
    1251/    47E9 : CD 5C 56                    CALL    BCDEFP          ; Move STEP to BCDE
    1252/    47EC : CD 10 56                    CALL    TSTSGN          ; Test sign of FPREG
    1253/    47EF : E1                          POP     HL              ; Restore code string address
    1254/    47F0 : C5                  SAVSTP: PUSH    BC              ; Save the STEP value in block
    1255/    47F1 : D5                          PUSH    DE
    1256/    47F2 : F5                          PUSH    AF              ; Save sign of STEP
    1257/    47F3 : 33                          INC     SP              ; Don't save flags
    1258/    47F4 : E5                          PUSH    HL              ; Save code string address
    1259/    47F5 : 2A CA 60                    LD      HL,(BRKLIN)     ; Get address of index variable
    1260/    47F8 : E3                          EX      (SP),HL         ; Save and restore code string
    1261/    47F9 : 06 81               PUTFID: LD      B,ZFOR          ; "FOR" block marker
    1262/    47FB : C5                          PUSH    BC              ; Save it
    1263/    47FC : 33                          INC     SP              ; Don't save C
    1264/    47FD :                     
    1265/    47FD : CD 85 48            RUNCNT: CALL    TSTBRK          ; Execution driver - Test break
    1266/    4800 : 22 CA 60                    LD      (BRKLIN),HL     ; Save code address for break
    1267/    4803 : 7E                          LD      A,(HL)          ; Get next byte in code string
    1268/    4804 : FE 3A                       CP      ':'             ; Multi statement line?
    1269/    4806 : 28 29                       Jr      Z,EXCUTE        ; Yes - Execute it
    1270/    4808 : B7                          OR      A               ; End of line?
    1271/    4809 : C2 70 43                    JP      NZ,SNERR        ; No - Syntax error
    1272/    480C : 23                          INC     HL              ; Point to address of next line
    1273/    480D : 7E                          LD      A,(HL)          ; Get LSB of line pointer
    1274/    480E : 23                          INC     HL
    1275/    480F : B6                          OR      (HL)            ; Is it zero (End of prog)?
    1276/    4810 : CA 9A 48                    JP      Z,ENDPRG        ; Yes - Terminate execution
    1277/    4813 : 23                          INC     HL              ; Point to line number
    1278/    4814 : 5E                          LD      E,(HL)          ; Get LSB of line number
    1279/    4815 : 23                          INC     HL
    1280/    4816 : 56                          LD      D,(HL)          ; Get MSB of line number
    1281/    4817 : EB                          EX      DE,HL           ; Line number to HL
    1282/    4818 : 22 58 60                    LD      (LINEAT),HL     ; Save as current line number
    1283/    481B : 3A 0A 60            	ld	a, (TRFLAG)
    1284/    481E : B7                  	or	a
    1285/    481F : 28 0F               	jr	z, loc_4830
    1286/    4821 : D5                  	push	de
    1287/    4822 : 3E 3C               	ld	a, '<'
    1288/    4824 : CD 8E 46            	call	OUTC
    1289/    4827 : CD 9B 57            	call	PRNTHL
    1290/    482A : 3E 3E               	ld	a, '>'
    1291/    482C : CD 8E 46            	call	OUTC
    1292/    482F : D1                  	pop	de
    1293/    4830 :                     loc_4830:
    1294/    4830 : EB                          EX      DE,HL           ; Line number back to DE
    1295/    4831 : CD 5C 48            EXCUTE: CALL    GETCHR          ; Get key word
    1296/    4834 : 11 FD 47                    LD      DE,RUNCNT       ; Where to RETurn to
    1297/    4837 : D5                          PUSH    DE              ; Save for RETurn
    1298/    4838 : C8                  IFJMP:  RET     Z               ; Go to RUNCNT if end of STMT
    1299/    4839 : D6 80               ONJMP:  SUB     ZEND            ; Is it a token?
    1300/    483B : DA D2 49                    JP      C,LET           ; No - try to assign it
    1301/    483E : FE 25                       CP      ZNEW+1-ZEND     ; END to NEW ?
    1302/    4840 : 38 0C               	jr	c, loc_484E
    1303/    4842 : D6 50               	sub	50h ; 'P'
    1304/    4844 : DA 70 43            	jp	c, SNERR
    1305/    4847 : FE 09               	cp	9
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 23 - 11/7/2018 12:33:42


    1306/    4849 : D2 70 43                    JP      NC,SNERR        ; Not a key word - ?SN Error
    1307/    484C : C6 25               	add	a, 25h
    1308/    484E :                     loc_484E:
    1309/    484E : 07                          RLCA                    ; Double it
    1310/    484F : 4F                          LD      C,A             ; BC = Offset into table
    1311/    4850 : 06 00                       LD      B,0
    1312/    4852 : EB                          EX      DE,HL           ; Save code string address
    1313/    4853 : 21 6D 42                    LD      HL,WORDTB       ; Keyword address table
    1314/    4856 : 09                          ADD     HL,BC           ; Point to routine address
    1315/    4857 : 4E                          LD      C,(HL)          ; Get LSB of routine address
    1316/    4858 : 23                          INC     HL
    1317/    4859 : 46                          LD      B,(HL)          ; Get MSB of routine address
    1318/    485A : C5                          PUSH    BC              ; Save routine address
    1319/    485B : EB                          EX      DE,HL           ; Restore code string address
    1320/    485C :                     
    1321/    485C : 23                  GETCHR: INC     HL              ; Point to next character
    1322/    485D : 7E                          LD      A,(HL)          ; Get next code string byte
    1323/    485E : FE 3A                       CP      ':'             ; Z if ':'
    1324/    4860 : D0                          RET     NC              ; NC if > "9"
    1325/    4861 : FE 20                       CP      ' '
    1326/    4863 : 28 F7                       Jr      Z,GETCHR        ; Skip over spaces
    1327/    4865 : FE 30                       CP      '0'
    1328/    4867 : 3F                          CCF                     ; NC if < '0'
    1329/    4868 : 3C                          INC     A               ; Test for zero - Leave carry
    1330/    4869 : 3D                          DEC     A               ; Z if Null
    1331/    486A : C9                          RET
    1332/    486B :                     
    1333/    486B : EB                  RESTOR: EX      DE,HL           ; Save code string address
    1334/    486C : 2A 5A 60                    LD      HL,(BASTXT)     ; Point to start of program
    1335/    486F : 28 0E                       Jr      Z,RESTNL        ; Just RESTORE - reset pointer
    1336/    4871 : EB                          EX      DE,HL           ; Restore code string address
    1337/    4872 : CD F6 48                    CALL    ATOH            ; Get line number to DE
    1338/    4875 : E5                          PUSH    HL              ; Save code string address
    1339/    4876 : CD B0 44                    CALL    SRCHLN          ; Search for line number in DE
    1340/    4879 : 60                          LD      H,B             ; HL = Address of line
    1341/    487A : 69                          LD      L,C
    1342/    487B : D1                          POP     DE              ; Restore code string address
    1343/    487C : D2 94 49                    JP      NC,ULERR        ; ?UL Error if not found
    1344/    487F : 2B                  RESTNL: DEC     HL              ; Byte before DATA statement
    1345/    4880 : 22 D8 60            UPDATA: LD      (NXTDAT),HL     ; Update DATA pointer
    1346/    4883 : EB                          EX      DE,HL           ; Restore code string address
    1347/    4884 : C9                          RET
    1348/    4885 :                     
    1349/    4885 :                     
    1350/    4885 : DB 04               TSTBRK:	in	a, (4)
    1351/    4887 : FE 83               	cp	83h
    1352/    4889 : C0                  	ret	nz
    1353/    488A : CD 2F 5E            	call	getkey		; get input status
    1354/    488D : FE 83               	cp	83h
    1355/    488F : 00                  	nop
    1356/    4890 :                     
    1357/    4890 :                     
    1358/    4890 : C0                  STOP:   RET     NZ              ; Exit if anything else
    1359/    4891 : F6                          DB   0F6H            ; Flag "STOP"
    1360/    4892 : C0                  PEND:   RET     NZ              ; Exit if anything else
    1361/    4893 : 22 CA 60                    LD      (BRKLIN),HL     ; Save point of break
    1362/    4896 : 21                          DB   21H             ; Skip "OR 11111111B"
    1363/    4897 : F6 FF               INPBRK: OR      11111111B       ; Flag "Break" wanted
    1364/    4899 : C1                          POP     BC              ; Return not needed and more
    1365/    489A : 2A 58 60            ENDPRG: LD      HL,(LINEAT)     ; Get current line number
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 24 - 11/7/2018 12:33:42


    1366/    489D : F5                          PUSH    AF              ; Save STOP / END status
    1367/    489E : 7D                          LD      A,L             ; Is it direct break?
    1368/    489F : A4                          AND     H
    1369/    48A0 : 3C                          INC     A               ; Line is -1 if direct break
    1370/    48A1 : 28 09                       Jr      Z,NOLIN         ; Yes - No line number
    1371/    48A3 : 22 CE 60                    LD      (ERRLIN),HL     ; Save line of break
    1372/    48A6 : 2A CA 60                    LD      HL,(BRKLIN)     ; Get point of break
    1373/    48A9 : 22 D0 60                    LD      (CONTAD),HL     ; Save point to CONTinue
    1374/    48AC : AF                  NOLIN:  XOR     A
    1375/    48AD : 32 43 60                    LD      (CTLOFG),A      ; Enable output
    1376/    48B0 : CD B3 4A                    CALL    STTLIN          ; Start a new line
    1377/    48B3 : F1                          POP     AF              ; Restore STOP / END status
    1378/    48B4 : 21 49 43                    LD      HL,BRKMSG       ; "Break" message
    1379/    48B7 : C2 A4 43                    JP      NZ,ERRIN        ; "in line" wanted?
    1380/    48BA : C3 BB 43                    JP      PRNTOK          ; Go to command mode
    1381/    48BD :                     
    1382/    48BD : 2A D0 60            CONT:   LD      HL,(CONTAD)     ; Get CONTinue address
    1383/    48C0 : 7C                          LD      A,H             ; Is it zero?
    1384/    48C1 : B5                          OR      L
    1385/    48C2 : 1E 20                       LD      E,CN            ; ?CN Error
    1386/    48C4 : CA 84 43                    JP      Z,ERROR         ; Yes - output "?CN Error"
    1387/    48C7 : EB                          EX      DE,HL           ; Save code string address
    1388/    48C8 : 2A CE 60                    LD      HL,(ERRLIN)     ; Get line of last break
    1389/    48CB : 22 58 60                    LD      (LINEAT),HL     ; Set up current line number
    1390/    48CE : EB                          EX      DE,HL           ; Restore code string address
    1391/    48CF : C9                          RET                     ; CONTinue where left off
    1392/    48D0 :                     
    1393/    48D0 : CD 5C 48            FPSINT: CALL    GETCHR          ; Get next character
    1394/    48D3 : CD 7E 4C            POSINT: CALL    GETNUM          ; Get integer 0 to 32767
    1395/    48D6 : CD 10 56            DEPINT: CALL    TSTSGN          ; Test sign of FPREG
    1396/    48D9 : FA F1 48                    JP      M,FCERR         ; Negative - ?FC Error
    1397/    48DC : 3A E3 60            DEINT:  LD      A,(FPEXP)       ; Get integer value to DE
    1398/    48DF : FE 90                       CP      80H+16          ; Exponent in range (16 bits)?
    1399/    48E1 : DA B6 56                    JP      C,FPINT         ; Yes - convert it
    1400/    48E4 : 01 80 90                    LD      BC,9080H        ; BCDE = -32768
    1401/    48E7 : 11 00 00                    LD      DE,0000
    1402/    48EA : E5                          PUSH    HL              ; Save code string address
    1403/    48EB : CD 89 56                    CALL    CMPNUM          ; Compare FPREG with BCDE
    1404/    48EE : E1                          POP     HL              ; Restore code string address
    1405/    48EF : 51                          LD      D,C             ; MSB to D
    1406/    48F0 : C8                          RET     Z               ; Return if in range
    1407/    48F1 : 1E 08               FCERR:  LD      E,FC            ; ?FC Error
    1408/    48F3 : C3 84 43                    JP      ERROR           ; Output error-
    1409/    48F6 :                     
    1410/    48F6 : 2B                  ATOH:   DEC     HL              ; ASCII number to DE binary
    1411/    48F7 : 11 00 00            GETLN:  LD      DE,0            ; Get number to DE
    1412/    48FA : CD 5C 48            GTLNLP: CALL    GETCHR          ; Get next character
    1413/    48FD : D0                          RET     NC              ; Exit if not a digit
    1414/    48FE : E5                          PUSH    HL              ; Save code string address
    1415/    48FF : F5                          PUSH    AF              ; Save digit
    1416/    4900 : 21 98 19                    LD      HL,65529/10     ; Largest number 65529
    1417/    4903 : CD 75 46                    CALL    CPDEHL          ; Number in range?
    1418/    4906 : DA 70 43                    JP      C,SNERR         ; No - ?SN Error
    1419/    4909 : 62                          LD      H,D             ; HL = Number
    1420/    490A : 6B                          LD      L,E
    1421/    490B : 19                          ADD     HL,DE           ; Times 2
    1422/    490C : 29                          ADD     HL,HL           ; Times 4
    1423/    490D : 19                          ADD     HL,DE           ; Times 5
    1424/    490E : 29                          ADD     HL,HL           ; Times 10
    1425/    490F : F1                          POP     AF              ; Restore digit
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 25 - 11/7/2018 12:33:42


    1426/    4910 : D6 30                       SUB     '0'             ; Make it 0 to 9
    1427/    4912 : 5F                          LD      E,A             ; DE = Value of digit
    1428/    4913 : 16 00                       LD      D,0
    1429/    4915 : 19                          ADD     HL,DE           ; Add to number
    1430/    4916 : EB                          EX      DE,HL           ; Number to DE
    1431/    4917 : E1                          POP     HL              ; Restore code string address
    1432/    4918 : 18 E0                       Jr      GTLNLP          ; Go to next character
    1433/    491A :                     
    1434/    491A : CA 42 46            CLEAR:  JP      Z,INTVAR        ; Just "CLEAR" Keep parameters
    1435/    491D : CD D3 48                    CALL    POSINT          ; Get integer 0 to 32767 to DE
    1436/    4920 : 2B                          DEC     HL              ; Cancel increment
    1437/    4921 : CD 5C 48                    CALL    GETCHR          ; Get next character
    1438/    4924 : E5                          PUSH    HL              ; Save code string address
    1439/    4925 : 2A AB 60                    LD      HL,(LSTRAM)     ; Get end of RAM
    1440/    4928 : 28 12                       Jr      Z,STORED        ; No value given - Use stored
    1441/    492A : E1                          POP     HL              ; Restore code string address
    1442/    492B : CD 7B 46                    CALL    CHKSYN          ; Check for comma
    1443/    492E : 2C                          DB      ','
    1444/    492F : D5                          PUSH    DE              ; Save number
    1445/    4930 : CD D3 48                    CALL    POSINT          ; Get integer 0 to 32767
    1446/    4933 : 2B                          DEC     HL              ; Cancel increment
    1447/    4934 : CD 5C 48                    CALL    GETCHR          ; Get next character
    1448/    4937 : C2 70 43                    JP      NZ,SNERR        ; ?SN Error if more on line
    1449/    493A : E3                          EX      (SP),HL         ; Save code string address
    1450/    493B : EB                          EX      DE,HL           ; Number to DE
    1451/    493C : 7D                  STORED: LD      A,L             ; Get LSB of new RAM top
    1452/    493D : 93                          SUB     E               ; Subtract LSB of string space
    1453/    493E : 5F                          LD      E,A             ; Save LSB
    1454/    493F : 7C                          LD      A,H             ; Get MSB of new RAM top
    1455/    4940 : 9A                          SBC     A,D             ; Subtract MSB of string space
    1456/    4941 : 57                          LD      D,A             ; Save MSB
    1457/    4942 : DA 66 43                    JP      C,OMERR         ; ?OM Error if not enough mem
    1458/    4945 : E5                          PUSH    HL              ; Save RAM top
    1459/    4946 : 2A D2 60                    LD      HL,(PROGND)     ; Get program end
    1460/    4949 : 01 28 00                    LD      BC,40           ; 40 Bytes minimum working RAM
    1461/    494C : 09                          ADD     HL,BC           ; Get lowest address
    1462/    494D : CD 75 46                    CALL    CPDEHL          ; Enough memory?
    1463/    4950 : D2 66 43                    JP      NC,OMERR        ; No - ?OM Error
    1464/    4953 : EB                          EX      DE,HL           ; RAM top to HL
    1465/    4954 : 22 56 60                    LD      (STRSPC),HL     ; Set new string space
    1466/    4957 : E1                          POP     HL              ; End of memory to use
    1467/    4958 : 22 AB 60                    LD      (LSTRAM),HL     ; Set new top of RAM
    1468/    495B : E1                          POP     HL              ; Restore code string address
    1469/    495C : C3 42 46                    JP      INTVAR          ; Initialise variables
    1470/    495F :                     
    1471/    495F : CA 3E 46            RUN:    JP      Z,RUNFST        ; RUN from start if just RUN
    1472/    4962 : CD 42 46                    CALL    INTVAR          ; Initialise variables
    1473/    4965 : 01 FD 47                    LD      BC,RUNCNT       ; Execution driver loop
    1474/    4968 : 18 10                       Jr      RUNLIN          ; RUN from line number
    1475/    496A :                     
    1476/    496A : 0E 03               GOSUB:  LD      C,3             ; 3 Levels of stack needed
    1477/    496C : CD 4F 43                    CALL    CHKSTK          ; Check for 3 levels of stack
    1478/    496F : C1                          POP     BC              ; Get return address
    1479/    4970 : E5                          PUSH    HL              ; Save code string for RETURN
    1480/    4971 : E5                          PUSH    HL              ; And for GOSUB routine
    1481/    4972 : 2A 58 60                    LD      HL,(LINEAT)     ; Get current line
    1482/    4975 : E3                          EX      (SP),HL         ; Into stack - Code string out
    1483/    4976 : 3E 8C                       LD      A,ZGOSUB        ; "GOSUB" token
    1484/    4978 : F5                          PUSH    AF              ; Save token
    1485/    4979 : 33                          INC     SP              ; Don't save flags
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 26 - 11/7/2018 12:33:42


    1486/    497A :                     
    1487/    497A : C5                  RUNLIN: PUSH    BC              ; Save return address
    1488/    497B : CD F6 48            GOTO:   CALL    ATOH            ; ASCII number to DE binary
    1489/    497E : CD BF 49                    CALL    REM             ; Get end of line
    1490/    4981 : E5                          PUSH    HL              ; Save end of line
    1491/    4982 : 2A 58 60                    LD      HL,(LINEAT)     ; Get current line
    1492/    4985 : CD 75 46                    CALL    CPDEHL          ; Line after current?
    1493/    4988 : E1                          POP     HL              ; Restore end of line
    1494/    4989 : 23                          INC     HL              ; Start of next line
    1495/    498A : DC B3 44                    CALL    C,SRCHLP        ; Line is after current line
    1496/    498D : D4 B0 44                    CALL    NC,SRCHLN       ; Line is before current line
    1497/    4990 : 60                          LD      H,B             ; Set up code string address
    1498/    4991 : 69                          LD      L,C
    1499/    4992 : 2B                          DEC     HL              ; Incremented after
    1500/    4993 : D8                          RET     C               ; Line found
    1501/    4994 : 1E 0E               ULERR:  LD      E,UL            ; ?UL Error
    1502/    4996 : C3 84 43                    JP      ERROR           ; Output error message
    1503/    4999 :                     
    1504/    4999 : C0                  RETURN: RET     NZ              ; Return if not just RETURN
    1505/    499A : 16 FF                       LD      D,-1            ; Flag "GOSUB" search
    1506/    499C : CD 66 47                    CALL    BAKSTK          ; Look "GOSUB" block
    1507/    499F : F9                          LD      SP,HL           ; Kill all FORs in subroutine
    1508/    49A0 : FE 8C                       CP      ZGOSUB          ; Test for "GOSUB" token
    1509/    49A2 : 1E 04                       LD      E,RG            ; ?RG Error
    1510/    49A4 : C2 84 43                    JP      NZ,ERROR        ; Error if no "GOSUB" found
    1511/    49A7 : E1                          POP     HL              ; Get RETURN line number
    1512/    49A8 : 22 58 60                    LD      (LINEAT),HL     ; Save as current
    1513/    49AB : 23                          INC     HL              ; Was it from direct statement?
    1514/    49AC : 7C                          LD      A,H
    1515/    49AD : B5                          OR      L               ; Return to line
    1516/    49AE : 20 07                       Jr      NZ,RETLIN       ; No - Return to line
    1517/    49B0 : 3A C8 60                    LD      A,(LSTBIN)      ; Any INPUT in subroutine?
    1518/    49B3 : B7                          OR      A               ; If so buffer is corrupted
    1519/    49B4 : C2 BA 43                    JP      NZ,POPNOK       ; Yes - Go to command mode
    1520/    49B7 : 21 FD 47            RETLIN: LD      HL,RUNCNT       ; Execution driver loop
    1521/    49BA : E3                          EX      (SP),HL         ; Into stack - Code string out
    1522/    49BB : 3E                          DB      3EH             ; Skip "POP HL"
    1523/    49BC : E1                  NXTDTA: POP     HL              ; Restore code string address
    1524/    49BD :                     
    1525/    49BD : 01 3A               DATA:   DB      01H,3AH         ; ':' End of statement
    1526/    49BF : 0E 00               REM:    LD      C,0             ; 00  End of statement
    1527/    49C1 : 06 00                       LD      B,0
    1528/    49C3 : 79                  NXTSTL: LD      A,C             ; Statement and byte
    1529/    49C4 : 48                          LD      C,B
    1530/    49C5 : 47                          LD      B,A             ; Statement end byte
    1531/    49C6 : 7E                  NXTSTT: LD      A,(HL)          ; Get byte
    1532/    49C7 : B7                          OR      A               ; End of line?
    1533/    49C8 : C8                          RET     Z               ; Yes - Exit
    1534/    49C9 : B8                          CP      B               ; End of statement?
    1535/    49CA : C8                          RET     Z               ; Yes - Exit
    1536/    49CB : 23                          INC     HL              ; Next byte
    1537/    49CC : FE 22                       CP      '"'             ; Literal string?
    1538/    49CE : 28 F3                       Jr      Z,NXTSTL        ; Yes - Look for another '"'
    1539/    49D0 : 18 F4                       Jr      NXTSTT          ; Keep looking
    1540/    49D2 :                     
    1541/    49D2 : CD 5E 4E            LET:    CALL    GETVAR          ; Get variable name
    1542/    49D5 : CD 7B 46                    CALL    CHKSYN          ; Make sure "=" follows
    1543/    49D8 : B4                          DB      ZEQUAL          ; "=" token
    1544/    49D9 : D5                          PUSH    DE              ; Save address of variable
    1545/    49DA : 3A A9 60                    LD      A,(TYPE)        ; Get data type
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 27 - 11/7/2018 12:33:42


    1546/    49DD : F5                          PUSH    AF              ; Save type
    1547/    49DE : CD 97 4C                    CALL    EVAL            ; Evaluate expression
    1548/    49E1 : F1                          POP     AF              ; Restore type
    1549/    49E2 : E3                          EX      (SP),HL         ; Save code - Get var addr
    1550/    49E3 : 22 CA 60                    LD      (BRKLIN),HL     ; Save address of variable
    1551/    49E6 : 1F                          RRA                     ; Adjust type
    1552/    49E7 : CD 83 4C                    CALL    CHKTYP          ; Check types are the same
    1553/    49EA : 28 35                       Jr      Z,LETNUM        ; Numeric - Move value
    1554/    49EC : E5                  LETSTR: PUSH    HL              ; Save address of string var
    1555/    49ED : 2A E0 60                    LD      HL,(FPREG)      ; Pointer to string entry
    1556/    49F0 : E5                          PUSH    HL              ; Save it on stack
    1557/    49F1 : 23                          INC     HL              ; Skip over length
    1558/    49F2 : 23                          INC     HL
    1559/    49F3 : 5E                          LD      E,(HL)          ; LSB of string address
    1560/    49F4 : 23                          INC     HL
    1561/    49F5 : 56                          LD      D,(HL)          ; MSB of string address
    1562/    49F6 : 2A 5A 60                    LD      HL,(BASTXT)     ; Point to start of program
    1563/    49F9 : CD 75 46                    CALL    CPDEHL          ; Is string before program?
    1564/    49FC : 30 12                       Jr      NC,CRESTR       ; Yes - Create string entry
    1565/    49FE : 2A 56 60                    LD      HL,(STRSPC)     ; Point to string space
    1566/    4A01 : CD 75 46                    CALL    CPDEHL          ; Is string literal in program?
    1567/    4A04 : D1                          POP     DE              ; Restore address of string
    1568/    4A05 : 30 11                       Jr      NC,MVSTPT       ; Yes - Set up pointer
    1569/    4A07 : 21 BB 60                    LD      HL,TMPSTR       ; Temporary string pool
    1570/    4A0A : CD 75 46                    CALL    CPDEHL          ; Is string in temporary pool?
    1571/    4A0D : 30 09                       Jr      NC,MVSTPT       ; No - Set up pointer
    1572/    4A0F : 3E                          DB   3EH             ; Skip "POP DE"
    1573/    4A10 : D1                  CRESTR: POP     DE              ; Restore address of string
    1574/    4A11 : CD 79 52                    CALL    BAKTMP          ; Back to last tmp-str entry
    1575/    4A14 : EB                          EX      DE,HL           ; Address of string entry
    1576/    4A15 : CD C2 50                    CALL    SAVSTR          ; Save string in string area
    1577/    4A18 : CD 79 52            MVSTPT: CALL    BAKTMP          ; Back to last tmp-str entry
    1578/    4A1B : E1                          POP     HL              ; Get string pointer
    1579/    4A1C : CD 6B 56                    CALL    DETHL4          ; Move string pointer to var
    1580/    4A1F : E1                          POP     HL              ; Restore code string address
    1581/    4A20 : C9                          RET
    1582/    4A21 :                     
    1583/    4A21 : E5                  LETNUM: PUSH    HL              ; Save address of variable
    1584/    4A22 : CD 68 56                    CALL    FPTHL           ; Move value to variable
    1585/    4A25 : D1                          POP     DE              ; Restore address of variable
    1586/    4A26 : E1                          POP     HL              ; Restore code string address
    1587/    4A27 : C9                          RET
    1588/    4A28 :                     
    1589/    4A28 : CD 88 53            ON:     CALL    GETINT          ; Get integer 0-255
    1590/    4A2B : 7E                          LD      A,(HL)          ; Get "GOTO" or "GOSUB" token
    1591/    4A2C : 47                          LD      B,A             ; Save in B
    1592/    4A2D : FE 8C                       CP      ZGOSUB          ; "GOSUB" token?
    1593/    4A2F : 28 05                       Jr      Z,ONGO          ; Yes - Find line number
    1594/    4A31 : CD 7B 46                    CALL    CHKSYN          ; Make sure it's "GOTO"
    1595/    4A34 : 88                          DB   ZGOTO           ; "GOTO" token
    1596/    4A35 : 2B                          DEC     HL              ; Cancel increment
    1597/    4A36 : 4B                  ONGO:   LD      C,E             ; Integer of branch value
    1598/    4A37 : 0D                  ONGOLP: DEC     C               ; Count branches
    1599/    4A38 : 78                          LD      A,B             ; Get "GOTO" or "GOSUB" token
    1600/    4A39 : CA 39 48                    JP      Z,ONJMP         ; Go to that line if right one
    1601/    4A3C : CD F7 48                    CALL    GETLN           ; Get line number to DE
    1602/    4A3F : FE 2C                       CP      ','             ; Another line number?
    1603/    4A41 : C0                          RET     NZ              ; No - Drop through
    1604/    4A42 : 18 F3                       Jr      ONGOLP          ; Yes - loop
    1605/    4A44 :                     
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 28 - 11/7/2018 12:33:42


    1606/    4A44 : CD 97 4C            IF:     CALL    EVAL            ; Evaluate expression
    1607/    4A47 : 7E                          LD      A,(HL)          ; Get token
    1608/    4A48 : FE 88                       CP      ZGOTO           ; "GOTO" token?
    1609/    4A4A : 28 05                       Jr      Z,IFGO          ; Yes - Get line
    1610/    4A4C : CD 7B 46                    CALL    CHKSYN          ; Make sure it's "THEN"
    1611/    4A4F : A9                          DB      ZTHEN           ; "THEN" token
    1612/    4A50 : 2B                          DEC     HL              ; Cancel increment
    1613/    4A51 : CD 81 4C            IFGO:   CALL    TSTNUM          ; Make sure it's numeric
    1614/    4A54 : CD 10 56                    CALL    TSTSGN          ; Test state of expression
    1615/    4A57 : CA BF 49                    JP      Z,REM           ; False - Drop through
    1616/    4A5A : CD 5C 48                    CALL    GETCHR          ; Get next character
    1617/    4A5D : DA 7B 49                    JP      C,GOTO          ; Number - GOTO that line
    1618/    4A60 : C3 38 48                    JP      IFJMP           ; Otherwise do statement
    1619/    4A63 :                     
    1620/    4A63 : 2B                  MRPRNT: DEC     HL              ; DEC 'cos GETCHR INCs
    1621/    4A64 : CD 5C 48                    CALL    GETCHR          ; Get next character
    1622/    4A67 : 18 00                       jr	PRINT
    1623/    4A69 : 28 54               PRINT:  Jr      Z,PRNTCRLF      ; CRLF if just PRINT
    1624/    4A6B : C8                  PRNTLP: RET     Z               ; End of list - Exit
    1625/    4A6C : FE A5                       CP      ZTAB            ; "TAB(" token?
    1626/    4A6E : 28 7E                       Jr      Z,DOTAB         ; Yes - Do TAB routine
    1627/    4A70 : FE A8                       CP      ZSPC            ; "SPC(" token?
    1628/    4A72 : 28 7A                       Jr      Z,DOTAB         ; Yes - Do SPC routine
    1629/    4A74 : E5                          PUSH    HL              ; Save code string address
    1630/    4A75 : FE 2C                       CP      ','             ; Comma?
    1631/    4A77 : 28 61                       Jr      Z,DOCOM         ; Yes - Move to next zone
    1632/    4A79 : FE 3B                       CP      59 ;";"         ; Semi-colon?
    1633/    4A7B : CA 0D 4B                    JP      Z,NEXITM        ; Do semi-colon routine
    1634/    4A7E : C1                          POP     BC              ; Code string address to BC
    1635/    4A7F : CD 97 4C                    CALL    EVAL            ; Evaluate expression
    1636/    4A82 : E5                          PUSH    HL              ; Save code string address
    1637/    4A83 : 3A A9 60                    LD      A,(TYPE)        ; Get variable type
    1638/    4A86 : B7                          OR      A               ; Is it a string variable?
    1639/    4A87 : 20 24                       Jr      NZ,PRNTST       ; Yes - Output string contents
    1640/    4A89 : CD A6 57                    CALL    NUMASC          ; Convert number to text
    1641/    4A8C : CD E6 50                    CALL    CRTST           ; Create temporary string
    1642/    4A8F : 36 20                       LD      (HL),' '        ; Followed by a space
    1643/    4A91 : 2A E0 60                    LD      HL,(FPREG)      ; Get length of output
    1644/    4A94 : 34                          INC     (HL)            ; Plus 1 for the space
    1645/    4A95 : 2A E0 60                    LD      HL,(FPREG)      ; < Not needed >
    1646/    4A98 : 3A 41 60                    LD      A,(LWIDTH)      ; Get width of line
    1647/    4A9B : 47                          LD      B,A             ; To B
    1648/    4A9C : 04                          INC     B               ; Width 255 (No limit)?
    1649/    4A9D : 28 0A                       Jr      Z,PRNTNB        ; Yes - Output number string
    1650/    4A9F : 04                          INC     B               ; Adjust it
    1651/    4AA0 : 3A A7 60                    LD      A,(CURPOS)      ; Get cursor position
    1652/    4AA3 : 86                          ADD     A,(HL)          ; Add length of string
    1653/    4AA4 : 3D                          DEC     A               ; Adjust it
    1654/    4AA5 : B8                          CP      B               ; Will output fit on this line?
    1655/    4AA6 : D4 BF 4A                    CALL    NC,PRNTCRLF     ; No - CRLF first
    1656/    4AA9 : CD 28 51            PRNTNB: CALL    PRS1            ; Output string at (HL)
    1657/    4AAC : AF                          XOR     A               ; Skip CALL by setting 'z' flag
    1658/    4AAD : C4 28 51            PRNTST: CALL    NZ,PRS1         ; Output string at (HL)
    1659/    4AB0 : E1                          POP     HL              ; Restore code string address
    1660/    4AB1 : 18 B0                       Jr      MRPRNT          ; See if more to PRINT
    1661/    4AB3 :                     
    1662/    4AB3 : 3A A7 60            STTLIN: LD      A,(CURPOS)      ; Make sure on new line
    1663/    4AB6 : B7                          OR      A               ; Already at start?
    1664/    4AB7 : C8                          RET     Z               ; Yes - Do nothing
    1665/    4AB8 : 18 05                       Jr      PRNTCRLF        ; Start a new line
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 29 - 11/7/2018 12:33:42


    1666/    4ABA :                     
    1667/    4ABA : 36 00               ENDINP: LD      (HL),0          ; Mark end of buffer
    1668/    4ABC : 21 5C 60                    LD      HL,BUFFER-1     ; Point to buffer
    1669/    4ABF : 3E 0D               PRNTCRLF: LD    A,CR            ; Load a CR
    1670/    4AC1 : CD 8E 46                    CALL    OUTC            ; Output character
    1671/    4AC4 : 3E 0A               DONULL: LD      A,LF            ; Load a LF
    1672/    4AC6 : CD 8E 46                    CALL    OUTC            ; Output character
    1673/    4AC9 : AF                          XOR     A               ; Set to position 0
    1674/    4ACA : 32 A7 60                    LD      (CURPOS),A      ; Store it
    1675/    4ACD : 3A 40 60                    LD      A,(NULLS)       ; Get number of nulls
    1676/    4AD0 : 3D                  NULLP:  DEC     A               ; Count them
    1677/    4AD1 : C8                          RET     Z               ; Return if done
    1678/    4AD2 : F5                          PUSH    AF              ; Save count
    1679/    4AD3 : AF                          XOR     A               ; Load a null
    1680/    4AD4 : CD 8E 46                    CALL    OUTC            ; Output it
    1681/    4AD7 : F1                          POP     AF              ; Restore count
    1682/    4AD8 : 18 F6                       Jr      NULLP           ; Keep counting
    1683/    4ADA :                     
    1684/    4ADA : 3A 42 60            DOCOM:  LD      A,(COMMAN)      ; Get comma width
    1685/    4ADD : 47                          LD      B,A             ; Save in B
    1686/    4ADE : 3A A7 60                    LD      A,(CURPOS)      ; Get current position
    1687/    4AE1 : B8                          CP      B               ; Within the limit?
    1688/    4AE2 : D4 BF 4A                    CALL    NC,PRNTCRLF     ; No - output CRLF
    1689/    4AE5 : 30 26                       Jr      NC,NEXITM       ; Get next item
    1690/    4AE7 : D6 0E               ZONELP: SUB     14              ; Next zone of 14 characters
    1691/    4AE9 : 30 FC                       Jr      NC,ZONELP       ; Repeat if more zones
    1692/    4AEB : 2F                          CPL                     ; Number of spaces to output
    1693/    4AEC : 18 16                       Jr      ASPCS           ; Output them
    1694/    4AEE :                     
    1695/    4AEE : F5                  DOTAB:  PUSH    AF              ; Save token
    1696/    4AEF : CD 85 53                    CALL    FNDNUM          ; Evaluate expression
    1697/    4AF2 : CD 7B 46                    CALL    CHKSYN          ; Make sure ")" follows
    1698/    4AF5 : 29                          DB   ")"
    1699/    4AF6 : 2B                          DEC     HL              ; Back space on to ")"
    1700/    4AF7 : F1                          POP     AF              ; Restore token
    1701/    4AF8 : D6 A8                       SUB     ZSPC            ; Was it "SPC(" ?
    1702/    4AFA : E5                          PUSH    HL              ; Save code string address
    1703/    4AFB : 28 03                       Jr      Z,DOSPC         ; Yes - Do 'E' spaces
    1704/    4AFD : 3A A7 60                    LD      A,(CURPOS)      ; Get current position
    1705/    4B00 : 2F                  DOSPC:  CPL                     ; Number of spaces to print to
    1706/    4B01 : 83                          ADD     A,E             ; Total number to print
    1707/    4B02 : 30 09                       Jr      NC,NEXITM       ; TAB < Current POS(X)
    1708/    4B04 : 3C                  ASPCS:  INC     A               ; Output A spaces
    1709/    4B05 : 47                          LD      B,A             ; Save number to print
    1710/    4B06 : 3E 20                       LD      A,' '           ; Space
    1711/    4B08 : CD 8E 46            SPCLP:  CALL    OUTC            ; Output character in A
    1712/    4B0B : 10 FB                       djnz	SPCLP        ; Repeat if more
    1713/    4B0D : E1                  NEXITM: POP     HL              ; Restore code string address
    1714/    4B0E : CD 5C 48                    CALL    GETCHR          ; Get next character
    1715/    4B11 : C3 6B 4A                    JP      PRNTLP          ; More to print
    1716/    4B14 :                     
    1717/    4B14 : CD 88 53            WIDTH:  CALL    GETINT          ; Get integer 0-255
    1718/    4B17 : 7B                          LD      A,E             ; Width to A
    1719/    4B18 : 32 41 60                    LD      (LWIDTH),A      ; Set width
    1720/    4B1B : C9                          RET
    1721/    4B1C :                     
    1722/    4B1C : CD 88 53            NULL:   CALL    GETINT          ; Get integer 0-255
    1723/    4B1F : C0                          RET     NZ              ; Return if bad value
    1724/    4B20 : 3C                  	inc	a
    1725/    4B21 : 32 40 60                    LD      (NULLS),A       ; Set nulls number
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 30 - 11/7/2018 12:33:42


    1726/    4B24 : C9                          RET
    1727/    4B25 :                     
    1728/    4B25 : 3F 72 65 64 6F 20   REDO:   DB   "?redo from start",CR,0
                    66 72 6F 6D 20 73 
                    74 61 72 74 0D 00 
    1729/    4B37 :                     
    1730/    4B37 : 3A C9 60            BADINP: LD      A,(READFG)      ; READ or INPUT?
    1731/    4B3A : B7                          OR      A
    1732/    4B3B : C2 6A 43                    JP      NZ,DATSNR       ; READ - ?SN Error
    1733/    4B3E : C1                          POP     BC              ; Throw away code string addr
    1734/    4B3F : 21 25 4B                    LD      HL,REDO         ; "Redo from start" message
    1735/    4B42 : CD 25 51                    CALL    PRS             ; Output string
    1736/    4B45 : C3 71 46                    JP      DOAGN           ; Do last INPUT again
    1737/    4B48 :                     
    1738/    4B48 : CD 93 50            INPUT:  CALL    IDTEST          ; Test for illegal direct
    1739/    4B4B : 7E                          LD      A,(HL)          ; Get character after "INPUT"
    1740/    4B4C : FE 22                       CP      '"'             ; Is there a prompt string?
    1741/    4B4E : 3E 00                       LD      A,0             ; Clear A and leave flags
    1742/    4B50 : 32 43 60                    LD      (CTLOFG),A      ; Enable output
    1743/    4B53 : 20 0C                       Jr      NZ,NOPMPT       ; No prompt - get input
    1744/    4B55 : CD E7 50                    CALL    QTSTR           ; Get string terminated by '"'
    1745/    4B58 : CD 7B 46                    CALL    CHKSYN          ; Check for ';' after prompt
    1746/    4B5B : 3B                          DB   ';'
    1747/    4B5C : E5                          PUSH    HL              ; Save code string address
    1748/    4B5D : CD 28 51                    CALL    PRS1            ; Output prompt string
    1749/    4B60 : 3E                          DB   3EH             ; Skip "PUSH HL"
    1750/    4B61 : E5                  NOPMPT: PUSH    HL              ; Save code string address
    1751/    4B62 : CD C5 46                    CALL    PROMPT          ; Get input with "? " prompt
    1752/    4B65 : C1                          POP     BC              ; Restore code string address
    1753/    4B66 : DA 97 48                    JP      C,INPBRK        ; Break pressed - Exit
    1754/    4B69 : 23                          INC     HL              ; Next byte
    1755/    4B6A : 7E                          LD      A,(HL)          ; Get it
    1756/    4B6B : B7                          OR      A               ; End of line?
    1757/    4B6C : 2B                          DEC     HL              ; Back again
    1758/    4B6D : C5                          PUSH    BC              ; Re-save code string address
    1759/    4B6E : CA BC 49                    JP      Z,NXTDTA        ; Yes - Find next DATA stmt
    1760/    4B71 : 36 2C                       LD      (HL),','        ; Store comma as separator
    1761/    4B73 : 18 05                       Jr      NXTITM          ; Get next item
    1762/    4B75 :                     
    1763/    4B75 : E5                  READ:   PUSH    HL              ; Save code string address
    1764/    4B76 : 2A D8 60                    LD      HL,(NXTDAT)     ; Next DATA statement
    1765/    4B79 : F6                          DB   0F6H            ; Flag "READ"
    1766/    4B7A : AF                  NXTITM: XOR     A               ; Flag "INPUT"
    1767/    4B7B : 32 C9 60                    LD      (READFG),A      ; Save "READ"/"INPUT" flag
    1768/    4B7E : E3                          EX      (SP),HL         ; Get code str' , Save pointer
    1769/    4B7F : 18 04                       Jr      GTVLUS          ; Get values
    1770/    4B81 :                     
    1771/    4B81 : CD 7B 46            NEDMOR: CALL    CHKSYN          ; Check for comma between items
    1772/    4B84 : 2C                          DB      ','
    1773/    4B85 : CD 5E 4E            GTVLUS: CALL    GETVAR          ; Get variable name
    1774/    4B88 : E3                          EX      (SP),HL         ; Save code str" , Get pointer
    1775/    4B89 : D5                          PUSH    DE              ; Save variable address
    1776/    4B8A : 7E                          LD      A,(HL)          ; Get next "INPUT"/"DATA" byte
    1777/    4B8B : FE 2C                       CP      ','             ; Comma?
    1778/    4B8D : 28 1C                       Jr      Z,ANTVLU        ; Yes - Get another value
    1779/    4B8F : 3A C9 60                    LD      A,(READFG)      ; Is it READ?
    1780/    4B92 : B7                          OR      A
    1781/    4B93 : 20 7D                       Jr      NZ,FDTLP        ; Yes - Find next DATA stmt
    1782/    4B95 : 3E 3F                       LD      A,'?'           ; More INPUT needed
    1783/    4B97 : CD 8E 46                    CALL    OUTC            ; Output character
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 31 - 11/7/2018 12:33:42


    1784/    4B9A : CD C5 46                    CALL    PROMPT          ; Get INPUT with prompt
    1785/    4B9D : D1                          POP     DE              ; Variable address
    1786/    4B9E : C1                          POP     BC              ; Code string address
    1787/    4B9F : DA 97 48                    JP      C,INPBRK        ; Break pressed
    1788/    4BA2 : 23                          INC     HL              ; Point to next DATA byte
    1789/    4BA3 : 7E                          LD      A,(HL)          ; Get byte
    1790/    4BA4 : B7                          OR      A               ; Is it zero (No input) ?
    1791/    4BA5 : 2B                          DEC     HL              ; Back space INPUT pointer
    1792/    4BA6 : C5                          PUSH    BC              ; Save code string address
    1793/    4BA7 : CA BC 49                    JP      Z,NXTDTA        ; Find end of buffer
    1794/    4BAA : D5                          PUSH    DE              ; Save variable address
    1795/    4BAB : 3A A9 60            ANTVLU: LD      A,(TYPE)        ; Check data type
    1796/    4BAE : B7                          OR      A               ; Is it numeric?
    1797/    4BAF : 28 21                       Jr      Z,INPBIN        ; Yes - Convert to binary
    1798/    4BB1 : CD 5C 48                    CALL    GETCHR          ; Get next character
    1799/    4BB4 : 57                          LD      D,A             ; Save input character
    1800/    4BB5 : 47                          LD      B,A             ; Again
    1801/    4BB6 : FE 22                       CP      '"'             ; Start of literal sting?
    1802/    4BB8 : 28 0C                       Jr      Z,STRENT        ; Yes - Create string entry
    1803/    4BBA : 3A C9 60                    LD      A,(READFG)      ; "READ" or "INPUT" ?
    1804/    4BBD : B7                          OR      A
    1805/    4BBE : 57                          LD      D,A             ; Save 00 if "INPUT"
    1806/    4BBF : 28 02                       Jr      Z,ITMSEP        ; "INPUT" - End with 00
    1807/    4BC1 : 16 3A                       LD      D,':'           ; "DATA" - End with 00 or ':'
    1808/    4BC3 : 06 2C               ITMSEP: LD      B,','           ; Item separator
    1809/    4BC5 : 2B                          DEC     HL              ; Back space for DTSTR
    1810/    4BC6 : CD EA 50            STRENT: CALL    DTSTR           ; Get string terminated by D
    1811/    4BC9 : EB                          EX      DE,HL           ; String address to DE
    1812/    4BCA : 21 DD 4B                    LD      HL,LTSTND       ; Where to go after LETSTR
    1813/    4BCD : E3                          EX      (SP),HL         ; Save HL , get input pointer
    1814/    4BCE : D5                          PUSH    DE              ; Save address of string
    1815/    4BCF : C3 EC 49                    JP      LETSTR          ; Assign string to variable
    1816/    4BD2 :                     
    1817/    4BD2 : CD 5C 48            INPBIN: CALL    GETCHR          ; Get next character
    1818/    4BD5 : CD 13 57                    CALL    ASCTFP          ; Convert ASCII to FP number
    1819/    4BD8 : E3                          EX      (SP),HL         ; Save input ptr, Get var addr
    1820/    4BD9 : CD 68 56                    CALL    FPTHL           ; Move FPREG to variable
    1821/    4BDC : E1                          POP     HL              ; Restore input pointer
    1822/    4BDD : 2B                  LTSTND: DEC     HL              ; DEC 'cos GETCHR INCs
    1823/    4BDE : CD 5C 48                    CALL    GETCHR          ; Get next character
    1824/    4BE1 : 28 05                       Jr      Z,MORDT         ; End of line - More needed?
    1825/    4BE3 : FE 2C                       CP      ','             ; Another value?
    1826/    4BE5 : C2 37 4B                    JP      NZ,BADINP       ; No - Bad input
    1827/    4BE8 : E3                  MORDT:  EX      (SP),HL         ; Get code string address
    1828/    4BE9 : 2B                          DEC     HL              ; DEC 'cos GETCHR INCs
    1829/    4BEA : CD 5C 48                    CALL    GETCHR          ; Get next character
    1830/    4BED : 20 92                       Jr      NZ,NEDMOR       ; More needed - Get it
    1831/    4BEF : D1                          POP     DE              ; Restore DATA pointer
    1832/    4BF0 : 3A C9 60                    LD      A,(READFG)      ; "READ" or "INPUT" ?
    1833/    4BF3 : B7                          OR      A
    1834/    4BF4 : EB                          EX      DE,HL           ; DATA pointer to HL
    1835/    4BF5 : C2 80 48                    JP      NZ,UPDATA       ; Update DATA pointer if "READ"
    1836/    4BF8 : D5                          PUSH    DE              ; Save code string address
    1837/    4BF9 : B6                          OR      (HL)            ; More input given?
    1838/    4BFA : 21 02 4C                    LD      HL,EXTIG        ; "?Extra ignored" message
    1839/    4BFD : C4 25 51                    CALL    NZ,PRS          ; Output string if extra given
    1840/    4C00 : E1                          POP     HL              ; Restore code string address
    1841/    4C01 : C9                          RET
    1842/    4C02 :                     
    1843/    4C02 : 3F 65 78 74 72 61   EXTIG:  DB   "?extra ignored",CR,0
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 32 - 11/7/2018 12:33:42


                    20 69 67 6E 6F 72 
                    65 64 0D 00 
    1844/    4C12 :                     
    1845/    4C12 : CD BD 49            FDTLP:  CALL    DATA            ; Get next statement
    1846/    4C15 : B7                          OR      A               ; End of line?
    1847/    4C16 : 20 12                       Jr      NZ,FANDT        ; No - See if DATA statement
    1848/    4C18 : 23                          INC     HL
    1849/    4C19 : 7E                          LD      A,(HL)          ; End of program?
    1850/    4C1A : 23                          INC     HL
    1851/    4C1B : B6                          OR      (HL)            ; 00 00 Ends program
    1852/    4C1C : 1E 06                       LD      E,OD            ; ?OD Error
    1853/    4C1E : CA 84 43                    JP      Z,ERROR         ; Yes - Out of DATA
    1854/    4C21 : 23                          INC     HL
    1855/    4C22 : 5E                          LD      E,(HL)          ; LSB of line number
    1856/    4C23 : 23                          INC     HL
    1857/    4C24 : 56                          LD      D,(HL)          ; MSB of line number
    1858/    4C25 : EB                          EX      DE,HL
    1859/    4C26 : 22 C5 60                    LD      (DATLIN),HL     ; Set line of current DATA item
    1860/    4C29 : EB                          EX      DE,HL
    1861/    4C2A : CD 5C 48            FANDT:  CALL    GETCHR          ; Get next character
    1862/    4C2D : FE 83                       CP      ZDATA           ; "DATA" token
    1863/    4C2F : 20 E1                       Jr      NZ,FDTLP        ; No "DATA" - Keep looking
    1864/    4C31 : C3 AB 4B                    JP      ANTVLU          ; Found - Convert input
    1865/    4C34 :                     
    1866/    4C34 : 11 00 00            NEXT:   LD      DE,0            ; In case no index given
    1867/    4C37 : C4 5E 4E            NEXT1:  CALL    NZ,GETVAR       ; Get index address
    1868/    4C3A : 22 CA 60                    LD      (BRKLIN),HL     ; Save code string address
    1869/    4C3D : CD 66 47                    CALL    BAKSTK          ; Look for "FOR" block
    1870/    4C40 : C2 76 43                    JP      NZ,NFERR        ; No "FOR" - ?NF Error
    1871/    4C43 : F9                          LD      SP,HL           ; Clear nested loops
    1872/    4C44 : D5                          PUSH    DE              ; Save index address
    1873/    4C45 : 7E                          LD      A,(HL)          ; Get sign of STEP
    1874/    4C46 : 23                          INC     HL
    1875/    4C47 : F5                          PUSH    AF              ; Save sign of STEP
    1876/    4C48 : D5                          PUSH    DE              ; Save index address
    1877/    4C49 : CD 4E 56                    CALL    PHLTFP          ; Move index value to FPREG
    1878/    4C4C : E3                          EX      (SP),HL         ; Save address of TO value
    1879/    4C4D : E5                          PUSH    HL              ; Save address of index
    1880/    4C4E : CD D6 53                    CALL    ADDPHL          ; Add STEP to index value
    1881/    4C51 : E1                          POP     HL              ; Restore address of index
    1882/    4C52 : CD 68 56                    CALL    FPTHL           ; Move value to index variable
    1883/    4C55 : E1                          POP     HL              ; Restore address of TO value
    1884/    4C56 : CD 5F 56                    CALL    LOADFP          ; Move TO value to BCDE
    1885/    4C59 : E5                          PUSH    HL              ; Save address of line of FOR
    1886/    4C5A : CD 89 56                    CALL    CMPNUM          ; Compare index with TO value
    1887/    4C5D : E1                          POP     HL              ; Restore address of line num
    1888/    4C5E : C1                          POP     BC              ; Address of sign of STEP
    1889/    4C5F : 90                          SUB     B               ; Compare with expected sign
    1890/    4C60 : CD 5F 56                    CALL    LOADFP          ; BC = Loop stmt,DE = Line num
    1891/    4C63 : 28 09                       Jr      Z,KILFOR        ; Loop finished - Terminate it
    1892/    4C65 : EB                          EX      DE,HL           ; Loop statement line number
    1893/    4C66 : 22 58 60                    LD      (LINEAT),HL     ; Set loop line number
    1894/    4C69 : 69                          LD      L,C             ; Set code string to loop
    1895/    4C6A : 60                          LD      H,B
    1896/    4C6B : C3 F9 47                    JP      PUTFID          ; Put back "FOR" and continue
    1897/    4C6E :                     
    1898/    4C6E : F9                  KILFOR: LD      SP,HL           ; Remove "FOR" block
    1899/    4C6F : 2A CA 60                    LD      HL,(BRKLIN)     ; Code string after "NEXT"
    1900/    4C72 : 7E                          LD      A,(HL)          ; Get next byte in code string
    1901/    4C73 : FE 2C                       CP      ','             ; More NEXTs ?
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 33 - 11/7/2018 12:33:42


    1902/    4C75 : C2 FD 47                    JP      NZ,RUNCNT       ; No - Do next statement
    1903/    4C78 : CD 5C 48                    CALL    GETCHR          ; Position to index name
    1904/    4C7B : CD 37 4C                    CALL    NEXT1           ; Re-enter NEXT routine
    1905/    4C7E :                     ; < will not RETurn to here , Exit to RUNCNT or Loop >
    1906/    4C7E :                     
    1907/    4C7E : CD 97 4C            GETNUM: CALL    EVAL            ; Get a numeric expression
    1908/    4C81 : F6                  TSTNUM: DB      0F6H            ; Clear carry (numeric)
    1909/    4C82 : 37                  TSTSTR: SCF                     ; Set carry (string)
    1910/    4C83 : 3A A9 60            CHKTYP: LD      A,(TYPE)        ; Check types match
    1911/    4C86 : 8F                          ADC     A,A             ; Expected + actual
    1912/    4C87 : B7                          OR      A               ; Clear carry , set parity
    1913/    4C88 : E8                          RET     PE              ; Even parity - Types match
    1914/    4C89 : C3 82 43                    JP      TMERR           ; Different types - Error
    1915/    4C8C :                     
    1916/    4C8C :                     ;???
    1917/    4C8C : CD 7B 46            	call	CHKSYN
    1918/    4C8F : B4                  	db 0B4h
    1919/    4C90 : C3 97 4C            	jp	EVAL
    1920/    4C93 :                     ;---
    1921/    4C93 :                     
    1922/    4C93 : CD 7B 46            OPNPAR: CALL    CHKSYN          ; Make sure "(" follows
    1923/    4C96 : 28                          DB   "("
    1924/    4C97 : 2B                  EVAL:   DEC     HL              ; Evaluate expression & save
    1925/    4C98 : 16 00                       LD      D,0             ; Precedence value
    1926/    4C9A : D5                  EVAL1:  PUSH    DE              ; Save precedence
    1927/    4C9B : 0E 01                       LD      C,1
    1928/    4C9D : CD 4F 43                    CALL    CHKSTK          ; Check for 1 level of stack
    1929/    4CA0 : CD 0A 4D                    CALL    OPRND           ; Get next expression value
    1930/    4CA3 : 22 CC 60            EVAL2:  LD      (NXTOPR),HL     ; Save address of next operator
    1931/    4CA6 : 2A CC 60            EVAL3:  LD      HL,(NXTOPR)     ; Restore address of next opr
    1932/    4CA9 : C1                          POP     BC              ; Precedence value and operator
    1933/    4CAA : 78                          LD      A,B             ; Get precedence value
    1934/    4CAB : FE 78                       CP      78H             ; "AND" or "OR" ?
    1935/    4CAD : D4 81 4C                    CALL    NC,TSTNUM       ; No - Make sure it's a number
    1936/    4CB0 : 7E                          LD      A,(HL)          ; Get next operator / function
    1937/    4CB1 : 16 00                       LD      D,0             ; Clear Last relation
    1938/    4CB3 : D6 B3               RLTLP:  SUB     ZGTR            ; ">" Token
    1939/    4CB5 : 38 15                       Jr      C,FOPRND        ; + - * / ^ AND OR - Test it
    1940/    4CB7 : FE 03                       CP      ZLTH+1-ZGTR     ; < = >
    1941/    4CB9 : 30 11                       Jr      NC,FOPRND       ; Function - Call it
    1942/    4CBB : FE 01                       CP      ZEQUAL-ZGTR     ; "="
    1943/    4CBD : 17                          RLA                     ; <- Test for legal
    1944/    4CBE : AA                          XOR     D               ; <- combinations of < = >
    1945/    4CBF : BA                          CP      D               ; <- by combining last token
    1946/    4CC0 : 57                          LD      D,A             ; <- with current one
    1947/    4CC1 : DA 70 43                    JP      C,SNERR         ; Error if "<<' '==" or ">>"
    1948/    4CC4 : 22 C1 60                    LD      (CUROPR),HL     ; Save address of current token
    1949/    4CC7 : CD 5C 48                    CALL    GETCHR          ; Get next character
    1950/    4CCA : 18 E7                       Jr      RLTLP           ; Treat the two as one
    1951/    4CCC :                     
    1952/    4CCC : 7A                  FOPRND: LD      A,D             ; < = > found ?
    1953/    4CCD : B7                          OR      A
    1954/    4CCE : C2 DA 4D                    JP      NZ,TSTRED       ; Yes - Test for reduction
    1955/    4CD1 : 7E                          LD      A,(HL)          ; Get operator token
    1956/    4CD2 : 22 C1 60                    LD      (CUROPR),HL     ; Save operator address
    1957/    4CD5 : D6 AC                       SUB     ZPLUS           ; Operator or function?
    1958/    4CD7 : D8                          RET     C               ; Neither - Exit
    1959/    4CD8 : FE 07                       CP      ZOR+1-ZPLUS     ; Is it + - * / ^ AND OR ?
    1960/    4CDA : D0                          RET     NC              ; No - Exit
    1961/    4CDB : 5F                          LD      E,A             ; Coded operator
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 34 - 11/7/2018 12:33:42


    1962/    4CDC : 3A A9 60                    LD      A,(TYPE)        ; Get data type
    1963/    4CDF : 3D                          DEC     A               ; FF = numeric , 00 = string
    1964/    4CE0 : B3                          OR      E               ; Combine with coded operator
    1965/    4CE1 : 7B                          LD      A,E             ; Get coded operator
    1966/    4CE2 : CA 10 52                    JP      Z,CONCAT        ; String concatenation
    1967/    4CE5 : 07                          RLCA                    ; Times 2
    1968/    4CE6 : 83                          ADD     A,E             ; Times 3
    1969/    4CE7 : 5F                          LD      E,A             ; To DE (D is 0)
    1970/    4CE8 : 21 FD 42                    LD      HL,PRITAB       ; Precedence table
    1971/    4CEB : 19                          ADD     HL,DE           ; To the operator concerned
    1972/    4CEC : 78                          LD      A,B             ; Last operator precedence
    1973/    4CED : 56                          LD      D,(HL)          ; Get evaluation precedence
    1974/    4CEE : BA                          CP      D               ; Compare with eval precedence
    1975/    4CEF : D0                          RET     NC              ; Exit if higher precedence
    1976/    4CF0 : 23                          INC     HL              ; Point to routine address
    1977/    4CF1 : CD 81 4C                    CALL    TSTNUM          ; Make sure it's a number
    1978/    4CF4 :                     
    1979/    4CF4 : C5                  STKTHS: PUSH    BC              ; Save last precedence & token
    1980/    4CF5 : 01 A6 4C                    LD      BC,EVAL3        ; Where to go on prec' break
    1981/    4CF8 : C5                          PUSH    BC              ; Save on stack for return
    1982/    4CF9 : 43                          LD      B,E             ; Save operator
    1983/    4CFA : 4A                          LD      C,D             ; Save precedence
    1984/    4CFB : CD 41 56                    CALL    STAKFP          ; Move value to stack
    1985/    4CFE : 58                          LD      E,B             ; Restore operator
    1986/    4CFF : 51                          LD      D,C             ; Restore precedence
    1987/    4D00 : 4E                          LD      C,(HL)          ; Get LSB of routine address
    1988/    4D01 : 23                          INC     HL
    1989/    4D02 : 46                          LD      B,(HL)          ; Get MSB of routine address
    1990/    4D03 : 23                          INC     HL
    1991/    4D04 : C5                          PUSH    BC              ; Save routine address
    1992/    4D05 : 2A C1 60                    LD      HL,(CUROPR)     ; Address of current operator
    1993/    4D08 : 18 90                       Jr      EVAL1           ; Loop until prec' break
    1994/    4D0A :                     
    1995/    4D0A : AF                  OPRND:  XOR     A               ; Get operand routine
    1996/    4D0B : 32 A9 60                    LD      (TYPE),A        ; Set numeric expected
    1997/    4D0E : CD 5C 48                    CALL    GETCHR          ; Get next character
    1998/    4D11 : 1E 24                       LD      E,MO            ; ?MO Error
    1999/    4D13 : CA 84 43                    JP      Z,ERROR         ; No operand - Error
    2000/    4D16 : DA 13 57                    JP      C,ASCTFP        ; Number - Get value
    2001/    4D19 : CD 86 46                    CALL    CHKLTR          ; See if a letter
    2002/    4D1C : 30 39                       Jr      NC,CONVAR       ; Letter - Find variable
    2003/    4D1E : FE AC                	CP      ZPLUS           ; '+' Token ?
    2004/    4D20 : 28 E8                       Jr      Z,OPRND         ; Yes - Look for operand
    2005/    4D22 : FE 2E                       CP      '.'             ; '.' ?
    2006/    4D24 : CA 13 57                    JP      Z,ASCTFP        ; Yes - Create FP number
    2007/    4D27 : FE AD                       CP      ZMINUS          ; '-' Token ?
    2008/    4D29 : 28 1B                       Jr      Z,MINUS         ; Yes - Do minus
    2009/    4D2B : FE 22                       CP      '"'             ; Literal string ?
    2010/    4D2D : CA E7 50                    JP      Z,QTSTR         ; Get string terminated by '"'
    2011/    4D30 : FE AA                       CP      ZNOT            ; "NOT" Token ?
    2012/    4D32 : CA 39 4E                    JP      Z,EVNOT         ; Yes - Eval NOT expression
    2013/    4D35 : FE A7                       CP      ZFN             ; "FN" Token ?
    2014/    4D37 : CA 4B 50                    JP      Z,DOFN          ; Yes - Do FN routine
    2015/    4D3A : D6 B6                       SUB     ZSGN            ; Is it a function?
    2016/    4D3C : 30 2A                       Jr      NC,FNOFST       ; Yes - Evaluate function
    2017/    4D3E : CD 93 4C            EVLPAR: CALL    OPNPAR          ; Evaluate expression in "()"
    2018/    4D41 : CD 7B 46                    CALL    CHKSYN          ; Make sure ")" follows
    2019/    4D44 : 29                          DB   ")"
    2020/    4D45 : C9                          RET
    2021/    4D46 :                     
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 35 - 11/7/2018 12:33:42


    2022/    4D46 : 16 7D               MINUS:  LD      D,7DH           ; '-' precedence
    2023/    4D48 : CD 9A 4C                    CALL    EVAL1           ; Evaluate until prec' break
    2024/    4D4B : 2A CC 60                    LD      HL,(NXTOPR)     ; Get next operator address
    2025/    4D4E : E5                          PUSH    HL              ; Save next operator address
    2026/    4D4F : CD 39 56                    CALL    INVSGN          ; Negate value
    2027/    4D52 : CD 81 4C            RETNUM: CALL    TSTNUM          ; Make sure it's a number
    2028/    4D55 : E1                          POP     HL              ; Restore next operator address
    2029/    4D56 : C9                          RET
    2030/    4D57 :                     
    2031/    4D57 : CD 5E 4E            CONVAR: CALL    GETVAR          ; Get variable address to DE
    2032/    4D5A : E5                  FRMEVL: PUSH    HL              ; Save code string address
    2033/    4D5B : EB                          EX      DE,HL           ; Variable address to HL
    2034/    4D5C : 22 E0 60                    LD      (FPREG),HL      ; Save address of variable
    2035/    4D5F : 3A A9 60                    LD      A,(TYPE)        ; Get type
    2036/    4D62 : B7                          OR      A               ; Numeric?
    2037/    4D63 : CC 4E 56                    CALL    Z,PHLTFP        ; Yes - Move contents to FPREG
    2038/    4D66 : E1                          POP     HL              ; Restore code string address
    2039/    4D67 : C9                          RET
    2040/    4D68 :                     
    2041/    4D68 : 06 00               FNOFST: LD      B,0             ; Get address of function
    2042/    4D6A : 07                          RLCA                    ; Double function offset
    2043/    4D6B : 4F                          LD      C,A             ; BC = Offset in function table
    2044/    4D6C : C5                          PUSH    BC              ; Save adjusted token value
    2045/    4D6D : CD 5C 48                    CALL    GETCHR          ; Get next character
    2046/    4D70 : 79                          LD      A,C             ; Get adjusted token value
    2047/    4D71 : FE 22                       CP      022h		; orig: 2*(ZLEFT-ZSGN)-1; Adj' LEFT$,RIGHT$ or MID$ ?
    2048/    4D73 : CA 70 5D            	jp	z, POINT
    2049/    4D76 : FE 2D               	cp	02Dh
    2050/    4D78 : 38 18                       Jr      C,FNVAL         ; No - Do function
    2051/    4D7A : CD 93 4C                    CALL    OPNPAR          ; Evaluate expression  (X,...
    2052/    4D7D : CD 7B 46                    CALL    CHKSYN          ; Make sure ',' follows
    2053/    4D80 : 2C                          DB      ','
    2054/    4D81 : CD 82 4C                    CALL    TSTSTR          ; Make sure it's a string
    2055/    4D84 : EB                          EX      DE,HL           ; Save code string address
    2056/    4D85 : 2A E0 60                    LD      HL,(FPREG)      ; Get address of string
    2057/    4D88 : E3                          EX      (SP),HL         ; Save address of string
    2058/    4D89 : E5                          PUSH    HL              ; Save adjusted token value
    2059/    4D8A : EB                          EX      DE,HL           ; Restore code string address
    2060/    4D8B : CD 88 53                    CALL    GETINT          ; Get integer 0-255
    2061/    4D8E : EB                          EX      DE,HL           ; Save code string address
    2062/    4D8F : E3                          EX      (SP),HL         ; Save integer,HL = adj' token
    2063/    4D90 : 18 08                       Jr      GOFUNC          ; Jump to string function
    2064/    4D92 :                     
    2065/    4D92 : CD 3E 4D            FNVAL:  CALL    EVLPAR          ; Evaluate expression
    2066/    4D95 : E3                          EX      (SP),HL         ; HL = Adjusted token value
    2067/    4D96 : 11 52 4D                    LD      DE,RETNUM       ; Return number from function
    2068/    4D99 : D5                          PUSH    DE              ; Save on stack
    2069/    4D9A : 01 C9 42            GOFUNC: LD      BC,FNCTAB       ; Function routine addresses
    2070/    4D9D : 09                          ADD     HL,BC           ; Point to right address
    2071/    4D9E : 4E                          LD      C,(HL)          ; Get LSB of address
    2072/    4D9F : 23                          INC     HL              ;
    2073/    4DA0 : 66                          LD      H,(HL)          ; Get MSB of address
    2074/    4DA1 : 69                          LD      L,C             ; Address to HL
    2075/    4DA2 : E9                          JP      (HL)            ; Jump to function
    2076/    4DA3 :                     
    2077/    4DA3 : 15                  SGNEXP: DEC     D               ; Dee to flag negative exponent
    2078/    4DA4 : FE AD                       CP      ZMINUS          ; '-' token ?
    2079/    4DA6 : C8                          RET     Z               ; Yes - Return
    2080/    4DA7 : FE 2D                       CP      '-'             ; '-' ASCII ?
    2081/    4DA9 : C8                          RET     Z               ; Yes - Return
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 36 - 11/7/2018 12:33:42


    2082/    4DAA : 14                          INC     D               ; Inc to flag positive exponent
    2083/    4DAB : FE 2B                       CP      '+'             ; '+' ASCII ?
    2084/    4DAD : C8                          RET     Z               ; Yes - Return
    2085/    4DAE : FE AC                       CP      ZPLUS           ; '+' token ?
    2086/    4DB0 : C8                          RET     Z               ; Yes - Return
    2087/    4DB1 : 2B                          DEC     HL              ; DEC 'cos GETCHR INCs
    2088/    4DB2 : C9                          RET                     ; Return "NZ"
    2089/    4DB3 :                     
    2090/    4DB3 : F6                  POR:    DB      0F6H            ; Flag "OR"
    2091/    4DB4 : AF                  PAND:   XOR     A               ; Flag "AND"
    2092/    4DB5 : F5                          PUSH    AF              ; Save "AND" / "OR" flag
    2093/    4DB6 : CD 81 4C                    CALL    TSTNUM          ; Make sure it's a number
    2094/    4DB9 : CD DC 48                    CALL    DEINT           ; Get integer -32768 to 32767
    2095/    4DBC : F1                          POP     AF              ; Restore "AND" / "OR" flag
    2096/    4DBD : EB                          EX      DE,HL           ; <- Get last
    2097/    4DBE : C1                          POP     BC              ; <-  value
    2098/    4DBF : E3                          EX      (SP),HL         ; <-  from
    2099/    4DC0 : EB                          EX      DE,HL           ; <-  stack
    2100/    4DC1 : CD 51 56                    CALL    FPBCDE          ; Move last value to FPREG
    2101/    4DC4 : F5                          PUSH    AF              ; Save "AND" / "OR" flag
    2102/    4DC5 : CD DC 48                    CALL    DEINT           ; Get integer -32768 to 32767
    2103/    4DC8 : F1                          POP     AF              ; Restore "AND" / "OR" flag
    2104/    4DC9 : C1                          POP     BC              ; Get value
    2105/    4DCA : 79                          LD      A,C             ; Get LSB
    2106/    4DCB : 21 09 50                    LD      HL,ACPASS       ; Address of save AC as current
    2107/    4DCE : 20 05                       Jr      NZ,POR1         ; Jump if OR
    2108/    4DD0 : A3                          AND     E               ; "AND" LSBs
    2109/    4DD1 : 4F                          LD      C,A             ; Save LSB
    2110/    4DD2 : 78                          LD      A,B             ; Get MBS
    2111/    4DD3 : A2                          AND     D               ; "AND" MSBs
    2112/    4DD4 : E9                          JP      (HL)            ; Save AC as current (ACPASS)
    2113/    4DD5 :                     
    2114/    4DD5 : B3                  POR1:   OR      E               ; "OR" LSBs
    2115/    4DD6 : 4F                          LD      C,A             ; Save LSB
    2116/    4DD7 : 78                          LD      A,B             ; Get MSB
    2117/    4DD8 : B2                          OR      D               ; "OR" MSBs
    2118/    4DD9 : E9                          JP      (HL)            ; Save AC as current (ACPASS)
    2119/    4DDA :                     
    2120/    4DDA : 21 EC 4D            TSTRED: LD      HL,CMPLOG       ; Logical compare routine
    2121/    4DDD : 3A A9 60                    LD      A,(TYPE)        ; Get data type
    2122/    4DE0 : 1F                          RRA                     ; Carry set = string
    2123/    4DE1 : 7A                          LD      A,D             ; Get last precedence value
    2124/    4DE2 : 17                          RLA                     ; Times 2 plus carry
    2125/    4DE3 : 5F                          LD      E,A             ; To E
    2126/    4DE4 : 16 64                       LD      D,64H           ; Relational precedence
    2127/    4DE6 : 78                          LD      A,B             ; Get current precedence
    2128/    4DE7 : BA                          CP      D               ; Compare with last
    2129/    4DE8 : D0                          RET     NC              ; Eval if last was rel' or log'
    2130/    4DE9 : C3 F4 4C                    JP      STKTHS          ; Stack this one and get next
    2131/    4DEC :                     
    2132/    4DEC : EE 4D               CMPLOG: DW   CMPLG1          ; Compare two values / strings
    2133/    4DEE : 79                  CMPLG1: LD      A,C             ; Get data type
    2134/    4DEF : B7                          OR      A
    2135/    4DF0 : 1F                          RRA
    2136/    4DF1 : C1                          POP     BC              ; Get last expression to BCDE
    2137/    4DF2 : D1                          POP     DE
    2138/    4DF3 : F5                          PUSH    AF              ; Save status
    2139/    4DF4 : CD 83 4C                    CALL    CHKTYP          ; Check that types match
    2140/    4DF7 : 21 2F 4E                    LD      HL,CMPRES       ; Result to comparison
    2141/    4DFA : E5                          PUSH    HL              ; Save for RETurn
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 37 - 11/7/2018 12:33:42


    2142/    4DFB : CA 89 56                    JP      Z,CMPNUM        ; Compare values if numeric
    2143/    4DFE : AF                          XOR     A               ; Compare two strings
    2144/    4DFF : 32 A9 60                    LD      (TYPE),A        ; Set type to numeric
    2145/    4E02 : D5                          PUSH    DE              ; Save string name
    2146/    4E03 : CD 5C 52                    CALL    GSTRCU          ; Get current string
    2147/    4E06 : 7E                          LD      A,(HL)          ; Get length of string
    2148/    4E07 : 23                          INC     HL
    2149/    4E08 : 23                          INC     HL
    2150/    4E09 : 4E                          LD      C,(HL)          ; Get LSB of address
    2151/    4E0A : 23                          INC     HL
    2152/    4E0B : 46                          LD      B,(HL)          ; Get MSB of address
    2153/    4E0C : D1                          POP     DE              ; Restore string name
    2154/    4E0D : C5                          PUSH    BC              ; Save address of string
    2155/    4E0E : F5                          PUSH    AF              ; Save length of string
    2156/    4E0F : CD 60 52                    CALL    GSTRDE          ; Get second string
    2157/    4E12 : CD 5F 56                    CALL    LOADFP          ; Get address of second string
    2158/    4E15 : F1                          POP     AF              ; Restore length of string 1
    2159/    4E16 : 57                          LD      D,A             ; Length to D
    2160/    4E17 : E1                          POP     HL              ; Restore address of string 1
    2161/    4E18 : 7B                  CMPSTR: LD      A,E             ; Bytes of string 2 to do
    2162/    4E19 : B2                          OR      D               ; Bytes of string 1 to do
    2163/    4E1A : C8                          RET     Z               ; Exit if all bytes compared
    2164/    4E1B : 7A                          LD      A,D             ; Get bytes of string 1 to do
    2165/    4E1C : D6 01                       SUB     1
    2166/    4E1E : D8                          RET     C               ; Exit if end of string 1
    2167/    4E1F : AF                          XOR     A
    2168/    4E20 : BB                          CP      E               ; Bytes of string 2 to do
    2169/    4E21 : 3C                          INC     A
    2170/    4E22 : D0                          RET     NC              ; Exit if end of string 2
    2171/    4E23 : 15                          DEC     D               ; Count bytes in string 1
    2172/    4E24 : 1D                          DEC     E               ; Count bytes in string 2
    2173/    4E25 : 0A                          LD      A,(BC)          ; Byte in string 2
    2174/    4E26 : BE                          CP      (HL)            ; Compare to byte in string 1
    2175/    4E27 : 23                          INC     HL              ; Move up string 1
    2176/    4E28 : 03                          INC     BC              ; Move up string 2
    2177/    4E29 : 28 ED                       Jr      Z,CMPSTR        ; Same - Try next bytes
    2178/    4E2B : 3F                          CCF                     ; Flag difference (">" or "<")
    2179/    4E2C : C3 1B 56                    JP      FLGDIF          ; "<" gives -1 , ">" gives +1
    2180/    4E2F :                     
    2181/    4E2F : 3C                  CMPRES: INC     A               ; Increment current value
    2182/    4E30 : 8F                          ADC     A,A             ; Double plus carry
    2183/    4E31 : C1                          POP     BC              ; Get other value
    2184/    4E32 : A0                          AND     B               ; Combine them
    2185/    4E33 : C6 FF                       ADD     A,-1            ; Carry set if different
    2186/    4E35 : 9F                          SBC     A,A             ; 00 - Equal , FF - Different
    2187/    4E36 : C3 22 56                    JP      FLGREL          ; Set current value & continue
    2188/    4E39 :                     
    2189/    4E39 : 16 5A               EVNOT:  LD      D,5AH           ; Precedence value for "NOT"
    2190/    4E3B : CD 9A 4C                    CALL    EVAL1           ; Eval until precedence break
    2191/    4E3E : CD 81 4C                    CALL    TSTNUM          ; Make sure it's a number
    2192/    4E41 : CD DC 48                    CALL    DEINT           ; Get integer -32768 - 32767
    2193/    4E44 : 7B                          LD      A,E             ; Get LSB
    2194/    4E45 : 2F                          CPL                     ; Invert LSB
    2195/    4E46 : 4F                          LD      C,A             ; Save "NOT" of LSB
    2196/    4E47 : 7A                          LD      A,D             ; Get MSB
    2197/    4E48 : 2F                          CPL                     ; Invert MSB
    2198/    4E49 : CD 09 50                    CALL    ACPASS          ; Save AC as current
    2199/    4E4C : C1                          POP     BC              ; Clean up stack
    2200/    4E4D : C3 A6 4C                    JP      EVAL3           ; Continue evaluation
    2201/    4E50 :                     
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 38 - 11/7/2018 12:33:42


    2202/    4E50 : 2B                  DIMRET: DEC     HL              ; DEC 'cos GETCHR INCs
    2203/    4E51 : CD 5C 48                    CALL    GETCHR          ; Get next character
    2204/    4E54 : C8                          RET     Z               ; End of DIM statement
    2205/    4E55 : CD 7B 46                    CALL    CHKSYN          ; Make sure ',' follows
    2206/    4E58 : 2C                          DB      ','
    2207/    4E59 : 01 50 4E            DIM:    LD      BC,DIMRET       ; Return to "DIMRET"
    2208/    4E5C : C5                          PUSH    BC              ; Save on stack
    2209/    4E5D : F6                          DB      0F6H            ; Flag "Create" variable
    2210/    4E5E : AF                  GETVAR: XOR     A               ; Find variable address,to DE
    2211/    4E5F : 32 A8 60                    LD      (LCRFLG),A      ; Set locate / create flag
    2212/    4E62 : 46                          LD      B,(HL)          ; Get First byte of name
    2213/    4E63 : CD 86 46            GTFNAM: CALL    CHKLTR          ; See if a letter
    2214/    4E66 : DA 70 43                    JP      C,SNERR         ; ?SN Error if not a letter
    2215/    4E69 : AF                          XOR     A
    2216/    4E6A : 4F                          LD      C,A             ; Clear second byte of name
    2217/    4E6B : 32 A9 60                    LD      (TYPE),A        ; Set type to numeric
    2218/    4E6E : CD 5C 48                    CALL    GETCHR          ; Get next character
    2219/    4E71 : 38 05                       Jr      C,SVNAM2        ; Numeric - Save in name
    2220/    4E73 : CD 86 46                    CALL    CHKLTR          ; See if a letter
    2221/    4E76 : 38 0B                       Jr      C,CHARTY        ; Not a letter - Check type
    2222/    4E78 : 4F                  SVNAM2: LD      C,A             ; Save second byte of name
    2223/    4E79 : CD 5C 48            ENDNAM: CALL    GETCHR          ; Get next character
    2224/    4E7C : 38 FB                       Jr      C,ENDNAM        ; Numeric - Get another
    2225/    4E7E : CD 86 46                    CALL    CHKLTR          ; See if a letter
    2226/    4E81 : 30 F6                       Jr      NC,ENDNAM       ; Letter - Get another
    2227/    4E83 : D6 24               CHARTY: SUB     '$'             ; String variable?
    2228/    4E85 : 20 0A                       Jr      NZ,NOTSTR       ; No - Numeric variable
    2229/    4E87 : 3C                          INC     A               ; A = 1 (string type)
    2230/    4E88 : 32 A9 60                    LD      (TYPE),A        ; Set type to string
    2231/    4E8B : 0F                          RRCA                    ; A = 80H , Flag for string
    2232/    4E8C : 81                          ADD     A,C             ; 2nd byte of name has bit 7 on
    2233/    4E8D : 4F                          LD      C,A             ; Resave second byte on name
    2234/    4E8E : CD 5C 48                    CALL    GETCHR          ; Get next character
    2235/    4E91 : 3A C7 60            NOTSTR: LD      A,(FORFLG)      ; Array name needed ?
    2236/    4E94 : 3D                          DEC     A
    2237/    4E95 : CA 36 4F                    JP      Z,ARLDSV        ; Yes - Get array name
    2238/    4E98 : F2 A0 4E                    JP      P,NSCFOR        ; No array with "FOR" or "FN"
    2239/    4E9B : 7E                          LD      A,(HL)          ; Get byte again
    2240/    4E9C : D6 28                       SUB     '('             ; Subscripted variable?
    2241/    4E9E : 28 6F                       Jr      Z,SBSCPT        ; Yes - Sort out subscript
    2242/    4EA0 :                     
    2243/    4EA0 : AF                  NSCFOR: XOR     A               ; Simple variable
    2244/    4EA1 : 32 C7 60                    LD      (FORFLG),A      ; Clear "FOR" flag
    2245/    4EA4 : E5                          PUSH    HL              ; Save code string address
    2246/    4EA5 : 50                          LD      D,B             ; DE = Variable name to find
    2247/    4EA6 : 59                          LD      E,C
    2248/    4EA7 : 2A DA 60                    LD      HL,(FNRGNM)     ; FN argument name
    2249/    4EAA : CD 75 46                    CALL    CPDEHL          ; Is it the FN argument?
    2250/    4EAD : 11 DC 60                    LD      DE,FNARG        ; Point to argument value
    2251/    4EB0 : CA 58 55                    JP      Z,POPHRT        ; Yes - Return FN argument value
    2252/    4EB3 : 2A D4 60                    LD      HL,(VAREND)     ; End of variables
    2253/    4EB6 : EB                          EX      DE,HL           ; Address of end of search
    2254/    4EB7 : 2A D2 60                    LD      HL,(PROGND)     ; Start of variables address
    2255/    4EBA : CD 75 46            FNDVAR: CALL    CPDEHL          ; End of variable list table?
    2256/    4EBD : 28 10                       Jr      Z,CFEVAL        ; Yes - Called from EVAL?
    2257/    4EBF : 79                          LD      A,C             ; Get second byte of name
    2258/    4EC0 : 96                          SUB     (HL)            ; Compare with name in list
    2259/    4EC1 : 23                          INC     HL              ; Move on to first byte
    2260/    4EC2 : 20 02                       Jr      NZ,FNTHR        ; Different - Find another
    2261/    4EC4 : 78                          LD      A,B             ; Get first byte of name
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 39 - 11/7/2018 12:33:42


    2262/    4EC5 : 96                          SUB     (HL)            ; Compare with name in list
    2263/    4EC6 : 23                  FNTHR:  INC     HL              ; Move on to LSB of value
    2264/    4EC7 : 28 38                       Jr      Z,RETADR        ; Found - Return address
    2265/    4EC9 : 23                          INC     HL              ; <- Skip
    2266/    4ECA : 23                          INC     HL              ; <- over
    2267/    4ECB : 23                          INC     HL              ; <- F.P.
    2268/    4ECC : 23                          INC     HL              ; <- value
    2269/    4ECD : 18 EB                       Jr      FNDVAR          ; Keep looking
    2270/    4ECF :                     
    2271/    4ECF : E1                  CFEVAL: POP     HL              ; Restore code string address
    2272/    4ED0 : E3                          EX      (SP),HL         ; Get return address
    2273/    4ED1 : D5                          PUSH    DE              ; Save address of variable
    2274/    4ED2 : 11 5A 4D                    LD      DE,FRMEVL       ; Return address in EVAL
    2275/    4ED5 : CD 75 46                    CALL    CPDEHL          ; Called from EVAL ?
    2276/    4ED8 : D1                          POP     DE              ; Restore address of variable
    2277/    4ED9 : 28 29                       Jr      Z,RETNUL        ; Yes - Return null variable
    2278/    4EDB : E3                          EX      (SP),HL         ; Put back return
    2279/    4EDC : E5                          PUSH    HL              ; Save code string address
    2280/    4EDD : C5                          PUSH    BC              ; Save variable name
    2281/    4EDE : 01 06 00                    LD      BC,6            ; 2 byte name plus 4 byte data
    2282/    4EE1 : 2A D6 60                    LD      HL,(ARREND)     ; End of arrays
    2283/    4EE4 : E5                          PUSH    HL              ; Save end of arrays
    2284/    4EE5 : 09                          ADD     HL,BC           ; Move up 6 bytes
    2285/    4EE6 : C1                          POP     BC              ; Source address in BC
    2286/    4EE7 : E5                          PUSH    HL              ; Save new end address
    2287/    4EE8 : CD A0 44                    CALL    MOVUP           ; Move arrays up
    2288/    4EEB : E1                          POP     HL              ; Restore new end address
    2289/    4EEC : 22 D6 60                    LD      (ARREND),HL     ; Set new end address
    2290/    4EEF : 60                          LD      H,B             ; End of variables to HL
    2291/    4EF0 : 69                          LD      L,C
    2292/    4EF1 : 22 D4 60                    LD      (VAREND),HL     ; Set new end address
    2293/    4EF4 :                     
    2294/    4EF4 : 2B                  ZEROLP: DEC     HL              ; Back through to zero variable
    2295/    4EF5 : 36 00                       LD      (HL),0          ; Zero byte in variable
    2296/    4EF7 : CD 75 46                    CALL    CPDEHL          ; Done them all?
    2297/    4EFA : 20 F8                       Jr      NZ,ZEROLP       ; No - Keep on going
    2298/    4EFC : D1                          POP     DE              ; Get variable name
    2299/    4EFD : 73                          LD      (HL),E          ; Store second character
    2300/    4EFE : 23                          INC     HL
    2301/    4EFF : 72                          LD      (HL),D          ; Store first character
    2302/    4F00 : 23                          INC     HL
    2303/    4F01 : EB                  RETADR: EX      DE,HL           ; Address of variable in DE
    2304/    4F02 : E1                          POP     HL              ; Restore code string address
    2305/    4F03 : C9                          RET
    2306/    4F04 :                     
    2307/    4F04 : 32 E3 60            RETNUL: LD      (FPEXP),A       ; Set result to zero
    2308/    4F07 : 21 43 43                    LD      HL,ZERBYT       ; Also set a null string
    2309/    4F0A : 22 E0 60                    LD      (FPREG),HL      ; Save for EVAL
    2310/    4F0D : E1                          POP     HL              ; Restore code string address
    2311/    4F0E : C9                          RET
    2312/    4F0F :                     
    2313/    4F0F : E5                  SBSCPT: PUSH    HL              ; Save code string address
    2314/    4F10 : 2A A8 60                    LD      HL,(LCRFLG)     ; Locate/Create and Type
    2315/    4F13 : E3                          EX      (SP),HL         ; Save and get code string
    2316/    4F14 : 57                          LD      D,A             ; Zero number of dimensions
    2317/    4F15 : D5                  SCPTLP: PUSH    DE              ; Save number of dimensions
    2318/    4F16 : C5                          PUSH    BC              ; Save array name
    2319/    4F17 : CD D0 48                    CALL    FPSINT          ; Get subscript (0-32767)
    2320/    4F1A : C1                          POP     BC              ; Restore array name
    2321/    4F1B : F1                          POP     AF              ; Get number of dimensions
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 40 - 11/7/2018 12:33:42


    2322/    4F1C : EB                          EX      DE,HL
    2323/    4F1D : E3                          EX      (SP),HL         ; Save subscript value
    2324/    4F1E : E5                          PUSH    HL              ; Save LCRFLG and TYPE
    2325/    4F1F : EB                          EX      DE,HL
    2326/    4F20 : 3C                          INC     A               ; Count dimensions
    2327/    4F21 : 57                          LD      D,A             ; Save in D
    2328/    4F22 : 7E                          LD      A,(HL)          ; Get next byte in code string
    2329/    4F23 : FE 2C                       CP      ','             ; Comma (more to come)?
    2330/    4F25 : 28 EE                       Jr      Z,SCPTLP        ; Yes - More subscripts
    2331/    4F27 : CD 7B 46                    CALL    CHKSYN          ; Make sure ")" follows
    2332/    4F2A : 29                          DB      ")"
    2333/    4F2B : 22 CC 60                    LD      (NXTOPR),HL     ; Save code string address
    2334/    4F2E : E1                          POP     HL              ; Get LCRFLG and TYPE
    2335/    4F2F : 22 A8 60                    LD      (LCRFLG),HL     ; Restore Locate/create & type
    2336/    4F32 : 1E 00                       LD      E,0             ; Flag not CSAVE* or CLOAD*
    2337/    4F34 : D5                          PUSH    DE              ; Save number of dimensions (D)
    2338/    4F35 : 11                          DB      11H             ; Skip "PUSH HL" and "PUSH AF'
    2339/    4F36 :                     
    2340/    4F36 : E5                  ARLDSV: PUSH    HL              ; Save code string address
    2341/    4F37 : F5                          PUSH    AF              ; A = 00 , Flags set = Z,N
    2342/    4F38 : 2A D4 60                    LD      HL,(VAREND)     ; Start of arrays
    2343/    4F3B : 3E                          DB      3EH             ; Skip "ADD HL,DE"
    2344/    4F3C : 19                  FNDARY: ADD     HL,DE           ; Move to next array start
    2345/    4F3D : ED 5B D6 60                 LD      de,(ARREND)     ; End of arrays
    2346/    4F41 : CD 75 46                    CALL    CPDEHL          ; End of arrays found?
    2347/    4F44 : 28 23                       Jr      Z,CREARY        ; Yes - Create array
    2348/    4F46 : 7E                          LD      A,(HL)          ; Get second byte of name
    2349/    4F47 : B9                          CP      C               ; Compare with name given
    2350/    4F48 : 23                          INC     HL              ; Move on
    2351/    4F49 : 20 02                       Jr      NZ,NXTARY       ; Different - Find next array
    2352/    4F4B : 7E                          LD      A,(HL)          ; Get first byte of name
    2353/    4F4C : B8                          CP      B               ; Compare with name given
    2354/    4F4D : 23                  NXTARY: INC     HL              ; Move on
    2355/    4F4E : 5E                          LD      E,(HL)          ; Get LSB of next array address
    2356/    4F4F : 23                          INC     HL
    2357/    4F50 : 56                          LD      D,(HL)          ; Get MSB of next array address
    2358/    4F51 : 23                          INC     HL
    2359/    4F52 : 20 E8                       Jr      NZ,FNDARY       ; Not found - Keep looking
    2360/    4F54 : 3A A8 60                    LD      A,(LCRFLG)      ; Found Locate or Create it?
    2361/    4F57 : B7                          OR      A
    2362/    4F58 : C2 79 43                    JP      NZ,DDERR        ; Create - ?DD Error
    2363/    4F5B : F1                          POP     AF              ; Locate - Get number of dim'ns
    2364/    4F5C : 44                          LD      B,H             ; BC Points to array dim'ns
    2365/    4F5D : 4D                          LD      C,L
    2366/    4F5E : CA 58 55                    JP      Z,POPHRT        ; Jump if array load/save
    2367/    4F61 : 96                          SUB     (HL)            ; Same number of dimensions?
    2368/    4F62 : 28 5F                       Jr      Z,FINDEL        ; Yes - Find element
    2369/    4F64 : 1E 10               BSERR:  LD      E,BS            ; ?BS Error
    2370/    4F66 : C3 84 43                    JP      ERROR           ; Output error
    2371/    4F69 :                     
    2372/    4F69 : 11 04 00            CREARY: LD      DE,4            ; 4 Bytes per entry
    2373/    4F6C : F1                          POP     AF              ; Array to save or 0 dim'ns?
    2374/    4F6D : CA F1 48                    JP      Z,FCERR         ; Yes - ?FC Error
    2375/    4F70 : 71                          LD      (HL),C          ; Save second byte of name
    2376/    4F71 : 23                          INC     HL
    2377/    4F72 : 70                          LD      (HL),B          ; Save first byte of name
    2378/    4F73 : 23                          INC     HL
    2379/    4F74 : 4F                          LD      C,A             ; Number of dimensions to C
    2380/    4F75 : CD 4F 43                    CALL    CHKSTK          ; Check if enough memory
    2381/    4F78 : 23                          INC     HL              ; Point to number of dimensions
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 41 - 11/7/2018 12:33:42


    2382/    4F79 : 23                          INC     HL
    2383/    4F7A : 22 C1 60                    LD      (CUROPR),HL     ; Save address of pointer
    2384/    4F7D : 71                          LD      (HL),C          ; Set number of dimensions
    2385/    4F7E : 23                          INC     HL
    2386/    4F7F : 3A A8 60                    LD      A,(LCRFLG)      ; Locate of Create?
    2387/    4F82 : 17                          RLA                     ; Carry set = Create
    2388/    4F83 : 79                          LD      A,C             ; Get number of dimensions
    2389/    4F84 : 01 0B 00            CRARLP: LD      BC,10+1         ; Default dimension size 10
    2390/    4F87 : 30 02                       Jr      NC,DEFSIZ       ; Locate - Set default size
    2391/    4F89 : C1                          POP     BC              ; Get specified dimension size
    2392/    4F8A : 03                          INC     BC              ; Include zero element
    2393/    4F8B : 71                  DEFSIZ: LD      (HL),C          ; Save LSB of dimension size
    2394/    4F8C : 23                          INC     HL
    2395/    4F8D : 70                          LD      (HL),B          ; Save MSB of dimension size
    2396/    4F8E : 23                          INC     HL
    2397/    4F8F : F5                          PUSH    AF              ; Save num' of dim'ns an status
    2398/    4F90 : E5                          PUSH    HL              ; Save address of dim'n size
    2399/    4F91 : CD FA 56                    CALL    MLDEBC          ; Multiply DE by BC to find
    2400/    4F94 : EB                          EX      DE,HL           ; amount of mem needed (to DE)
    2401/    4F95 : E1                          POP     HL              ; Restore address of dimension
    2402/    4F96 : F1                          POP     AF              ; Restore number of dimensions
    2403/    4F97 : 3D                          DEC     A               ; Count them
    2404/    4F98 : 20 EA                       Jr      NZ,CRARLP       ; Do next dimension if more
    2405/    4F9A : F5                          PUSH    AF              ; Save locate/create flag
    2406/    4F9B : 42                          LD      B,D             ; MSB of memory needed
    2407/    4F9C : 4B                          LD      C,E             ; LSB of memory needed
    2408/    4F9D : EB                          EX      DE,HL
    2409/    4F9E : 19                          ADD     HL,DE           ; Add bytes to array start
    2410/    4F9F : DA 66 43                    JP      C,OMERR         ; Too big - Error
    2411/    4FA2 : CD 58 43                    CALL    ENFMEM          ; See if enough memory
    2412/    4FA5 : 22 D6 60                    LD      (ARREND),HL     ; Save new end of array
    2413/    4FA8 :                     
    2414/    4FA8 : 2B                  ZERARY: DEC     HL              ; Back through array data
    2415/    4FA9 : 36 00                       LD      (HL),0          ; Set array element to zero
    2416/    4FAB : CD 75 46                    CALL    CPDEHL          ; All elements zeroed?
    2417/    4FAE : 20 F8                       Jr      NZ,ZERARY       ; No - Keep on going
    2418/    4FB0 : 03                          INC     BC              ; Number of bytes + 1
    2419/    4FB1 : 57                          LD      D,A             ; A=0
    2420/    4FB2 : 2A C1 60                    LD      HL,(CUROPR)     ; Get address of array
    2421/    4FB5 : 5E                          LD      E,(HL)          ; Number of dimensions
    2422/    4FB6 : EB                          EX      DE,HL           ; To HL
    2423/    4FB7 : 29                          ADD     HL,HL           ; Two bytes per dimension size
    2424/    4FB8 : 09                          ADD     HL,BC           ; Add number of bytes
    2425/    4FB9 : EB                          EX      DE,HL           ; Bytes needed to DE
    2426/    4FBA : 2B                          DEC     HL
    2427/    4FBB : 2B                          DEC     HL
    2428/    4FBC : 73                          LD      (HL),E          ; Save LSB of bytes needed
    2429/    4FBD : 23                          INC     HL
    2430/    4FBE : 72                          LD      (HL),D          ; Save MSB of bytes needed
    2431/    4FBF : 23                          INC     HL
    2432/    4FC0 : F1                          POP     AF              ; Locate / Create?
    2433/    4FC1 : 38 22                       Jr      C,ENDDIM        ; A is 0 , End if create
    2434/    4FC3 : 47                  FINDEL: LD      B,A             ; Find array element
    2435/    4FC4 : 4F                          LD      C,A
    2436/    4FC5 : 7E                          LD      A,(HL)          ; Number of dimensions
    2437/    4FC6 : 23                          INC     HL
    2438/    4FC7 : 16                          DB      16H             ; Skip "POP HL"
    2439/    4FC8 : E1                  FNDELP: POP     HL              ; Address of next dim' size
    2440/    4FC9 : 5E                          LD      E,(HL)          ; Get LSB of dim'n size
    2441/    4FCA : 23                          INC     HL
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 42 - 11/7/2018 12:33:42


    2442/    4FCB : 56                          LD      D,(HL)          ; Get MSB of dim'n size
    2443/    4FCC : 23                          INC     HL
    2444/    4FCD : E3                          EX      (SP),HL         ; Save address - Get index
    2445/    4FCE : F5                          PUSH    AF              ; Save number of dim'ns
    2446/    4FCF : CD 75 46                    CALL    CPDEHL          ; Dimension too large?
    2447/    4FD2 : 30 90                       Jr      NC,BSERR        ; Yes - ?BS Error
    2448/    4FD4 : E5                          PUSH    HL              ; Save index
    2449/    4FD5 : CD FA 56                    CALL    MLDEBC          ; Multiply previous by size
    2450/    4FD8 : D1                          POP     DE              ; Index supplied to DE
    2451/    4FD9 : 19                          ADD     HL,DE           ; Add index to pointer
    2452/    4FDA : F1                          POP     AF              ; Number of dimensions
    2453/    4FDB : 3D                          DEC     A               ; Count them
    2454/    4FDC : 44                          LD      B,H             ; MSB of pointer
    2455/    4FDD : 4D                          LD      C,L             ; LSB of pointer
    2456/    4FDE : 20 E8                       Jr      NZ,FNDELP       ; More - Keep going
    2457/    4FE0 : 29                          ADD     HL,HL           ; 4 Bytes per element
    2458/    4FE1 : 29                          ADD     HL,HL
    2459/    4FE2 : C1                          POP     BC              ; Start of array
    2460/    4FE3 : 09                          ADD     HL,BC           ; Point to element
    2461/    4FE4 : EB                          EX      DE,HL           ; Address of element to DE
    2462/    4FE5 : 2A CC 60            ENDDIM: LD      HL,(NXTOPR)     ; Got code string address
    2463/    4FE8 : C9                          RET
    2464/    4FE9 :                     
    2465/    4FE9 : 2A D6 60            FRE:    LD      HL,(ARREND)     ; Start of free memory
    2466/    4FEC : EB                          EX      DE,HL           ; To DE
    2467/    4FED : 21 00 00                    LD      HL,0            ; End of free memory
    2468/    4FF0 : 39                          ADD     HL,SP           ; Current stack value
    2469/    4FF1 : 3A A9 60                    LD      A,(TYPE)        ; Dummy argument type
    2470/    4FF4 : B7                          OR      A
    2471/    4FF5 : 28 0D                       Jr      Z,FRENUM        ; Numeric - Free variable space
    2472/    4FF7 : CD 5C 52                    CALL    GSTRCU          ; Current string to pool
    2473/    4FFA : CD 66 51                    CALL    GARBGE          ; Garbage collection
    2474/    4FFD : 2A 56 60                    LD      HL,(STRSPC)     ; Bottom of string space in use
    2475/    5000 : EB                          EX      DE,HL           ; To DE
    2476/    5001 : 2A BF 60                    LD      HL,(STRBOT)     ; Bottom of string space
    2477/    5004 : 7D                  FRENUM: LD      A,L             ; Get LSB of end
    2478/    5005 : 93                          SUB     E               ; Subtract LSB of beginning
    2479/    5006 : 4F                          LD      C,A             ; Save difference if C
    2480/    5007 : 7C                          LD      A,H             ; Get MSB of end
    2481/    5008 : 9A                          SBC     A,D             ; Subtract MSB of beginning
    2482/    5009 : 41                  ACPASS: LD      B,C             ; Return integer AC
    2483/    500A : 50                  ABPASS: LD      D,B             ; Return integer AB
    2484/    500B : 1E 00                       LD      E,0
    2485/    500D : 21 A9 60                    LD      HL,TYPE         ; Point to type
    2486/    5010 : 73                          LD      (HL),E          ; Set type to numeric
    2487/    5011 : 06 90                       LD      B,80H+16        ; 16 bit integer
    2488/    5013 : C3 27 56                    JP      RETINT          ; Return the integr
    2489/    5016 :                     
    2490/    5016 : 3A A7 60            POS:    LD      A,(CURPOS)      ; Get cursor position
    2491/    5019 : 47                  PASSA:  LD      B,A             ; Put A into AB
    2492/    501A : AF                          XOR     A               ; Zero A
    2493/    501B : C3 0A 50                    JP      ABPASS          ; Return integer AB
    2494/    501E :                     
    2495/    501E : CD A1 50            DEF:    CALL    CHEKFN          ; Get "FN" and name
    2496/    5021 : CD 93 50                    CALL    IDTEST          ; Test for illegal direct
    2497/    5024 : 01 BD 49                    LD      BC,DATA         ; To get next statement
    2498/    5027 : C5                          PUSH    BC              ; Save address for RETurn
    2499/    5028 : D5                          PUSH    DE              ; Save address of function ptr
    2500/    5029 : CD 7B 46                    CALL    CHKSYN          ; Make sure "(" follows
    2501/    502C : 28                          DB      "("
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 43 - 11/7/2018 12:33:42


    2502/    502D : CD 5E 4E                    CALL    GETVAR          ; Get argument variable name
    2503/    5030 : E5                          PUSH    HL              ; Save code string address
    2504/    5031 : EB                          EX      DE,HL           ; Argument address to HL
    2505/    5032 : 2B                          DEC     HL
    2506/    5033 : 56                          LD      D,(HL)          ; Get first byte of arg name
    2507/    5034 : 2B                          DEC     HL
    2508/    5035 : 5E                          LD      E,(HL)          ; Get second byte of arg name
    2509/    5036 : E1                          POP     HL              ; Restore code string address
    2510/    5037 : CD 81 4C                    CALL    TSTNUM          ; Make sure numeric argument
    2511/    503A : CD 7B 46                    CALL    CHKSYN          ; Make sure ")" follows
    2512/    503D : 29                          DB      ")"
    2513/    503E : CD 7B 46                    CALL    CHKSYN          ; Make sure "=" follows
    2514/    5041 : B4                          DB      ZEQUAL          ; "=" token
    2515/    5042 : 44                          LD      B,H             ; Code string address to BC
    2516/    5043 : 4D                          LD      C,L
    2517/    5044 : E3                          EX      (SP),HL         ; Save code str , Get FN ptr
    2518/    5045 : 71                          LD      (HL),C          ; Save LSB of FN code string
    2519/    5046 : 23                          INC     HL
    2520/    5047 : 70                          LD      (HL),B          ; Save MSB of FN code string
    2521/    5048 : C3 E0 50                    JP      SVSTAD          ; Save address and do function
    2522/    504B :                     
    2523/    504B : CD A1 50            DOFN:   CALL    CHEKFN          ; Make sure FN follows
    2524/    504E : D5                          PUSH    DE              ; Save function pointer address
    2525/    504F : CD 3E 4D                    CALL    EVLPAR          ; Evaluate expression in "()"
    2526/    5052 : CD 81 4C                    CALL    TSTNUM          ; Make sure numeric result
    2527/    5055 : E3                          EX      (SP),HL         ; Save code str , Get FN ptr
    2528/    5056 : 5E                          LD      E,(HL)          ; Get LSB of FN code string
    2529/    5057 : 23                          INC     HL
    2530/    5058 : 56                          LD      D,(HL)          ; Get MSB of FN code string
    2531/    5059 : 23                          INC     HL
    2532/    505A : 7A                          LD      A,D             ; And function DEFined?
    2533/    505B : B3                          OR      E
    2534/    505C : CA 7C 43                    JP      Z,UFERR         ; No - ?UF Error
    2535/    505F : 7E                          LD      A,(HL)          ; Get LSB of argument address
    2536/    5060 : 23                          INC     HL
    2537/    5061 : 66                          LD      H,(HL)          ; Get MSB of argument address
    2538/    5062 : 6F                          LD      L,A             ; HL = Arg variable address
    2539/    5063 : E5                          PUSH    HL              ; Save it
    2540/    5064 : 2A DA 60                    LD      HL,(FNRGNM)     ; Get old argument name
    2541/    5067 : E3                          EX      (SP),HL ;       ; Save old , Get new
    2542/    5068 : 22 DA 60                    LD      (FNRGNM),HL     ; Set new argument name
    2543/    506B : 2A DE 60                    LD      HL,(FNARG+2)    ; Get LSB,NLSB of old arg value
    2544/    506E : E5                          PUSH    HL              ; Save it
    2545/    506F : 2A DC 60                    LD      HL,(FNARG)      ; Get MSB,EXP of old arg value
    2546/    5072 : E5                          PUSH    HL              ; Save it
    2547/    5073 : 21 DC 60                    LD      HL,FNARG        ; HL = Value of argument
    2548/    5076 : D5                          PUSH    DE              ; Save FN code string address
    2549/    5077 : CD 68 56                    CALL    FPTHL           ; Move FPREG to argument
    2550/    507A : E1                          POP     HL              ; Get FN code string address
    2551/    507B : CD 7E 4C                    CALL    GETNUM          ; Get value from function
    2552/    507E : 2B                          DEC     HL              ; DEC 'cos GETCHR INCs
    2553/    507F : CD 5C 48                    CALL    GETCHR          ; Get next character
    2554/    5082 : C2 70 43                    JP      NZ,SNERR        ; Bad character in FN - Error
    2555/    5085 : E1                          POP     HL              ; Get MSB,EXP of old arg
    2556/    5086 : 22 DC 60                    LD      (FNARG),HL      ; Restore it
    2557/    5089 : E1                          POP     HL              ; Get LSB,NLSB of old arg
    2558/    508A : 22 DE 60                    LD      (FNARG+2),HL    ; Restore it
    2559/    508D : E1                          POP     HL              ; Get name of old arg
    2560/    508E : 22 DA 60                    LD      (FNRGNM),HL     ; Restore it
    2561/    5091 : E1                          POP     HL              ; Restore code string address
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 44 - 11/7/2018 12:33:42


    2562/    5092 : C9                          RET
    2563/    5093 :                     
    2564/    5093 : E5                  IDTEST: PUSH    HL              ; Save code string address
    2565/    5094 : 2A 58 60                    LD      HL,(LINEAT)     ; Get current line number
    2566/    5097 : 23                          INC     HL              ; -1 means direct statement
    2567/    5098 : 7C                          LD      A,H
    2568/    5099 : B5                          OR      L
    2569/    509A : E1                          POP     HL              ; Restore code string address
    2570/    509B : C0                          RET     NZ              ; Return if in program
    2571/    509C : 1E 16                       LD      E,ID            ; ?ID Error
    2572/    509E : C3 84 43                    JP      ERROR
    2573/    50A1 :                     
    2574/    50A1 : CD 7B 46            CHEKFN: CALL    CHKSYN          ; Make sure FN follows
    2575/    50A4 : A7                          DB      ZFN             ; "FN" token
    2576/    50A5 : 3E 80                       LD      A,80H
    2577/    50A7 : 32 C7 60                    LD      (FORFLG),A      ; Flag FN name to find
    2578/    50AA : B6                          OR      (HL)            ; FN name has bit 7 set
    2579/    50AB : 47                          LD      B,A             ; in first byte of name
    2580/    50AC : CD 63 4E                    CALL    GTFNAM          ; Get FN name
    2581/    50AF : C3 81 4C                    JP      TSTNUM          ; Make sure numeric function
    2582/    50B2 :                     
    2583/    50B2 : CD 81 4C            STR:    CALL    TSTNUM          ; Make sure it's a number
    2584/    50B5 : CD A6 57                    CALL    NUMASC          ; Turn number into text
    2585/    50B8 : CD E6 50            STR1:   CALL    CRTST           ; Create string entry for it
    2586/    50BB : CD 5C 52                    CALL    GSTRCU          ; Current string to pool
    2587/    50BE : 01 B6 52                    LD      BC,TOPOOL       ; Save in string pool
    2588/    50C1 : C5                          PUSH    BC              ; Save address on stack
    2589/    50C2 :                     
    2590/    50C2 : 7E                  SAVSTR: LD      A,(HL)          ; Get string length
    2591/    50C3 : 23                          INC     HL
    2592/    50C4 : 23                          INC     HL
    2593/    50C5 : E5                          PUSH    HL              ; Save pointer to string
    2594/    50C6 : CD 3D 51                    CALL    TESTR           ; See if enough string space
    2595/    50C9 : E1                          POP     HL              ; Restore pointer to string
    2596/    50CA : 4E                          LD      C,(HL)          ; Get LSB of address
    2597/    50CB : 23                          INC     HL
    2598/    50CC : 46                          LD      B,(HL)          ; Get MSB of address
    2599/    50CD : CD DA 50                    CALL    CRTMST          ; Create string entry
    2600/    50D0 : E5                          PUSH    HL              ; Save pointer to MSB of addr
    2601/    50D1 : 6F                          LD      L,A             ; Length of string
    2602/    50D2 : CD 50 52                    CALL    TOSTRA          ; Move to string area
    2603/    50D5 : D1                          POP     DE              ; Restore pointer to MSB
    2604/    50D6 : C9                          RET
    2605/    50D7 :                     
    2606/    50D7 : CD 3D 51            MKTMST: CALL    TESTR           ; See if enough string space
    2607/    50DA : 21 BB 60            CRTMST: LD      HL,TMPSTR       ; Temporary string
    2608/    50DD : E5                          PUSH    HL              ; Save it
    2609/    50DE : 77                          LD      (HL),A          ; Save length of string
    2610/    50DF : 23                          INC     HL
    2611/    50E0 : 23                  SVSTAD: INC     HL
    2612/    50E1 : 73                          LD      (HL),E          ; Save LSB of address
    2613/    50E2 : 23                          INC     HL
    2614/    50E3 : 72                          LD      (HL),D          ; Save MSB of address
    2615/    50E4 : E1                          POP     HL              ; Restore pointer
    2616/    50E5 : C9                          RET
    2617/    50E6 :                     
    2618/    50E6 : 2B                  CRTST:  DEC     HL              ; DEC - INCed after
    2619/    50E7 : 06 22               QTSTR:  LD      B,'"'           ; Terminating quote
    2620/    50E9 : 50                          LD      D,B             ; Quote to D
    2621/    50EA : E5                  DTSTR:  PUSH    HL              ; Save start
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 45 - 11/7/2018 12:33:42


    2622/    50EB : 0E FF                       LD      C,-1            ; Set counter to -1
    2623/    50ED : 23                  QTSTLP: INC     HL              ; Move on
    2624/    50EE : 7E                          LD      A,(HL)          ; Get byte
    2625/    50EF : 0C                          INC     C               ; Count bytes
    2626/    50F0 : B7                          OR      A               ; End of line?
    2627/    50F1 : 28 06                       Jr      Z,CRTSTE        ; Yes - Create string entry
    2628/    50F3 : BA                          CP      D               ; Terminator D found?
    2629/    50F4 : 28 03                       Jr      Z,CRTSTE        ; Yes - Create string entry
    2630/    50F6 : B8                          CP      B               ; Terminator B found?
    2631/    50F7 : 20 F4                       Jr      NZ,QTSTLP       ; No - Keep looking
    2632/    50F9 : FE 22               CRTSTE: CP      '"'             ; End with '"'?
    2633/    50FB : CC 5C 48                    CALL    Z,GETCHR        ; Yes - Get next character
    2634/    50FE : E3                          EX      (SP),HL         ; Starting quote
    2635/    50FF : 23                          INC     HL              ; First byte of string
    2636/    5100 : EB                          EX      DE,HL           ; To DE
    2637/    5101 : 79                          LD      A,C             ; Get length
    2638/    5102 : CD DA 50                    CALL    CRTMST          ; Create string entry
    2639/    5105 : 11 BB 60            TSTOPL: LD      DE,TMPSTR       ; Temporary string
    2640/    5108 : 2A AD 60                    LD      HL,(TMSTPT)     ; Temporary string pool pointer
    2641/    510B : 22 E0 60                    LD      (FPREG),HL      ; Save address of string ptr
    2642/    510E : 3E 01                       LD      A,1
    2643/    5110 : 32 A9 60                    LD      (TYPE),A        ; Set type to string
    2644/    5113 : CD 6B 56                    CALL    DETHL4          ; Move string to pool
    2645/    5116 : CD 75 46                    CALL    CPDEHL          ; Out of string pool?
    2646/    5119 : 22 AD 60                    LD      (TMSTPT),HL     ; Save new pointer
    2647/    511C : E1                          POP     HL              ; Restore code string address
    2648/    511D : 7E                          LD      A,(HL)          ; Get next code byte
    2649/    511E : C0                          RET     NZ              ; Return if pool OK
    2650/    511F : 1E 1E                       LD      E,ST            ; ?ST Error
    2651/    5121 : C3 84 43                    JP      ERROR           ; String pool overflow
    2652/    5124 :                     
    2653/    5124 : 23                  PRNUMS: INC     HL              ; Skip leading space
    2654/    5125 : CD E6 50            PRS:    CALL    CRTST           ; Create string entry for it
    2655/    5128 : CD 5C 52            PRS1:   CALL    GSTRCU          ; Current string to pool
    2656/    512B : CD 5F 56                    CALL    LOADFP          ; Move string block to BCDE
    2657/    512E : 1C                          INC     E               ; Length + 1
    2658/    512F : 1D                  PRSLP:  DEC     E               ; Count characters
    2659/    5130 : C8                          RET     Z               ; End of string
    2660/    5131 : 0A                          LD      A,(BC)          ; Get byte to output
    2661/    5132 : CD 8E 46                    CALL    OUTC            ; Output character in A
    2662/    5135 : FE 0D                       CP      CR              ; Return?
    2663/    5137 : CC C4 4A                    CALL    Z,DONULL        ; Yes - Do nulls
    2664/    513A : 03                          INC     BC              ; Next byte in string
    2665/    513B : 18 F2                       Jr      PRSLP           ; More characters to output
    2666/    513D :                     
    2667/    513D : B7                  TESTR:  OR      A               ; Test if enough room
    2668/    513E : 0E                          DB      0EH             ; No garbage collection done
    2669/    513F : F1                  GRBDON: POP     AF              ; Garbage collection done
    2670/    5140 : F5                          PUSH    AF              ; Save status
    2671/    5141 : ED 5B 56 60                 LD      de,(STRSPC)     ; Bottom of string space in use
    2672/    5145 : 2A BF 60                    LD      HL,(STRBOT)     ; Bottom of string area
    2673/    5148 : 2F                          CPL                     ; Negate length (Top down)
    2674/    5149 : 4F                          LD      C,A             ; -Length to BC
    2675/    514A : 06 FF                       LD      B,-1            ; BC = -ve length of string
    2676/    514C : 09                          ADD     HL,BC           ; Add to bottom of space in use
    2677/    514D : 23                          INC     HL              ; Plus one for 2's complement
    2678/    514E : CD 75 46                    CALL    CPDEHL          ; Below string RAM area?
    2679/    5151 : 38 07                       Jr      C,TESTOS        ; Tidy up if not done else err
    2680/    5153 : 22 BF 60                    LD      (STRBOT),HL     ; Save new bottom of area
    2681/    5156 : 23                          INC     HL              ; Point to first byte of string
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 46 - 11/7/2018 12:33:42


    2682/    5157 : EB                          EX      DE,HL           ; Address to DE
    2683/    5158 : F1                    	POP     AF              ; Throw away status push
    2684/    5159 : C9                          RET
    2685/    515A :                     
    2686/    515A : F1                  TESTOS: POP     AF              ; Garbage collect been done?
    2687/    515B : 1E 1A                       LD      E,OS            ; ?OS Error
    2688/    515D : CA 84 43                    JP      Z,ERROR         ; Yes - Not enough string apace
    2689/    5160 : BF                          CP      A               ; Flag garbage collect done
    2690/    5161 : F5                          PUSH    AF              ; Save status
    2691/    5162 : 01 3F 51                    LD      BC,GRBDON       ; Garbage collection done
    2692/    5165 : C5                          PUSH    BC              ; Save for RETurn
    2693/    5166 : 2A AB 60            GARBGE: LD      HL,(LSTRAM)     ; Get end of RAM pointer
    2694/    5169 : 22 BF 60            GARBLP: LD      (STRBOT),HL     ; Reset string pointer
    2695/    516C : 21 00 00                    LD      HL,0
    2696/    516F : E5                          PUSH    HL              ; Flag no string found
    2697/    5170 : 2A 56 60                    LD      HL,(STRSPC)     ; Get bottom of string space
    2698/    5173 : E5                          PUSH    HL              ; Save bottom of string space
    2699/    5174 : 21 AF 60                    LD      HL,TMSTPL       ; Temporary string pool
    2700/    5177 : ED 5B AD 60         GRBLP:  LD      de,(TMSTPT)     ; Temporary string pool pointer
    2701/    517B : CD 75 46                    CALL    CPDEHL          ; Temporary string pool done?
    2702/    517E : 01 77 51                    LD      BC,GRBLP        ; Loop until string pool done
    2703/    5181 : 20 3F                       Jr      NZ,STPOOL       ; No - See if in string area
    2704/    5183 : 2A D2 60                    LD      HL,(PROGND)     ; Start of simple variables
    2705/    5186 : ED 5B D4 60         SMPVAR: LD      de,(VAREND)     ; End of simple variables
    2706/    518A : CD 75 46                    CALL    CPDEHL          ; All simple strings done?
    2707/    518D : 28 0A                       Jr      Z,ARRLP         ; Yes - Do string arrays
    2708/    518F : 7E                          LD      A,(HL)          ; Get type of variable
    2709/    5190 : 23                          INC     HL
    2710/    5191 : 23                          INC     HL
    2711/    5192 : B7                          OR      A               ; "S" flag set if string
    2712/    5193 : CD C5 51                    CALL    STRADD          ; See if string in string area
    2713/    5196 : 18 EE                       Jr      SMPVAR          ; Loop until simple ones done
    2714/    5198 :                     
    2715/    5198 : C1                  GNXARY: POP     BC              ; Scrap address of this array
    2716/    5199 : ED 5B D6 60         ARRLP:  LD      de,(ARREND)     ; End of string arrays
    2717/    519D : CD 75 46                    CALL    CPDEHL          ; All string arrays done?
    2718/    51A0 : 28 49                       Jr      Z,SCNEND        ; Yes - Move string if found
    2719/    51A2 : CD 5F 56                    CALL    LOADFP          ; Get array name to BCDE
    2720/    51A5 : 7B                          LD      A,E             ; Get type of array
    2721/    51A6 : E5                          PUSH    HL              ; Save address of num of dim'ns
    2722/    51A7 : 09                          ADD     HL,BC           ; Start of next array
    2723/    51A8 : B7                          OR      A               ; Test type of array
    2724/    51A9 : F2 98 51                    JP      P,GNXARY        ; Numeric array - Ignore it
    2725/    51AC : 22 C1 60                    LD      (CUROPR),HL     ; Save address of next array
    2726/    51AF : E1                          POP     HL              ; Get address of num of dim'ns
    2727/    51B0 : 4E                          LD      C,(HL)          ; BC = Number of dimensions
    2728/    51B1 : 06 00                       LD      B,0
    2729/    51B3 : 09                          ADD     HL,BC           ; Two bytes per dimension size
    2730/    51B4 : 09                          ADD     HL,BC
    2731/    51B5 : 23                          INC     HL              ; Plus one for number of dim'ns
    2732/    51B6 : ED 5B C1 60         GRBARY: LD      de,(CUROPR)     ; Get address of next array
    2733/    51BA : CD 75 46                    CALL    CPDEHL          ; Is this array finished?
    2734/    51BD : 28 DA                       Jr      Z,ARRLP         ; Yes - Get next one
    2735/    51BF : 01 B6 51                    LD      BC,GRBARY       ; Loop until array all done
    2736/    51C2 :                     
    2737/    51C2 : C5                  STPOOL: PUSH    BC              ; Save return address
    2738/    51C3 : F6 80                       OR      80H             ; Flag string type
    2739/    51C5 : 7E                  STRADD: LD      A,(HL)          ; Get string length
    2740/    51C6 : 23                          INC     HL
    2741/    51C7 : 23                          INC     HL
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 47 - 11/7/2018 12:33:42


    2742/    51C8 : 5E                          LD      E,(HL)          ; Get LSB of string address
    2743/    51C9 : 23                          INC     HL
    2744/    51CA : 56                          LD      D,(HL)          ; Get MSB of string address
    2745/    51CB : 23                          INC     HL
    2746/    51CC : F0                          RET     P               ; Not a string - Return
    2747/    51CD : B7                          OR      A               ; Set flags on string length
    2748/    51CE : C8                          RET     Z               ; Null string - Return
    2749/    51CF : 44                          LD      B,H             ; Save variable pointer
    2750/    51D0 : 4D                          LD      C,L
    2751/    51D1 : 2A BF 60                    LD      HL,(STRBOT)     ; Bottom of new area
    2752/    51D4 : CD 75 46                    CALL    CPDEHL          ; String been done?
    2753/    51D7 : 60                          LD      H,B             ; Restore variable pointer
    2754/    51D8 : 69                          LD      L,C
    2755/    51D9 : D8                          RET     C               ; String done - Ignore
    2756/    51DA : E1                          POP     HL              ; Return address
    2757/    51DB : E3                          EX      (SP),HL         ; Lowest available string area
    2758/    51DC : CD 75 46                    CALL    CPDEHL          ; String within string area?
    2759/    51DF : E3                          EX      (SP),HL         ; Lowest available string area
    2760/    51E0 : E5                          PUSH    HL              ; Re-save return address
    2761/    51E1 : 60                          LD      H,B             ; Restore variable pointer
    2762/    51E2 : 69                          LD      L,C
    2763/    51E3 : D0                          RET     NC              ; Outside string area - Ignore
    2764/    51E4 : C1                          POP     BC              ; Get return , Throw 2 away
    2765/    51E5 : F1                          POP     AF              ;
    2766/    51E6 : F1                          POP     AF              ;
    2767/    51E7 : E5                          PUSH    HL              ; Save variable pointer
    2768/    51E8 : D5                          PUSH    DE              ; Save address of current
    2769/    51E9 : C5                          PUSH    BC              ; Put back return address
    2770/    51EA : C9                          RET                     ; Go to it
    2771/    51EB :                     
    2772/    51EB : D1                  SCNEND: POP     DE              ; Addresses of strings
    2773/    51EC : E1                          POP     HL              ;
    2774/    51ED : 7D                          LD      A,L             ; HL = 0 if no more to do
    2775/    51EE : B4                          OR      H
    2776/    51EF : C8                          RET     Z               ; No more to do - Return
    2777/    51F0 : 2B                          DEC     HL
    2778/    51F1 : 46                          LD      B,(HL)          ; MSB of address of string
    2779/    51F2 : 2B                          DEC     HL
    2780/    51F3 : 4E                          LD      C,(HL)          ; LSB of address of string
    2781/    51F4 : E5                          PUSH    HL              ; Save variable address
    2782/    51F5 : 2B                          DEC     HL
    2783/    51F6 : 2B                          DEC     HL
    2784/    51F7 : 6E                          LD      L,(HL)          ; HL = Length of string
    2785/    51F8 : 26 00                       LD      H,0
    2786/    51FA : 09                          ADD     HL,BC           ; Address of end of string+1
    2787/    51FB : 50                          LD      D,B             ; String address to DE
    2788/    51FC : 59                          LD      E,C
    2789/    51FD : 2B                          DEC     HL              ; Last byte in string
    2790/    51FE : 44                          LD      B,H             ; Address to BC
    2791/    51FF : 4D                          LD      C,L
    2792/    5200 : 2A BF 60                    LD      HL,(STRBOT)     ; Current bottom of string area
    2793/    5203 : CD A3 44                    CALL    MOVSTR          ; Move string to new address
    2794/    5206 : E1                          POP     HL              ; Restore variable address
    2795/    5207 : 71                          LD      (HL),C          ; Save new LSB of address
    2796/    5208 : 23                          INC     HL
    2797/    5209 : 70                          LD      (HL),B          ; Save new MSB of address
    2798/    520A : 69                          LD      L,C             ; Next string area+1 to HL
    2799/    520B : 60                          LD      H,B
    2800/    520C : 2B                          DEC     HL              ; Next string area address
    2801/    520D : C3 69 51                    JP      GARBLP          ; Look for more strings
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 48 - 11/7/2018 12:33:42


    2802/    5210 :                     
    2803/    5210 : C5                  CONCAT: PUSH    BC              ; Save prec' opr & code string
    2804/    5211 : E5                          PUSH    HL              ;
    2805/    5212 : 2A E0 60                    LD      HL,(FPREG)      ; Get first string
    2806/    5215 : E3                          EX      (SP),HL         ; Save first string
    2807/    5216 : CD 0A 4D                    CALL    OPRND           ; Get second string
    2808/    5219 : E3                          EX      (SP),HL         ; Restore first string
    2809/    521A : CD 82 4C                    CALL    TSTSTR          ; Make sure it's a string
    2810/    521D : 7E                          LD      A,(HL)          ; Get length of second string
    2811/    521E : E5                          PUSH    HL              ; Save first string
    2812/    521F : 2A E0 60                    LD      HL,(FPREG)      ; Get second string
    2813/    5222 : E5                          PUSH    HL              ; Save second string
    2814/    5223 : 86                          ADD     A,(HL)          ; Add length of second string
    2815/    5224 : 1E 1C                       LD      E,LS            ; ?LS Error
    2816/    5226 : DA 84 43                    JP      C,ERROR         ; String too long - Error
    2817/    5229 : CD D7 50                    CALL    MKTMST          ; Make temporary string
    2818/    522C : D1                          POP     DE              ; Get second string to DE
    2819/    522D : CD 60 52                    CALL    GSTRDE          ; Move to string pool if needed
    2820/    5230 : E3                          EX      (SP),HL         ; Get first string
    2821/    5231 : CD 5F 52                    CALL    GSTRHL          ; Move to string pool if needed
    2822/    5234 : E5                          PUSH    HL              ; Save first string
    2823/    5235 : 2A BD 60                    LD      HL,(TMPSTR+2)   ; Temporary string address
    2824/    5238 : EB                          EX      DE,HL           ; To DE
    2825/    5239 : CD 47 52                    CALL    SSTSA           ; First string to string area
    2826/    523C : CD 47 52                    CALL    SSTSA           ; Second string to string area
    2827/    523F : 21 A3 4C                    LD      HL,EVAL2        ; Return to evaluation loop
    2828/    5242 : E3                          EX      (SP),HL         ; Save return,get code string
    2829/    5243 : E5                          PUSH    HL              ; Save code string address
    2830/    5244 : C3 05 51                    JP      TSTOPL          ; To temporary string to pool
    2831/    5247 :                     
    2832/    5247 : E1                  SSTSA:  POP     HL              ; Return address
    2833/    5248 : E3                          EX      (SP),HL         ; Get string block,save return
    2834/    5249 : 7E                          LD      A,(HL)          ; Get length of string
    2835/    524A : 23                          INC     HL
    2836/    524B : 23                          INC     HL
    2837/    524C : 4E                          LD      C,(HL)          ; Get LSB of string address
    2838/    524D : 23                          INC     HL
    2839/    524E : 46                          LD      B,(HL)          ; Get MSB of string address
    2840/    524F : 6F                          LD      L,A             ; Length to L
    2841/    5250 : 2C                  TOSTRA: INC     L               ; INC - DECed after
    2842/    5251 : 2D                  TSALP:  DEC     L               ; Count bytes moved
    2843/    5252 : C8                          RET     Z               ; End of string - Return
    2844/    5253 : 0A                          LD      A,(BC)          ; Get source
    2845/    5254 : 12                          LD      (DE),A          ; Save destination
    2846/    5255 : 03                          INC     BC              ; Next source
    2847/    5256 : 13                          INC     DE              ; Next destination
    2848/    5257 : 18 F8                       Jr      TSALP           ; Loop until string moved
    2849/    5259 :                     
    2850/    5259 : CD 82 4C            GETSTR: CALL    TSTSTR          ; Make sure it's a string
    2851/    525C : 2A E0 60            GSTRCU: LD      HL,(FPREG)      ; Get current string
    2852/    525F : EB                  GSTRHL: EX      DE,HL           ; Save DE
    2853/    5260 : CD 79 52            GSTRDE: CALL    BAKTMP          ; Was it last tmp-str?
    2854/    5263 : EB                          EX      DE,HL           ; Restore DE
    2855/    5264 : C0                          RET     NZ              ; No - Return
    2856/    5265 : D5                          PUSH    DE              ; Save string
    2857/    5266 : 50                          LD      D,B             ; String block address to DE
    2858/    5267 : 59                          LD      E,C
    2859/    5268 : 1B                          DEC     DE              ; Point to length
    2860/    5269 : 4E                          LD      C,(HL)          ; Get string length
    2861/    526A : 2A BF 60                    LD      HL,(STRBOT)     ; Current bottom of string area
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 49 - 11/7/2018 12:33:42


    2862/    526D : CD 75 46                    CALL    CPDEHL          ; Last one in string area?
    2863/    5270 : 20 05                       Jr      NZ,POPHL        ; No - Return
    2864/    5272 : 47                          LD      B,A             ; Clear B (A=0)
    2865/    5273 : 09                          ADD     HL,BC           ; Remove string from str' area
    2866/    5274 : 22 BF 60                    LD      (STRBOT),HL     ; Save new bottom of str' area
    2867/    5277 : E1                  POPHL:  POP     HL              ; Restore string
    2868/    5278 : C9                          RET
    2869/    5279 :                     
    2870/    5279 : 2A AD 60            BAKTMP: LD      HL,(TMSTPT)     ; Get temporary string pool top
    2871/    527C : 2B                          DEC     HL              ; Back
    2872/    527D : 46                          LD      B,(HL)          ; Get MSB of address
    2873/    527E : 2B                          DEC     HL              ; Back
    2874/    527F : 4E                          LD      C,(HL)          ; Get LSB of address
    2875/    5280 : 2B                          DEC     HL              ; Back
    2876/    5281 : 2B                          DEC     HL              ; Back
    2877/    5282 : CD 75 46                    CALL    CPDEHL          ; String last in string pool?
    2878/    5285 : C0                          RET     NZ              ; Yes - Leave it
    2879/    5286 : 22 AD 60                    LD      (TMSTPT),HL     ; Save new string pool top
    2880/    5289 : C9                          RET
    2881/    528A :                     
    2882/    528A : 01 19 50            LEN:    LD      BC,PASSA        ; To return integer A
    2883/    528D : C5                          PUSH    BC              ; Save address
    2884/    528E : CD 59 52            GETLEN: CALL    GETSTR          ; Get string and its length
    2885/    5291 : AF                          XOR     A
    2886/    5292 : 57                          LD      D,A             ; Clear D
    2887/    5293 : 32 A9 60                    LD      (TYPE),A        ; Set type to numeric
    2888/    5296 : 7E                          LD      A,(HL)          ; Get length of string
    2889/    5297 : B7                          OR      A               ; Set status flags
    2890/    5298 : C9                          RET
    2891/    5299 :                     
    2892/    5299 : 01 19 50            ASC:    LD      BC,PASSA        ; To return integer A
    2893/    529C : C5                          PUSH    BC              ; Save address
    2894/    529D : CD 8E 52            GTFLNM: CALL    GETLEN          ; Get length of string
    2895/    52A0 : CA F1 48                    JP      Z,FCERR         ; Null string - Error
    2896/    52A3 : 23                          INC     HL
    2897/    52A4 : 23                          INC     HL
    2898/    52A5 : 5E                          LD      E,(HL)          ; Get LSB of address
    2899/    52A6 : 23                          INC     HL
    2900/    52A7 : 56                          LD      D,(HL)          ; Get MSB of address
    2901/    52A8 : 1A                          LD      A,(DE)          ; Get first byte of string
    2902/    52A9 : C9                          RET
    2903/    52AA :                     
    2904/    52AA : 3E 01               CHR:    LD      A,1             ; One character string
    2905/    52AC : CD D7 50                    CALL    MKTMST          ; Make a temporary string
    2906/    52AF : CD 8B 53                    CALL    MAKINT          ; Make it integer A
    2907/    52B2 : 2A BD 60                    LD      HL,(TMPSTR+2)   ; Get address of string
    2908/    52B5 : 73                          LD      (HL),E          ; Save character
    2909/    52B6 : C1                  TOPOOL: POP     BC              ; Clean up stack
    2910/    52B7 : C3 05 51                    JP      TSTOPL          ; Temporary string to pool
    2911/    52BA :                     
    2912/    52BA : CD 3C 53            LEFT:   CALL    LFRGNM          ; Get number and ending ")"
    2913/    52BD : AF                          XOR     A               ; Start at first byte in string
    2914/    52BE : E3                  RIGHT1: EX      (SP),HL         ; Save code string,Get string
    2915/    52BF : 4F                          LD      C,A             ; Starting position in string
    2916/    52C0 : E5                  MID1:   PUSH    HL              ; Save string block address
    2917/    52C1 : 7E                          LD      A,(HL)          ; Get length of string
    2918/    52C2 : B8                          CP      B               ; Compare with number given
    2919/    52C3 : 38 02                       Jr      C,ALLFOL        ; All following bytes required
    2920/    52C5 : 78                          LD      A,B             ; Get new length
    2921/    52C6 : 11                          DB      11H             ; Skip "LD C,0"
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 50 - 11/7/2018 12:33:42


    2922/    52C7 : 0E 00               ALLFOL: LD      C,0             ; First byte of string
    2923/    52C9 : C5                          PUSH    BC              ; Save position in string
    2924/    52CA : CD 3D 51                    CALL    TESTR           ; See if enough string space
    2925/    52CD : C1                          POP     BC              ; Get position in string
    2926/    52CE : E1                          POP     HL              ; Restore string block address
    2927/    52CF : E5                          PUSH    HL              ; And re-save it
    2928/    52D0 : 23                          INC     HL
    2929/    52D1 : 23                          INC     HL
    2930/    52D2 : 46                          LD      B,(HL)          ; Get LSB of address
    2931/    52D3 : 23                          INC     HL
    2932/    52D4 : 66                          LD      H,(HL)          ; Get MSB of address
    2933/    52D5 : 68                          LD      L,B             ; HL = address of string
    2934/    52D6 : 06 00                       LD      B,0             ; BC = starting address
    2935/    52D8 : 09                          ADD     HL,BC           ; Point to that byte
    2936/    52D9 : 44                          LD      B,H             ; BC = source string
    2937/    52DA : 4D                          LD      C,L
    2938/    52DB : CD DA 50                    CALL    CRTMST          ; Create a string entry
    2939/    52DE : 6F                          LD      L,A             ; Length of new string
    2940/    52DF : CD 50 52                    CALL    TOSTRA          ; Move string to string area
    2941/    52E2 : D1                          POP     DE              ; Clear stack
    2942/    52E3 : CD 60 52                    CALL    GSTRDE          ; Move to string pool if needed
    2943/    52E6 : C3 05 51                    JP      TSTOPL          ; Temporary string to pool
    2944/    52E9 :                     
    2945/    52E9 : CD 3C 53            RIGHT:  CALL    LFRGNM          ; Get number and ending ")"
    2946/    52EC : D1                          POP     DE              ; Get string length
    2947/    52ED : D5                          PUSH    DE              ; And re-save
    2948/    52EE : 1A                          LD      A,(DE)          ; Get length
    2949/    52EF : 90                          SUB     B               ; Move back N bytes
    2950/    52F0 : 18 CC                       Jr      RIGHT1          ; Go and get sub-string
    2951/    52F2 :                     
    2952/    52F2 : EB                  MID:    EX      DE,HL           ; Get code string address
    2953/    52F3 : 7E                          LD      A,(HL)          ; Get next byte ',' or ")"
    2954/    52F4 : CD 41 53                    CALL    MIDNUM          ; Get number supplied
    2955/    52F7 : 04                          INC     B               ; Is it character zero?
    2956/    52F8 : 05                          DEC     B
    2957/    52F9 : CA F1 48                    JP      Z,FCERR         ; Yes - Error
    2958/    52FC : C5                          PUSH    BC              ; Save starting position
    2959/    52FD : 1E FF                       LD      E,255           ; All of string
    2960/    52FF : FE 29                       CP      ')'             ; Any length given?
    2961/    5301 : 28 07                       Jr      Z,RSTSTR        ; No - Rest of string
    2962/    5303 : CD 7B 46                    CALL    CHKSYN          ; Make sure ',' follows
    2963/    5306 : 2C                          DB      ','
    2964/    5307 : CD 88 53                    CALL    GETINT          ; Get integer 0-255
    2965/    530A : CD 7B 46            RSTSTR: CALL    CHKSYN          ; Make sure ")" follows
    2966/    530D : 29                          DB      ")"
    2967/    530E : F1                          POP     AF              ; Restore starting position
    2968/    530F : E3                          EX      (SP),HL         ; Get string,8ave code string
    2969/    5310 : 01 C0 52                    LD      BC,MID1         ; Continuation of MID$ routine
    2970/    5313 : C5                          PUSH    BC              ; Save for return
    2971/    5314 : 3D                          DEC     A               ; Starting position-1
    2972/    5315 : BE                          CP      (HL)            ; Compare with length
    2973/    5316 : 06 00                       LD      B,0             ; Zero bytes length
    2974/    5318 : D0                          RET     NC              ; Null string if start past end
    2975/    5319 : 4F                          LD      C,A             ; Save starting position-1
    2976/    531A : 7E                          LD      A,(HL)          ; Get length of string
    2977/    531B : 91                          SUB     C               ; Subtract start
    2978/    531C : BB                          CP      E               ; Enough string for it?
    2979/    531D : 47                          LD      B,A             ; Save maximum length available
    2980/    531E : D8                          RET     C               ; Truncate string if needed
    2981/    531F : 43                          LD      B,E             ; Set specified length
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 51 - 11/7/2018 12:33:42


    2982/    5320 : C9                          RET                     ; Go and create string
    2983/    5321 :                     
    2984/    5321 : CD 8E 52            VAL:    CALL    GETLEN          ; Get length of string
    2985/    5324 : CA 47 54                    JP      Z,RESZER        ; Result zero
    2986/    5327 : 5F                          LD      E,A             ; Save length
    2987/    5328 : 23                          INC     HL
    2988/    5329 : 23                          INC     HL
    2989/    532A : 7E                          LD      A,(HL)          ; Get LSB of address
    2990/    532B : 23                          INC     HL
    2991/    532C : 66                          LD      H,(HL)          ; Get MSB of address
    2992/    532D : 6F                          LD      L,A             ; HL = String address
    2993/    532E : E5                          PUSH    HL              ; Save string address
    2994/    532F : 19                          ADD     HL,DE
    2995/    5330 : 46                          LD      B,(HL)          ; Get end of string+1 byte
    2996/    5331 : 72                          LD      (HL),D          ; Zero it to terminate
    2997/    5332 : E3                          EX      (SP),HL         ; Save string end,get start
    2998/    5333 : C5                          PUSH    BC              ; Save end+1 byte
    2999/    5334 : 7E                          LD      A,(HL)          ; Get starting byte
    3000/    5335 : CD 13 57            	CALL    ASCTFP          ; Convert ASCII string to FP
    3001/    5338 : C1                  	POP     BC              ; Restore end+1 byte
    3002/    5339 : E1                          POP     HL              ; Restore end+1 address
    3003/    533A : 70                          LD      (HL),B          ; Put back original byte
    3004/    533B : C9                          RET
    3005/    533C :                     
    3006/    533C : EB                  LFRGNM: EX      DE,HL           ; Code string address to HL
    3007/    533D : CD 7B 46                    CALL    CHKSYN          ; Make sure ")" follows
    3008/    5340 : 29                          DB      ")"
    3009/    5341 : C1                  MIDNUM: POP     BC              ; Get return address
    3010/    5342 : D1                          POP     DE              ; Get number supplied
    3011/    5343 : C5                          PUSH    BC              ; Re-save return address
    3012/    5344 : 43                          LD      B,E             ; Number to B
    3013/    5345 : C9                          RET
    3014/    5346 :                     
    3015/    5346 : CD 8B 53            INP:    CALL    MAKINT          ; Make it integer A
    3016/    5349 : 4F                  	ld	c, a
    3017/    534A : ED 78               	in	a, (c)
    3018/    534C : C3 19 50                    JP      PASSA           ; Return integer A
    3019/    534F :                     
    3020/    534F : CD 79 53            POUT:   CALL    SETIO           ; Set up port number
    3021/    5352 : 3A 06 60            	ld	a, (OTPORT)
    3022/    5355 : 4F                  	ld	c, a
    3023/    5356 : 7B                  	ld	a, e
    3024/    5357 : ED 79               	out	(c), a
    3025/    5359 : C9                  	ret
    3026/    535A :                     
    3027/    535A : CD 79 53            WAIT:   CALL    SETIO           ; Set up port number
    3028/    535D : F5                          PUSH    AF              ; Save AND mask
    3029/    535E : 1E 00                       LD      E,0             ; Assume zero if none given
    3030/    5360 : 2B                          DEC     HL              ; DEC 'cos GETCHR INCs
    3031/    5361 : CD 5C 48                    CALL    GETCHR          ; Get next character
    3032/    5364 : 28 07                       Jr      Z,NOXOR         ; No XOR byte given
    3033/    5366 : CD 7B 46                    CALL    CHKSYN          ; Make sure ',' follows
    3034/    5369 : 2C                          DB      ','
    3035/    536A : CD 88 53                    CALL    GETINT          ; Get integer 0-255 to XOR with
    3036/    536D : C1                  NOXOR:  POP     BC              ; Restore AND mask
    3037/    536E : 3A 06 60            	ld	a, (OTPORT)
    3038/    5371 : 4F                  	ld	c, a
    3039/    5372 :                     loc_5372:
    3040/    5372 : ED 78               	in	a, (c)
    3041/    5374 : AB                  	xor	e
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 52 - 11/7/2018 12:33:42


    3042/    5375 : A0                  	and	b
    3043/    5376 : 28 FA               	jr	z, loc_5372
    3044/    5378 : C9                  	ret
    3045/    5379 :                     
    3046/    5379 : CD 88 53            SETIO:  CALL    GETINT          ; Get integer 0-255
    3047/    537C : 32 06 60                    LD      (OTPORT),A      ; Set output port
    3048/    537F : CD 7B 46                    CALL    CHKSYN          ; Make sure ',' follows
    3049/    5382 : 2C                          DB      ','
    3050/    5383 : 18 03                       Jr      GETINT          ; Get integer 0-255 and return
    3051/    5385 :                     
    3052/    5385 : CD 5C 48            FNDNUM: CALL    GETCHR          ; Get next character
    3053/    5388 : CD 7E 4C            GETINT: CALL    GETNUM          ; Get a number from 0 to 255
    3054/    538B : CD D6 48            MAKINT: CALL    DEPINT          ; Make sure value 0 - 255
    3055/    538E : 7A                          LD      A,D             ; Get MSB of number
    3056/    538F : B7                          OR      A               ; Zero?
    3057/    5390 : C2 F1 48                    JP      NZ,FCERR        ; No - Error
    3058/    5393 : 2B                          DEC     HL              ; DEC 'cos GETCHR INCs
    3059/    5394 : CD 5C 48                    CALL    GETCHR          ; Get next character
    3060/    5397 : 7B                          LD      A,E             ; Get number to A
    3061/    5398 : C9                          RET
    3062/    5399 :                     
    3063/    5399 : CD DC 48            PEEK:   CALL    DEINT           ; Get memory address
    3064/    539C : 1A                          LD      A,(DE)          ; Get byte in memory
    3065/    539D : C3 19 50                    JP      PASSA           ; Return integer A
    3066/    53A0 :                     
    3067/    53A0 : CD 7E 4C            POKE:   CALL    GETNUM          ; Get memory address
    3068/    53A3 : CD DC 48                    CALL    DEINT           ; Get integer -32768 to 3276
    3069/    53A6 : D5                          PUSH    DE              ; Save memory address
    3070/    53A7 : CD 7B 46                    CALL    CHKSYN          ; Make sure ',' follows
    3071/    53AA : 2C                          DB      ','
    3072/    53AB : CD 88 53                    CALL    GETINT          ; Get integer 0-255
    3073/    53AE : D1                          POP     DE              ; Restore memory address
    3074/    53AF : 12                          LD      (DE),A          ; Load it into memory
    3075/    53B0 : C9                          RET
    3076/    53B1 :                     
    3077/    53B1 : CD DC 48            DEEK:   CALL    DEINT           ; Get integer -32768 to 32767
    3078/    53B4 : D5                          PUSH    DE              ; Save number
    3079/    53B5 : E1                          POP     HL              ; Number to HL
    3080/    53B6 : 46                          LD      B,(HL)          ; Get LSB of contents
    3081/    53B7 : 23                          INC     HL
    3082/    53B8 : 7E                          LD      A,(HL)          ; Get MSB of contents
    3083/    53B9 : C3 0A 50                    JP      ABPASS          ; Return integer AB
    3084/    53BC :                     
    3085/    53BC : CD 7E 4C            DOKE:   CALL    GETNUM          ; Get a number
    3086/    53BF : CD DC 48                    CALL    DEINT           ; Get integer -32768 to 32767
    3087/    53C2 : D5                          PUSH    DE              ; Save address
    3088/    53C3 : CD 7B 46                    CALL    CHKSYN          ; Make sure ',' follows
    3089/    53C6 : 2C                          DB      ','
    3090/    53C7 : CD 7E 4C                    CALL    GETNUM          ; Get a number
    3091/    53CA : CD DC 48                    CALL    DEINT           ; Get integer -32768 to 32767
    3092/    53CD : E3                          EX      (SP),HL         ; Save value,get address
    3093/    53CE : 73                          LD      (HL),E          ; Save LSB of value
    3094/    53CF : 23                          INC     HL
    3095/    53D0 : 72                          LD      (HL),D          ; Save MSB of value
    3096/    53D1 : E1                          POP     HL              ; Restore code string address
    3097/    53D2 : C9                          RET
    3098/    53D3 :                     
    3099/    53D3 : 21 76 58            ROUND:  LD      HL,HALF         ; Add 0.5 to FPREG
    3100/    53D6 : CD 5F 56            ADDPHL: CALL    LOADFP          ; Load FP at (HL) to BCDE
    3101/    53D9 : 18 09                       Jr      FPADD           ; Add BCDE to FPREG
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 53 - 11/7/2018 12:33:42


    3102/    53DB :                     
    3103/    53DB : CD 5F 56            SUBPHL: CALL    LOADFP          ; FPREG = -FPREG + number at HL
    3104/    53DE : 21                          DB      21H             ; Skip "POP BC" and "POP DE"
    3105/    53DF : C1                  PSUB:   POP     BC              ; Get FP number from stack
    3106/    53E0 : D1                          POP     DE
    3107/    53E1 : CD 39 56            SUBCDE: CALL    INVSGN          ; Negate FPREG
    3108/    53E4 : 78                  FPADD:  LD      A,B             ; Get FP exponent
    3109/    53E5 : B7                          OR      A               ; Is number zero?
    3110/    53E6 : C8                          RET     Z               ; Yes - Nothing to add
    3111/    53E7 : 3A E3 60                    LD      A,(FPEXP)       ; Get FPREG exponent
    3112/    53EA : B7                          OR      A               ; Is this number zero?
    3113/    53EB : CA 51 56                    JP      Z,FPBCDE        ; Yes - Move BCDE to FPREG
    3114/    53EE : 90                          SUB     B               ; BCDE number larger?
    3115/    53EF : 30 0C                       Jr      NC,NOSWAP       ; No - Don't swap them
    3116/    53F1 : 2F                          CPL                     ; Two's complement
    3117/    53F2 : 3C                          INC     A               ;  FP exponent
    3118/    53F3 : EB                          EX      DE,HL
    3119/    53F4 : CD 41 56                    CALL    STAKFP          ; Put FPREG on stack
    3120/    53F7 : EB                          EX      DE,HL
    3121/    53F8 : CD 51 56                    CALL    FPBCDE          ; Move BCDE to FPREG
    3122/    53FB : C1                          POP     BC              ; Restore number from stack
    3123/    53FC : D1                          POP     DE
    3124/    53FD : FE 19               NOSWAP: CP      24+1            ; Second number insignificant?
    3125/    53FF : D0                          RET     NC              ; Yes - First number is result
    3126/    5400 : F5                          PUSH    AF              ; Save number of bits to scale
    3127/    5401 : CD 74 56                    CALL    SIGNS           ; Set MSBs & sign of result
    3128/    5404 : 67                          LD      H,A             ; Save sign of result
    3129/    5405 : F1                          POP     AF              ; Restore scaling factor
    3130/    5406 : CD A2 54                    CALL    SCALE           ; Scale BCDE to same exponent
    3131/    5409 : B4                          OR      H               ; Result to be positive?
    3132/    540A : 21 E0 60                    LD      HL,FPREG        ; Point to FPREG
    3133/    540D : F2 23 54                    JP      P,MINCDE        ; No - Subtract FPREG from CDE
    3134/    5410 : CD 82 54                    CALL    PLUCDE          ; Add FPREG to CDE
    3135/    5413 : D2 63 54                    JP      NC,RONDUP       ; No overflow - Round it up
    3136/    5416 : 23                          INC     HL              ; Point to exponent
    3137/    5417 : 34                          INC     (HL)            ; Increment it
    3138/    5418 : CA 7F 43                    JP      Z,OVERR         ; Number overflowed - Error
    3139/    541B : 2E 01                       LD      L,1             ; 1 bit to shift right
    3140/    541D : CD B6 54                    CALL    SHRT1           ; Shift result right
    3141/    5420 : C3 63 54                    JP      RONDUP          ; Round it up
    3142/    5423 :                     
    3143/    5423 : AF                  MINCDE: XOR     A               ; Clear A and carry
    3144/    5424 : 90                          SUB     B               ; Negate exponent
    3145/    5425 : 47                          LD      B,A             ; Re-save exponent
    3146/    5426 : 7E                          LD      A,(HL)          ; Get LSB of FPREG
    3147/    5427 : 9B                          SBC     A, E            ; Subtract LSB of BCDE
    3148/    5428 : 5F                          LD      E,A             ; Save LSB of BCDE
    3149/    5429 : 23                          INC     HL
    3150/    542A : 7E                          LD      A,(HL)          ; Get NMSB of FPREG
    3151/    542B : 9A                          SBC     A,D             ; Subtract NMSB of BCDE
    3152/    542C : 57                          LD      D,A             ; Save NMSB of BCDE
    3153/    542D : 23                          INC     HL
    3154/    542E : 7E                          LD      A,(HL)          ; Get MSB of FPREG
    3155/    542F : 99                          SBC     A,C             ; Subtract MSB of BCDE
    3156/    5430 : 4F                          LD      C,A             ; Save MSB of BCDE
    3157/    5431 : DC 8E 54            CONPOS: CALL    C,COMPL         ; Overflow - Make it positive
    3158/    5434 :                     
    3159/    5434 : 68                  BNORM:  LD      L,B             ; L = Exponent
    3160/    5435 : 63                          LD      H,E             ; H = LSB
    3161/    5436 : AF                          XOR     A
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 54 - 11/7/2018 12:33:42


    3162/    5437 : 47                  BNRMLP: LD      B,A             ; Save bit count
    3163/    5438 : 79                          LD      A,C             ; Get MSB
    3164/    5439 : B7                          OR      A               ; Is it zero?
    3165/    543A : 20 16                       Jr      NZ,PNORM        ; No - Do it bit at a time
    3166/    543C : 4A                          LD      C,D             ; MSB = NMSB
    3167/    543D : 54                          LD      D,H             ; NMSB= LSB
    3168/    543E : 65                          LD      H,L             ; LSB = VLSB
    3169/    543F : 6F                          LD      L,A             ; VLSB= 0
    3170/    5440 : 78                          LD      A,B             ; Get exponent
    3171/    5441 : D6 08                       SUB     8               ; Count 8 bits
    3172/    5443 : FE E0                       CP      -24-8           ; Was number zero?
    3173/    5445 : 20 F0                       Jr      NZ,BNRMLP       ; No - Keep normalising
    3174/    5447 : AF                  RESZER: XOR     A               ; Result is zero
    3175/    5448 : 32 E3 60            SAVEXP: LD      (FPEXP),A       ; Save result as zero
    3176/    544B : C9                          RET
    3177/    544C :                     
    3178/    544C : 05                  NORMAL: DEC     B               ; Count bits
    3179/    544D : 29                          ADD     HL,HL           ; Shift HL left
    3180/    544E : CB 12                       rl	d		; NMSB left with last bit
    3181/    5450 : CB 11                       rl	c		; MSB left with last bit
    3182/    5452 : F2 4C 54            PNORM:  JP      P,NORMAL        ; Not done - Keep going
    3183/    5455 : 78                          LD      A,B             ; Number of bits shifted
    3184/    5456 : 5C                          LD      E,H             ; Save HL in EB
    3185/    5457 : 45                          LD      B,L
    3186/    5458 : B7                          OR      A               ; Any shifting done?
    3187/    5459 : 28 08                       Jr      Z,RONDUP        ; No - Round it up
    3188/    545B : 21 E3 60                    LD      HL,FPEXP        ; Point to exponent
    3189/    545E : 86                          ADD     A,(HL)          ; Add shifted bits
    3190/    545F : 77                          LD      (HL),A          ; Re-save exponent
    3191/    5460 : 30 E5                       Jr      NC,RESZER       ; Underflow - Result is zero
    3192/    5462 : C8                          RET     Z               ; Result is zero
    3193/    5463 : 78                  RONDUP: LD      A,B             ; Get VLSB of number
    3194/    5464 : 21 E3 60            RONDB:  LD      HL,FPEXP        ; Point to exponent
    3195/    5467 : B7                          OR      A               ; Any rounding?
    3196/    5468 : FC 75 54                    CALL    M,FPROND        ; Yes - Round number up
    3197/    546B : 46                          LD      B,(HL)          ; B = Exponent
    3198/    546C : 23                          INC     HL
    3199/    546D : 7E                          LD      A,(HL)          ; Get sign of result
    3200/    546E : E6 80                       AND     10000000B       ; Only bit 7 needed
    3201/    5470 : A9                          XOR     C               ; Set correct sign
    3202/    5471 : 4F                          LD      C,A             ; Save correct sign in number
    3203/    5472 : C3 51 56                    JP      FPBCDE          ; Move BCDE to FPREG
    3204/    5475 :                     
    3205/    5475 : 1C                  FPROND: INC     E               ; Round LSB
    3206/    5476 : C0                          RET     NZ              ; Return if ok
    3207/    5477 : 14                          INC     D               ; Round NMSB
    3208/    5478 : C0                          RET     NZ              ; Return if ok
    3209/    5479 : 0C                          INC     C               ; Round MSB
    3210/    547A : C0                          RET     NZ              ; Return if ok
    3211/    547B : 0E 80                       LD      C,80H           ; Set normal value
    3212/    547D : 34                          INC     (HL)            ; Increment exponent
    3213/    547E : C0                          RET     NZ              ; Return if ok
    3214/    547F : C3 7F 43                    JP      OVERR           ; Overflow error
    3215/    5482 :                     
    3216/    5482 : 7E                  PLUCDE: LD      A,(HL)          ; Get LSB of FPREG
    3217/    5483 : 83                          ADD     A,E             ; Add LSB of BCDE
    3218/    5484 : 5F                          LD      E,A             ; Save LSB of BCDE
    3219/    5485 : 23                          INC     HL
    3220/    5486 : 7E                          LD      A,(HL)          ; Get NMSB of FPREG
    3221/    5487 : 8A                          ADC     A,D             ; Add NMSB of BCDE
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 55 - 11/7/2018 12:33:42


    3222/    5488 : 57                          LD      D,A             ; Save NMSB of BCDE
    3223/    5489 : 23                          INC     HL
    3224/    548A : 7E                          LD      A,(HL)          ; Get MSB of FPREG
    3225/    548B : 89                          ADC     A,C             ; Add MSB of BCDE
    3226/    548C : 4F                          LD      C,A             ; Save MSB of BCDE
    3227/    548D : C9                          RET
    3228/    548E :                     
    3229/    548E : 21 E4 60            COMPL:  LD      HL,SGNRES       ; Sign of result
    3230/    5491 : 7E                          LD      A,(HL)          ; Get sign of result
    3231/    5492 : 2F                          CPL                     ; Negate it
    3232/    5493 : 77                          LD      (HL),A          ; Put it back
    3233/    5494 : AF                          XOR     A
    3234/    5495 : 6F                          LD      L,A             ; Set L to zero
    3235/    5496 : 90                          SUB     B               ; Negate exponent,set carry
    3236/    5497 : 47                          LD      B,A             ; Re-save exponent
    3237/    5498 : 7D                          LD      A,L             ; Load zero
    3238/    5499 : 9B                          SBC     A,E             ; Negate LSB
    3239/    549A : 5F                          LD      E,A             ; Re-save LSB
    3240/    549B : 7D                          LD      A,L             ; Load zero
    3241/    549C : 9A                          SBC     A,D             ; Negate NMSB
    3242/    549D : 57                          LD      D,A             ; Re-save NMSB
    3243/    549E : 7D                          LD      A,L             ; Load zero
    3244/    549F : 99                          SBC     A,C             ; Negate MSB
    3245/    54A0 : 4F                          LD      C,A             ; Re-save MSB
    3246/    54A1 : C9                          RET
    3247/    54A2 :                     
    3248/    54A2 : 06 00               SCALE:  LD      B,0             ; Clear underflow
    3249/    54A4 : D6 08               SCALLP: SUB     8               ; 8 bits (a whole byte)?
    3250/    54A6 : 38 07                       Jr      C,SHRITE        ; No - Shift right A bits
    3251/    54A8 : 43                          LD      B,E             ; <- Shift
    3252/    54A9 : 5A                          LD      E,D             ; <- right
    3253/    54AA : 51                          LD      D,C             ; <- eight
    3254/    54AB : 0E 00                       LD      C,0             ; <- bits
    3255/    54AD : 18 F5                       Jr      SCALLP          ; More bits to shift
    3256/    54AF :                     
    3257/    54AF : C6 09               SHRITE: ADD     A,8+1           ; Adjust count
    3258/    54B1 : 6F                          LD      L,A             ; Save bits to shift
    3259/    54B2 : AF                  SHRLP:  XOR     A               ; Flag for all done
    3260/    54B3 : 2D                          DEC     L               ; All shifting done?
    3261/    54B4 : C8                          RET     Z               ; Yes - Return
    3262/    54B5 : 79                          LD      A,C             ; Get MSB
    3263/    54B6 : 1F                  SHRT1:  RRA                     ; Shift it right
    3264/    54B7 : 4F                          LD      C,A             ; Re-save
    3265/    54B8 : CB 1A                       rr	d		; NMSB Shift right with last bit
    3266/    54BA : CB 1B                       rr	e		; LSB Shift right with last bit
    3267/    54BC : CB 18                       rr	b		; underflow Shift right with last bit
    3268/    54BE : 18 F2                       Jr      SHRLP           ; More bits to do
    3269/    54C0 :                     
    3270/    54C0 : 00 00 00 81         UNITY:  DB       000H,000H,000H,081H    ; 1.00000
    3271/    54C4 :                     
    3272/    54C4 : 03                  LOGTAB: DB      3                       ; Table used by LOG
    3273/    54C5 : AA 56 19 80                 DB      0AAH,056H,019H,080H     ; 0.59898
    3274/    54C9 : F1 22 76 80                 DB      0F1H,022H,076H,080H     ; 0.96147
    3275/    54CD : 45 AA 38 82                 DB      045H,0AAH,038H,082H     ; 2.88539
    3276/    54D1 :                     
    3277/    54D1 : CD 10 56            LOG:    CALL    TSTSGN          ; Test sign of value
    3278/    54D4 : B7                          OR      A
    3279/    54D5 : EA F1 48                    JP      PE,FCERR        ; ?FC Error if <= zero
    3280/    54D8 : 21 E3 60                    LD      HL,FPEXP        ; Point to exponent
    3281/    54DB : 7E                          LD      A,(HL)          ; Get exponent
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 56 - 11/7/2018 12:33:42


    3282/    54DC : 01 35 80                    LD      BC,8035H        ; BCDE = SQR(1/2)
    3283/    54DF : 11 F3 04                    LD      DE,04F3H
    3284/    54E2 : 90                          SUB     B               ; Scale value to be < 1
    3285/    54E3 : F5                          PUSH    AF              ; Save scale factor
    3286/    54E4 : 70                          LD      (HL),B          ; Save new exponent
    3287/    54E5 : D5                          PUSH    DE              ; Save SQR(1/2)
    3288/    54E6 : C5                          PUSH    BC
    3289/    54E7 : CD E4 53                    CALL    FPADD           ; Add SQR(1/2) to value
    3290/    54EA : C1                          POP     BC              ; Restore SQR(1/2)
    3291/    54EB : D1                          POP     DE
    3292/    54EC : 04                          INC     B               ; Make it SQR(2)
    3293/    54ED : CD 6D 55                    CALL    DVBCDE          ; Divide by SQR(2)
    3294/    54F0 : 21 C0 54                    LD      HL,UNITY        ; Point to 1.
    3295/    54F3 : CD DB 53                    CALL    SUBPHL          ; Subtract FPREG from 1
    3296/    54F6 : 21 C4 54                    LD      HL,LOGTAB       ; Coefficient table
    3297/    54F9 : CD 40 59                    CALL    SUMSER          ; Evaluate sum of series
    3298/    54FC : 01 80 80                    LD      BC,8080H        ; BCDE = -0.5
    3299/    54FF : 11 00 00                    LD      DE,0000H
    3300/    5502 : CD E4 53                    CALL    FPADD           ; Subtract 0.5 from FPREG
    3301/    5505 : F1                          POP     AF              ; Restore scale factor
    3302/    5506 : CD 7D 57                    CALL    RSCALE          ; Re-scale number
    3303/    5509 : 01 31 80            MULLN2: LD      BC,8031H        ; BCDE = Ln(2)
    3304/    550C : 11 18 72                    LD      DE,7218H
    3305/    550F : 21                          DB      21H             ; Skip "POP BC" and "POP DE"
    3306/    5510 :                     
    3307/    5510 : C1                  MULT:   POP     BC              ; Get number from stack
    3308/    5511 : D1                          POP     DE
    3309/    5512 : CD 10 56            FPMULT: CALL    TSTSGN          ; Test sign of FPREG
    3310/    5515 : C8                          RET     Z               ; Return zero if zero
    3311/    5516 : 2E 00                       LD      L,0             ; Flag add exponents
    3312/    5518 : CD CE 55                    CALL    ADDEXP          ; Add exponents
    3313/    551B : 79                          LD      A,C             ; Get MSB of multiplier
    3314/    551C : 32 F2 60                    LD      (MULVAL),A      ; Save MSB of multiplier
    3315/    551F : EB                          EX      DE,HL
    3316/    5520 : 22 F3 60                    LD      (MULVAL+1),HL   ; Save rest of multiplier
    3317/    5523 : 01 00 00                    LD      BC,0            ; Partial product (BCDE) = zero
    3318/    5526 : 50                          LD      D,B
    3319/    5527 : 58                          LD      E,B
    3320/    5528 : 21 34 54                    LD      HL,BNORM        ; Address of normalise
    3321/    552B : E5                          PUSH    HL              ; Save for return
    3322/    552C : 21 34 55                    LD      HL,MULT8        ; Address of 8 bit multiply
    3323/    552F : E5                          PUSH    HL              ; Save for NMSB,MSB
    3324/    5530 : E5                          PUSH    HL              ;
    3325/    5531 : 21 E0 60                    LD      HL,FPREG        ; Point to number
    3326/    5534 : 7E                  MULT8:  LD      A,(HL)          ; Get LSB of number
    3327/    5535 : 23                          INC     HL              ; Point to NMSB
    3328/    5536 : B7                          OR      A               ; Test LSB
    3329/    5537 : 28 21                       Jr      Z,BYTSFT        ; Zero - shift to next byte
    3330/    5539 : E5                          PUSH    HL              ; Save address of number
    3331/    553A : 2E 08                       LD      L,8             ; 8 bits to multiply by
    3332/    553C : 1F                  MUL8LP: RRA                     ; Shift LSB right
    3333/    553D : 67                          LD      H,A             ; Save LSB
    3334/    553E : 79                          LD      A,C             ; Get MSB
    3335/    553F : 30 0B                       Jr      NC,NOMADD       ; Bit was zero - Don't add
    3336/    5541 : E5                          PUSH    HL              ; Save LSB and count
    3337/    5542 : 2A F3 60                    LD      HL,(MULVAL+1)   ; Get LSB and NMSB
    3338/    5545 : 19                          ADD     HL,DE           ; Add NMSB and LSB
    3339/    5546 : EB                          EX      DE,HL           ; Leave sum in DE
    3340/    5547 : E1                          POP     HL              ; Restore MSB and count
    3341/    5548 : 3A F2 60                    LD      A,(MULVAL)      ; Get MSB of multiplier
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 57 - 11/7/2018 12:33:42


    3342/    554B : 89                          ADC     A,C             ; Add MSB
    3343/    554C : 1F                  NOMADD: RRA                     ; Shift MSB right
    3344/    554D : 4F                          LD      C,A             ; Re-save MSB
    3345/    554E : CB 1A               	rr	d		; Shift NMSB right
    3346/    5550 : CB 1B               	rr	e		; Shift LSB right
    3347/    5552 : CB 18               	rr	b		; Shift VLSB right
    3348/    5554 : 2D                          DEC     L               ; Count bits multiplied
    3349/    5555 : 7C                          LD      A,H             ; Get LSB of multiplier
    3350/    5556 : 20 E4                       Jr      NZ,MUL8LP       ; More - Do it
    3351/    5558 : E1                  POPHRT: POP     HL              ; Restore address of number
    3352/    5559 : C9                          RET
    3353/    555A :                     
    3354/    555A : 43                  BYTSFT: LD      B,E             ; Shift partial product left
    3355/    555B : 5A                          LD      E,D
    3356/    555C : 51                          LD      D,C
    3357/    555D : 4F                          LD      C,A
    3358/    555E : C9                          RET
    3359/    555F :                     
    3360/    555F : CD 41 56            DIV10:  CALL    STAKFP          ; Save FPREG on stack
    3361/    5562 : 01 20 84                    LD      BC,8420H        ; BCDE = 10.
    3362/    5565 : 11 00 00                    LD      DE,0000H
    3363/    5568 : CD 51 56                    CALL    FPBCDE          ; Move 10 to FPREG
    3364/    556B :                     
    3365/    556B : C1                  DIV:    POP     BC              ; Get number from stack
    3366/    556C : D1                          POP     DE
    3367/    556D : CD 10 56            DVBCDE: CALL    TSTSGN          ; Test sign of FPREG
    3368/    5570 : CA 73 43                    JP      Z,DZERR         ; Error if division by zero
    3369/    5573 : 2E FF                       LD      L,-1            ; Flag subtract exponents
    3370/    5575 : CD CE 55                    CALL    ADDEXP          ; Subtract exponents
    3371/    5578 : 34                          INC     (HL)            ; Add 2 to exponent to adjust
    3372/    5579 : 34                          INC     (HL)
    3373/    557A : 2B                          DEC     HL              ; Point to MSB
    3374/    557B : 7E                          LD      A,(HL)          ; Get MSB of dividend
    3375/    557C : 32 14 60                    LD      (DIV3),A        ; Save for subtraction
    3376/    557F : 2B                          DEC     HL
    3377/    5580 : 7E                          LD      A,(HL)          ; Get NMSB of dividend
    3378/    5581 : 32 10 60                    LD      (DIV2),A        ; Save for subtraction
    3379/    5584 : 2B                          DEC     HL
    3380/    5585 : 7E                          LD      A,(HL)          ; Get MSB of dividend
    3381/    5586 : 32 0C 60                    LD      (DIV1),A        ; Save for subtraction
    3382/    5589 : 41                          LD      B,C             ; Get MSB
    3383/    558A : EB                          EX      DE,HL           ; NMSB,LSB to HL
    3384/    558B : AF                          XOR     A
    3385/    558C : 4F                          LD      C,A             ; Clear MSB of quotient
    3386/    558D : 57                          LD      D,A             ; Clear NMSB of quotient
    3387/    558E : 5F                          LD      E,A             ; Clear LSB of quotient
    3388/    558F : 32 17 60                    LD      (DIV4),A        ; Clear overflow count
    3389/    5592 : E5                  DIVLP:  PUSH    HL              ; Save divisor
    3390/    5593 : C5                          PUSH    BC
    3391/    5594 : 7D                          LD      A,L             ; Get LSB of number
    3392/    5595 : CD 0B 60                    CALL    DIVSUP          ; Subt' divisor from dividend
    3393/    5598 : DE 00                       SBC     A,0             ; Count for overflows
    3394/    559A : 3F                          CCF
    3395/    559B : 30 07                       Jr      NC,RESDIV       ; Restore divisor if borrow
    3396/    559D : 32 17 60                    LD      (DIV4),A        ; Re-save overflow count
    3397/    55A0 : F1                          POP     AF              ; Scrap divisor
    3398/    55A1 : F1                          POP     AF
    3399/    55A2 : 37                          SCF                     ; Set carry to
    3400/    55A3 : D2                          DB      0D2H            ; Skip "POP BC" and "POP HL"
    3401/    55A4 :                     
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 58 - 11/7/2018 12:33:42


    3402/    55A4 : C1                  RESDIV: POP     BC              ; Restore divisor
    3403/    55A5 : E1                          POP     HL
    3404/    55A6 : 79                          LD      A,C             ; Get MSB of quotient
    3405/    55A7 : 3C                          INC     A
    3406/    55A8 : 3D                          DEC     A
    3407/    55A9 : 1F                          RRA                     ; Bit 0 to bit 7
    3408/    55AA : FA 64 54                    JP      M,RONDB         ; Done - Normalise result
    3409/    55AD : 17                          RLA                     ; Restore carry
    3410/    55AE : CB 13               	rl	e		; Double LSB of quotient
    3411/    55B0 : CB 12               	rl	d		; Double NMSB of quotient
    3412/    55B2 : CB 11               	rl	c		; Double MSB of quotient
    3413/    55B4 : 29                          ADD     HL,HL           ; Double NMSB,LSB of divisor
    3414/    55B5 : CB 10               	rl	b		; Double MSB of quotient
    3415/    55B7 : 3A 17 60                    LD      A,(DIV4)        ; Get VLSB of quotient
    3416/    55BA : 17                          RLA                     ; Double it
    3417/    55BB : 32 17 60                    LD      (DIV4),A        ; Put it back
    3418/    55BE : 79                          LD      A,C             ; Get MSB of quotient
    3419/    55BF : B2                          OR      D               ; Merge NMSB
    3420/    55C0 : B3                          OR      E               ; Merge LSB
    3421/    55C1 : 20 CF                       Jr      NZ,DIVLP        ; Not done - Keep dividing
    3422/    55C3 : E5                          PUSH    HL              ; Save divisor
    3423/    55C4 : 21 E3 60                    LD      HL,FPEXP        ; Point to exponent
    3424/    55C7 : 35                          DEC     (HL)            ; Divide by 2
    3425/    55C8 : E1                          POP     HL              ; Restore divisor
    3426/    55C9 : 20 C7                       Jr      NZ,DIVLP        ; Ok - Keep going
    3427/    55CB : C3 7F 43                    JP      OVERR           ; Overflow error
    3428/    55CE :                     
    3429/    55CE : 78                  ADDEXP: LD      A,B             ; Get exponent of dividend
    3430/    55CF : B7                          OR      A               ; Test it
    3431/    55D0 : CA F2 55                    JP      Z,OVTST3        ; Zero - Result zero
    3432/    55D3 : 7D                          LD      A,L             ; Get add/subtract flag
    3433/    55D4 : 21 E3 60                    LD      HL,FPEXP        ; Point to exponent
    3434/    55D7 : AE                          XOR     (HL)            ; Add or subtract it
    3435/    55D8 : 80                          ADD     A,B             ; Add the other exponent
    3436/    55D9 : 47                          LD      B,A             ; Save new exponent
    3437/    55DA : 1F                          RRA                     ; Test exponent for overflow
    3438/    55DB : A8                          XOR     B
    3439/    55DC : 78                          LD      A,B             ; Get exponent
    3440/    55DD : F2 F1 55                    JP      P,OVTST2        ; Positive - Test for overflow
    3441/    55E0 : C6 80                       ADD     A,80H           ; Add excess 128
    3442/    55E2 : 77                          LD      (HL),A          ; Save new exponent
    3443/    55E3 : CA 58 55                    JP      Z,POPHRT        ; Zero - Result zero
    3444/    55E6 : CD 74 56                    CALL    SIGNS           ; Set MSBs and sign of result
    3445/    55E9 : 77                          LD      (HL),A          ; Save new exponent
    3446/    55EA : 2B                          DEC     HL              ; Point to MSB
    3447/    55EB : C9                          RET
    3448/    55EC :                     
    3449/    55EC : CD 10 56            OVTST1: CALL    TSTSGN          ; Test sign of FPREG
    3450/    55EF : 2F                          CPL                     ; Invert sign
    3451/    55F0 : E1                          POP     HL              ; Clean up stack
    3452/    55F1 : B7                  OVTST2: OR      A               ; Test if new exponent zero
    3453/    55F2 : E1                  OVTST3: POP     HL              ; Clear off return address
    3454/    55F3 : F2 47 54                    JP      P,RESZER        ; Result zero
    3455/    55F6 : C3 7F 43                    JP      OVERR           ; Overflow error
    3456/    55F9 :                     
    3457/    55F9 : CD 5C 56            MLSP10: CALL    BCDEFP          ; Move FPREG to BCDE
    3458/    55FC : 78                          LD      A,B             ; Get exponent
    3459/    55FD : B7                          OR      A               ; Is it zero?
    3460/    55FE : C8                          RET     Z               ; Yes - Result is zero
    3461/    55FF : C6 02                       ADD     A,2             ; Multiply by 4
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 59 - 11/7/2018 12:33:42


    3462/    5601 : DA 7F 43                    JP      C,OVERR         ; Overflow - ?OV Error
    3463/    5604 : 47                          LD      B,A             ; Re-save exponent
    3464/    5605 : CD E4 53                    CALL    FPADD           ; Add BCDE to FPREG (Times 5)
    3465/    5608 : 21 E3 60                    LD      HL,FPEXP        ; Point to exponent
    3466/    560B : 34                          INC     (HL)            ; Double number (Times 10)
    3467/    560C : C0                          RET     NZ              ; Ok - Return
    3468/    560D : C3 7F 43                    JP      OVERR           ; Overflow error
    3469/    5610 :                     
    3470/    5610 : 3A E3 60            TSTSGN: LD      A,(FPEXP)       ; Get sign of FPREG
    3471/    5613 : B7                          OR      A
    3472/    5614 : C8                          RET     Z               ; RETurn if number is zero
    3473/    5615 : 3A E2 60                    LD      A,(FPREG+2)     ; Get MSB of FPREG
    3474/    5618 : FE                          DB      0FEH            ; Test sign
    3475/    5619 : 2F                  RETREL: CPL                     ; Invert sign
    3476/    561A : 17                          RLA                     ; Sign bit to carry
    3477/    561B : 9F                  FLGDIF: SBC     A,A             ; Carry to all bits of A
    3478/    561C : C0                          RET     NZ              ; Return -1 if negative
    3479/    561D : 3C                          INC     A               ; Bump to +1
    3480/    561E : C9                          RET                     ; Positive - Return +1
    3481/    561F :                     
    3482/    561F : CD 10 56            SGN:    CALL    TSTSGN          ; Test sign of FPREG
    3483/    5622 : 06 88               FLGREL: LD      B,80H+8         ; 8 bit integer in exponent
    3484/    5624 : 11 00 00                    LD      DE,0            ; Zero NMSB and LSB
    3485/    5627 : 21 E3 60            RETINT: LD      HL,FPEXP        ; Point to exponent
    3486/    562A : 4F                          LD      C,A             ; CDE = MSB,NMSB and LSB
    3487/    562B : 70                          LD      (HL),B          ; Save exponent
    3488/    562C : 06 00                       LD      B,0             ; CDE = integer to normalise
    3489/    562E : 23                          INC     HL              ; Point to sign of result
    3490/    562F : 36 80                       LD      (HL),80H        ; Set sign of result
    3491/    5631 : 17                          RLA                     ; Carry = sign of integer
    3492/    5632 : C3 31 54                    JP      CONPOS          ; Set sign of result
    3493/    5635 :                     
    3494/    5635 : CD 10 56            ABS:    CALL    TSTSGN          ; Test sign of FPREG
    3495/    5638 : F0                          RET     P               ; Return if positive
    3496/    5639 : 21 E2 60            INVSGN: LD      HL,FPREG+2      ; Point to MSB
    3497/    563C : 7E                          LD      A,(HL)          ; Get sign of mantissa
    3498/    563D : EE 80                       XOR     80H             ; Invert sign of mantissa
    3499/    563F : 77                          LD      (HL),A          ; Re-save sign of mantissa
    3500/    5640 : C9                          RET
    3501/    5641 :                     
    3502/    5641 : EB                  STAKFP: EX      DE,HL           ; Save code string address
    3503/    5642 : 2A E0 60                    LD      HL,(FPREG)      ; LSB,NLSB of FPREG
    3504/    5645 : E3                          EX      (SP),HL         ; Stack them,get return
    3505/    5646 : E5                          PUSH    HL              ; Re-save return
    3506/    5647 : 2A E2 60                    LD      HL,(FPREG+2)    ; MSB and exponent of FPREG
    3507/    564A : E3                          EX      (SP),HL         ; Stack them,get return
    3508/    564B : E5                          PUSH    HL              ; Re-save return
    3509/    564C : EB                          EX      DE,HL           ; Restore code string address
    3510/    564D : C9                          RET
    3511/    564E :                     
    3512/    564E : CD 5F 56            PHLTFP: CALL    LOADFP          ; Number at HL to BCDE
    3513/    5651 : ED 53 E0 60         FPBCDE: LD      (FPREG),DE      ; Save LSB,NLSB of number
    3514/    5655 : ED 43 E2 60                 LD      (FPREG+2),BC    ; Save MSB and exponent
    3515/    5659 : 50                  	ld	d, b
    3516/    565A : 59                  	ld	e, c
    3517/    565B : C9                          RET
    3518/    565C :                     
    3519/    565C : 21 E0 60            BCDEFP: LD      HL,FPREG        ; Point to FPREG
    3520/    565F : 5E                  LOADFP: LD      E,(HL)          ; Get LSB of number
    3521/    5660 : 23                          INC     HL
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 60 - 11/7/2018 12:33:42


    3522/    5661 : 56                          LD      D,(HL)          ; Get NMSB of number
    3523/    5662 : 23                          INC     HL
    3524/    5663 : 4E                          LD      C,(HL)          ; Get MSB of number
    3525/    5664 : 23                          INC     HL
    3526/    5665 : 46                          LD      B,(HL)          ; Get exponent of number
    3527/    5666 : 23                  INCHL:  INC     HL              ; Used for conditional "INC HL"
    3528/    5667 : C9                          RET
    3529/    5668 :                     
    3530/    5668 : 11 E0 60            FPTHL:  LD      DE,FPREG        ; Point to FPREG
    3531/    566B : 06 04               DETHL4: LD      B,4             ; 4 bytes to move
    3532/    566D : 1A                  DETHLB: LD      A,(DE)          ; Get source
    3533/    566E : 77                          LD      (HL),A          ; Save destination
    3534/    566F : 13                          INC     DE              ; Next source
    3535/    5670 : 23                          INC     HL              ; Next destination
    3536/    5671 : 10 FA                       djnz	DETHLB       ; Loop if more
    3537/    5673 : C9                          RET
    3538/    5674 :                     
    3539/    5674 : 21 E2 60            SIGNS:  LD      HL,FPREG+2      ; Point to MSB of FPREG
    3540/    5677 : 7E                          LD      A,(HL)          ; Get MSB
    3541/    5678 : 07                          RLCA                    ; Old sign to carry
    3542/    5679 : 37                          SCF                     ; Set MSBit
    3543/    567A : 1F                          RRA                     ; Set MSBit of MSB
    3544/    567B : 77                          LD      (HL),A          ; Save new MSB
    3545/    567C : 3F                          CCF                     ; Complement sign
    3546/    567D : 1F                          RRA                     ; Old sign to carry
    3547/    567E : 23                          INC     HL
    3548/    567F : 23                          INC     HL
    3549/    5680 : 77                          LD      (HL),A          ; Set sign of result
    3550/    5681 : 79                          LD      A,C             ; Get MSB
    3551/    5682 : 07                          RLCA                    ; Old sign to carry
    3552/    5683 : 37                          SCF                     ; Set MSBit
    3553/    5684 : 1F                          RRA                     ; Set MSBit of MSB
    3554/    5685 : 4F                          LD      C,A             ; Save MSB
    3555/    5686 : 1F                          RRA
    3556/    5687 : AE                          XOR     (HL)            ; New sign of result
    3557/    5688 : C9                          RET
    3558/    5689 :                     
    3559/    5689 : 78                  CMPNUM: LD      A,B             ; Get exponent of number
    3560/    568A : B7                          OR      A
    3561/    568B : CA 10 56                    JP      Z,TSTSGN        ; Zero - Test sign of FPREG
    3562/    568E : 21 19 56                    LD      HL,RETREL       ; Return relation routine
    3563/    5691 : E5                          PUSH    HL              ; Save for return
    3564/    5692 : CD 10 56                    CALL    TSTSGN          ; Test sign of FPREG
    3565/    5695 : 79                          LD      A,C             ; Get MSB of number
    3566/    5696 : C8                          RET     Z               ; FPREG zero - Number's MSB
    3567/    5697 : 21 E2 60                    LD      HL,FPREG+2      ; MSB of FPREG
    3568/    569A : AE                          XOR     (HL)            ; Combine signs
    3569/    569B : 79                          LD      A,C             ; Get MSB of number
    3570/    569C : F8                          RET     M               ; Exit if signs different
    3571/    569D : CD A3 56                    CALL    CMPFP           ; Compare FP numbers
    3572/    56A0 : 1F                          RRA                     ; Get carry to sign
    3573/    56A1 : A9                          XOR     C               ; Combine with MSB of number
    3574/    56A2 : C9                          RET
    3575/    56A3 :                     
    3576/    56A3 : 23                  CMPFP:  INC     HL              ; Point to exponent
    3577/    56A4 : 78                          LD      A,B             ; Get exponent
    3578/    56A5 : BE                          CP      (HL)            ; Compare exponents
    3579/    56A6 : C0                          RET     NZ              ; Different
    3580/    56A7 : 2B                          DEC     HL              ; Point to MBS
    3581/    56A8 : 79                          LD      A,C             ; Get MSB
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 61 - 11/7/2018 12:33:42


    3582/    56A9 : BE                          CP      (HL)            ; Compare MSBs
    3583/    56AA : C0                          RET     NZ              ; Different
    3584/    56AB : 2B                          DEC     HL              ; Point to NMSB
    3585/    56AC : 7A                          LD      A,D             ; Get NMSB
    3586/    56AD : BE                          CP      (HL)            ; Compare NMSBs
    3587/    56AE : C0                          RET     NZ              ; Different
    3588/    56AF : 2B                          DEC     HL              ; Point to LSB
    3589/    56B0 : 7B                          LD      A,E             ; Get LSB
    3590/    56B1 : 96                          SUB     (HL)            ; Compare LSBs
    3591/    56B2 : C0                          RET     NZ              ; Different
    3592/    56B3 : E1                          POP     HL              ; Drop RETurn
    3593/    56B4 : E1                          POP     HL              ; Drop another RETurn
    3594/    56B5 : C9                          RET
    3595/    56B6 :                     
    3596/    56B6 : 47                  FPINT:  LD      B,A             ; <- Move
    3597/    56B7 : 4F                          LD      C,A             ; <- exponent
    3598/    56B8 : 57                          LD      D,A             ; <- to all
    3599/    56B9 : 5F                          LD      E,A             ; <- bits
    3600/    56BA : B7                          OR      A               ; Test exponent
    3601/    56BB : C8                          RET     Z               ; Zero - Return zero
    3602/    56BC : E5                          PUSH    HL              ; Save pointer to number
    3603/    56BD : CD 5C 56                    CALL    BCDEFP          ; Move FPREG to BCDE
    3604/    56C0 : CD 74 56                    CALL    SIGNS           ; Set MSBs & sign of result
    3605/    56C3 : AE                          XOR     (HL)            ; Combine with sign of FPREG
    3606/    56C4 : 67                          LD      H,A             ; Save combined signs
    3607/    56C5 : FC DA 56                    CALL    M,DCBCDE        ; Negative - Decrement BCDE
    3608/    56C8 : 3E 98                       LD      A,80H+24        ; 24 bits
    3609/    56CA : 90                          SUB     B               ; Bits to shift
    3610/    56CB : CD A2 54                    CALL    SCALE           ; Shift BCDE
    3611/    56CE : 7C                          LD      A,H             ; Get combined sign
    3612/    56CF : 17                          RLA                     ; Sign to carry
    3613/    56D0 : DC 75 54                    CALL    C,FPROND        ; Negative - Round number up
    3614/    56D3 : 06 00                       LD      B,0             ; Zero exponent
    3615/    56D5 : DC 8E 54                    CALL    C,COMPL         ; If negative make positive
    3616/    56D8 : E1                          POP     HL              ; Restore pointer to number
    3617/    56D9 : C9                          RET
    3618/    56DA :                     
    3619/    56DA : 1B                  DCBCDE: DEC     DE              ; Decrement BCDE
    3620/    56DB : 7A                          LD      A,D             ; Test LSBs
    3621/    56DC : A3                          AND     E
    3622/    56DD : 3C                          INC     A
    3623/    56DE : C0                          RET     NZ              ; Exit if LSBs not FFFF
    3624/    56DF : 0B                          DEC     BC              ; Decrement MSBs
    3625/    56E0 : C9                          RET
    3626/    56E1 :                     
    3627/    56E1 : 21 E3 60            INT:    LD      HL,FPEXP        ; Point to exponent
    3628/    56E4 : 7E                          LD      A,(HL)          ; Get exponent
    3629/    56E5 : FE 98                       CP      80H+24          ; Integer accuracy only?
    3630/    56E7 : 3A E0 60                    LD      A,(FPREG)       ; Get LSB
    3631/    56EA : D0                          RET     NC              ; Yes - Already integer
    3632/    56EB : 7E                          LD      A,(HL)          ; Get exponent
    3633/    56EC : CD B6 56                    CALL    FPINT           ; F.P to integer
    3634/    56EF : 36 98                       LD      (HL),80H+24     ; Save 24 bit integer
    3635/    56F1 : 7B                          LD      A,E             ; Get LSB of number
    3636/    56F2 : F5                          PUSH    AF              ; Save LSB
    3637/    56F3 : 79                          LD      A,C             ; Get MSB of number
    3638/    56F4 : 17                          RLA                     ; Sign to carry
    3639/    56F5 : CD 31 54                    CALL    CONPOS          ; Set sign of result
    3640/    56F8 : F1                          POP     AF              ; Restore LSB of number
    3641/    56F9 : C9                          RET
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 62 - 11/7/2018 12:33:42


    3642/    56FA :                     
    3643/    56FA : 21 00 00            MLDEBC: LD      HL,0            ; Clear partial product
    3644/    56FD : 78                          LD      A,B             ; Test multiplier
    3645/    56FE : B1                          OR      C
    3646/    56FF : C8                          RET     Z               ; Return zero if zero
    3647/    5700 : 3E 10                       LD      A,16            ; 16 bits
    3648/    5702 : 29                  MLDBLP: ADD     HL,HL           ; Shift P.P left
    3649/    5703 : DA 64 4F                    JP      C,BSERR         ; ?BS Error if overflow
    3650/    5706 : EB                          EX      DE,HL
    3651/    5707 : 29                          ADD     HL,HL           ; Shift multiplier left
    3652/    5708 : EB                          EX      DE,HL
    3653/    5709 : 30 04                       Jr      NC,NOMLAD       ; Bit was zero - No add
    3654/    570B : 09                          ADD     HL,BC           ; Add multiplicand
    3655/    570C : DA 64 4F                    JP      C,BSERR         ; ?BS Error if overflow
    3656/    570F : 3D                  NOMLAD: DEC     A               ; Count bits
    3657/    5710 : 20 F0                       Jr      NZ,MLDBLP       ; More
    3658/    5712 : C9                          RET
    3659/    5713 :                     
    3660/    5713 : FE 2D               ASCTFP: CP      '-'             ; Negative?
    3661/    5715 : F5                          PUSH    AF              ; Save it and flags
    3662/    5716 : 28 05                       Jr      Z,CNVNUM        ; Yes - Convert number
    3663/    5718 : FE 2B                       CP      '+'             ; Positive?
    3664/    571A : 28 01                       Jr      Z,CNVNUM        ; Yes - Convert number
    3665/    571C : 2B                          DEC     HL              ; DEC 'cos GETCHR INCs
    3666/    571D : CD 47 54            CNVNUM: CALL    RESZER          ; Set result to zero
    3667/    5720 : 47                          LD      B,A             ; Digits after point counter
    3668/    5721 : 57                          LD      D,A             ; Sign of exponent
    3669/    5722 : 5F                          LD      E,A             ; Exponent of ten
    3670/    5723 : 2F                          CPL
    3671/    5724 : 4F                          LD      C,A             ; Before or after point flag
    3672/    5725 : CD 5C 48            MANLP:  CALL    GETCHR          ; Get next character
    3673/    5728 : 38 3D                       Jr      C,ADDIG         ; Digit - Add to number
    3674/    572A : FE 2E                       CP      '.'
    3675/    572C : 28 16                       Jr      Z,DPOINT        ; '.' - Flag point
    3676/    572E : FE 45                       CP      'E'
    3677/    5730 : 20 15                       Jr      NZ,CONEXP       ; Not 'E' - Scale number
    3678/    5732 : CD 5C 48                    CALL    GETCHR          ; Get next character
    3679/    5735 : CD A3 4D                    CALL    SGNEXP          ; Get sign of exponent
    3680/    5738 :                     
    3681/    5738 : CD 5C 48            EXPLP:  CALL    GETCHR          ; Get next character
    3682/    573B : 38 4B                       Jr      C,EDIGIT        ; Digit - Add to exponent
    3683/    573D : 14                          INC     D               ; Is sign negative?
    3684/    573E : 20 07                       Jr      NZ,CONEXP       ; No - Scale number
    3685/    5740 : AF                          XOR     A
    3686/    5741 : 93                          SUB     E               ; Negate exponent
    3687/    5742 : 5F                          LD      E,A             ; And re-save it
    3688/    5743 : 0C                          INC     C               ; Flag end of number
    3689/    5744 : 0C                  DPOINT: INC     C               ; Flag point passed
    3690/    5745 : 28 DE                       Jr      Z,MANLP         ; Zero - Get another digit
    3691/    5747 : E5                  CONEXP: PUSH    HL              ; Save code string address
    3692/    5748 : 7B                          LD      A,E             ; Get exponent
    3693/    5749 : 90                          SUB     B               ; Subtract digits after point
    3694/    574A : F4 5F 57            SCALMI: CALL    P,SCALPL        ; Positive - Multiply number
    3695/    574D : F2 56 57                    JP      P,ENDCON        ; Positive - All done
    3696/    5750 : F5                          PUSH    AF              ; Save number of times to /10
    3697/    5751 : CD 5F 55                    CALL    DIV10           ; Divide by 10
    3698/    5754 : F1                          POP     AF              ; Restore count
    3699/    5755 : 3C                          INC     A               ; Count divides
    3700/    5756 :                     
    3701/    5756 : 20 F2               ENDCON: Jr      NZ,SCALMI       ; More to do
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 63 - 11/7/2018 12:33:42


    3702/    5758 : D1                          POP     DE              ; Restore code string address
    3703/    5759 : F1                          POP     AF              ; Restore sign of number
    3704/    575A : CC 39 56                    CALL    Z,INVSGN        ; Negative - Negate number
    3705/    575D : EB                          EX      DE,HL           ; Code string address to HL
    3706/    575E : C9                          RET
    3707/    575F :                     
    3708/    575F : C8                  SCALPL: RET     Z               ; Exit if no scaling needed
    3709/    5760 : F5                  MULTEN: PUSH    AF              ; Save count
    3710/    5761 : CD F9 55                    CALL    MLSP10          ; Multiply number by 10
    3711/    5764 : F1                          POP     AF              ; Restore count
    3712/    5765 : 3D                          DEC     A               ; Count multiplies
    3713/    5766 : C9                          RET
    3714/    5767 :                     
    3715/    5767 : D5                  ADDIG:  PUSH    DE              ; Save sign of exponent
    3716/    5768 : 57                          LD      D,A             ; Save digit
    3717/    5769 : 78                          LD      A,B             ; Get digits after point
    3718/    576A : 89                          ADC     A,C             ; Add one if after point
    3719/    576B : 47                          LD      B,A             ; Re-save counter
    3720/    576C : C5                          PUSH    BC              ; Save point flags
    3721/    576D : E5                          PUSH    HL              ; Save code string address
    3722/    576E : D5                          PUSH    DE              ; Save digit
    3723/    576F : CD F9 55                    CALL    MLSP10          ; Multiply number by 10
    3724/    5772 : F1                          POP     AF              ; Restore digit
    3725/    5773 : D6 30                       SUB     '0'             ; Make it absolute
    3726/    5775 : CD 7D 57                    CALL    RSCALE          ; Re-scale number
    3727/    5778 : E1                          POP     HL              ; Restore code string address
    3728/    5779 : C1                          POP     BC              ; Restore point flags
    3729/    577A : D1                          POP     DE              ; Restore sign of exponent
    3730/    577B : 18 A8                       Jr      MANLP           ; Get another digit
    3731/    577D :                     
    3732/    577D : CD 41 56            RSCALE: CALL    STAKFP          ; Put number on stack
    3733/    5780 : CD 22 56                    CALL    FLGREL          ; Digit to add to FPREG
    3734/    5783 : C1                  PADD:   POP     BC              ; Restore number
    3735/    5784 : D1                          POP     DE
    3736/    5785 : C3 E4 53                    JP      FPADD           ; Add BCDE to FPREG and return
    3737/    5788 :                     
    3738/    5788 : 7B                  EDIGIT: LD      A,E             ; Get digit
    3739/    5789 : 07                          RLCA                    ; Times 2
    3740/    578A : 07                          RLCA                    ; Times 4
    3741/    578B : 83                          ADD     A,E             ; Times 5
    3742/    578C : 07                          RLCA                    ; Times 10
    3743/    578D : 86                          ADD     A,(HL)          ; Add next digit
    3744/    578E : D6 30                       SUB     '0'             ; Make it absolute
    3745/    5790 : 5F                          LD      E,A             ; Save new digit
    3746/    5791 : 18 A5                       Jr      EXPLP           ; Look for another digit
    3747/    5793 :                     
    3748/    5793 : E5                  LINEIN: PUSH    HL              ; Save code string address
    3749/    5794 : 21 3F 43                    LD      HL,INMSG        ; Output " in "
    3750/    5797 : CD 25 51                    CALL    PRS             ; Output string at HL
    3751/    579A : E1                          POP     HL              ; Restore code string address
    3752/    579B : EB                  PRNTHL: EX      DE,HL           ; Code string address to DE
    3753/    579C : AF                          XOR     A
    3754/    579D : 06 98                       LD      B,80H+24        ; 24 bits
    3755/    579F : CD 27 56                    CALL    RETINT          ; Return the integer
    3756/    57A2 : 21 24 51                    LD      HL,PRNUMS       ; Print number string
    3757/    57A5 : E5                          PUSH    HL              ; Save for return
    3758/    57A6 : 21 E5 60            NUMASC: LD      HL,PBUFF        ; Convert number to ASCII
    3759/    57A9 : E5                          PUSH    HL              ; Save for return
    3760/    57AA : CD 10 56                    CALL    TSTSGN          ; Test sign of FPREG
    3761/    57AD : 36 20                       LD      (HL),' '        ; Space at start
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 64 - 11/7/2018 12:33:42


    3762/    57AF : F2 B4 57                    JP      P,SPCFST        ; Positive - Space to start
    3763/    57B2 : 36 2D                       LD      (HL),'-'        ; '-' sign at start
    3764/    57B4 : 23                  SPCFST: INC     HL              ; First byte of number
    3765/    57B5 : 36 30                       LD      (HL),'0'        ; '0' if zero
    3766/    57B7 : CA 61 58                    JP      Z,JSTZER        ; Return '0' if zero
    3767/    57BA : E5                          PUSH    HL              ; Save buffer address
    3768/    57BB : FC 39 56                    CALL    M,INVSGN        ; Negate FPREG if negative
    3769/    57BE : AF                          XOR     A               ; Zero A
    3770/    57BF : F5                          PUSH    AF              ; Save it
    3771/    57C0 : CD 67 58                    CALL    RNGTST          ; Test number is in range
    3772/    57C3 : 01 43 91            SIXDIG: LD      BC,9143H        ; BCDE - 99999.9
    3773/    57C6 : 11 F8 4F                    LD      DE,4FF8H
    3774/    57C9 : CD 89 56                    CALL    CMPNUM          ; Compare numbers
    3775/    57CC : B7                          OR      A
    3776/    57CD : E2 E0 57                    JP      PO,INRNG        ; > 99999.9 - Sort it out
    3777/    57D0 : F1                          POP     AF              ; Restore count
    3778/    57D1 : CD 60 57                    CALL    MULTEN          ; Multiply by ten
    3779/    57D4 : F5                          PUSH    AF              ; Re-save count
    3780/    57D5 : 18 EC                       Jr      SIXDIG          ; Test it again
    3781/    57D7 :                     
    3782/    57D7 : CD 5F 55            GTSIXD: CALL    DIV10           ; Divide by 10
    3783/    57DA : F1                          POP     AF              ; Get count
    3784/    57DB : 3C                          INC     A               ; Count divides
    3785/    57DC : F5                          PUSH    AF              ; Re-save count
    3786/    57DD : CD 67 58                    CALL    RNGTST          ; Test number is in range
    3787/    57E0 : CD D3 53            INRNG:  CALL    ROUND           ; Add 0.5 to FPREG
    3788/    57E3 : 3C                          INC     A
    3789/    57E4 : CD B6 56                    CALL    FPINT           ; F.P to integer
    3790/    57E7 : CD 51 56                    CALL    FPBCDE          ; Move BCDE to FPREG
    3791/    57EA : 01 06 03                    LD      BC,0306H        ; 1E+06 to 1E-03 range
    3792/    57ED : F1                          POP     AF              ; Restore count
    3793/    57EE : 81                          ADD     A,C             ; 6 digits before point
    3794/    57EF : 3C                          INC     A               ; Add one
    3795/    57F0 : FA FB 57                    JP      M,MAKNUM        ; Do it in 'E' form if < 1E-02
    3796/    57F3 : FE 08                       CP      6+1+1           ; More than 999999 ?
    3797/    57F5 : 30 04                       Jr      NC,MAKNUM       ; Yes - Do it in 'E' form
    3798/    57F7 : 3C                          INC     A               ; Adjust for exponent
    3799/    57F8 : 47                          LD      B,A             ; Exponent of number
    3800/    57F9 : 3E 02                       LD      A,2             ; Make it zero after
    3801/    57FB :                     
    3802/    57FB : 3D                  MAKNUM: DEC     A               ; Adjust for digits to do
    3803/    57FC : 3D                          DEC     A
    3804/    57FD : E1                          POP     HL              ; Restore buffer address
    3805/    57FE : F5                          PUSH    AF              ; Save count
    3806/    57FF : 11 7A 58                    LD      DE,POWERS       ; Powers of ten
    3807/    5802 : 05                          DEC     B               ; Count digits before point
    3808/    5803 : 20 06                       Jr      NZ,DIGTXT       ; Not zero - Do number
    3809/    5805 : 36 2E                       LD      (HL),'.'        ; Save point
    3810/    5807 : 23                          INC     HL              ; Move on
    3811/    5808 : 36 30                       LD      (HL),'0'        ; Save zero
    3812/    580A : 23                          INC     HL              ; Move on
    3813/    580B : 05                  DIGTXT: DEC     B               ; Count digits before point
    3814/    580C : 36 2E                       LD      (HL),'.'        ; Save point in case
    3815/    580E : CC 66 56                    CALL    Z,INCHL         ; Last digit - move on
    3816/    5811 : C5                          PUSH    BC              ; Save digits before point
    3817/    5812 : E5                          PUSH    HL              ; Save buffer address
    3818/    5813 : D5                          PUSH    DE              ; Save powers of ten
    3819/    5814 : CD 5C 56                    CALL    BCDEFP          ; Move FPREG to BCDE
    3820/    5817 : E1                          POP     HL              ; Powers of ten table
    3821/    5818 : 06 2F                       LD      B, '0'-1        ; ASCII '0' - 1
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 65 - 11/7/2018 12:33:42


    3822/    581A :                     
    3823/    581A : 04                  TRYAGN: INC     B               ; Count subtractions
    3824/    581B : 7B                          LD      A,E             ; Get LSB
    3825/    581C : 96                          SUB     (HL)            ; Subtract LSB
    3826/    581D : 5F                          LD      E,A             ; Save LSB
    3827/    581E : 23                          INC     HL
    3828/    581F : 7A                          LD      A,D             ; Get NMSB
    3829/    5820 : 9E                          SBC     A,(HL)          ; Subtract NMSB
    3830/    5821 : 57                          LD      D,A             ; Save NMSB
    3831/    5822 : 23                          INC     HL
    3832/    5823 : 79                          LD      A,C             ; Get MSB
    3833/    5824 : 9E                          SBC     A,(HL)          ; Subtract MSB
    3834/    5825 : 4F                          LD      C,A             ; Save MSB
    3835/    5826 : 2B                          DEC     HL              ; Point back to start
    3836/    5827 : 2B                          DEC     HL
    3837/    5828 : 30 F0                       Jr      NC,TRYAGN       ; No overflow - Try again
    3838/    582A : CD 82 54                    CALL    PLUCDE          ; Restore number
    3839/    582D : 23                          INC     HL              ; Start of next number
    3840/    582E : CD 51 56                    CALL    FPBCDE          ; Move BCDE to FPREG
    3841/    5831 : EB                          EX      DE,HL           ; Save point in table
    3842/    5832 : E1                          POP     HL              ; Restore buffer address
    3843/    5833 : 70                          LD      (HL),B          ; Save digit in buffer
    3844/    5834 : 23                          INC     HL              ; And move on
    3845/    5835 : C1                          POP     BC              ; Restore digit count
    3846/    5836 : 0D                          DEC     C               ; Count digits
    3847/    5837 : 20 D2                       Jr      NZ,DIGTXT       ; More - Do them
    3848/    5839 : 05                          DEC     B               ; Any decimal part?
    3849/    583A : 28 0B                       Jr      Z,DOEBIT        ; No - Do 'E' bit
    3850/    583C : 2B                  SUPTLZ: DEC     HL              ; Move back through buffer
    3851/    583D : 7E                          LD      A,(HL)          ; Get character
    3852/    583E : FE 30                       CP      '0'             ; '0' character?
    3853/    5840 : 28 FA                       Jr      Z,SUPTLZ        ; Yes - Look back for more
    3854/    5842 : FE 2E                       CP      '.'             ; A decimal point?
    3855/    5844 : C4 66 56                    CALL    NZ,INCHL        ; Move back over digit
    3856/    5847 :                     
    3857/    5847 : F1                  DOEBIT: POP     AF              ; Get 'E' flag
    3858/    5848 : 28 1A                       Jr      Z,NOENED        ; No 'E' needed - End buffer
    3859/    584A : 36 45                       LD      (HL),'E'        ; Put 'E' in buffer
    3860/    584C : 23                          INC     HL              ; And move on
    3861/    584D : 36 2B                       LD      (HL),'+'        ; Put '+' in buffer
    3862/    584F : F2 56 58                    JP      P,OUTEXP        ; Positive - Output exponent
    3863/    5852 : 36 2D                       LD      (HL),'-'        ; Put '-' in buffer
    3864/    5854 : 2F                          CPL                     ; Negate exponent
    3865/    5855 : 3C                          INC     A
    3866/    5856 : 06 2F               OUTEXP: LD      B,'0'-1         ; ASCII '0' - 1
    3867/    5858 : 04                  EXPTEN: INC     B               ; Count subtractions
    3868/    5859 : D6 0A                       SUB     10              ; Tens digit
    3869/    585B : 30 FB                       Jr      NC,EXPTEN       ; More to do
    3870/    585D : C6 3A                       ADD     A,'0'+10        ; Restore and make ASCII
    3871/    585F : 23                          INC     HL              ; Move on
    3872/    5860 : 70                          LD      (HL),B          ; Save MSB of exponent
    3873/    5861 : 23                  JSTZER: INC     HL              ;
    3874/    5862 : 77                          LD      (HL),A          ; Save LSB of exponent
    3875/    5863 : 23                          INC     HL
    3876/    5864 : 71                  NOENED: LD      (HL),C          ; Mark end of buffer
    3877/    5865 : E1                          POP     HL              ; Restore code string address
    3878/    5866 : C9                          RET
    3879/    5867 :                     
    3880/    5867 : 01 74 94            RNGTST: LD      BC,9474H        ; BCDE = 999999.
    3881/    586A : 11 F7 23                    LD      DE,23F7H
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 66 - 11/7/2018 12:33:42


    3882/    586D : CD 89 56                    CALL    CMPNUM          ; Compare numbers
    3883/    5870 : B7                          OR      A
    3884/    5871 : E1                          POP     HL              ; Return address to HL
    3885/    5872 : E2 D7 57                    JP      PO,GTSIXD       ; Too big - Divide by ten
    3886/    5875 : E9                          JP      (HL)            ; Otherwise return to caller
    3887/    5876 :                     
    3888/    5876 : 00 00 00 80         HALF:   DB      00H,00H,00H,80H ; 0.5
    3889/    587A :                     
    3890/    587A : A0 86 01            POWERS: DB      0A0H,086H,001H  ; 100000
    3891/    587D : 10 27 00                    DB      010H,027H,000H  ;  10000
    3892/    5880 : E8 03 00                    DB      0E8H,003H,000H  ;   1000
    3893/    5883 : 64 00 00                    DB      064H,000H,000H  ;    100
    3894/    5886 : 0A 00 00                    DB      00AH,000H,000H  ;     10
    3895/    5889 : 01 00 00                    DB      001H,000H,000H  ;      1
    3896/    588C :                     
    3897/    588C : 21 39 56            NEGAFT: LD  HL,INVSGN           ; Negate result
    3898/    588F : E3                          EX      (SP),HL         ; To be done after caller
    3899/    5890 : E9                          JP      (HL)            ; Return to caller
    3900/    5891 :                     
    3901/    5891 : CD 41 56            SQR:    CALL    STAKFP          ; Put value on stack
    3902/    5894 : 21 76 58                    LD      HL,HALF         ; Set power to 1/2
    3903/    5897 : CD 4E 56                    CALL    PHLTFP          ; Move 1/2 to FPREG
    3904/    589A :                     
    3905/    589A : C1                  POWER:  POP     BC              ; Get base
    3906/    589B : D1                          POP     DE
    3907/    589C : CD 10 56                    CALL    TSTSGN          ; Test sign of power
    3908/    589F : 78                          LD      A,B             ; Get exponent of base
    3909/    58A0 : CA DF 58                    JP      Z,EXP           ; Make result 1 if zero
    3910/    58A3 : F2 AA 58                    JP      P,POWER1        ; Positive base - Ok
    3911/    58A6 : B7                          OR      A               ; Zero to negative power?
    3912/    58A7 : CA 73 43                    JP      Z,DZERR         ; Yes - ?/0 Error
    3913/    58AA : B7                  POWER1: OR      A               ; Base zero?
    3914/    58AB : CA 48 54                    JP      Z,SAVEXP        ; Yes - Return zero
    3915/    58AE : D5                          PUSH    DE              ; Save base
    3916/    58AF : C5                          PUSH    BC
    3917/    58B0 : 79                          LD      A,C             ; Get MSB of base
    3918/    58B1 : F6 7F                       OR      01111111B       ; Get sign status
    3919/    58B3 : CD 5C 56                    CALL    BCDEFP          ; Move power to BCDE
    3920/    58B6 : F2 C7 58                    JP      P,POWER2        ; Positive base - Ok
    3921/    58B9 : D5                          PUSH    DE              ; Save power
    3922/    58BA : C5                          PUSH    BC
    3923/    58BB : CD E1 56                    CALL    INT             ; Get integer of power
    3924/    58BE : C1                          POP     BC              ; Restore power
    3925/    58BF : D1                          POP     DE
    3926/    58C0 : F5                          PUSH    AF              ; MSB of base
    3927/    58C1 : CD 89 56                    CALL    CMPNUM          ; Power an integer?
    3928/    58C4 : E1                          POP     HL              ; Restore MSB of base
    3929/    58C5 : 7C                          LD      A,H             ; but don't affect flags
    3930/    58C6 : 1F                          RRA                     ; Exponent odd or even?
    3931/    58C7 : E1                  POWER2: POP     HL              ; Restore MSB and exponent
    3932/    58C8 : 22 E2 60                    LD      (FPREG+2),HL    ; Save base in FPREG
    3933/    58CB : E1                          POP     HL              ; LSBs of base
    3934/    58CC : 22 E0 60                    LD      (FPREG),HL      ; Save in FPREG
    3935/    58CF : DC 8C 58                    CALL    C,NEGAFT        ; Odd power - Negate result
    3936/    58D2 : CC 39 56                    CALL    Z,INVSGN        ; Negative base - Negate it
    3937/    58D5 : D5                          PUSH    DE              ; Save power
    3938/    58D6 : C5                          PUSH    BC
    3939/    58D7 : CD D1 54                    CALL    LOG             ; Get LOG of base
    3940/    58DA : C1                          POP     BC              ; Restore power
    3941/    58DB : D1                          POP     DE
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 67 - 11/7/2018 12:33:42


    3942/    58DC : CD 12 55                    CALL    FPMULT          ; Multiply LOG by power
    3943/    58DF :                     
    3944/    58DF : CD 41 56            EXP:    CALL    STAKFP          ; Put value on stack
    3945/    58E2 : 01 38 81                    LD      BC,08138H       ; BCDE = 1/Ln(2)
    3946/    58E5 : 11 3B AA                    LD      DE,0AA3BH
    3947/    58E8 : CD 12 55                    CALL    FPMULT          ; Multiply value by 1/LN(2)
    3948/    58EB : 3A E3 60                    LD      A,(FPEXP)       ; Get exponent
    3949/    58EE : FE 88                       CP      80H+8           ; Is it in range?
    3950/    58F0 : D2 EC 55                    JP      NC,OVTST1       ; No - Test for overflow
    3951/    58F3 : CD E1 56                    CALL    INT             ; Get INT of FPREG
    3952/    58F6 : C6 80                       ADD     A,80H           ; For excess 128
    3953/    58F8 : C6 02                       ADD     A,2             ; Exponent > 126?
    3954/    58FA : DA EC 55                    JP      C,OVTST1        ; Yes - Test for overflow
    3955/    58FD : F5                          PUSH    AF              ; Save scaling factor
    3956/    58FE : 21 C0 54                    LD      HL,UNITY        ; Point to 1.
    3957/    5901 : CD D6 53                    CALL    ADDPHL          ; Add 1 to FPREG
    3958/    5904 : CD 09 55                    CALL    MULLN2          ; Multiply by LN(2)
    3959/    5907 : F1                          POP     AF              ; Restore scaling factor
    3960/    5908 : C1                          POP     BC              ; Restore exponent
    3961/    5909 : D1                          POP     DE
    3962/    590A : F5                          PUSH    AF              ; Save scaling factor
    3963/    590B : CD E1 53                    CALL    SUBCDE          ; Subtract exponent from FPREG
    3964/    590E : CD 39 56                    CALL    INVSGN          ; Negate result
    3965/    5911 : 21 1F 59                    LD      HL,EXPTAB       ; Coefficient table
    3966/    5914 : CD 4F 59                    CALL    SMSER1          ; Sum the series
    3967/    5917 : 11 00 00                    LD      DE,0            ; Zero LSBs
    3968/    591A : C1                          POP     BC              ; Scaling factor
    3969/    591B : 4A                          LD      C,D             ; Zero MSB
    3970/    591C : C3 12 55                    JP      FPMULT          ; Scale result to correct value
    3971/    591F :                     
    3972/    591F : 08                  EXPTAB: DB      8                       ; Table used by EXP
    3973/    5920 : 40 2E 94 74                 DB      040H,02EH,094H,074H     ; -1/7! (-1/5040)
    3974/    5924 : 70 4F 2E 77                 DB      070H,04FH,02EH,077H     ;  1/6! ( 1/720)
    3975/    5928 : 6E 02 88 7A                 DB      06EH,002H,088H,07AH     ; -1/5! (-1/120)
    3976/    592C : E6 A0 2A 7C                 DB      0E6H,0A0H,02AH,07CH     ;  1/4! ( 1/24)
    3977/    5930 : 50 AA AA 7E                 DB      050H,0AAH,0AAH,07EH     ; -1/3! (-1/6)
    3978/    5934 : FF FF 7F 7F                 DB      0FFH,0FFH,07FH,07FH     ;  1/2! ( 1/2)
    3979/    5938 : 00 00 80 81                 DB      000H,000H,080H,081H     ; -1/1! (-1/1)
    3980/    593C : 00 00 00 81                 DB      000H,000H,000H,081H     ;  1/0! ( 1/1)
    3981/    5940 :                     
    3982/    5940 : CD 41 56            SUMSER: CALL    STAKFP          ; Put FPREG on stack
    3983/    5943 : 11 10 55                    LD      DE,MULT         ; Multiply by "X"
    3984/    5946 : D5                          PUSH    DE              ; To be done after
    3985/    5947 : E5                          PUSH    HL              ; Save address of table
    3986/    5948 : CD 5C 56                    CALL    BCDEFP          ; Move FPREG to BCDE
    3987/    594B : CD 12 55                    CALL    FPMULT          ; Square the value
    3988/    594E : E1                          POP     HL              ; Restore address of table
    3989/    594F : CD 41 56            SMSER1: CALL    STAKFP          ; Put value on stack
    3990/    5952 : 7E                          LD      A,(HL)          ; Get number of coefficients
    3991/    5953 : 23                          INC     HL              ; Point to start of table
    3992/    5954 : CD 4E 56                    CALL    PHLTFP          ; Move coefficient to FPREG
    3993/    5957 : 06                          DB      06H             ; Skip "POP AF"
    3994/    5958 : F1                  SUMLP:  POP     AF              ; Restore count
    3995/    5959 : C1                          POP     BC              ; Restore number
    3996/    595A : D1                          POP     DE
    3997/    595B : 3D                          DEC     A               ; Cont coefficients
    3998/    595C : C8                          RET     Z               ; All done
    3999/    595D : D5                          PUSH    DE              ; Save number
    4000/    595E : C5                          PUSH    BC
    4001/    595F : F5                          PUSH    AF              ; Save count
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 68 - 11/7/2018 12:33:42


    4002/    5960 : E5                          PUSH    HL              ; Save address in table
    4003/    5961 : CD 12 55                    CALL    FPMULT          ; Multiply FPREG by BCDE
    4004/    5964 : E1                          POP     HL              ; Restore address in table
    4005/    5965 : CD 5F 56                    CALL    LOADFP          ; Number at HL to BCDE
    4006/    5968 : E5                          PUSH    HL              ; Save address in table
    4007/    5969 : CD E4 53                    CALL    FPADD           ; Add coefficient to FPREG
    4008/    596C : E1                          POP     HL              ; Restore address in table
    4009/    596D : 18 E9                       Jr      SUMLP           ; More coefficients
    4010/    596F :                     
    4011/    596F : CD 10 56            RND:    CALL    TSTSGN          ; Test sign of FPREG
    4012/    5972 : 21 1B 60                    LD      HL,SEED+2       ; Random number seed
    4013/    5975 : FA CF 59                    JP      M,RESEED        ; Negative - Re-seed
    4014/    5978 : 21 3C 60                    LD      HL,LSTRND       ; Last random number
    4015/    597B : CD 4E 56                    CALL    PHLTFP          ; Move last RND to FPREG
    4016/    597E : 21 1B 60                    LD      HL,SEED+2       ; Random number seed
    4017/    5981 : C8                          RET     Z               ; Return if RND(0)
    4018/    5982 : 86                          ADD     A,(HL)          ; Add (SEED)+2)
    4019/    5983 : E6 07                       AND     00000111B       ; 0 to 7
    4020/    5985 : 06 00                       LD      B,0
    4021/    5987 : 77                          LD      (HL),A          ; Re-save seed
    4022/    5988 : 23                          INC     HL              ; Move to coefficient table
    4023/    5989 : 87                          ADD     A,A             ; 4 bytes
    4024/    598A : 87                          ADD     A,A             ; per entry
    4025/    598B : 4F                          LD      C,A             ; BC = Offset into table
    4026/    598C : 09                          ADD     HL,BC           ; Point to coefficient
    4027/    598D : CD 5F 56                    CALL    LOADFP          ; Coefficient to BCDE
    4028/    5990 : CD 12 55                    CALL    FPMULT  ;       ; Multiply FPREG by coefficient
    4029/    5993 : 3A 1A 60                    LD      A,(SEED+1)      ; Get (SEED+1)
    4030/    5996 : 3C                          INC     A               ; Add 1
    4031/    5997 : E6 03                       AND     00000011B       ; 0 to 3
    4032/    5999 : 06 00                       LD      B,0
    4033/    599B : FE 01                       CP      1               ; Is it zero?
    4034/    599D : 88                          ADC     A,B             ; Yes - Make it 1
    4035/    599E : 32 1A 60                    LD      (SEED+1),A      ; Re-save seed
    4036/    59A1 : 21 D2 59                    LD      HL,RNDTAB-4     ; Addition table
    4037/    59A4 : 87                          ADD     A,A             ; 4 bytes
    4038/    59A5 : 87                          ADD     A,A             ; per entry
    4039/    59A6 : 4F                          LD      C,A             ; BC = Offset into table
    4040/    59A7 : 09                          ADD     HL,BC           ; Point to value
    4041/    59A8 : CD D6 53                    CALL    ADDPHL          ; Add value to FPREG
    4042/    59AB : CD 5C 56            RND1:   CALL    BCDEFP          ; Move FPREG to BCDE
    4043/    59AE : 7B                          LD      A,E             ; Get LSB
    4044/    59AF : 59                          LD      E,C             ; LSB = MSB
    4045/    59B0 : EE 4F                       XOR     01001111B       ; Fiddle around
    4046/    59B2 : 4F                          LD      C,A             ; New MSB
    4047/    59B3 : 36 80                       LD      (HL),80H        ; Set exponent
    4048/    59B5 : 2B                          DEC     HL              ; Point to MSB
    4049/    59B6 : 46                          LD      B,(HL)          ; Get MSB
    4050/    59B7 : 36 80                       LD      (HL),80H        ; Make value -0.5
    4051/    59B9 : 21 19 60                    LD      HL,SEED         ; Random number seed
    4052/    59BC : 34                          INC     (HL)            ; Count seed
    4053/    59BD : 7E                          LD      A,(HL)          ; Get seed
    4054/    59BE : D6 AB                       SUB     171             ; Do it modulo 171
    4055/    59C0 : 20 04                       Jr      NZ,RND2         ; Non-zero - Ok
    4056/    59C2 : 77                          LD      (HL),A          ; Zero seed
    4057/    59C3 : 0C                          INC     C               ; Fillde about
    4058/    59C4 : 15                          DEC     D               ; with the
    4059/    59C5 : 1C                          INC     E               ; number
    4060/    59C6 : CD 34 54            RND2:   CALL    BNORM           ; Normalise number
    4061/    59C9 : 21 3C 60                    LD      HL,LSTRND       ; Save random number
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 69 - 11/7/2018 12:33:42


    4062/    59CC : C3 68 56                    JP      FPTHL           ; Move FPREG to last and return
    4063/    59CF :                     
    4064/    59CF : 77                  RESEED: LD      (HL),A          ; Re-seed random numbers
    4065/    59D0 : 2B                          DEC     HL
    4066/    59D1 : 77                          LD      (HL),A
    4067/    59D2 : 2B                          DEC     HL
    4068/    59D3 : 77                          LD      (HL),A
    4069/    59D4 : 18 D5                       Jr      RND1            ; Return RND seed
    4070/    59D6 :                     
    4071/    59D6 : 68 B1 46 68         RNDTAB: DB   068H,0B1H,046H,068H     ; Table used by RND
    4072/    59DA : 99 E9 92 69                 DB   099H,0E9H,092H,069H
    4073/    59DE : 10 D1 75 68                 DB   010H,0D1H,075H,068H
    4074/    59E2 :                     
    4075/    59E2 : 21 2C 5A            COS:    LD      HL,HALFPI       ; Point to PI/2
    4076/    59E5 : CD D6 53                    CALL    ADDPHL          ; Add it to PPREG
    4077/    59E8 : CD 41 56            SIN:    CALL    STAKFP          ; Put angle on stack
    4078/    59EB : 01 49 83                    LD      BC,8349H        ; BCDE = 2 PI
    4079/    59EE : 11 DB 0F                    LD      DE,0FDBH
    4080/    59F1 : CD 51 56                    CALL    FPBCDE          ; Move 2 PI to FPREG
    4081/    59F4 : C1                          POP     BC              ; Restore angle
    4082/    59F5 : D1                          POP     DE
    4083/    59F6 : CD 6D 55                    CALL    DVBCDE          ; Divide angle by 2 PI
    4084/    59F9 : CD 41 56                    CALL    STAKFP          ; Put it on stack
    4085/    59FC : CD E1 56                    CALL    INT             ; Get INT of result
    4086/    59FF : C1                          POP     BC              ; Restore number
    4087/    5A00 : D1                          POP     DE
    4088/    5A01 : CD E1 53                    CALL    SUBCDE          ; Make it 0 <= value < 1
    4089/    5A04 : 21 30 5A                    LD      HL,QUARTR       ; Point to 0.25
    4090/    5A07 : CD DB 53                    CALL    SUBPHL          ; Subtract value from 0.25
    4091/    5A0A : CD 10 56                    CALL    TSTSGN          ; Test sign of value
    4092/    5A0D : 37                          SCF                     ; Flag positive
    4093/    5A0E : F2 18 5A                    JP      P,SIN1          ; Positive - Ok
    4094/    5A11 : CD D3 53                    CALL    ROUND           ; Add 0.5 to value
    4095/    5A14 : CD 10 56                    CALL    TSTSGN          ; Test sign of value
    4096/    5A17 : B7                          OR      A               ; Flag negative
    4097/    5A18 : F5                  SIN1:   PUSH    AF              ; Save sign
    4098/    5A19 : F4 39 56                    CALL    P,INVSGN        ; Negate value if positive
    4099/    5A1C : 21 30 5A                    LD      HL,QUARTR       ; Point to 0.25
    4100/    5A1F : CD D6 53                    CALL    ADDPHL          ; Add 0.25 to value
    4101/    5A22 : F1                          POP     AF              ; Restore sign
    4102/    5A23 : D4 39 56                    CALL    NC,INVSGN       ; Negative - Make positive
    4103/    5A26 : 21 34 5A                    LD      HL,SINTAB       ; Coefficient table
    4104/    5A29 : C3 40 59                    JP      SUMSER          ; Evaluate sum of series
    4105/    5A2C :                     
    4106/    5A2C : DB 0F 49 81         HALFPI: DB   0DBH,00FH,049H,081H     ; 1.5708 (PI/2)
    4107/    5A30 :                     
    4108/    5A30 : 00 00 00 7F         QUARTR: DB   000H,000H,000H,07FH     ; 0.25
    4109/    5A34 :                     
    4110/    5A34 : 05                  SINTAB: DB   5                       ; Table used by SIN
    4111/    5A35 : BA D7 1E 86                 DB   0BAH,0D7H,01EH,086H     ; 39.711
    4112/    5A39 : 64 26 99 87                 DB   064H,026H,099H,087H     ;-76.575
    4113/    5A3D : 58 34 23 87                 DB   058H,034H,023H,087H     ; 81.602
    4114/    5A41 : E0 5D A5 86                 DB   0E0H,05DH,0A5H,086H     ;-41.342
    4115/    5A45 : DA 0F 49 83                 DB   0DAH,00FH,049H,083H     ;  6.2832
    4116/    5A49 :                     
    4117/    5A49 : CD 41 56            TAN:    CALL    STAKFP          ; Put angle on stack
    4118/    5A4C : CD E8 59                    CALL    SIN             ; Get SIN of angle
    4119/    5A4F : C1                          POP     BC              ; Restore angle
    4120/    5A50 : E1                          POP     HL
    4121/    5A51 : CD 41 56                    CALL    STAKFP          ; Save SIN of angle
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 70 - 11/7/2018 12:33:42


    4122/    5A54 : EB                          EX      DE,HL           ; BCDE = Angle
    4123/    5A55 : CD 51 56                    CALL    FPBCDE          ; Angle to FPREG
    4124/    5A58 : CD E2 59                    CALL    COS             ; Get COS of angle
    4125/    5A5B : C3 6B 55                    JP      DIV             ; TAN = SIN / COS
    4126/    5A5E :                     
    4127/    5A5E : CD 10 56            ATN:    CALL    TSTSGN          ; Test sign of value
    4128/    5A61 : FC 8C 58                    CALL    M,NEGAFT        ; Negate result after if -ve
    4129/    5A64 : FC 39 56                    CALL    M,INVSGN        ; Negate value if -ve
    4130/    5A67 : 3A E3 60                    LD      A,(FPEXP)       ; Get exponent
    4131/    5A6A : FE 81                       CP      81H             ; Number less than 1?
    4132/    5A6C : DA 7B 5A                    JP      C,ATN1          ; Yes - Get arc tangnt
    4133/    5A6F : 01 00 81                    LD      BC,8100H        ; BCDE = 1
    4134/    5A72 : 51                          LD      D,C
    4135/    5A73 : 59                          LD      E,C
    4136/    5A74 : CD 6D 55                    CALL    DVBCDE          ; Get reciprocal of number
    4137/    5A77 : 21 DB 53                    LD      HL,SUBPHL       ; Sub angle from PI/2
    4138/    5A7A : E5                          PUSH    HL              ; Save for angle > 1
    4139/    5A7B : 21 85 5A            ATN1:   LD      HL,ATNTAB       ; Coefficient table
    4140/    5A7E : CD 40 59                    CALL    SUMSER          ; Evaluate sum of series
    4141/    5A81 : 21 2C 5A                    LD      HL,HALFPI       ; PI/2 - angle in case > 1
    4142/    5A84 : C9                          RET                     ; Number > 1 - Sub from PI/2
    4143/    5A85 :                     
    4144/    5A85 : 09                  ATNTAB: DB   9                       ; Table used by ATN
    4145/    5A86 : 4A D7 3B 78                 DB   04AH,0D7H,03BH,078H     ; 1/17
    4146/    5A8A : 02 6E 84 7B                 DB   002H,06EH,084H,07BH     ;-1/15
    4147/    5A8E : FE C1 2F 7C                 DB   0FEH,0C1H,02FH,07CH     ; 1/13
    4148/    5A92 : 74 31 9A 7D                 DB   074H,031H,09AH,07DH     ;-1/11
    4149/    5A96 : 84 3D 5A 7D                 DB   084H,03DH,05AH,07DH     ; 1/9
    4150/    5A9A : C8 7F 91 7E                 DB   0C8H,07FH,091H,07EH     ;-1/7
    4151/    5A9E : E4 BB 4C 7E                 DB   0E4H,0BBH,04CH,07EH     ; 1/5
    4152/    5AA2 : 6C AA AA 7F                 DB   06CH,0AAH,0AAH,07FH     ;-1/3
    4153/    5AA6 : 00 00 00 81                 DB   000H,000H,000H,081H     ; 1/1
    4154/    5AAA :                     
    4155/    5AAA :                     ;---
    4156/    5AAA : CD BE 5A            PCALL:	call	sub_5ABE
    4157/    5AAD : 28 06               	jr	z, loc_5AB5
    4158/    5AAF : CD 7E 4C            	call	GETNUM
    4159/    5AB2 : CD DC 48            	call	DEINT
    4160/    5AB5 :                     loc_5AB5:
    4161/    5AB5 : E5                  	push	hl
    4162/    5AB6 : 21 BC 5A            	ld	hl, loc_5ABC
    4163/    5AB9 : E5                  	push	hl
    4164/    5ABA : EB                  	ex	de, hl
    4165/    5ABB : E9                  	jp	(hl)
    4166/    5ABC :                     
    4167/    5ABC :                     loc_5ABC:
    4168/    5ABC : E1                  	pop	hl
    4169/    5ABD : C9                  	ret
    4170/    5ABE :                     
    4171/    5ABE :                     sub_5ABE:
    4172/    5ABE : FE AE               	cp	0AEh ; ''
    4173/    5AC0 : C0                  	ret	nz
    4174/    5AC1 : 11 00 00            	ld	de, 0
    4175/    5AC4 :                     loc_5AC4:
    4176/    5AC4 : CD 5C 48            	call	GETCHR
    4177/    5AC7 : C8                  	ret	z
    4178/    5AC8 : 38 0B               	jr	c, loc_5AD5
    4179/    5ACA : FE 94               	cp	94h ; ''
    4180/    5ACC : 28 16               	jr	z, loc_5AE4
    4181/    5ACE : FE 47               	cp	47h ; 'G'
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 71 - 11/7/2018 12:33:42


    4182/    5AD0 : D2 70 43            	jp	nc, SNERR
    4183/    5AD3 : D6 07               	sub	7
    4184/    5AD5 :                     loc_5AD5:
    4185/    5AD5 : D6 30               	sub	'0'
    4186/    5AD7 : DA 70 43            	jp	c, SNERR
    4187/    5ADA : EB                  	ex	de, hl
    4188/    5ADB : 29                  	add	hl, hl
    4189/    5ADC : 29                  	add	hl, hl
    4190/    5ADD : 29                  	add	hl, hl
    4191/    5ADE : 29                  	add	hl, hl
    4192/    5ADF : B5                  	or	l
    4193/    5AE0 : 6F                  	ld	l, a
    4194/    5AE1 : EB                  	ex	de, hl
    4195/    5AE2 : 18 E0               	jr	loc_5AC4
    4196/    5AE4 :                     loc_5AE4:
    4197/    5AE4 : 7B                  	ld	a, e
    4198/    5AE5 : 87                  	add	a, a
    4199/    5AE6 : 87                  	add	a, a
    4200/    5AE7 : 87                  	add	a, a
    4201/    5AE8 : 87                  	add	a, a
    4202/    5AE9 : F6 0D               	or	0Dh
    4203/    5AEB : 57                  	ld	d, a
    4204/    5AEC : 1E EF               	ld	e, 0EFh	; ''
    4205/    5AEE : 18 D4               	jr	loc_5AC4
    4206/    5AF0 :                     
    4207/    5AF0 :                     
    4208/    5AF0 : E5                  RENUM:	push	hl
    4209/    5AF1 : 21 0A 00            	ld	hl, 10
    4210/    5AF4 : 22 54 60            	ld	(unk_6054), hl
    4211/    5AF7 : 2A 5A 60            	ld	hl, (BASTXT)
    4212/    5AFA : E5                  	push	hl
    4213/    5AFB : 23                  	inc	hl
    4214/    5AFC : 23                  	inc	hl
    4215/    5AFD : 7E                  	ld	a, (hl)
    4216/    5AFE : 23                  	inc	hl
    4217/    5AFF : 66                  	ld	h, (hl)
    4218/    5B00 : 6F                  	ld	l, a
    4219/    5B01 : 22 4E 60            	ld	(unk_604E), hl
    4220/    5B04 : 22 52 60            	ld	(unk_6052), hl
    4221/    5B07 : 08                  	ex	af, af'	;'
    4222/    5B08 : ED 5B D2 60         	ld	de, (PROGND)
    4223/    5B0C : 1B                  	dec	de
    4224/    5B0D : 1B                  	dec	de
    4225/    5B0E :                     loc_5B0E:
    4226/    5B0E : E1                  	pop	hl
    4227/    5B0F : E5                  	push	hl
    4228/    5B10 : 7E                  	ld	a, (hl)
    4229/    5B11 : 23                  	inc	hl
    4230/    5B12 : 66                  	ld	h, (hl)
    4231/    5B13 : 6F                  	ld	l, a
    4232/    5B14 : CD 75 46            	call	CPDEHL
    4233/    5B17 : E3                  	ex	(sp), hl
    4234/    5B18 : 20 F4               	jr	nz, loc_5B0E
    4235/    5B1A : D1                  	pop	de
    4236/    5B1B : 23                  	inc	hl
    4237/    5B1C : 23                  	inc	hl
    4238/    5B1D : 7E                  	ld	a, (hl)
    4239/    5B1E : 23                  	inc	hl
    4240/    5B1F : 66                  	ld	h, (hl)
    4241/    5B20 : 6F                  	ld	l, a
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 72 - 11/7/2018 12:33:42


    4242/    5B21 : 22 50 60            	ld	(unk_6050), hl
    4243/    5B24 : 3E 04               	ld	a, 4
    4244/    5B26 : 08                  	ex	af, af'	;'
    4245/    5B27 : 21 4E 60            	ld	hl, unk_604E
    4246/    5B2A : E3                  	ex	(sp), hl
    4247/    5B2B :                     loc_5B2B:
    4248/    5B2B : 28 21               	jr	z, loc_5B4E
    4249/    5B2D : CD F6 48            	call	ATOH
    4250/    5B30 : F5                  	push	af
    4251/    5B31 : 7A                  	ld	a, d
    4252/    5B32 : B3                  	or	e
    4253/    5B33 :                     loc_5B33:
    4254/    5B33 : CA F1 48            	jp	z, FCERR
    4255/    5B36 : F1                  	pop	af
    4256/    5B37 : E3                  	ex	(sp), hl
    4257/    5B38 : 73                  	ld	(hl), e
    4258/    5B39 : 23                  	inc	hl
    4259/    5B3A : 72                  	ld	(hl), d
    4260/    5B3B : 23                  	inc	hl
    4261/    5B3C : 28 10               	jr	z, loc_5B4E
    4262/    5B3E : 08                  	ex	af, af'	;'
    4263/    5B3F : 3D                  	dec	a
    4264/    5B40 : 28 08               	jr	z, loc_5B4A
    4265/    5B42 : 08                  	ex	af, af'	;'
    4266/    5B43 : E3                  	ex	(sp), hl
    4267/    5B44 : CD 7B 46            	call	CHKSYN
    4268/    5B47 : 2C                  	db ','
    4269/    5B48 : 18 E1               	jr	loc_5B2B
    4270/    5B4A :                     loc_5B4A:
    4271/    5B4A : 08                  	ex	af, af'	;'
    4272/    5B4B : C2 70 43            	jp	nz, SNERR
    4273/    5B4E :                     loc_5B4E:
    4274/    5B4E : 2A 50 60            	ld	hl, (unk_6050)
    4275/    5B51 : ED 5B 4E 60         	ld	de, (unk_604E)
    4276/    5B55 : CD 75 46            	call	CPDEHL
    4277/    5B58 :                     loc_5B58:
    4278/    5B58 : DA F1 48            	jp	c, FCERR
    4279/    5B5B : 2A 5A 60            	ld	hl, (BASTXT)
    4280/    5B5E :                     loc_5B5E:
    4281/    5B5E : CD B3 44            	call	SRCHLP
    4282/    5B61 : 38 04               	jr	c, loc_5B67
    4283/    5B63 : 28 CE               	jr	z, loc_5B33
    4284/    5B65 : 18 F7               	jr	loc_5B5E
    4285/    5B67 :                     loc_5B67:
    4286/    5B67 : E1                  	pop	hl
    4287/    5B68 : C5                  	push	bc
    4288/    5B69 : ED 5B 50 60         	ld	de, (unk_6050)
    4289/    5B6D : 21 00 00            	ld	hl, 0
    4290/    5B70 : 22 50 60            	ld	(unk_6050), hl
    4291/    5B73 :                     loc_5B73:
    4292/    5B73 : 60                  	ld	h, b
    4293/    5B74 : 69                  	ld	l, c
    4294/    5B75 : 4E                  	ld	c, (hl)
    4295/    5B76 : 23                  	inc	hl
    4296/    5B77 : 46                  	ld	b, (hl)
    4297/    5B78 : 78                  	ld	a, b
    4298/    5B79 : B1                  	or	c
    4299/    5B7A : 28 B7               	jr	z, loc_5B33
    4300/    5B7C : 23                  	inc	hl
    4301/    5B7D : 7E                  	ld	a, (hl)
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 73 - 11/7/2018 12:33:42


    4302/    5B7E : 23                  	inc	hl
    4303/    5B7F : 66                  	ld	h, (hl)
    4304/    5B80 : 6F                  	ld	l, a
    4305/    5B81 : CD 75 46            	call	CPDEHL
    4306/    5B84 : 2A 50 60            	ld	hl, (unk_6050)
    4307/    5B87 : 23                  	inc	hl
    4308/    5B88 : 22 50 60            	ld	(unk_6050), hl
    4309/    5B8B : 20 E6               	jr	nz, loc_5B73
    4310/    5B8D : 23                  	inc	hl
    4311/    5B8E : 23                  	inc	hl
    4312/    5B8F : 29                  	add	hl, hl
    4313/    5B90 : 23                  	inc	hl
    4314/    5B91 : ED 5B D2 60         	ld	de, (PROGND)
    4315/    5B95 : 19                  	add	hl, de
    4316/    5B96 : 38 C0               	jr	c, loc_5B58
    4317/    5B98 : CD 58 43            	call	ENFMEM
    4318/    5B9B : 22 D2 60            	ld	(PROGND), hl
    4319/    5B9E : AF                  	xor	a
    4320/    5B9F : 2B                  	dec	hl
    4321/    5BA0 : 77                  	ld	(hl), a
    4322/    5BA1 : 2B                  	dec	hl
    4323/    5BA2 : 77                  	ld	(hl), a
    4324/    5BA3 : 1B                  	dec	de
    4325/    5BA4 : 1B                  	dec	de
    4326/    5BA5 : EB                  	ex	de, hl
    4327/    5BA6 : 73                  	ld	(hl), e
    4328/    5BA7 : 23                  	inc	hl
    4329/    5BA8 : 72                  	ld	(hl), d
    4330/    5BA9 : 23                  	inc	hl
    4331/    5BAA : 3D                  	dec	a
    4332/    5BAB : 77                  	ld	(hl), a
    4333/    5BAC : 23                  	inc	hl
    4334/    5BAD : 77                  	ld	(hl), a
    4335/    5BAE : 23                  	inc	hl
    4336/    5BAF : EB                  	ex	de, hl
    4337/    5BB0 : 2A 52 60            	ld	hl, (unk_6052)
    4338/    5BB3 : 22 4E 60            	ld	(unk_604E), hl
    4339/    5BB6 :                     loc_5BB6:
    4340/    5BB6 : E1                  	pop	hl
    4341/    5BB7 : 4E                  	ld	c, (hl)
    4342/    5BB8 : 23                  	inc	hl
    4343/    5BB9 : 46                  	ld	b, (hl)
    4344/    5BBA : 23                  	inc	hl
    4345/    5BBB : C5                  	push	bc
    4346/    5BBC : 01 4E 60            	ld	bc, unk_604E
    4347/    5BBF : 7E                  	ld	a, (hl)
    4348/    5BC0 : 12                  	ld	(de), a
    4349/    5BC1 : 0A                  	ld	a, (bc)
    4350/    5BC2 : 77                  	ld	(hl), a
    4351/    5BC3 : 23                  	inc	hl
    4352/    5BC4 : 13                  	inc	de
    4353/    5BC5 : 03                  	inc	bc
    4354/    5BC6 : 7E                  	ld	a, (hl)
    4355/    5BC7 : 12                  	ld	(de), a
    4356/    5BC8 : 0A                  	ld	a, (bc)
    4357/    5BC9 : 77                  	ld	(hl), a
    4358/    5BCA : 13                  	inc	de
    4359/    5BCB : 2A 4E 60            	ld	hl, (unk_604E)
    4360/    5BCE : ED 4B 54 60         	ld	bc, (unk_6054)
    4361/    5BD2 : 09                  	add	hl, bc
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 74 - 11/7/2018 12:33:42


    4362/    5BD3 : 22 4E 60            	ld	(unk_604E), hl
    4363/    5BD6 : 2A 50 60            	ld	hl, (unk_6050)
    4364/    5BD9 : 2B                  	dec	hl
    4365/    5BDA : 7C                  	ld	a, h
    4366/    5BDB : B5                  	or	l
    4367/    5BDC : 22 50 60            	ld	(unk_6050), hl
    4368/    5BDF : 20 D5               	jr	nz, loc_5BB6
    4369/    5BE1 : 12                  	ld	(de), a
    4370/    5BE2 : E1                  	pop	hl
    4371/    5BE3 : 2A 5A 60            	ld	hl, (BASTXT)
    4372/    5BE6 : E5                  	push	hl
    4373/    5BE7 :                     loc_5BE7:
    4374/    5BE7 : E1                  	pop	hl
    4375/    5BE8 : 4E                  	ld	c, (hl)
    4376/    5BE9 : 23                  	inc	hl
    4377/    5BEA : 46                  	ld	b, (hl)
    4378/    5BEB : 23                  	inc	hl
    4379/    5BEC : C5                  	push	bc
    4380/    5BED : 7E                  	ld	a, (hl)
    4381/    5BEE : 23                  	inc	hl
    4382/    5BEF : A6                  	and	(hl)
    4383/    5BF0 : 3C                  	inc	a
    4384/    5BF1 : 28 23               	jr	z, loc_5C16
    4385/    5BF3 :                     loc_5BF3:
    4386/    5BF3 : 23                  	inc	hl
    4387/    5BF4 :                     loc_5BF4:
    4388/    5BF4 : 7E                  	ld	a, (hl)
    4389/    5BF5 : B7                  	or	a
    4390/    5BF6 : 28 EF               	jr	z, loc_5BE7
    4391/    5BF8 : FE 88               	cp	88h ; ''
    4392/    5BFA : 28 27               	jr	z, loc_5C23
    4393/    5BFC : FE 8C               	cp	8Ch ; ''
    4394/    5BFE : 28 23               	jr	z, loc_5C23
    4395/    5C00 : FE 8B               	cp	8Bh ; ''
    4396/    5C02 : 28 04               	jr	z, loc_5C08
    4397/    5C04 : FE A9               	cp	0A9h ; ''
    4398/    5C06 : 20 EB               	jr	nz, loc_5BF3
    4399/    5C08 :                     loc_5C08:
    4400/    5C08 : 23                  	inc	hl
    4401/    5C09 : CD F6 48            	call	ATOH
    4402/    5C0C : 7B                  	ld	a, e
    4403/    5C0D : B2                  	or	d
    4404/    5C0E : C4 38 5C            	call	nz, sub_5C38
    4405/    5C11 : C4 6A 5C            	call	nz, sub_5C6A
    4406/    5C14 : 18 DE               	jr	loc_5BF4
    4407/    5C16 :                     
    4408/    5C16 :                     loc_5C16:
    4409/    5C16 : 2B                  	dec	hl
    4410/    5C17 : 22 D2 60            	ld	(PROGND), hl
    4411/    5C1A : 2B                  	dec	hl
    4412/    5C1B : 77                  	ld	(hl), a
    4413/    5C1C : 2B                  	dec	hl
    4414/    5C1D : 77                  	ld	(hl), a
    4415/    5C1E : E1                  	pop	hl
    4416/    5C1F : E1                  	pop	hl
    4417/    5C20 : C3 7F 44            	jp	SETPTR
    4418/    5C23 :                     
    4419/    5C23 :                     loc_5C23:
    4420/    5C23 : 23                  	inc	hl
    4421/    5C24 : CD F6 48            	call	ATOH
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 75 - 11/7/2018 12:33:42


    4422/    5C27 : 7B                  	ld	a, e
    4423/    5C28 : B2                  	or	d
    4424/    5C29 : 28 C9               	jr	z, loc_5BF4
    4425/    5C2B : CD 38 5C            	call	sub_5C38
    4426/    5C2E : C4 6A 5C            	call	nz, sub_5C6A
    4427/    5C31 : 7E                  	ld	a, (hl)
    4428/    5C32 : FE 2C               	cp	','
    4429/    5C34 : 20 BE               	jr	nz, loc_5BF4
    4430/    5C36 : 18 EB               	jr	loc_5C23
    4431/    5C38 :                     
    4432/    5C38 :                     sub_5C38:
    4433/    5C38 : E5                  	push	hl
    4434/    5C39 : D5                  	push	de
    4435/    5C3A : 11 FF FF            	ld	de, 0FFFFh
    4436/    5C3D : CD B0 44            	call	SRCHLN
    4437/    5C40 : D1                  	pop	de
    4438/    5C41 : 03                  	inc	bc
    4439/    5C42 : 03                  	inc	bc
    4440/    5C43 : 03                  	inc	bc
    4441/    5C44 : 03                  	inc	bc
    4442/    5C45 : 60                  	ld	h, b
    4443/    5C46 : 69                  	ld	l, c
    4444/    5C47 : ED 4B 52 60         	ld	bc, (unk_6052)
    4445/    5C4B :                     loc_5C4B:
    4446/    5C4B : 7E                  	ld	a, (hl)
    4447/    5C4C : 23                  	inc	hl
    4448/    5C4D : E5                  	push	hl
    4449/    5C4E : B6                  	or	(hl)
    4450/    5C4F : 28 16               	jr	z, loc_5C67
    4451/    5C51 : 7E                  	ld	a, (hl)
    4452/    5C52 : 2B                  	dec	hl
    4453/    5C53 : 6E                  	ld	l, (hl)
    4454/    5C54 : 67                  	ld	h, a
    4455/    5C55 : CD 75 46            	call	CPDEHL
    4456/    5C58 : 28 0A               	jr	z, loc_5C64
    4457/    5C5A : 2A 54 60            	ld	hl, (unk_6054)
    4458/    5C5D : 09                  	add	hl, bc
    4459/    5C5E : 44                  	ld	b, h
    4460/    5C5F : 4D                  	ld	c, l
    4461/    5C60 : E1                  	pop	hl
    4462/    5C61 : 23                  	inc	hl
    4463/    5C62 : 18 E7               	jr	loc_5C4B
    4464/    5C64 :                     
    4465/    5C64 :                     loc_5C64:
    4466/    5C64 : 3E FF               	ld	a, 0FFh
    4467/    5C66 : B7                  	or	a
    4468/    5C67 :                     loc_5C67:
    4469/    5C67 : E1                  	pop	hl
    4470/    5C68 : E1                  	pop	hl
    4471/    5C69 : C9                  	ret
    4472/    5C6A :                     
    4473/    5C6A :                     sub_5C6A:
    4474/    5C6A : C5                  	push	bc
    4475/    5C6B : EB                  	ex	de, hl
    4476/    5C6C : 2A D2 60            	ld	hl, (PROGND)
    4477/    5C6F : ED 52               	sbc	hl, de
    4478/    5C71 : E5                  	push	hl
    4479/    5C72 :                     loc_5C72:
    4480/    5C72 : C1                  	pop	bc
    4481/    5C73 : 62                  	ld	h, d
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 76 - 11/7/2018 12:33:42


    4482/    5C74 : 6B                  	ld	l, e
    4483/    5C75 : 1B                  	dec	de
    4484/    5C76 : 1A                  	ld	a, (de)
    4485/    5C77 : FE 2C               	cp	','
    4486/    5C79 : 28 0B               	jr	z, loc_5C86
    4487/    5C7B : FE 3A               	cp	':'
    4488/    5C7D : 30 07               	jr	nc, loc_5C86
    4489/    5C7F : C5                  	push	bc
    4490/    5C80 : D5                  	push	de
    4491/    5C81 : ED B0               	ldir
    4492/    5C83 : D1                  	pop	de
    4493/    5C84 : 18 EC               	jr	loc_5C72
    4494/    5C86 :                     
    4495/    5C86 :                     loc_5C86:
    4496/    5C86 : EB                  	ex	de, hl
    4497/    5C87 : D1                  	pop	de
    4498/    5C88 : E5                  	push	hl
    4499/    5C89 : C5                  	push	bc
    4500/    5C8A : AF                  	xor	a
    4501/    5C8B : 06 98               	ld	b, 98h ; ''
    4502/    5C8D : CD 27 56            	call	RETINT
    4503/    5C90 : CD A6 57            	call	NUMASC
    4504/    5C93 : C1                  	pop	bc
    4505/    5C94 : D1                  	pop	de
    4506/    5C95 : 23                  	inc	hl
    4507/    5C96 : 13                  	inc	de
    4508/    5C97 :                     loc_5C97:
    4509/    5C97 : 7E                  	ld	a, (hl)
    4510/    5C98 : B7                  	or	a
    4511/    5C99 : 28 0F               	jr	z, loc_5CAA
    4512/    5C9B : C5                  	push	bc
    4513/    5C9C : E5                  	push	hl
    4514/    5C9D : EB                  	ex	de, hl
    4515/    5C9E : 09                  	add	hl, bc
    4516/    5C9F : 54                  	ld	d, h
    4517/    5CA0 : 5D                  	ld	e, l
    4518/    5CA1 : 2B                  	dec	hl
    4519/    5CA2 : ED B8               	lddr
    4520/    5CA4 : E1                  	pop	hl
    4521/    5CA5 : ED A0               	ldi
    4522/    5CA7 : C1                  	pop	bc
    4523/    5CA8 : 18 ED               	jr	loc_5C97
    4524/    5CAA :                     
    4525/    5CAA :                     loc_5CAA:
    4526/    5CAA : D5                  	push	de
    4527/    5CAB : ED 5B 5A 60         	ld	de, (BASTXT)
    4528/    5CAF : CD 88 44            	call	PTRLP
    4529/    5CB2 :                     loc_5CB2:
    4530/    5CB2 : 23                  	inc	hl
    4531/    5CB3 : 7E                  	ld	a, (hl)
    4532/    5CB4 : 23                  	inc	hl
    4533/    5CB5 : B6                  	or	(hl)
    4534/    5CB6 : 20 FA               	jr	nz, loc_5CB2
    4535/    5CB8 : EB                  	ex	de, hl
    4536/    5CB9 : 73                  	ld	(hl), e
    4537/    5CBA : 23                  	inc	hl
    4538/    5CBB : 72                  	ld	(hl), d
    4539/    5CBC : 13                  	inc	de
    4540/    5CBD : 13                  	inc	de
    4541/    5CBE : ED 53 D2 60         	ld	(PROGND), de
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 77 - 11/7/2018 12:33:42


    4542/    5CC2 : E1                  	pop	hl
    4543/    5CC3 : 54                  	ld	d, h
    4544/    5CC4 : 5D                  	ld	e, l
    4545/    5CC5 :                     loc_5CC5:
    4546/    5CC5 : 7E                  	ld	a, (hl)
    4547/    5CC6 : B7                  	or	a
    4548/    5CC7 : 23                  	inc	hl
    4549/    5CC8 : 20 FB               	jr	nz, loc_5CC5
    4550/    5CCA : C1                  	pop	bc
    4551/    5CCB : E3                  	ex	(sp), hl
    4552/    5CCC : C5                  	push	bc
    4553/    5CCD : EB                  	ex	de, hl
    4554/    5CCE : C9                  	ret
    4555/    5CCF :                     
    4556/    5CCF :                     
    4557/    5CCF :                     ; 512 x 00-Byte Vorton
    4558/    5CCF :                     ; E6 Syncbyte
    4559/    5CCF :                     ; 6 Byte Name
    4560/    5CCF :                     ; D3 Kennung Basic
    4561/    5CCF :                     ; 2 Byte Laenge (hi, lo)
    4562/    5CCF :                     ; xxx Bytes
    4563/    5CCF : CD 97 4C            CSAVE:	call	EVAL
    4564/    5CD2 : E5                  	push	hl
    4565/    5CD3 : CD 9D 52            	call	GTFLNM
    4566/    5CD6 : 06 00               	ld	b, 0
    4567/    5CD8 : AF                  csave1:	xor	a
    4568/    5CD9 : CD 30 03            	call	330h
    4569/    5CDC : AF                  	xor	a
    4570/    5CDD : CD 30 03            	call	330h
    4571/    5CE0 : 10 F6               	djnz	csave1
    4572/    5CE2 : 3E E6               	ld	a, 0E6h	; Sync
    4573/    5CE4 : CD 30 03            	call	330h
    4574/    5CE7 : 06 06               	ld	b, 6
    4575/    5CE9 : 1A                  csave2:	ld	a, (de)
    4576/    5CEA : CD 30 03            	call	330h
    4577/    5CED : 13                  	inc	de
    4578/    5CEE : 10 F9               	djnz	csave2
    4579/    5CF0 : 3E D3               	ld	a, 0D3h	; ID Basic Pgm
    4580/    5CF2 : CD 30 03            	call	330h
    4581/    5CF5 : 2A D2 60            	ld	hl, (PROGND)
    4582/    5CF8 : 11 F7 60            	ld	de, PROGST+1
    4583/    5CFB : AF                  	xor	a
    4584/    5CFC : ED 52               	sbc	hl, de
    4585/    5CFE : 7C                  	ld	a, h
    4586/    5CFF : CD 30 03            	call	330h
    4587/    5D02 : 7D                  	ld	a, l
    4588/    5D03 : 23                  	inc	hl
    4589/    5D04 : CD 30 03            csave3:	call	330h
    4590/    5D07 : 2B                  	dec	hl
    4591/    5D08 : 7D                  	ld	a, l
    4592/    5D09 : B4                  	or	h
    4593/    5D0A : 1A                  	ld	a, (de)
    4594/    5D0B : 13                  	inc	de
    4595/    5D0C : 20 F6               	jr	nz, csave3
    4596/    5D0E : E1                  	pop	hl
    4597/    5D0F : C9                  	ret
    4598/    5D10 :                     
    4599/    5D10 : CD 97 4C            CLOAD:	call	EVAL
    4600/    5D13 : CD 9D 52            	call	GTFLNM
    4601/    5D16 : AF                  	xor	a
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 78 - 11/7/2018 12:33:42


    4602/    5D17 : 32 24 18            	ld	(1824h), a
    4603/    5D1A : CD 35 04            cload1:	call	435h
    4604/    5D1D : FE E6               	cp	0E6h ; ''
    4605/    5D1F : 28 09               	jr	z, cload2
    4606/    5D21 : FE 19               	cp	19h
    4607/    5D23 : 20 F5               	jr	nz, cload1
    4608/    5D25 : 3E FF               	ld	a, 0FFh
    4609/    5D27 : 32 24 18            	ld	(1824h), a
    4610/    5D2A : 06 06               cload2:	ld	b, 6
    4611/    5D2C : 2A 00 18            	ld	hl, (1800h)
    4612/    5D2F : CD 26 04            cload3:	call	426h
    4613/    5D32 : 77                  	ld	(hl), a
    4614/    5D33 : 2B                  	dec	hl
    4615/    5D34 : 10 F9               	djnz	cload3
    4616/    5D36 : 22 00 18            	ld	(1800h), hl
    4617/    5D39 : CD 26 04            	call	426h
    4618/    5D3C : FE D3               	cp	0D3h ; ''
    4619/    5D3E : 20 1D               	jr	nz, cloaderr
    4620/    5D40 : CD 26 04            	call	426h
    4621/    5D43 : 47                  	ld	b, a
    4622/    5D44 : CD 26 04            	call	426h
    4623/    5D47 : 4F                  	ld	c, a
    4624/    5D48 : 2A D2 60            cload4:	ld	hl, (PROGND)
    4625/    5D4B : 2B                  	dec	hl
    4626/    5D4C : 2B                  	dec	hl
    4627/    5D4D : CD 26 04            cload5:	call	426h
    4628/    5D50 : 77                  	ld	(hl), a
    4629/    5D51 : 23                  	inc	hl
    4630/    5D52 : 0B                  	dec	bc
    4631/    5D53 : 78                  	ld	a, b
    4632/    5D54 : B1                  	or	c
    4633/    5D55 : 20 F6               	jr	nz, cload5
    4634/    5D57 : 22 D2 60            	ld	(PROGND), hl
    4635/    5D5A : C3 7F 44            	jp	SETPTR
    4636/    5D5D :                     cloaderr:
    4637/    5D5D : 21 66 5D            	ld	hl, BadFile	; "Bad file\r"
    4638/    5D60 : CD 25 51            	call	PRS
    4639/    5D63 : C3 7F 44            	jp	SETPTR
    4640/    5D66 :                     
    4641/    5D66 : 42 61 64 20 66 69   BadFile:	db "Bad file",0Dh,0
                    6C 65 0D 00 
    4642/    5D70 :                     
    4643/    5D70 :                     
    4644/    5D70 : AF                  POINT:	xor	a
    4645/    5D71 : 01                  	db    1
    4646/    5D72 : 3E 80               PSET:	ld	a, 80h
    4647/    5D74 : 01                  	db    1
    4648/    5D75 : 3E 01               PRESET:	ld	a, 1
    4649/    5D77 : F5                  	push	af
    4650/    5D78 : CD 7B 46            	call	CHKSYN
    4651/    5D7B : 28                  	db '('
    4652/    5D7C : CD 88 53            	call	GETINT
    4653/    5D7F : FE 80               	cp	80h ; ''
    4654/    5D81 : D2 F1 48            	jp	nc, FCERR
    4655/    5D84 : F5                  	push	af
    4656/    5D85 : CD 7B 46            	call	CHKSYN
    4657/    5D88 : 2C                  	db ','
    4658/    5D89 : CD 88 53            	call	GETINT
    4659/    5D8C : FE 40               	cp	40h ; '@'
    4660/    5D8E : D2 F1 48            	jp	nc, FCERR
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 79 - 11/7/2018 12:33:42


    4661/    5D91 : 3F                  	ccf
    4662/    5D92 : 1F                  	rra
    4663/    5D93 : 57                  	ld	d, a
    4664/    5D94 : 0E 00               	ld	c, 0
    4665/    5D96 : 30 01               	jr	nc, point1
    4666/    5D98 : 0C                  	inc	c
    4667/    5D99 : F1                  point1:	pop	af
    4668/    5D9A : 87                  	add	a, a
    4669/    5D9B : 5F                  	ld	e, a
    4670/    5D9C : 06 02               	ld	b, 2
    4671/    5D9E : 7A                  point2:	ld	a, d
    4672/    5D9F : 1F                  	rra
    4673/    5DA0 : 57                  	ld	d, a
    4674/    5DA1 : 7B                  	ld	a, e
    4675/    5DA2 : 1F                  	rra
    4676/    5DA3 : 5F                  	ld	e, a
    4677/    5DA4 : 10 F8               	djnz	point2
    4678/    5DA6 : 79                  	ld	a, c
    4679/    5DA7 : 8F                  	adc	a, a
    4680/    5DA8 : 3C                  	inc	a
    4681/    5DA9 : 47                  	ld	b, a
    4682/    5DAA : AF                  	xor	a
    4683/    5DAB : 37                  	scf
    4684/    5DAC : 8F                  point3:	adc	a, a
    4685/    5DAD : 10 FD               	djnz	point3
    4686/    5DAF : 4F                  	ld	c, a
    4687/    5DB0 : E5                  	push	hl
    4688/    5DB1 : 21 FF 17            	ld	hl, 17FFh	; BWS-1
    4689/    5DB4 : ED 52               	sbc	hl, de
    4690/    5DB6 : EB                  	ex	de, hl
    4691/    5DB7 : E1                  	pop	hl
    4692/    5DB8 : 1A                  	ld	a, (de)
    4693/    5DB9 : FE 20               	cp	' '
    4694/    5DBB : 38 01               	jr	c, point4
    4695/    5DBD : AF                  	xor	a
    4696/    5DBE : 47                  point4:	ld	b, a
    4697/    5DBF : F1                  	pop	af
    4698/    5DC0 : B7                  	or	a
    4699/    5DC1 : 78                  point5:	ld	a, b
    4700/    5DC2 : 28 12               	jr	z, point8
    4701/    5DC4 : 12                  	ld	(de), a
    4702/    5DC5 : FA D3 5D            	jp	m, point7
    4703/    5DC8 : 79                  	ld	a, c
    4704/    5DC9 : 2F                  	cpl
    4705/    5DCA : 4F                  	ld	c, a
    4706/    5DCB : 1A                  	ld	a, (de)
    4707/    5DCC : A1                  	and	c
    4708/    5DCD : 12                  point6:	ld	(de), a
    4709/    5DCE : CD 7B 46            	call	CHKSYN
    4710/    5DD1 : 29                  	db ')'
    4711/    5DD2 : C9                  	ret
    4712/    5DD3 : B1                  point7:	or	c
    4713/    5DD4 : 18 F7               	jr	point6
    4714/    5DD6 : A1                  point8:	and	c
    4715/    5DD7 : 91                  	sub	c
    4716/    5DD8 : F5                  	push	af
    4717/    5DD9 : CD 7B 46            	call	CHKSYN
    4718/    5DDC : 29                  	db ')'
    4719/    5DDD : F1                  	pop	af
    4720/    5DDE : D1                  	pop	de
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 80 - 11/7/2018 12:33:42


    4721/    5DDF : E5                  	push	hl
    4722/    5DE0 : 11 52 4D            	ld	de, RETNUM
    4723/    5DE3 : D5                  	push	de
    4724/    5DE4 : 28 05               	jr	z, point10
    4725/    5DE6 : AF                  	xor	a
    4726/    5DE7 : 47                  	ld	b, a
    4727/    5DE8 : C3 0A 50            point9:	jp	ABPASS
    4728/    5DEB :                     point10:
    4729/    5DEB : 06 01               	ld	b, 1
    4730/    5DED : 18 F9               	jr	point9
    4731/    5DEF :                     
    4732/    5DEF :                     
    4733/    5DEF : CD 7B 46            SCREEN:	call	CHKSYN
    4734/    5DF2 : 28                  	db '('
    4735/    5DF3 : CD 88 53            	call    GETINT
    4736/    5DF6 : FE 40               	cp	64
    4737/    5DF8 : 30 0A               	jr	nc, screen1
    4738/    5DFA : F5                  	push	af
    4739/    5DFB : CD 7B 46            	call	CHKSYN
    4740/    5DFE : 2C                  	db ','
    4741/    5DFF : CD 88 53            	call	GETINT
    4742/    5E02 : FE 20               	cp	32
    4743/    5E04 :                     screen1:
    4744/    5E04 : D2 F1 48            	jp	nc, FCERR
    4745/    5E07 : D1                  	pop	de
    4746/    5E08 : 5A                  	ld	e, d
    4747/    5E09 : 16 00               	ld	d, 0
    4748/    5E0B : 06 06               	ld	b, 6
    4749/    5E0D :                     screen2:
    4750/    5E0D : CB 27               	sla	a
    4751/    5E0F : CB 12               	rl	d
    4752/    5E11 : 10 FA               	djnz	screen2
    4753/    5E13 : 83                  	add	a, e
    4754/    5E14 : 5F                  	ld	e, a
    4755/    5E15 : E5                  	push	hl
    4756/    5E16 : 21 FF 17            	ld	hl, 17FFh
    4757/    5E19 : ED 52               	sbc	hl, de
    4758/    5E1B : 22 00 18            	ld	(1800h), hl
    4759/    5E1E : E1                  	pop	hl
    4760/    5E1F : CD 7B 46            	call	CHKSYN
    4761/    5E22 : 29                  	db ')'
    4762/    5E23 : C9                  	ret
    4763/    5E24 :                     
    4764/    5E24 : 3E 0C               CLS:	ld	a, 0Ch
    4765/    5E26 :                     
    4766/    5E26 : F5                  MONOUT:	push	af
    4767/    5E27 : C3 35 5E            	jp	co1
    4768/    5E2A : F1                  coret:	pop	af
    4769/    5E2B : C9                  	ret
    4770/    5E2C :                     
    4771/    5E2C : C3 5C 5E            GETINP:	jp	co6
    4772/    5E2F :                     
    4773/    5E2F : C3 FA 07            getkey:	jp	7FAh		; get input status
    4774/    5E32 :                     
    4775/    5E32 : C3 FD 07            BYE:	jp	7FDh
    4776/    5E35 :                     
    4777/    5E35 : FE 08               co1:	cp	8
    4778/    5E37 : 37                  	scf
    4779/    5E38 : 28 0E               	jr	z, co4
    4780/    5E3A : FE 09               	cp	9
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 81 - 11/7/2018 12:33:42


    4781/    5E3C : 28 0A               	jr	z, co4
    4782/    5E3E : CD 10 00            co2:	call	10h
    4783/    5E41 : 18 E7               	jr	coret
    4784/    5E43 : 3E 0D               co3:	ld	a, 0Dh
    4785/    5E45 : E1                  	pop	hl
    4786/    5E46 : 18 F6               	jr	co2
    4787/    5E48 : E5                  co4:	push	hl
    4788/    5E49 : 2A 00 18            	ld	hl, (1800h)
    4789/    5E4C : 23                  	inc	hl
    4790/    5E4D : 38 07               	jr	c, co5
    4791/    5E4F : 2B                  	dec	hl
    4792/    5E50 : 2B                  	dec	hl
    4793/    5E51 : 7C                  	ld	a, h
    4794/    5E52 : FE 0F               	cp	0Fh
    4795/    5E54 : 28 ED               	jr	z, co3
    4796/    5E56 : 22 00 18            co5:	ld	(1800h), hl
    4797/    5E59 : E1                  	pop	hl
    4798/    5E5A : 18 CE               	jr	coret
    4799/    5E5C : E5                  co6:	push	hl
    4800/    5E5D : D5                  	push	de
    4801/    5E5E : C5                  	push	bc
    4802/    5E5F : 2A 00 18            	ld	hl, (1800h)
    4803/    5E62 : 56                  	ld	d, (hl)
    4804/    5E63 : 36 7F               co7:	ld	(hl), 7Fh ; ''
    4805/    5E65 : 06 00               co8:	ld	b, 0
    4806/    5E67 : C5                  co9:	push	bc
    4807/    5E68 : 06 00               	ld	b, 0
    4808/    5E6A : 10 FE               co10:	djnz	co10
    4809/    5E6C : C1                  	pop	bc
    4810/    5E6D : CD FA 07            	call	7FAh
    4811/    5E70 : 20 17               	jr	nz, co12
    4812/    5E72 : E5                  	push	hl
    4813/    5E73 : 21 C0 18            	ld	hl, 18C0h
    4814/    5E76 : CB 26               	sla	(hl)
    4815/    5E78 : 36 10               	ld	(hl), 10h
    4816/    5E7A : 30 02               	jr	nc, co11
    4817/    5E7C : CB FE               	set	7, (hl)
    4818/    5E7E : E1                  co11:	pop	hl
    4819/    5E7F : 10 E6               	djnz	co9
    4820/    5E81 : 3E 7F               	ld	a, 7Fh ; ''
    4821/    5E83 : BE                  	cp	(hl)
    4822/    5E84 : 20 DD               	jr	nz, co7
    4823/    5E86 : 72                  	ld	(hl), d
    4824/    5E87 : 18 DC               	jr	co8
    4825/    5E89 : 72                  co12:	ld	(hl), d
    4826/    5E8A : F5                  	push	af
    4827/    5E8B : CD EB 07            	call	7EBh
    4828/    5E8E : DB 04               	in	a, (4)
    4829/    5E90 : FE 92               	cp	92h ; ''
    4830/    5E92 : 20 08               	jr	nz, co13
    4831/    5E94 : 21 C0 18            	ld	hl, 18C0h
    4832/    5E97 : CB 26               	sla	(hl)
    4833/    5E99 : 3F                  	ccf
    4834/    5E9A : CB 1E               	rr	(hl)
    4835/    5E9C : DB 04               co13:	in	a, (4)
    4836/    5E9E : 21 E1 5E            	ld	hl, cotab
    4837/    5EA1 : 4E                  co14:	ld	c, (hl)
    4838/    5EA2 : B9                  	cp	c
    4839/    5EA3 : 28 F7               	jr	z, co13
    4840/    5EA5 : 23                  	inc	hl
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 82 - 11/7/2018 12:33:42


    4841/    5EA6 : 0D                  	dec	c
    4842/    5EA7 : 20 F8               	jr	nz, co14
    4843/    5EA9 : CB 7F               	bit	7, a
    4844/    5EAB : 21 C0 18            	ld	hl, 18C0h
    4845/    5EAE : 28 0C               	jr	z, co16
    4846/    5EB0 : CD EB 07            	call	7EBh
    4847/    5EB3 : 35                  	dec	(hl)
    4848/    5EB4 : 28 05               	jr	z, co15
    4849/    5EB6 : 7E                  	ld	a, (hl)
    4850/    5EB7 : FE 80               	cp	80h ; ''
    4851/    5EB9 : 20 E1               	jr	nz, co13
    4852/    5EBB : 34                  co15:	inc	(hl)
    4853/    5EBC : F1                  co16:	pop	af
    4854/    5EBD : E6 7F               	and	7Fh ; ''
    4855/    5EBF : 21 C0 18            	ld	hl, 18C0h
    4856/    5EC2 : 5E                  	ld	e, (hl)
    4857/    5EC3 : CB 7B               	bit	7, e
    4858/    5EC5 : 28 16               	jr	z, co18
    4859/    5EC7 : FE 41               	cp	41h ; 'A'
    4860/    5EC9 : 38 12               	jr	c, co18
    4861/    5ECB : FE 5B               	cp	5Bh ; '['
    4862/    5ECD : 30 04               	jr	nc, co17
    4863/    5ECF : CB EF               	set	5, a
    4864/    5ED1 : 18 0A               	jr	co18
    4865/    5ED3 : FE 61               co17:	cp	61h ; 'a'
    4866/    5ED5 : 38 06               	jr	c, co18
    4867/    5ED7 : FE 7B               	cp	7Bh ; '{'
    4868/    5ED9 : 30 02               	jr	nc, co18
    4869/    5EDB : CB AF               	res	5, a
    4870/    5EDD : C1                  co18:	pop	bc
    4871/    5EDE : D1                  	pop	de
    4872/    5EDF : E1                  	pop	hl
    4873/    5EE0 : C9                  	ret
    4874/    5EE1 :                     
    4875/    5EE1 : 92                  cotab:	db  92h	; 
    4876/    5EE2 : 8D                  	db  8Dh	; 
    4877/    5EE3 : 01                  	db    1
    4878/    5EE4 :                     
    4879/    5EE4 : CD F6 48            EDIT:	call	ATOH
    4880/    5EE7 : C0                  	ret	nz
    4881/    5EE8 : C1                  	pop	bc
    4882/    5EE9 : CD B0 44            	call	SRCHLN
    4883/    5EEC : D2 94 49            	jp	nc, ULERR
    4884/    5EEF : 60                  	ld	h, b
    4885/    5EF0 : 69                  	ld	l, c
    4886/    5EF1 : 7E                  	ld	a, (hl)
    4887/    5EF2 : 23                  	inc	hl
    4888/    5EF3 : B6                  	or	(hl)
    4889/    5EF4 : 23                  	inc	hl
    4890/    5EF5 : CA 94 49            	jp	z, ULERR
    4891/    5EF8 : 23                  	inc	hl
    4892/    5EF9 : 23                  	inc	hl
    4893/    5EFA : D5                  	push	de
    4894/    5EFB : E5                  	push	hl
    4895/    5EFC : EB                  	ex	de, hl
    4896/    5EFD : CD 9B 57            	call	PRNTHL
    4897/    5F00 : EB                  	ex	de, hl
    4898/    5F01 : E1                  	pop	hl
    4899/    5F02 : 3E 20               	ld	a, ' '
    4900/    5F04 : CD 8E 46            	call	OUTC
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 83 - 11/7/2018 12:33:42


    4901/    5F07 : CD 14 47            	call	sub_4714
    4902/    5F0A : 3E 4A               	ld	a, 'J'
    4903/    5F0C : 90                  	sub	b
    4904/    5F0D : 21 5C 60            	ld	hl, BUFFER-1
    4905/    5F10 : 4F                  	ld	c, a
    4906/    5F11 : 06 00               	ld	b, 0
    4907/    5F13 : 09                  	add	hl, bc
    4908/    5F14 : 41                  	ld	b, c
    4909/    5F15 : CD 95 45            	call	MORINP
    4910/    5F18 : D1                  	pop	de
    4911/    5F19 : 21 5D 60            	ld	hl, BUFFER
    4912/    5F1C : 37                  	scf
    4913/    5F1D : F5                  	push	af
    4914/    5F1E : C3 24 44            	jp	getcmd5
    4915/    5F21 :                     
    4916/    5F21 :                     
    4917/    5F21 : E5                  COUNT:	push	hl
    4918/    5F22 : D5                  	push	de
    4919/    5F23 : 2A 44 60            	ld	hl, (LINESC)
    4920/    5F26 : 11 FF FF            	ld	de, 0FFFFh
    4921/    5F29 : ED 5A               	adc	hl, de
    4922/    5F2B : 22 44 60            	ld	(LINESC), hl
    4923/    5F2E : D1                  	pop	de
    4924/    5F2F : E1                  	pop	hl
    4925/    5F30 : F0                  	ret	p
    4926/    5F31 : CD 41 47            	call	SETLIN
    4927/    5F34 : CD 2C 5E            	call	GETINP
    4928/    5F37 : FE 03               	cp	3
    4929/    5F39 : CA 4A 47            	jp	z, loc_474A
    4930/    5F3C : 18 E3               	jr	COUNT
    4931/    5F3E :                     
    4932/    5F3E :                     ;TTYLIN
    4933/    5F3E :                     sub_5F3E:
    4934/    5F3E : E5                  	push	hl
    4935/    5F3F : 06 49               	ld	b, 49h ; 'I'
    4936/    5F41 : 21 5D 60            	ld	hl, BUFFER
    4937/    5F44 : E5                  	push	hl
    4938/    5F45 : DD E1               	pop	ix
    4939/    5F47 :                     loc_5F47:
    4940/    5F47 : 36 20               	ld	(hl), ' '
    4941/    5F49 : 23                  	inc	hl
    4942/    5F4A : 10 FB               	djnz	loc_5F47
    4943/    5F4C : E1                  	pop	hl
    4944/    5F4D : C9                  	ret
    4945/    5F4E :                     sub_5F4E:
    4946/    5F4E : 05                  	dec	b
    4947/    5F4F : 28 08               	jr	z, loc_5F59
    4948/    5F51 : DD 77 00            	ld	(ix+0),	a
    4949/    5F54 : DD 23               	inc	ix
    4950/    5F56 : C3 26 5E            	jp	MONOUT
    4951/    5F59 :                     
    4952/    5F59 :                     loc_5F59:
    4953/    5F59 : D1                  	pop	de
    4954/    5F5A : C9                  	ret
    4955/    5F5B :                     
    4956/    5F5B :                     	end
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 84 - 11/7/2018 12:33:42


  symbol table (* = unused):
  ------------------------

 ABPASS :                      500A C |  ABS :                         5635 C |
 ACPASS :                      5009 C |  ADDEXP :                      55CE C |
 ADDIG :                       5767 C |  ADDPHL :                      53D6 C |
 ALLFOL :                      52C7 C |  ANTVLU :                      4BAB C |
*ARCHITECTURE :  i386-unknown-win32 - |  ARLDSV :                      4F36 C |
 ARREND :                      60D6 - |  ARRLP :                       5199 C |
 ASC :                         5299 C |  ASCTFP :                      5713 C |
 ASPCS :                       4B04 C |  ATN :                         5A5E C |
 ATN1 :                        5A7B C |  ATNTAB :                      5A85 C |
 ATOH :                        48F6 C |  AUTO :                        4600 C |
 AUTO1 :                       4616 C |  AUTO2 :                       461E C |
 AUTO3 :                       461F C |  BADFILE :                     5D66 C |
 BADINP :                      4B37 C |  BAKSTK :                      4766 C |
 BAKTMP :                      5279 C |  BASTXT :                      605A - |
 BCDEFP :                      565C C |  BFREE :                       40C3 C |
*BIGENDIAN :                      0 - | *BKSP :                           8 - |
 BNORM :                       5434 C |  BNRMLP :                      5437 C |
*BRANCHEXT :                      0 - |  BRKLIN :                      60CA - |
 BRKMSG :                      4349 C |  BRKRET :                      4074 C |
 BS :                            10 - |  BSERR :                       4F64 C |
 BUFFER :                      605D - |  BYE :                         5E32 C |
 BYTSFT :                      555A C | *CASESENSITIVE :                  0 - |
 CFEVAL :                      4ECF C |  CHARTY :                      4E83 C |
 CHEKFN :                      50A1 C |  CHKLTR :                      4686 C |
 CHKSTK :                      434F C |  CHKSYN :                      467B C |
 CHKTYP :                      4C83 C |  CHR :                         52AA C |
 CLEAR :                       491A C |  CLOAD :                       5D10 C |
 CLOAD1 :                      5D1A C |  CLOAD2 :                      5D2A C |
 CLOAD3 :                      5D2F C | *CLOAD4 :                      5D48 C |
 CLOAD5 :                      5D4D C |  CLOADERR :                    5D5D C |
 CLOTST :                      46B6 C |  CLREG :                       4658 C |
 CLRPTR :                      4633 C |  CLS :                         5E24 C |
 CMPFP :                       56A3 C |  CMPLG1 :                      4DEE C |
 CMPLOG :                      4DEC C |  CMPNUM :                      5689 C |
 CMPRES :                      4E2F C |  CMPSTR :                      4E18 C |
 CN :                            20 - |  CNVNUM :                      571D C |
 CO1 :                         5E35 C |  CO10 :                        5E6A C |
 CO11 :                        5E7E C |  CO12 :                        5E89 C |
 CO13 :                        5E9C C |  CO14 :                        5EA1 C |
 CO15 :                        5EBB C |  CO16 :                        5EBC C |
 CO17 :                        5ED3 C |  CO18 :                        5EDD C |
 CO2 :                         5E3E C |  CO3 :                         5E43 C |
 CO4 :                         5E48 C |  CO5 :                         5E56 C |
 CO6 :                         5E5C C |  CO7 :                         5E63 C |
 CO8 :                         5E65 C |  CO9 :                         5E67 C |
*COLD :                        4000 C |  COMMAN :                      6042 - |
 COMPL :                       548E C |  CONCAT :                      5210 C |
 CONEXP :                      5747 C |  CONPOS :                      5431 C |
*CONSTPI :        3.141592653589793 - |  CONT :                        48BD C |
 CONTAD :                      60D0 - |  CONVAR :                      4D57 C |
 CORET :                       5E2A C |  COS :                         59E2 C |
 COTAB :                       5EE1 C |  COUNT :                       5F21 C |
 CPDEHL :                      4675 C |  CPYLIT :                      4567 C |
 CR :                             D - |  CRARLP :                      4F84 C |
 CREARY :                      4F69 C |  CRESTR :                      4A10 C |
 CRNCLP :                      44D8 C |  CRTMST :                      50DA C |
 CRTST :                       50E6 C |  CRTSTE :                      50F9 C |
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 85 - 11/7/2018 12:33:42


 CRUNCH :                      44CF C | *CS :                             C - |
 CSAVE :                       5CCF C |  CSAVE1 :                      5CD8 C |
 CSAVE2 :                      5CE9 C |  CSAVE3 :                      5D04 C |
 CTLOFG :                      6043 - | *CTRLC :                          3 - |
*CTRLG :                          7 - |  CTRLO :                          F - |
*CTRLQ :                         11 - | *CTRLR :                         12 - |
*CTRLS :                         13 - | *CTRLU :                         15 - |
 CUROPR :                      60C1 - |  CURPOS :                      60A7 - |
 DATA :                        49BD C | *DATE :                   11/7/2018 - |
 DATFLG :                      60AA - |  DATLIN :                      60C5 - |
 DATSNR :                      436A C |  DCBCDE :                      56DA C |
 DD :                            12 - |  DDERR :                       4379 C |
 DEEK :                        53B1 C |  DEF :                         501E C |
 DEFSIZ :                      4F8B C |  DEINT :                       48DC C |
*DEL :                           7F - |  DEPINT :                      48D6 C |
 DETHL4 :                      566B C |  DETHLB :                      566D C |
 DIGTXT :                      580B C |  DIM :                         4E59 C |
 DIMRET :                      4E50 C |  DINPOS :                      46AF C |
 DIV :                         556B C |  DIV1 :                        600C - |
 DIV10 :                       555F C |  DIV2 :                        6010 - |
 DIV3 :                        6014 - |  DIV4 :                        6017 - |
 DIVLP :                       5592 C |  DIVSUP :                      600B - |
 DOAGN :                       4671 C |  DOCOM :                       4ADA C |
 DOEBIT :                      5847 C |  DOFN :                        504B C |
 DOKE :                        53BC C |  DONULL :                      4AC4 C |
 DOSPC :                       4B00 C |  DOTAB :                       4AEE C |
 DPOINT :                      5744 C |  DTSTR :                       50EA C |
 DVBCDE :                      556D C |  DZ :                            14 - |
 DZERR :                       4373 C |  EDIGIT :                      5788 C |
 EDIT :                        5EE4 C |  ENDBUF :                      456D C |
 ENDCON :                      5756 C |  ENDDIM :                      4FE5 C |
 ENDINP :                      4ABA C |  ENDNAM :                      4E79 C |
 ENDPRG :                      489A C |  ENFMEM :                      4358 C |
 ERRIN :                       43A4 C |  ERRLIN :                      60CE - |
 ERRMSG :                      4338 C |  ERROR :                       4384 C |
 ERRORS :                      4312 C | *ESC :                           1B - |
 EVAL :                        4C97 C |  EVAL1 :                       4C9A C |
 EVAL2 :                       4CA3 C |  EVAL3 :                       4CA6 C |
 EVLPAR :                      4D3E C |  EVNOT :                       4E39 C |
 EXCUTE :                      4831 C |  EXP :                         58DF C |
 EXPLP :                       5738 C |  EXPTAB :                      591F C |
 EXPTEN :                      5858 C |  EXTIG :                       4C02 C |
*FALSE :                          0 - |  FANDT :                       4C2A C |
 FC :                             8 - |  FCERR :                       48F1 C |
 FDTLP :                       4C12 C |  FINDEL :                      4FC3 C |
 FLGDIF :                      561B C |  FLGREL :                      5622 C |
 FNARG :                       60DC - |  FNCTAB :                      42C9 C |
 FNDARY :                      4F3C C |  FNDELP :                      4FC8 C |
 FNDEND :                      4496 C |  FNDNUM :                      5385 C |
 FNDVAR :                      4EBA C |  FNDWRD :                      44FD C |
 FNOFST :                      4D68 C |  FNRGNM :                      60DA - |
 FNTHR :                       4EC6 C |  FNVAL :                       4D92 C |
 FOPRND :                      4CCC C |  FOR :                         4787 C |
 FORFLG :                      60C7 - |  FORFND :                      47B5 C |
 FORSLP :                      479B C |  FPADD :                       53E4 C |
 FPBCDE :                      5651 C |  FPEXP :                       60E3 - |
 FPINT :                       56B6 C |  FPMULT :                      5512 C |
 FPREG :                       60E0 - |  FPROND :                      5475 C |
 FPSINT :                      48D0 C |  FPTHL :                       5668 C |
 FRE :                         4FE9 C |  FRENUM :                      5004 C |
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 86 - 11/7/2018 12:33:42


 FRMEVL :                      4D5A C | *FULLPMMU :                       1 - |
 GARBGE :                      5166 C |  GARBLP :                      5169 C |
 GETCHR :                      485C C |  GETCMD :                      43C9 C |
 GETCMD1 :                     43E7 C |  GETCMD2 :                     43F0 C |
 GETCMD3 :                     43F6 C |  GETCMD4 :                     440F C |
 GETCMD5 :                     4424 C |  GETINP :                      5E2C C |
 GETINT :                      5388 C |  GETKEY :                      5E2F C |
 GETLEN :                      528E C |  GETLN :                       48F7 C |
 GETNUM :                      4C7E C |  GETNXT :                      4516 C |
 GETSTR :                      5259 C |  GETVAR :                      4E5E C |
 GNXARY :                      5198 C |  GOFUNC :                      4D9A C |
 GOSUB :                       496A C |  GOTO :                        497B C |
 GRBARY :                      51B6 C |  GRBDON :                      513F C |
 GRBLP :                       5177 C |  GSTRCU :                      525C C |
 GSTRDE :                      5260 C |  GSTRHL :                      525F C |
 GTFLNM :                      529D C |  GTFNAM :                      4E63 C |
 GTLNLP :                      48FA C |  GTSIXD :                      57D7 C |
 GTVLUS :                      4B85 C |  HALF :                        5876 C |
 HALFPI :                      5A2C C | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - |  ID :                            16 - |
 IDTEST :                      5093 C |  IF :                          4A44 C |
 IFGO :                        4A51 C |  IFJMP :                       4838 C |
 INCHL :                       5666 C |  INCLEN :                      46AB C |
 INDFND :                      477F C |  INEWLN :                      4459 C |
*INEXTMODE :                      0 - |  INITAB :                      40D2 C |
*INITBE :                      412E C | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - |  INMSG :                       433F C |
 INP :                         5346 C |  INPBIN :                      4BD2 C |
 INPBRK :                      4897 C |  INPUT :                       4B48 C |
 INRNG :                       57E0 C | *INSRCMODE :                      0 - |
*INSUPMODE :                      0 - |  INT :                         56E1 C |
 INTVAR :                      4642 C |  INVSGN :                      5639 C |
 ITMSEP :                      4BC3 C |  JSTZER :                      5861 C |
 KILFOR :                      4C6E C |  LCRFLG :                      60A8 - |
 LEFT :                        52BA C |  LEN :                         528A C |
 LET :                         49D2 C |  LETNUM :                      4A21 C |
 LETSTR :                      49EC C |  LF :                             A - |
 LFRGNM :                      533C C |  LINEAT :                      6058 - |
 LINEIN :                      5793 C |  LINES :                       46D2 C |
 LINESC :                      6044 - |  LINESN :                      6046 - |
 LINFND :                      4444 C |  LIST :                        46E1 C |
 LISTLP :                      46ED C | *LISTON :                         1 - |
 LOADFP :                      565F C |  LOC_4584 :                    4584 C |
 LOC_4590 :                    4590 C |  LOC_45B1 :                    45B1 C |
 LOC_45BF :                    45BF C |  LOC_45C6 :                    45C6 C |
 LOC_45C9 :                    45C9 C |  LOC_45D4 :                    45D4 C |
 LOC_45EF :                    45EF C |  LOC_45F7 :                    45F7 C |
 LOC_462D :                    462D C |  LOC_471B :                    471B C |
 LOC_471E :                    471E C |  LOC_472B :                    472B C |
 LOC_4732 :                    4732 C |  LOC_4734 :                    4734 C |
 LOC_473C :                    473C C |  LOC_4742 :                    4742 C |
 LOC_474A :                    474A C |  LOC_4830 :                    4830 C |
 LOC_484E :                    484E C |  LOC_5372 :                    5372 C |
 LOC_5AB5 :                    5AB5 C |  LOC_5ABC :                    5ABC C |
 LOC_5AC4 :                    5AC4 C |  LOC_5AD5 :                    5AD5 C |
 LOC_5AE4 :                    5AE4 C |  LOC_5B0E :                    5B0E C |
 LOC_5B2B :                    5B2B C |  LOC_5B33 :                    5B33 C |
 LOC_5B4A :                    5B4A C |  LOC_5B4E :                    5B4E C |
 LOC_5B58 :                    5B58 C |  LOC_5B5E :                    5B5E C |
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 87 - 11/7/2018 12:33:42


 LOC_5B67 :                    5B67 C |  LOC_5B73 :                    5B73 C |
 LOC_5BB6 :                    5BB6 C |  LOC_5BE7 :                    5BE7 C |
 LOC_5BF3 :                    5BF3 C |  LOC_5BF4 :                    5BF4 C |
 LOC_5C08 :                    5C08 C |  LOC_5C16 :                    5C16 C |
 LOC_5C23 :                    5C23 C |  LOC_5C4B :                    5C4B C |
 LOC_5C64 :                    5C64 C |  LOC_5C67 :                    5C67 C |
 LOC_5C72 :                    5C72 C |  LOC_5C86 :                    5C86 C |
 LOC_5C97 :                    5C97 C |  LOC_5CAA :                    5CAA C |
 LOC_5CB2 :                    5CB2 C |  LOC_5CC5 :                    5CC5 C |
 LOC_5F47 :                    5F47 C |  LOC_5F59 :                    5F59 C |
 LOG :                         54D1 C |  LOGTAB :                      54C4 C |
 LOKFOR :                      476A C |  LOOPST :                      60C3 - |
 LS :                            1C - |  LSTBIN :                      60C8 - |
 LSTRAM :                      60AB - |  LSTRND :                      603C - |
 LTSTND :                      4BDD C |  LWIDTH :                      6041 - |
*MACEXP :                         7 - |  MAKINT :                      538B C |
 MAKNUM :                      57FB C |  MANLP :                       5725 C |
 MATCH :                       4543 C |  MEMMSG :                      407A C |
 MID :                         52F2 C |  MID1 :                        52C0 C |
 MIDNUM :                      5341 C |  MINCDE :                      5423 C |
 MINUS :                       4D46 C |  MKTMST :                      50D7 C |
 MLDBLP :                      5702 C |  MLDEBC :                      56FA C |
 MLOOP :                       403D C |  MLSP10 :                      55F9 C |
 MO :                            24 - | *MOMCPU :                        80 - |
*MOMCPUNAME :                   Z80 - |  MONOUT :                      5E26 C |
 MORDT :                       4BE8 C |  MORINP :                      4595 C |
 MOVBUF :                      4478 C |  MOVDIR :                      454B C |
 MOVLP :                       44A6 C |  MOVSTR :                      44A3 C |
 MOVUP :                       44A0 C |  MRPRNT :                      4A63 C |
 MSIZ1 :                       403A C |  MSIZE :                       4021 C |
 MUL8LP :                      553C C |  MULLN2 :                      5509 C |
 MULT :                        5510 C |  MULT8 :                       5534 C |
 MULTEN :                      5760 C |  MULVAL :                      60F2 - |
 MVSTPT :                      4A18 C |  NEDMOR :                      4B81 C |
 NEGAFT :                      588C C | *NESTMAX :                      100 - |
 NEW :                         4632 C |  NEXITM :                      4B0D C |
 NEXT :                        4C34 C |  NEXT1 :                       4C37 C |
 NF :                             0 - |  NFERR :                       4376 C |
 NOCHNG :                      453D C |  NOENED :                      5864 C |
 NOLIN :                       48AC C |  NOMADD :                      554C C |
 NOMLAD :                      570F C |  NOPMPT :                      4B61 C |
 NORMAL :                      544C C |  NOSPC :                       4535 C |
 NOSWAP :                      53FD C |  NOTSTR :                      4E91 C |
 NOXOR :                       536D C |  NSCFOR :                      4EA0 C |
 NULL :                        4B1C C |  NULLP :                       4AD0 C |
 NULLS :                       6040 - |  NUMASC :                      57A6 C |
 NXTARY :                      4F4D C |  NXTBYT :                      4525 C |
 NXTCHR :                      4560 C |  NXTDAT :                      60D8 - |
 NXTDTA :                      49BC C |  NXTITM :                      4B7A C |
 NXTOPR :                      60CC - |  NXTSTL :                      49C3 C |
 NXTSTT :                      49C6 C |  OD :                             6 - |
 OKMSG :                       4344 C |  OM :                             C - |
 OMERR :                       4366 C |  ON :                          4A28 C |
 ONGO :                        4A36 C |  ONGOLP :                      4A37 C |
 ONJMP :                       4839 C |  OPNPAR :                      4C93 C |
 OPRND :                       4D0A C |  OS :                            1A - |
 OTPORT :                      6006 - |  OUTC :                        468E C |
 OUTEXP :                      5856 C |  OV :                             A - |
 OVERR :                       437F C |  OVTST1 :                      55EC C |
 OVTST2 :                      55F1 C |  OVTST3 :                      55F2 C |
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 88 - 11/7/2018 12:33:42


*PACKING :                        0 - |  PADD :                        5783 C |
*PADDING :                        1 - |  PAND :                        4DB4 C |
 PASSA :                       5019 C |  PBUFF :                       60E5 - |
 PCALL :                       5AAA C |  PEEK :                        5399 C |
 PEND :                        4892 C |  PHLTFP :                      564E C |
 PLUCDE :                      5482 C |  PNORM :                       5452 C |
 POINT :                       5D70 C |  POINT1 :                      5D99 C |
 POINT10 :                     5DEB C |  POINT2 :                      5D9E C |
 POINT3 :                      5DAC C |  POINT4 :                      5DBE C |
*POINT5 :                      5DC1 C |  POINT6 :                      5DCD C |
 POINT7 :                      5DD3 C |  POINT8 :                      5DD6 C |
 POINT9 :                      5DE8 C |  POKE :                        53A0 C |
 POPAF :                       46B3 C |  POPHL :                       5277 C |
 POPHRT :                      5558 C |  POPNOK :                      43BA C |
 POR :                         4DB3 C |  POR1 :                        4DD5 C |
 POS :                         5016 C |  POSINT :                      48D3 C |
 POUT :                        534F C |  POWER :                       589A C |
 POWER1 :                      58AA C |  POWER2 :                      58C7 C |
 POWERS :                      587A C |  PRESET :                      5D75 C |
 PRINT :                       4A69 C |  PRITAB :                      42FD C |
 PRNTCRLF :                    4ABF C |  PRNTHL :                      579B C |
 PRNTLP :                      4A6B C |  PRNTNB :                      4AA9 C |
 PRNTOK :                      43BB C |  PRNTST :                      4AAD C |
 PRNUMS :                      5124 C |  PROGND :                      60D2 - |
 PROGST :                      60F6 - |  PROMPT :                      46C5 C |
 PRS :                         5125 C |  PRS1 :                        5128 C |
 PRSLP :                       512F C |  PSET :                        5D72 C |
 PSUB :                        53DF C |  PTRLP :                       4488 C |
 PUTFID :                      47F9 C |  QTSTLP :                      50ED C |
 QTSTR :                       50E7 C |  QUARTR :                      5A30 C |
 READ :                        4B75 C |  READFG :                      60C9 - |
 REDO :                        4B25 C | *RELAXED :                        0 - |
 REM :                         49BF C |  RENUM :                       5AF0 C |
 RESDIV :                      55A4 C |  RESEED :                      59CF C |
 RESTNL :                      487F C |  RESTOR :                      486B C |
 RESZER :                      5447 C |  RETADR :                      4F01 C |
 RETINT :                      5627 C |  RETLIN :                      49B7 C |
 RETNAD :                      4547 C |  RETNUL :                      4F04 C |
 RETNUM :                      4D52 C |  RETREL :                      5619 C |
 RETURN :                      4999 C |  RG :                             4 - |
 RIGHT :                       52E9 C |  RIGHT1 :                      52BE C |
 RINPUT :                      604A - |  RLTLP :                       4CB3 C |
 RND :                         596F C |  RND1 :                        59AB C |
 RND2 :                        59C6 C |  RNDTAB :                      59D6 C |
 RNGTST :                      5867 C |  RONDB :                       5464 C |
 RONDUP :                      5463 C |  ROUND :                       53D3 C |
 RSCALE :                      577D C |  RSTSTR :                      530A C |
 RUN :                         495F C |  RUNCNT :                      47FD C |
 RUNFST :                      463E C |  RUNLIN :                      497A C |
 SAVEXP :                      5448 C |  SAVSTP :                      47F0 C |
 SAVSTR :                      50C2 C |  SBSCPT :                      4F0F C |
 SCALE :                       54A2 C |  SCALLP :                      54A4 C |
 SCALMI :                      574A C |  SCALPL :                      575F C |
 SCNEND :                      51EB C |  SCPTLP :                      4F15 C |
 SCREEN :                      5DEF C |  SCREEN1 :                     5E04 C |
 SCREEN2 :                     5E0D C |  SEARCH :                      4514 C |
 SEED :                        6019 - |  SETIO :                       5379 C |
 SETLIN :                      4741 C |  SETLIT :                      4557 C |
 SETPTR :                      447F C |  SETTOP :                      404C C |
 SFTPRG :                      444B C |  SGN :                         561F C |
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 89 - 11/7/2018 12:33:42


 SGNEXP :                      4DA3 C |  SGNRES :                      60E4 - |
 SHRITE :                      54AF C |  SHRLP :                       54B2 C |
 SHRT1 :                       54B6 C |  SIGNS :                       5674 C |
 SIN :                         59E8 C |  SIN1 :                        5A18 C |
 SINTAB :                      5A34 C |  SIXDIG :                      57C3 C |
 SMPVAR :                      5186 C |  SMSER1 :                      594F C |
 SN :                             2 - |  SNERR :                       4370 C |
 SPCFST :                      57B4 C |  SPCLP :                       4B08 C |
 SQR :                         5891 C |  SRCHLN :                      44B0 C |
 SRCHLP :                      44B3 C |  SSTSA :                       5247 C |
 ST :                            1E - |  STACK :                       6062 - |
 STAKFP :                      5641 C |  STARTB :                      4005 C |
 STKTHS :                      4CF4 C |  STLOOK :                      615B - |
 STOP :                        4890 C |  STORED :                      493C C |
 STPOOL :                      51C2 C |  STR :                         50B2 C |
*STR1 :                        50B8 C |  STRADD :                      51C5 C |
 STRBOT :                      60BF - |  STRENT :                      4BC6 C |
 STRSPC :                      6056 - |  STTLIN :                      4AB3 C |
 SUBCDE :                      53E1 C |  SUBPHL :                      53DB C |
 SUB_4714 :                    4714 C |  SUB_5ABE :                    5ABE C |
 SUB_5C38 :                    5C38 C |  SUB_5C6A :                    5C6A C |
 SUB_5F3E :                    5F3E C |  SUB_5F4E :                    5F4E C |
 SUMLP :                       5958 C |  SUMSER :                      5940 C |
 SUPTLZ :                      583C C |  SVNAM2 :                      4E78 C |
 SVSTAD :                      50E0 C |  TAN :                         5A49 C |
 TESTOS :                      515A C |  TESTR :                       513D C |
*TIME :                    12:33:42 - |  TM :                            18 - |
 TMERR :                       4382 C |  TMPSTR :                      60BB - |
 TMSTPL :                      60AF - |  TMSTPT :                      60AD - |
 TOPOOL :                      52B6 C |  TOSTRA :                      5250 C |
 TRFLAG :                      600A - |  TROFF :                       4761 C |
 TRON :                        4760 C | *TRUE :                           1 - |
 TRYAGN :                      581A C |  TSALP :                       5251 C |
 TSTBRK :                      4885 C |  TSTNUM :                      4C81 C |
 TSTOPL :                      5105 C |  TSTRED :                      4DDA C |
 TSTREM :                      455A C |  TSTSGN :                      5610 C |
 TSTSTR :                      4C82 C |  TTYLIN :                      458D C |
 TYPE :                        60A9 - |  UF :                            22 - |
 UFERR :                       437C C |  UL :                             E - |
 ULERR :                       4994 C |  UNITY :                       54C0 C |
 UNK_604D :                    604D - |  UNK_604E :                    604E - |
 UNK_6050 :                    6050 - |  UNK_6052 :                    6052 - |
 UNK_6054 :                    6054 - |  UNK_60A6 :                    60A6 - |
*UNK_60DE :                    60DE - |  UPDATA :                      4880 C |
 USR :                         6003 - |  VAL :                         5321 C |
 VAREND :                      60D4 - | *VERSION :                     142F - |
 WAIT :                        535A C | *WARM :                        4003 C |
 WARMST :                      4071 C |  WIDTH :                       4B14 C |
 WORDS :                       412E C |  WORDTB :                      426D C |
 WRKSPC :                      6000 - |  ZDATA :                         83 - |
*ZDIV :                          AF - |  ZEND :                          80 - |
 ZEQUAL :                        B4 - |  ZERARY :                      4FA8 C |
 ZERBYT :                      4343 - |  ZEROLP :                      4EF4 C |
 ZFN :                           A7 - |  ZFOR :                          81 - |
 ZGOSUB :                        8C - |  ZGOTO :                         88 - |
 ZGTR :                          B3 - | *ZLEFT :                         CF - |
 ZLTH :                          B5 - |  ZMINUS :                        AD - |
 ZNEW :                          A4 - |  ZNOT :                          AA - |
 ZONELP :                      4AE7 C |  ZOR :                           B2 - |
 ZPLUS :                         AC - | *ZPOINT :                        C7 - |
 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 90 - 11/7/2018 12:33:42


 ZPRINT :                        9E - |  ZREM :                          8E - |
 ZSGN :                          B6 - |  ZSPC :                          A8 - |
 ZSTEP :                         AB - |  ZTAB :                          A5 - |
 ZTHEN :                         A9 - | *ZTIMES :                        AE - |
 ZTO :                           A6 - |

    723 symbols
     49 unused symbols

 AS V1.42 Beta [Bld 116] - source file basic-as.asm - page 91 - 11/7/2018 12:33:42


  codepages:
  ----------

STANDARD (0 changed characters)


0.05 seconds assembly time

   4957 lines source file
      2 passes
      0 errors
      0 warnings
